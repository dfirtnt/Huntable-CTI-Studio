Filename,Excerpts of Supporting Language from DFIR Report Blog Article,LogSource and Detection Sections of SIGMA Rule
proc_creation_win_hktl_cobaltstrike_load_by_rundll32.yml,"**Cobalt Strike Rundll32:** ""C:\Windows\system32\cmd.exe /C rundll32 C:\Windows\system32\SQL.dll, StartW"" **DLL Execution:** ""rundll32 C:\PerfLogs\arti64.dll, rundll"" and ""rundll32 C:\PerfLogs\socks64.dll, rundll"" **StartW Function:** Rundll32 can be used by Cobalt Strike with StartW function to load DLLs from the command line","logsource:
    category: process_creation
    product: windows
detection:
    selection_rundll:
        - Image|endswith: '\rundll32.exe'
        - OriginalFileName: RUNDLL32.EXE
        - CommandLine|contains:
              - 'rundll32.exe'
              - 'rundll32 '
    selection_params:
        CommandLine|contains: '.dll'
        CommandLine|endswith:
            - ' StartW'
            - ',StartW'
    condition: all of selection*"
proc_creation_win_hktl_cobaltstrike_process_patterns.yml,"**Named Pipes:** ""Commonly uses named pipes with prefixes like \\postex_*, \\status_*, \\msagent_*"" **Rundll32 Patterns:** ""Often uses rundll32.exe to inject malicious code, with command line events showing rundll32.exe without arguments"" **Conhost Patterns:** ""Watch for suspicious rundll32.exe network connections"" **Pipe Redirection:** Monitor Sysmon Event IDs 17 and 18 for named pipes","logsource:
    category: process_creation
    product: windows
detection:
    selection_generic_1:
        CommandLine|endswith: 'cmd.exe /C whoami'
        ParentImage|startswith: 'C:\Temp\'
    selection_generic_2:
        ParentImage|endswith:
            - '\runonce.exe'
            - '\dllhost.exe'
        CommandLine|contains|all:
            - 'cmd.exe /c echo'
            - '> \\\\.\\pipe'
    selection_conhost_1:
        ParentCommandLine|contains|all:
            - 'cmd.exe /C echo'
            - ' > \\\\.\\pipe'
        CommandLine|endswith: 'conhost.exe 0xffffffff -ForceV1'
    selection_conhost_2:
        ParentCommandLine|endswith: '/C whoami'
        CommandLine|endswith: 'conhost.exe 0xffffffff -ForceV1'
    condition: 1 of selection_*"
proc_creation_win_hktl_inveigh.yml,"**Domain Controller Usage:** ""Inveigh was run on a domain controller during this PYSA/Mespinoza ransomware intrusion"" **Credential Access:** ""Used for network reconnaissance or credential harvesting purposes"" **Network MITM:** Cross-platform .NET IPv4/IPv6 machine-in-the-middle tool","logsource:
    category: process_creation
    product: windows
detection:
    selection:
        - Image|endswith: '\Inveigh.exe'
        - OriginalFileName:
              - '\Inveigh.exe'
              - '\Inveigh.dll'
        - Description: 'Inveigh'
        - CommandLine|contains:
              - ' -SpooferIP'
              - ' -ReplyToIPs '
              - ' -ReplyToDomains '
              - ' -ReplyToMACs '
              - ' -SnifferIP'
    condition: selection"
proc_creation_win_hktl_lazagne.yml,"**Comprehensive Password Dump:** ""LaZagne was used with the '-all' switch to comprehensively extract passwords"" **Command:** ""ls.exe all -oN -output C:\Users\REDACTED"" **Multiple Sources:** ""The tool can dump passwords from Browsers, LSA secrets, System hashes, Keepass, WinSCP, RDP Manager, OpenVPN, Git"" **Admin Privileges:** ""When run with admin privileges, LaZagne attempts to dump credentials from local registry hives""","logsource:
    product: windows
    category: process_creation
detection:
    selection_metadata:
        - Image|endswith: '\lazagne.exe'
        - Hashes|contains:
              - 'IMPHASH=ba5546933531fafa869b1f86a4e2a959'
              - 'IMPHASH=7aa1951517b3b8d38b12f874b66196c9'
              - 'IMPHASH=be10bb45cef8dcc6869b921dd20884ae'
              - 'IMPHASH=4e3e7ce958acceeb80e70eeb7d75870e'
              - 'IMPHASH=fc40519af20116c903e3ff836e366e39'
              - 'IMPHASH=1975641ebd67bc0f49282a7b8555b7b2'
              - 'IMPHASH=468ad8de9dcf3ce7a0becc5916ec6adb'
              - 'IMPHASH=e5d81cf6a49d9472d6de8c1764efdfb4'
              - 'IMPHASH=b87afca7a1175b7eb49b7c1eb6d58adf'
    selection_img_cli:
        Image|contains:
            - ':\PerfLogs\'
            - ':\ProgramData\'
            - ':\Temp\'
            - ':\Tmp\'
            - ':\Users\Public\'
            - ':\Windows\Temp\'
            - '\$Recycle.bin'
            - '\AppData\'
            - '\Desktop\'
            - '\Downloads\'
            - '\Favorites\'
            - '\Links\'
            - '\Music\'
            - '\Photos\'
            - '\Pictures\'
            - '\Saved Games\'
            - '\Searches\'
            - '\Users\Contacts\'
            - '\Users\Default\'
            - '\Users\Searches\'
            - '\Videos\'
            - '\Windows\addins\'
            - '\Windows\Fonts\'
            - '\Windows\IME\'
        CommandLine|endswith:
            - '.exe all'
            - '.exe browsers'
            - '.exe chats'
            - '.exe databases'
            - '.exe games'
            - '.exe git'
            - '.exe mails'
            - '.exe maven'
            - '.exe memory'
            - '.exe multimedia'
            - '.exe sysadmin'
            - '.exe unused'
            - '.exe wifi'
            - '.exe windows'
    selection_cli_modules:
        CommandLine|contains:
            - 'all '
            - 'browsers '
            - 'chats '
            - 'databases '
            - 'games '
            - 'mails '
            - 'maven '
            - 'memory '
            - 'multimedia '
            - 'php '
            - 'svn '
            - 'sysadmin '
            - 'unused '
            - 'wifi '
    selection_cli_options:
        CommandLine|contains:
            - '-1Password'
            - '-apachedirectorystudio'
            - '-autologon'
            - '-ChromiumBased'
            - '-coreftp'
            - '-credfiles'
            - '-credman'
            - '-cyberduck'
            - '-dbvis'
            - '-EyeCon'
            - '-filezilla'
            - '-filezillaserver'
            - '-ftpnavigator'
            - '-galconfusion'
            - '-gitforwindows'
            - '-hashdump'
            - '-iisapppool'
            - '-IISCentralCertP'
            - '-kalypsomedia'
            - '-keepass'
            - '-keepassconfig'
            - '-lsa_secrets'
            - '-mavenrepositories'
            - '-memory_dump'
            - '-Mozilla'
            - '-mRemoteNG'
            - '-mscache'
            - '-opensshforwindows'
            - '-openvpn'
            - '-outlook'
            - '-pidgin'
            - '-postgresql'
            - '-psi-im'
            - '-puttycm'
            - '-pypykatz'
            - '-Rclone'
            - '-rdpmanager'
            - '-robomongo'
            - '-roguestale'
            - '-skype'
            - '-SQLDeveloper'
            - '-squirrel'
            - '-tortoise'
            - '-turba'
            - '-UCBrowser'
            - '-unattended'
            - '-vault'
            - '-vaultfiles'
            - '-vnc'
            - '-winscp'
    condition: selection_metadata or selection_img_cli or all of selection_cli_*"
proc_creation_win_hktl_powertool.yml,"**Process and Driver Termination:** ""PowerTool which has the ability to kill a process, delete its process file, unload drivers, and delete the driver files"" **Defense Evasion:** Used to disable security tools and remove their files from the system","logsource:
    product: windows
    category: process_creation
detection:
    selection:
        - Image|endswith:
              - '\PowerTool.exe'
              - '\PowerTool64.exe'
        - OriginalFileName: 'PowerTool.exe'
    condition: selection"
proc_creation_win_imagingdevices_unusual_parents.yml,"**Bumblebee Activity:** ""Detects unusual parent or children of the ImagingDevices.exe (Windows Contacts) process as seen being used with Bumblebee activity"" **Process Injection:** Used as an injection target by Bumblebee malware **Unusual Parents:** Suspicious when spawned by WmiPrvSE.exe, svchost.exe, or dllhost.exe","logsource:
    category: process_creation
    product: windows
detection:
    selection_parent:
        ParentImage|endswith:
            - \WmiPrvSE.exe
            - \svchost.exe
            - \dllhost.exe
        Image|endswith: '\ImagingDevices.exe'
    selection_child:
        ParentImage|endswith: '\ImagingDevices.exe'
    condition: 1 of selection_*"
proc_creation_win_lolbins_by_office_applications.yml,"**Macro Execution:** ""Initial execution of the document writes a file to: C:\Users\Public\microsoft.security"" **LOLBin Usage:** ""wmic.exe process call create 'regsvr32 -s C:\Users\Public\microsoft.security'"" **Office Spawning:** regsvr32 being used as a LOLBin after an Office document macro execution","logsource:
    product: windows
    category: process_creation
detection:
    selection:
        Image|endswith:
            - '\regsvr32.exe'
            - '\rundll32.exe'
            - '\msiexec.exe'
            - '\mshta.exe'
            - '\verclsid.exe'
            - '\msdt.exe'
            - '\control.exe'
            - '\msidb.exe'
        ParentImage|endswith:
            - '\winword.exe'
            - '\excel.exe'
            - '\powerpnt.exe'
            - '\msaccess.exe'
            - '\mspub.exe'
            - '\eqnedt32.exe'
            - '\visio.exe'
            - '\wordpad.exe'
            - '\wordview.exe'
    condition: selection"
proc_creation_win_malware_icedid_rundll32_dllregisterserver.yml,"**Single Digit DLL:** ""rundll32.exe c:\windows\temp\1.dll, DllRegisterServer"" **IcedID Pattern:** ""The rundll32.exe was first copied to %temp%\entails.exe"" **DllRegisterServer Export:** ""The malicious DLL (templates544.png) was executed with a randomized filename"" **Evasion Technique:** ""This was likely to evade detection logic based around command line execution""","logsource:
    category: process_creation
    product: windows
detection:
    selection:
        Image|endswith: '\rundll32.exe'
        CommandLine|endswith:
            - '\1.dll, DllRegisterServer'
            - ' 1.dll, DllRegisterServer'
    condition: selection"
proc_creation_win_mofcomp_execution.yml,"**MOF Script Installation:** ""Attackers abuse this utility to install malicious MOF scripts"" **WMI Repository:** ""The mofcomp utility parses a file containing MOF statements and adds the classes and class instances defined in the file to the WMI repository"" **Suspicious Paths:** CommandLine contains suspicious paths like AppData\Local\Temp, Users\Public, WINDOWS\Temp","logsource:
    category: process_creation
    product: windows
detection:
    selection_img:
        - Image|endswith: '\mofcomp.exe'
        - OriginalFileName: 'mofcomp.exe'
    selection_case:
        - ParentImage|endswith:
              - '\cmd.exe'
              - '\powershell.exe'
              - '\pwsh.exe'
              - '\wsl.exe'
              - '\wscript.exe'
              - '\cscript.exe'
        - CommandLine|contains:
              - '\AppData\Local\Temp'
              - '\Users\Public\'
              - '\WINDOWS\Temp\'
              - '%temp%'
              - '%tmp%'
              - '%appdata%'
    filter_main_wmiprvse:
        ParentImage: 'C:\Windows\System32\wbem\WmiPrvSE.exe'
        CommandLine|contains: 'C:\Windows\TEMP\'
        CommandLine|endswith: '.mof'
    filter_optional_null_parent:
        CommandLine|contains: 'C:\Windows\TEMP\'
        CommandLine|endswith: '.mof'
    condition: all of selection_* and not 1 of filter_main_* and not 1 of filter_optional_*"
proc_creation_win_net_groups_and_accounts_recon.yml,"**Domain Group Discovery:** ""net group 'Domain admins' /DOMAIN"" **Enterprise Admins:** ""net group 'enterprise admins' /domain"" **Administrator Account:** ""net user administrator /domain"" **Lateral Movement:** Used for reconnaissance before lateral movement and privilege escalation","logsource:
    category: process_creation
    product: windows
detection:
    selection_img:
        - Image|endswith:
              - '\net.exe'
              - '\net1.exe'
        - OriginalFileName:
              - 'net.exe'
              - 'net1.exe'
    selection_group_root:
        CommandLine|contains:
            - ' group '
            - ' localgroup '
    selection_group_flags:
        CommandLine|contains:
            - 'domain admins'
            - ' administrator'
            - ' administrateur'
            - 'enterprise admins'
            - 'Exchange Trusted Subsystem'
            - 'Remote Desktop Users'
            - 'Utilisateurs du Bureau Ã  distance'
            - 'Usuarios de escritorio remoto'
            - ' /do'
    filter_group_add:
        CommandLine|contains: ' /add'
    selection_accounts_root:
        CommandLine|contains: ' accounts '
    selection_accounts_flags:
        CommandLine|contains: ' /do'
    condition: selection_img and ((all of selection_group_* and not filter_group_add) or all of selection_accounts_*)"