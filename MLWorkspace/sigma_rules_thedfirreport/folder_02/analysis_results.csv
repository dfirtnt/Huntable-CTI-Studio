Filename,Excerpts of Supporting Language from DFIR Report Blog Article,LogSource and Detection Sections of SIGMA Rule
image_load_malware_csharp_streamer_dotnet_load.yml,"**CSharp Streamer RAT Detection:** ""When executed, the tool writes a .NET executable to the %USERPROFILE%\\AppData\\Local\\Temp folder using a .tmp extension and then loads it into memory"" **File Path Pattern:** ""%USERPROFILE%\\AppData\\Local\\Temp"" with "".tmp"" extension **Specific Naming:** ""dat[0-9A-Z]{4}.tmp""","logsource:
    category: image_load
    product: windows
detection:
    selection:
        ImageLoaded|re: '\\AppData\\Local\\Temp\\dat[0-9A-Z]{4}\.tmp'
    condition: selection"
image_load_side_load_python.yml,"**Python DLL Sideloading:** ""A legitimate Python executable (setup.exe) was used to load a hidden, modified python311.dll"" **DLL Modification:** ""The modified DLL was designed to remove hooks from Windows API functions"" **Defense Evasion:** ""Implemented defense evasion techniques like obfuscating the payload in memory and bypassing AMSI, WLDP, and ETW""","logsource:
    category: image_load
    product: windows
detection:
    selection:
        ImageLoaded|endswith:
            - '\python39.dll'
            - '\python310.dll'
            - '\python311.dll'
            - '\python312.dll'
    filter_main_default_install_paths:
        - ImageLoaded|startswith:
              - 'C:\Program Files\Python3'
              - 'C:\Program Files (x86)\Python3'
        - ImageLoaded|contains: '\AppData\Local\Programs\Python\Python3'
    filter_optional_visual_studio:
        ImageLoaded|startswith: 'C:\Program Files\Microsoft Visual Studio\'
    filter_optional_cpython:
        ImageLoaded|contains:
            - '\cpython\externals\'
            - '\cpython\PCbuild\'
    filter_main_legit_signature_details:
        Product: 'Python'
        Signed: 'true'
        Description: 'Python'
        Company: 'Python Software Foundation'
    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*"
net_connection_win_domain_external_ip_lookup.yml,"**External IP Lookup:** ""icanhazip.tacticalrmm.io was used during the execution of Tactical RMM Agent"" **Purpose:** ""This domain was part of the remote management software's infrastructure for retrieving the current public IP address""","logsource:
    category: network_connection
    product: windows
detection:
    selection:
        - DestinationHostname:
              - 'www.ip.cn'
              - 'l2.io'
        - DestinationHostname|contains:
              - 'api.2ip.ua'
              - 'api.bigdatacloud.net'
              - 'api.ipify.org'
              - 'bot.whatismyipaddress.com'
              - 'canireachthe.net'
              - 'checkip.amazonaws.com'
              - 'checkip.dyndns.org'
              - 'curlmyip.com'
              - 'db-ip.com'
              - 'edns.ip-api.com'
              - 'eth0.me'
              - 'freegeoip.app'
              - 'geoipy.com'
              - 'getip.pro'
              - 'icanhazip.com'
              - 'ident.me'
              - 'ifconfig.io'
              - 'ifconfig.me'
              - 'ip-api.com'
              - 'ip.360.cn'
              - 'ip.anysrc.net'
              - 'ip.taobao.com'
              - 'ip.tyk.nu'
              - 'ipaddressworld.com'
              - 'ipapi.co'
              - 'ipconfig.io'
              - 'ipecho.net'
              - 'ipinfo.io'
              - 'ipip.net'
              - 'ipof.in'
              - 'ipv4.icanhazip.com'
              - 'ipv4bot.whatismyipaddress.com'
              - 'ipv6-test.com'
              - 'ipwho.is'
              - 'jsonip.com'
              - 'myexternalip.com'
              - 'seeip.org'
              - 'wgetip.com'
              - 'whatismyip.akamai.com'
              - 'whois.pconline.com.cn'
              - 'wtfismyip.com'
    filter_optional_brave:
        Image|endswith: '\brave.exe'
    filter_optional_chrome:
        Image:
            - 'C:\Program Files\Google\Chrome\Application\chrome.exe'
            - 'C:\Program Files (x86)\Google\Chrome\Application\chrome.exe'
    filter_optional_firefox:
        Image:
            - 'C:\Program Files\Mozilla Firefox\firefox.exe'
            - 'C:\Program Files (x86)\Mozilla Firefox\firefox.exe'
    filter_optional_ie:
        Image:
            - 'C:\Program Files (x86)\Internet Explorer\iexplore.exe'
            - 'C:\Program Files\Internet Explorer\iexplore.exe'
    filter_optional_maxthon:
        Image|endswith: '\maxthon.exe'
    filter_optional_edge_1:
        - Image|startswith: 'C:\Program Files (x86)\Microsoft\EdgeWebView\Application\'
        - Image|endswith: '\WindowsApps\MicrosoftEdge.exe'
        - Image:
              - 'C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe'
              - 'C:\Program Files\Microsoft\Edge\Application\msedge.exe'
    filter_optional_edge_2:
        Image|startswith:
            - 'C:\Program Files (x86)\Microsoft\EdgeCore\'
            - 'C:\Program Files\Microsoft\EdgeCore\'
        Image|endswith:
            - '\msedge.exe'
            - '\msedgewebview2.exe'
    filter_optional_opera:
        Image|endswith: '\opera.exe'
    filter_optional_safari:
        Image|endswith: '\safari.exe'
    filter_optional_seamonkey:
        Image|endswith: '\seamonkey.exe'
    filter_optional_vivaldi:
        Image|endswith: '\vivaldi.exe'
    filter_optional_whale:
        Image|endswith: '\whale.exe'
    condition: selection and not 1 of filter_optional_*"
pipe_created_susp_malicious_namedpipes.yml,"**Named Pipe Communication:** ""The presence of logs indicating the use of 'named pipe services' also increases the likelihood of Meterpreter or possibly Cobaltstrike"" **Qbot Named Pipe:** ""Named pipe 'dce_3d' was used for communication"" (from Qbot article)","logsource:
    product: windows
    category: pipe_created
    definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575'
detection:
    selection:
        PipeName:
            - '\46a676ab7f179e511e30dd2dc41bd388'
            - '\583da945-62af-10e8-4902-a8f205c72b2e'
            - '\6e7645c4-32c5-4fe3-aabf-e94c2f4370e7'
            - '\9f81f59bc58452127884ce513865ed20'
            - '\adschemerpc'
            - '\ahexec'
            - '\AnonymousPipe'
            - '\bc31a7'
            - '\bc367'
            - '\bizkaz'
            - '\csexecsvc'
            - '\dce_3d'
            - '\e710f28d59aa529d6792ca6ff0ca1b34'
            - '\gruntsvc'
            - '\isapi_dg'
            - '\isapi_dg2'
            - '\isapi_http'
            - '\jaccdpqnvbrrxlaf'
            - '\lsassw'
            - '\NamePipe_MoreWindows'
            - '\pcheap_reuse'
            - '\Posh*'
            - '\rpchlp_3'
            - '\sdlrpc'
            - '\svcctl'
            - '\testPipe'
            - '\winsession'
    condition: selection"
posh_pm_susp_reset_computermachinepassword.yml,"**Domain Compromise:** ""Exploited Zerologon vulnerability (CVE-2020-1472) to obtain domain admin privileges"" **Password Reset:** ""Used an executable named 'cool.exe' to reset domain controller password"" **PowerShell Usage:** Reset-ComputerMachinePassword cmdlet used to change computer account password for domain authentication","logsource:
    product: windows
    category: ps_module
    definition: 0ad03ef1-f21b-4a79-8ce8-e6900c54b65b
detection:
    selection:
        ContextInfo|contains: 'Reset-ComputerMachinePassword'
    condition: selection"
posh_ps_powerview_malicious_commandlets.yml,"**PowerView Reconnaissance:** ""Get-NetSubnet"" and ""Get-NetComputer -operatingsystem *server*"" **Local Admin Discovery:** ""Invoke-CheckLocalAdminAccess"" and ""Find-LocalAdminAccess"" **Domain Enumeration:** ""Import-Module ActiveDirectory; Get-ADComputer -Filter {enabled -eq $true} -properties *""","logsource:
    product: windows
    category: ps_script
    definition: 'Requirements: Script Block Logging must be enabled'
detection:
    selection:
        ScriptBlockText|contains:
            - 'Export-PowerViewCSV'
            - 'Find-DomainLocalGroupMember'
            - 'Find-DomainObjectPropertyOutlier'
            - 'Find-DomainProcess'
            - 'Find-DomainShare'
            - 'Find-DomainUserEvent'
            - 'Find-DomainUserLocation'
            - 'Find-ForeignGroup'
            - 'Find-ForeignUser'
            - 'Find-GPOComputerAdmin'
            - 'Find-GPOLocation'
            - 'Find-InterestingDomain'
            - 'Find-InterestingFile'
            - 'Find-LocalAdminAccess'
            - 'Find-ManagedSecurityGroups'
            - 'Get-CachedRDPConnection'
            - 'Get-DFSshare'
            - 'Get-DomainDFSShare'
            - 'Get-DomainDNSRecord'
            - 'Get-DomainDNSZone'
            - 'Get-DomainFileServer'
            - 'Get-DomainGPOComputerLocalGroupMapping'
            - 'Get-DomainGPOLocalGroup'
            - 'Get-DomainGPOUserLocalGroupMapping'
            - 'Get-LastLoggedOn'
            - 'Get-LoggedOnLocal'
            - 'Get-NetFileServer'
            - 'Get-NetForest'
            - 'Get-NetGPOGroup'
            - 'Get-NetProcess'
            - 'Get-NetRDPSession'
            - 'Get-RegistryMountedDrive'
            - 'Get-RegLoggedOn'
            - 'Get-WMIRegCachedRDPConnection'
            - 'Get-WMIRegLastLoggedOn'
            - 'Get-WMIRegMountedDrive'
            - 'Get-WMIRegProxy'
            - 'Invoke-ACLScanner'
            - 'Invoke-CheckLocalAdminAccess'
            - 'Invoke-EnumerateLocalAdmin'
            - 'Invoke-EventHunter'
            - 'Invoke-FileFinder'
            - 'Invoke-Kerberoast'
            - 'Invoke-MapDomainTrust'
            - 'Invoke-ProcessHunter'
            - 'Invoke-RevertToSelf'
            - 'Invoke-ShareFinder'
            - 'Invoke-UserHunter'
            - 'Invoke-UserImpersonation'
            - 'Remove-RemoteConnection'
            - 'Request-SPNTicket'
            - 'Resolve-IPAddress'
    condition: selection"
proc_creation_win_7zip_exfil_dmp_files.yml,"**7zip Compression:** ""They copied the LSASS dump file from a remote workstation"" **Command Used:** ""C:\Windows\system32\cmd.exe /C 7za.exe a -tzip -mx5 c:\programdata\lsass.zip c:\programdata\lsass.dmp"" **Credential Access:** ""The compression was likely preparation for potential exfiltration""","logsource:
    category: process_creation
    product: windows
detection:
    selection_img:
        - Description|contains: '7-Zip'
        - Image|endswith:
              - '\7z.exe'
              - '\7zr.exe'
              - '\7za.exe'
        - OriginalFileName:
              - '7z.exe'
              - '7za.exe'
    selection_extension:
        CommandLine|contains:
            - '.dmp'
            - '.dump'
            - '.hdmp'
    condition: all of selection_*"
proc_creation_win_chcp_codepage_lookup.yml,"**Host Discovery:** ""The threat actors used the 'chcp' command as a discovery technique to determine the system's language and locale"" **Command:** ""cmd.exe /c chcp >&2"" **Purpose:** ""Establishing the country of origin based on the language used"" **Motivation:** ""A fail-safe check to ensure certain users or regions were not targeted""","logsource:
    category: process_creation
    product: windows
detection:
    selection:
        ParentImage|endswith: '\cmd.exe'
        ParentCommandLine|windash|contains:
            - ' -c '
            - ' -r '
            - ' -k '
        Image|endswith: '\chcp.com'
        CommandLine|endswith:
            - 'chcp'
            - 'chcp '
            - 'chcp  '
    condition: selection"
proc_creation_win_cmd_copy_dmp_from_share.yml,"**Remote Dump Copy:** ""They copied the LSASS dump file from a remote workstation"" **Command:** ""C:\Windows\system32\cmd.exe /C copy \\<REMOTE_WORKSTATION>\C$\ProgramData\lsass.dmp c:\programdata\lsass.dmp"" **Credential Access:** ""LSASS Memory - T1003.001""","logsource:
    category: process_creation
    product: windows
detection:
    selection_img:
        - Image|endswith: '\cmd.exe'
        - OriginalFileName: 'Cmd.Exe'
    selection_cli:
        CommandLine|contains|all:
            - 'copy '
            - ' \\\\'
        CommandLine|contains:
            - '.dmp'
            - '.dump'
            - '.hdmp'
    condition: all of selection_*"
proc_creation_win_cmd_redirection_susp_folder.yml,"**Output Redirection:** ""The threat actors were able to write multiple commands to a batch file by using echo and redirecting the strings to a file named 1.bat"" **File Creation:** ""After they finished writing to that file, they ran certutil to decode the base64 data into an executable file"" **Obfuscation:** Used redirection to create encoded files and batch scripts","logsource:
    category: process_creation
    product: windows
detection:
    selection_img:
        - Image|endswith: '\cmd.exe'
        - OriginalFileName: 'Cmd.Exe'
    selection_cli_1:
        CommandLine|contains:
            - '>?%APPDATA%\'
            - '>?%TEMP%\'
            - '>?%TMP%\'
            - '>?%USERPROFILE%\'
            - '>?C:\ProgramData\'
            - '>?C:\Temp\'
            - '>?C:\Users\Public\'
            - '>?C:\Windows\Temp\'
    selection_cli_2:
        CommandLine|contains:
            - ' >'
            - '">'
            - "'>"
        CommandLine|contains|all:
            - 'C:\Users\'
            - '\AppData\Local\'
    condition: selection_img and 1 of selection_cli_*"