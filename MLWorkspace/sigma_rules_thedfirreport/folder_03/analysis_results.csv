Filename,Excerpts of Supporting Language from DFIR Report Blog Article,LogSource and Detection Sections of SIGMA Rule
proc_creation_win_conhost_legacy_option.yml,"**ForceV1 Legacy Option:** ""ForceV1 asks for information directly from the kernel space. Conhost connects to the console application"" **High Integrity:** ""High IntegrityLevel means the process is running with elevated privileges, such as an Administrator context""","logsource:
    product: windows
    category: process_creation
detection:
    selection:
        IntegrityLevel:
            - 'High'
            - 'S-1-16-12288'
        CommandLine|contains|all:
            - 'conhost.exe'
            - '0xffffffff'
            - '-ForceV1'
    condition: selection"
proc_creation_win_defender_default_action_modified.yml,"**Defender Disabling:** ""The attackers used three batch scripts (fed1.bat, fed2.bat, fed3.bat) to systematically disable Windows Defender"" **Registry Modifications:** ""reg add 'HKLM\Software\Policies\Microsoft\Windows Defender' /v 'DisableAntiSpyware' /t REG_DWORD /d '1' /f"" **Defense Evasion:** ""Disabling real-time monitoring, stopping Defender services, removing context menu handlers""","logsource:
    category: process_creation
    product: windows
detection:
    selection_cmdlet:
        CommandLine|contains: 'Set-MpPreference'
    selection_action:
        CommandLine|contains:
            - '-LowThreatDefaultAction'
            - '-ModerateThreatDefaultAction'
            - '-HighThreatDefaultAction'
            - '-SevereThreatDefaultAction'
            - '-ltdefac '
            - '-mtdefac '
            - '-htdefac '
            - '-stdefac '
    selection_value:
        CommandLine|contains:
            - 'Allow'
            - '6'
            - 'NoAction'
            - '9'
    condition: all of selection_*"
proc_creation_win_defender_remove_context_menu.yml,"**Context Menu Removal:** ""Removing context menu handlers"" as part of systematic Windows Defender disabling **Registry Modification:** ""Registry modifications to turn off Defender features"" **Defense Evasion:** ""Disabling Windows Defender Security Center, removing Defender from startup and system tray""","logsource:
    category: process_creation
    product: windows
detection:
    selection_img:
        - Image|endswith:
              - '\powershell_ise.exe'
              - '\powershell.exe'
              - '\pwsh.exe'
              - '\reg.exe'
        - OriginalFileName:
              - 'powershell_ise.EXE'
              - 'PowerShell.EXE'
              - 'pwsh.dll'
              - 'reg.exe'
    selection_action:
        CommandLine|contains:
            - 'del'
            - 'Remove-Item'
            - 'ri '
    selection_reg_path:
        CommandLine|contains: '\shellex\ContextMenuHandlers\EPP'
    condition: all of selection_*"
proc_creation_win_driverquery_recon.yml,"**Ursnif Reconnaissance:** ""driverquery.exe was used by Ursnif malware as part of its automated discovery commands"" **Output Redirection:** ""The malware executed 'driverquery.exe' and redirected its output to a temporary file named 'BD2C.bin1' in the user's local temp directory"" **System Discovery:** ""Part of a broader set of discovery commands that included systeminfo, net view, tasklist, and other system enumeration utilities""","logsource:
    category: process_creation
    product: windows
detection:
    selection_img:
        - Image|endswith: 'driverquery.exe'
        - OriginalFileName: 'drvqry.exe'
    selection_parent:
        - ParentImage|endswith:
              - '\cscript.exe'
              - '\mshta.exe'
              - '\regsvr32.exe'
              - '\rundll32.exe'
              - '\wscript.exe'
        - ParentImage|contains:
              - '\AppData\Local\'
              - '\Users\Public\'
              - '\Windows\Temp\'
    condition: all of selection_*"
proc_creation_win_driverquery_usage.yml,"**Driver Reconnaissance:** ""driverquery.exe was used by Ursnif malware as part of its automated discovery commands"" **System Information Gathering:** ""Part of a series of discovery commands aimed at gathering system information, which is consistent with the malware's reconnaissance techniques"" **Automated Discovery:** ""Demonstrating the malware's systematic approach to gathering information about the infected system""","logsource:
    category: process_creation
    product: windows
detection:
    selection:
        - Image|endswith: 'driverquery.exe'
        - OriginalFileName: 'drvqry.exe'
    filter_main_other:
        - ParentImage|endswith:
              - '\cscript.exe'
              - '\mshta.exe'
              - '\regsvr32.exe'
              - '\rundll32.exe'
              - '\wscript.exe'
        - ParentImage|contains:
              - '\AppData\Local\'
              - '\Users\Public\'
              - '\Windows\Temp\'
    condition: selection and not 1 of filter_main_*"
proc_creation_win_esentutl_params.yml,"**Credential Gathering:** ""Trickbot used esentutl to gather credential-related data"" **Browser Data Access:** ""Accessing MSEdge history, webcache, and saved passwords"" **Conti Recommendation:** ""Conti recommendation to its affiliates to use esentutl to access NTDS dumped file"" **pwgrab Module:** ""Used as part of the 'pwgrab' module for credential theft""","logsource:
    category: process_creation
    product: windows
detection:
    selection:
        CommandLine|contains|all:
            - 'esentutl'
            - ' /p'
    condition: selection"
proc_creation_win_esentutl_webcache.yml,"**Browser Data Theft:** ""Qbot used the built-in Windows utility esentutl.exe to collect browser data from Internet Explorer and Microsoft Edge"" **WebCache Targeting:** ""esentutl.exe /r V01 /l'C:\Users\[REDACTED]\AppData\Local\Microsoft\Windows\WebCache'"" **Data Collection:** ""This technique allows Qbot to access and exfiltrate browser-related data, which is part of its broader data collection strategy""","logsource:
    category: process_creation
    product: windows
detection:
    selection_img:
        - Image|endswith: '\esentutl.exe'
        - OriginalFileName: 'esentutl.exe'
    selection_flag:
        CommandLine|windash|contains: '-r'
    selection_webcache:
        CommandLine|contains: '\Windows\WebCache'
    condition: all of selection*"
proc_creation_win_exploit_cve_2020_1472_zero_poc.yml,"**ZeroLogon PoC:** ""The threat actors used a custom implementation of the Zerologon (CVE-2020-1472) exploit via an executable named 'zero.exe'"" **Command Format:** ""zero.exe 10.10.10.10 DomainControllerHostName domain.name administrator -c 'powershell.exe'"" **Domain Admin Hash:** ""Purpose: Retrieve the NTLM hash of a Domain Administrator account""","logsource:
    product: windows
    category: process_creation
detection:
    selection_main:
        ParentImage|endswith: '\cmd.exe'
        Image|endswith:
            - '\cool.exe'
            - '\zero.exe'
        CommandLine|contains|all:
            - 'Administrator'
            - '-c'
    selection_payloads_1:
        CommandLine|contains|all:
            - 'taskkill'
            - '/f'
            - '/im'
    selection_payloads_2:
        CommandLine|contains: 'powershell'
    condition: selection_main and 1 of selection_payloads_*"
proc_creation_win_hktl_cobaltstrike_bloopers_cmd.yml,"**Operator Mistakes:** ""The threat actors typed 'av_query' into the Windows command prompt, which was not a valid command"" **Command Bloopers:** ""This was likely meant to be a Cobalt Strike aggressor script command for identifying antivirus"" **Accidental Entry:** ""Operators accidentally enter Cobalt Strike-specific commands directly into the host shell, instead of the Cobalt Strike console""","logsource:
    category: process_creation
    product: windows
detection:
    selection_img:
        - OriginalFileName: 'Cmd.Exe'
        - Image|endswith: '\cmd.exe'
    selection_cli:
        CommandLine|startswith:
            - 'cmd '
            - 'cmd.exe'
            - 'c:\windows\system32\cmd.exe'
        CommandLine|contains:
            - 'psinject'
            - 'spawnas'
            - 'make_token'
            - 'remote-exec'
            - 'rev2self'
            - 'dcsync'
            - 'logonpasswords'
            - 'execute-assembly'
            - 'getsystem'
    condition: all of selection_*"
proc_creation_win_hktl_cobaltstrike_bloopers_modules.yml,"**Module Bloopers:** ""Operators accidentally enter Cobalt Strike-specific commands directly into the host shell"" **PowerShell Commands:** ""Invoke-ShareFinder, Get-NetCurrentUser, Get-NetDomain"" **Detection Strategy:** ""The goal is to create a detection mechanism for these human errors that might otherwise go unnoticed during an intrusion"" **Operator Sloppiness:** ""These mistakes as signs of the threat actors' continued sloppiness""","logsource:
    category: process_creation
    product: windows
detection:
    selection_img:
        - OriginalFileName: 'Cmd.Exe'
        - Image|endswith: '\cmd.exe'
    selection_cli:
        CommandLine|contains:
            - 'Invoke-UserHunter'
            - 'Invoke-ShareFinder'
            - 'Invoke-Kerberoast'
            - 'Invoke-SMBAutoBrute'
            - 'Invoke-Nightmare'
            - 'zerologon'
            - 'av_query'
    condition: all of selection_*"