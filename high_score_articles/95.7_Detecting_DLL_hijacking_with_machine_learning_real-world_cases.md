# Detecting DLL hijacking with machine learning: real-world cases

## Article Information

- **ID**: 1446
- **Hunt Score**: 95.7/100
- **Source**: Kaspersky Securelist
- **URL**: https://securelist.com/detecting-dll-hijacking-with-machine-learning-in-kaspersky-siem/117567/
- **Authors**: Gleb Ivanov, Andrey Gunkin
- **Published**: 2025-10-06 04:00:08
- **Discovered**: 2025-10-06 17:43:09
- **Word Count**: 0
- **Processing Status**: pending

## Tags
Artificial intelligence, Cybersecurity, DLL, DLL hijacking, DLL sideloading, Machine learning, SIEM, Security technologies, Security technology, Threat hunting, full, large, medium, thumbnail

## Summary
We will tell you how we integrated a DLL Hijacking detection model into the Kaspersky SIEM platform and how it helped us uncover several incidents in their early stages.

## Content

Introduction Our colleagues from the AI expertise center recently developed a machine-learning model that detects DLL-hijacking attacks. We then integrated this model into the Kaspersky Unified Monitoring and Analysis Platform SIEM system. In a separate article , our colleagues shared how the model had been created and what success they had achieved in lab environments. Here, we focus on how it operates within Kaspersky SIEM, the preparation steps taken before its release, and some real-world incidents it has already helped us uncover. How the model works in Kaspersky SIEM The model s operation generally boils down to a step-by-step check of all DLL libraries loaded by processes in the system, followed by validation in the Kaspersky Security Network (KSN) cloud. This approach allows local attributes (path, process name, and file hashes) to be combined with a global knowledge base and behavioral indicators, which significantly improves detection quality and reduces the probability of false positives. The model can run in one of two modes: on a correlator or on a collector. A correlator is a SIEM component that performs event analysis and correlation based on predefined rules or algorithms. If detection is configured on a correlator, the model checks events that have already triggered a rule. This reduces the volume of KSN queries and the model s response time. This is how it looks: A collector is a software or hardware component of a SIEM platform that collects and normalizes events from various sources, and then delivers these events to the platform s core. If detection is configured on a collector, the model processes all events associated with various processes loading libraries, provided these events meet the following conditions: The path to the process file is known. The path to the library is known. The hashes of the file and the library are available. This method consumes more resources, and the model s response takes longer than it does on a correlator. However, it can be useful for retrospective threat hunting because it allows you to check all events logged by Kaspersky SIEM. The model s workflow on a collector looks like this: It is important to note that the model is not limited to a binary malicious/non-malicious assessment; it ranks its responses by confidence level. This allows it to be used as a flexible tool in SOC practice. Examples of possible verdicts: 0: data is being processed. 1: maliciousness not confirmed. This means the model currently does not consider the library malicious. 2: suspicious library. 3: maliciousness confirmed. A Kaspersky SIEM rule for detecting DLL hijacking would look like this: N.KL_AI_DLLHijackingCheckResult > 1 Embedding the model into the Kaspersky SIEM correlator automates the process of finding DLL-hijacking attacks, making it possible to detect them at scale without having to manually analyze hundreds or thousands of loaded libraries. Furthermore, when combined with correlation rules and telemetry sources, the model can be used not just as a standalone module but as part of a comprehensive defense against infrastructure attacks. Incidents detected during the pilot testing of the model in the MDR service Before being released, the model (as part of the Kaspersky SIEM platform) was tested in the MDR service, where it was trained to identify attacks on large datasets supplied by our telemetry. This step was necessary to ensure that detection works not only in lab settings but also in real client infrastructures. During the pilot testing, we verified the model s resilience to false positives and its ability to correctly classify behavior even in non-typical DLL-loading scenarios. As a result, several real-world incidents were successfully detected where attackers used one type of DLL hijacking the DLL Sideloading technique to gain persistence and execute their code in the system. Let us take a closer look at the three most interesting of these. Incident 1. ToddyCat trying to launch Cobalt Strike disguised as a system library In one incident, the attackers successfully leveraged the vulnerability CVE-2021-27076 to exploit a SharePoint service that used IIS as a web server. They ran the following command: c:\windows\system32\inetsrv\w3wp.exe -ap "SharePoint - 80" -v "v4.0" -l "webengine4.dll" -a \\.\pipe\iisipmd32ded38-e45b-423f-804d-34471928538b -h "C:\inetpub\temp\apppools\SharePoint - 80\SharePoint - 80.config" -w "" -m 0 After the exploitation, the IIS process created files that were later used to run malicious code via the DLL sideloading technique ( T1574.001 Hijack Execution Flow: DLL ): C:\ProgramData\SystemSettings.exe C:\ProgramData\SystemSettings.dll SystemSettings.dll is the name of a library associated with the Windows Settings application (SystemSettings.exe). The original library contains code and data that the Settings application uses to manage and configure various system parameters. However, the library created by the attackers has malicious functionality and is only pretending to be a system library. Later, to establish persistence in the system and launch a DLL sideloading attack, a scheduled task was created, disguised as a Microsoft Edge browser update. It launches a SystemSettings.exe file, which is located in the same directory as the malicious library: Schtasks /create /ru "SYSTEM" /tn "\Microsoft\Windows\Edge\Edgeupdates" /sc DAILY /tr "C:\ProgramData\SystemSettings.exe" /F The task is set to run daily. When the SystemSettings.exe process is launched, it loads the malicious DLL. As this happened, the process and library data were sent to our model for analysis and detection of a potential attack. Example of a SystemSettings.dll load event with a DLL Hijacking module verdict in Kaspersky SIEM The resulting data helped our analysts highlight a suspicious DLL and analyze it in detail. The library was found to be a Cobalt Strike implant. After loading it, the SystemSettings.exe process attempted to connect to the attackers command-and-control server. DNS query: connect-microsoft[.]com DNS query type: AAAA DNS response: ::ffff:8.219.1[.]155; 8.219.1[.]155:8443 After establishing a connection, the attackers began host reconnaissance to gather various data to develop their attack. C:\ProgramData\SystemSettings.exe whoami /priv hostname reg query HKLM\SOFTWARE\Microsoft\Cryptography /v MachineGuid powershell -c $psversiontable dotnet --version systeminfo reg query "HKEY_LOCAL_MACHINE\SOFTWARE\VMware, Inc.\VMware Drivers" cmdkey /list REG query "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v PortNumber reg query "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers netsh wlan show profiles netsh wlan show interfaces set net localgroup administrators net user net user administrator ipconfig /all net config workstation net view arp -a route print netstat -ano tasklist schtasks /query /fo LIST /v net start net share net use netsh firewall show config netsh firewall show state net view /domain net time /domain net group "domain admins" /domain net localgroup administrators /domain net group "domain controllers" /domain net accounts /domain nltest / domain_trusts reg query HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run reg query HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce reg query HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run reg query HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Run reg query HKEY_CURRENT_USER\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunOnce Based on the attackers TTPs, such as loading Cobalt Strike as a DLL , using the DLL sideloading technique ( 1 , 2 ), and exploiting SharePoint, we can say with a high degree of confidence that the ToddyCat APT group was behind the attack. Thanks to the prompt response of our model, we were able to respond in time and block this activity, preventing the attackers from causing damage to the organization. Another example was discovered by the model after a client was connected to MDR monitoring: a legitimate system file located in an application folder attempted to load a suspicious library that was stored next to it. C:\Program Files\Chiniks\SettingSyncHost.exe C:\Program Files\Chiniks\policymanager.dll E83F331BD1EC115524EBFF7043795BBE The SettingSyncHost.exe file is a system host process for synchronizing settings between one user s different devices. Its 32-bit and 64-bit versions are usually located in C:\Windows\System32\ and C:\Windows\SysWOW64\, respectively. In this incident, the file location differed from the normal one. Example of a policymanager.dll load event with a DLL Hijacking module verdict in Kaspersky SIEM Analysis of the library file loaded by this process showed that it was malware designed to steal information from browsers. Graph of policymanager.dll activity in a sandbox The file directly accesses browser files that contain user data. C:\Users\ \AppData\Local\Google\Chrome\User Data\Local State The library file is on the list of files used for DLL hijacking, as published in the HijackLibs project. The project contains a list of common processes and libraries employed in DLL-hijacking attacks, which can be used to detect these attacks. Another incident discovered by our model occurred when a user connected a removable USB drive: Example of a Kaspersky SIEM event where a wsc.dll library was loaded from a USB drive, with a DLL Hijacking module verdict The connected drive s directory contained hidden folders with an identically named shortcut for each of them. The shortcuts had icons typically used for folders. Since file extensions were not shown by default on the drive, the user might have mistaken the shortcut for a folder and launched it. In turn, the shortcut opened the corresponding hidden folder and ran an executable file using the following command: "%comspec%" /q /c "RECYCLER.BIN\1\CEFHelper.exe [$DIGITS] [$DIGITS]" CEFHelper.exe is a legitimate Avast Antivirus executable that, through DLL sideloading, loaded the wsc.dll library, which is a malicious loader. Code snippet from the malicious file The loader opens a file named AvastAuth.dat, which contains an encrypted backdoor. The library reads the data from the file into memory, decrypts it, and executes it. After this, the backdoor attempts to connect to a remote command-and-control server. The library file, which contains the malicious loader, is on the list of known libraries used for DLL sideloading, as presented on the HijackLibs project website. Conclusion Integrating the model into the product provided the means of early and accurate detection of DLL-hijacking attempts which previously might have gone unnoticed. Even during the pilot testing, the model proved its effectiveness by identifying several incidents using this technique. Going forward, its accuracy will only increase as data accumulates and algorithms are updated in KSN, making this mechanism a reliable element of proactive protection for corporate systems. IoC Legitimate files used for DLL hijacking E0E092D4EFC15F25FD9C0923C52C33D6 loads SystemSettings.dll 09CD396C8F4B4989A83ED7A1F33F5503 loads policymanager.dll A72036F635CECF0DCB1E9C6F49A8FA5B loads wsc.dll Malicious files EA2882B05F8C11A285426F90859F23C6 SystemSettings.dll E83F331BD1EC115524EBFF7043795BBE policymanager.dll 831252E7FA9BD6FA174715647EBCE516 wsc.dll Paths C:\ProgramData\SystemSettings.exe C:\ProgramData\SystemSettings.dll C:\Program Files\Chiniks\SettingSyncHost.exe C:\Program Files\Chiniks\policymanager.dll D:\RECYCLER.BIN\1\CEFHelper.exe D:\RECYCLER.BIN\1\wsc.dll

## Metadata
- **content_type**: article
- **word_count**: 1626
- **content_length**: 11673
- **processing_timestamp**: 2025-10-06T17:57:16.517439
- **reading_time_minutes**: 1
- **image_count**: 0
- **link_count**: 0
- **headings**: []
- **publication_day_of_week**: Monday
- **publication_month**: October
- **publication_year**: 2025
- **age_days**: 0
- **threat_keywords**: ['malware', 'apt', 'attack', 'vulnerability', 'exploit', 'threat', 'security', 'incident', 'backdoor']
- **threat_keyword_count**: 9
- **perfect_keyword_matches**: ['comspec', 'hklm', 'appdata', 'programdata', 'D:\\', 'C:\\', '\\temp\\', 'System32', 'Whoami']
- **good_keyword_matches**: ['temp', 'c:\\windows\\', 'pipe', '::', '[.]', 'currentversion', 'Monitor', 'Executable', 'Detection', 'Hunting', '.exe', '--', 'cloud', 'network']
- **lolbas_matches**: ['schtasks', 'netsh', 'explorer', 'powershell', 'nltest', 'cmdkey', 'sc']
- **intelligence_matches**: ['APT', 'incident', 'IOC', 'technique', 'discovered', 'real-world']
- **negative_matches**: ['introduction']
- **processed_at**: 2025-10-06T17:57:16.547831
- **training_category**: chosen
- **training_reason**: None
- **training_categorized_at**: 2025-10-07T11:38:22.123389
- **content_chunks**: {'content_hash': 'aaeb104a585f3101deb66462f36075b766da3f3baef94211625150fc32f86e8d', 'chunked_at': '2025-10-07T00:40:35.966643', 'min_confidence': 0.8, 'original_content': 'Introduction Our colleagues from the AI expertise center recently developed a machine-learning model that detects DLL-hijacking attacks. We then integrated this model into the Kaspersky Unified Monitoring and Analysis Platform SIEM system. In a separate article , our colleagues shared how the model had been created and what success they had achieved in lab environments. Here, we focus on how it operates within Kaspersky SIEM, the preparation steps taken before its release, and some real-world incidents it has already helped us uncover. How the model works in Kaspersky SIEM The model s operation generally boils down to a step-by-step check of all DLL libraries loaded by processes in the system, followed by validation in the Kaspersky Security Network (KSN) cloud. This approach allows local attributes (path, process name, and file hashes) to be combined with a global knowledge base and behavioral indicators, which significantly improves detection quality and reduces the probability of false positives. The model can run in one of two modes: on a correlator or on a collector. A correlator is a SIEM component that performs event analysis and correlation based on predefined rules or algorithms. If detection is configured on a correlator, the model checks events that have already triggered a rule. This reduces the volume of KSN queries and the model s response time. This is how it looks: A collector is a software or hardware component of a SIEM platform that collects and normalizes events from various sources, and then delivers these events to the platform s core. If detection is configured on a collector, the model processes all events associated with various processes loading libraries, provided these events meet the following conditions: The path to the process file is known. The path to the library is known. The hashes of the file and the library are available. This method consumes more resources, and the model s response takes longer than it does on a correlator. However, it can be useful for retrospective threat hunting because it allows you to check all events logged by Kaspersky SIEM. The model s workflow on a collector looks like this: It is important to note that the model is not limited to a binary malicious/non-malicious assessment; it ranks its responses by confidence level. This allows it to be used as a flexible tool in SOC practice. Examples of possible verdicts: 0: data is being processed. 1: maliciousness not confirmed. This means the model currently does not consider the library malicious. 2: suspicious library. 3: maliciousness confirmed. A Kaspersky SIEM rule for detecting DLL hijacking would look like this: N.KL_AI_DLLHijackingCheckResult > 1 Embedding the model into the Kaspersky SIEM correlator automates the process of finding DLL-hijacking attacks, making it possible to detect them at scale without having to manually analyze hundreds or thousands of loaded libraries. Furthermore, when combined with correlation rules and telemetry sources, the model can be used not just as a standalone module but as part of a comprehensive defense against infrastructure attacks. Incidents detected during the pilot testing of the model in the MDR service Before being released, the model (as part of the Kaspersky SIEM platform) was tested in the MDR service, where it was trained to identify attacks on large datasets supplied by our telemetry. This step was necessary to ensure that detection works not only in lab settings but also in real client infrastructures. During the pilot testing, we verified the model s resilience to false positives and its ability to correctly classify behavior even in non-typical DLL-loading scenarios. As a result, several real-world incidents were successfully detected where attackers used one type of DLL hijacking the DLL Sideloading technique to gain persistence and execute their code in the system. Let us take a closer look at the three most interesting of these. Incident 1. ToddyCat trying to launch Cobalt Strike disguised as a system library In one incident, the attackers successfully leveraged the vulnerability CVE-2021-27076 to exploit a SharePoint service that used IIS as a web server. They ran the following command: c:\\windows\\system32\\inetsrv\\w3wp.exe -ap "SharePoint - 80" -v "v4.0" -l "webengine4.dll" -a \\\\.\\pipe\\iisipmd32ded38-e45b-423f-804d-34471928538b -h "C:\\inetpub\\temp\\apppools\\SharePoint - 80\\SharePoint - 80.config" -w "" -m 0 After the exploitation, the IIS process created files that were later used to run malicious code via the DLL sideloading technique ( T1574.001 Hijack Execution Flow: DLL ): C:\\ProgramData\\SystemSettings.exe C:\\ProgramData\\SystemSettings.dll SystemSettings.dll is the name of a library associated with the Windows Settings application (SystemSettings.exe). The original library contains code and data that the Settings application uses to manage and configure various system parameters. However, the library created by the attackers has malicious functionality and is only pretending to be a system library. Later, to establish persistence in the system and launch a DLL sideloading attack, a scheduled task was created, disguised as a Microsoft Edge browser update. It launches a SystemSettings.exe file, which is located in the same directory as the malicious library: Schtasks /create /ru "SYSTEM" /tn "\\Microsoft\\Windows\\Edge\\Edgeupdates" /sc DAILY /tr "C:\\ProgramData\\SystemSettings.exe" /F The task is set to run daily. When the SystemSettings.exe process is launched, it loads the malicious DLL. As this happened, the process and library data were sent to our model for analysis and detection of a potential attack. Example of a SystemSettings.dll load event with a DLL Hijacking module verdict in Kaspersky SIEM The resulting data helped our analysts highlight a suspicious DLL and analyze it in detail. The library was found to be a Cobalt Strike implant. After loading it, the SystemSettings.exe process attempted to connect to the attackers command-and-control server. DNS query: connect-microsoft[.]com DNS query type: AAAA DNS response: ::ffff:8.219.1[.]155; 8.219.1[.]155:8443 After establishing a connection, the attackers began host reconnaissance to gather various data to develop their attack. C:\\ProgramData\\SystemSettings.exe whoami /priv hostname reg query HKLM\\SOFTWARE\\Microsoft\\Cryptography /v MachineGuid powershell -c $psversiontable dotnet --version systeminfo reg query "HKEY_LOCAL_MACHINE\\SOFTWARE\\VMware, Inc.\\VMware Drivers" cmdkey /list REG query "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp" /v PortNumber reg query "HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Servers netsh wlan show profiles netsh wlan show interfaces set net localgroup administrators net user net user administrator ipconfig /all net config workstation net view arp -a route print netstat -ano tasklist schtasks /query /fo LIST /v net start net share net use netsh firewall show config netsh firewall show state net view /domain net time /domain net group "domain admins" /domain net localgroup administrators /domain net group "domain controllers" /domain net accounts /domain nltest / domain_trusts reg query HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run reg query HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce reg query HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run reg query HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run reg query HKEY_CURRENT_USER\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\RunOnce Based on the attackers TTPs, such as loading Cobalt Strike as a DLL , using the DLL sideloading technique ( 1 , 2 ), and exploiting SharePoint, we can say with a high degree of confidence that the ToddyCat APT group was behind the attack. Thanks to the prompt response of our model, we were able to respond in time and block this activity, preventing the attackers from causing damage to the organization. Another example was discovered by the model after a client was connected to MDR monitoring: a legitimate system file located in an application folder attempted to load a suspicious library that was stored next to it. C:\\Program Files\\Chiniks\\SettingSyncHost.exe C:\\Program Files\\Chiniks\\policymanager.dll E83F331BD1EC115524EBFF7043795BBE The SettingSyncHost.exe file is a system host process for synchronizing settings between one user s different devices. Its 32-bit and 64-bit versions are usually located in C:\\Windows\\System32\\ and C:\\Windows\\SysWOW64\\, respectively. In this incident, the file location differed from the normal one. Example of a policymanager.dll load event with a DLL Hijacking module verdict in Kaspersky SIEM Analysis of the library file loaded by this process showed that it was malware designed to steal information from browsers. Graph of policymanager.dll activity in a sandbox The file directly accesses browser files that contain user data. C:\\Users\\ \\AppData\\Local\\Google\\Chrome\\User Data\\Local State The library file is on the list of files used for DLL hijacking, as published in the HijackLibs project. The project contains a list of common processes and libraries employed in DLL-hijacking attacks, which can be used to detect these attacks. Another incident discovered by our model occurred when a user connected a removable USB drive: Example of a Kaspersky SIEM event where a wsc.dll library was loaded from a USB drive, with a DLL Hijacking module verdict The connected drive s directory contained hidden folders with an identically named shortcut for each of them. The shortcuts had icons typically used for folders. Since file extensions were not shown by default on the drive, the user might have mistaken the shortcut for a folder and launched it. In turn, the shortcut opened the corresponding hidden folder and ran an executable file using the following command: "%comspec%" /q /c "RECYCLER.BIN\\1\\CEFHelper.exe [$DIGITS] [$DIGITS]" CEFHelper.exe is a legitimate Avast Antivirus executable that, through DLL sideloading, loaded the wsc.dll library, which is a malicious loader. Code snippet from the malicious file The loader opens a file named AvastAuth.dat, which contains an encrypted backdoor. The library reads the data from the file into memory, decrypts it, and executes it. After this, the backdoor attempts to connect to a remote command-and-control server. The library file, which contains the malicious loader, is on the list of known libraries used for DLL sideloading, as presented on the HijackLibs project website. Conclusion Integrating the model into the product provided the means of early and accurate detection of DLL-hijacking attempts which previously might have gone unnoticed. Even during the pilot testing, the model proved its effectiveness by identifying several incidents using this technique. Going forward, its accuracy will only increase as data accumulates and algorithms are updated in KSN, making this mechanism a reliable element of proactive protection for corporate systems. IoC Legitimate files used for DLL hijacking E0E092D4EFC15F25FD9C0923C52C33D6 loads SystemSettings.dll 09CD396C8F4B4989A83ED7A1F33F5503 loads policymanager.dll A72036F635CECF0DCB1E9C6F49A8FA5B loads wsc.dll Malicious files EA2882B05F8C11A285426F90859F23C6 SystemSettings.dll E83F331BD1EC115524EBFF7043795BBE policymanager.dll 831252E7FA9BD6FA174715647EBCE516 wsc.dll Paths C:\\ProgramData\\SystemSettings.exe C:\\ProgramData\\SystemSettings.dll C:\\Program Files\\Chiniks\\SettingSyncHost.exe C:\\Program Files\\Chiniks\\policymanager.dll D:\\RECYCLER.BIN\\1\\CEFHelper.exe D:\\RECYCLER.BIN\\1\\wsc.dll', 'filtered_content': 'Furthermore, when combined with correlation rules and telemetry sources, the model can be used not just as a standalone module but as part of a comprehensive defense against infrastructure attacks. Incidents detected during the pilot testing of the model in the MDR service Before being released, the model (as part of the Kaspersky SIEM platform) was tested in the MDR service, where it was trained to identify attacks on large datasets supplied by our telemetry. This step was necessary to ensure that detection works not only in lab settings but also in real client infrastructures. During the pilot testing, we verified the model s resilience to false positives and its ability to correctly classify behavior even in non-typical DLL-loading scenarios. As a result, several real-world incidents were successfully detected where attackers used one type of DLL hijacking the DLL Sideloading technique to gain persistence and execute their code in the system. Let us take a closer look at the three most interesting of these. Incident 1. ToddyCat trying to launch Cobalt Strike disguised as a system library In one incident, the attackers successfully leveraged the vulnerability CVE-2021-27076 to exploit a SharePoint service that used IIS as a web server. They ran the following command: c:\\windows\\system32\\inetsrv\\w3wp.exe -ap "SharePoint - 80" -v "v4.0" -l "webengine4.dll" -a \\\\.\\pipe\\iisipmd32ded38-e45b-423f-804d-34471928538b -h "C:\\inetpub\\temp\\apppools\\SharePoint - 80\\SharePoint - 80.config" -w "" -m 0 After the exploitation, the IIS process created files that were later used to run malicious code via the DLL sideloading technique ( T1574.001 Hijack Execution Flow: DLL ): C:\\ProgramData\\SystemSettings.exe C:\\ProgramData\\SystemSettings.dll SystemSettings.dll is the name of a library associated with the Windows Settings application (SystemSettings.exe). The original library contains code and data that the Settings application uses to manage and configure various system parameters. However, the library created by the attackers has malicious functionality and is only pretending to be a system library. Later, to establish persistence in the system and launch a DLL sideloading attack, a scheduled task was created, disguised as a Microsoft Edge browser update. It launches a SystemSettings.exe file, which is located in the same directory as the malicious library: Schtasks /create /ru "SYSTEM" /tn "\\Microsoft\\Windows\\Edge\\Edgeupdates" /sc DAILY /tr "C:\\ProgramData\\SystemSettings.exe" /F The task is set to run daily. When the SystemSettings.exe process is launched, it loads the malicious DLL. As this happened, the process and library data were sent to our model for analysis and detection of a potential attack. Example of a SystemSettings.dll load event with a DLL Hijacking module verdict in Kaspersky SIEM The resulting data helped our analys ts highlight a suspicious DLL and analyze it in detail. The library was found to be a Cobalt Strike implant. After loading it, the SystemSettings.exe process attempted to connect to the attackers command-and-control server. DNS query: connect-microsoft[.]com DNS query type: AAAA DNS response: ::ffff:8.219.1[.]155; 8.219.1[.]155:8443 After establishing a connection, the attackers began host reconnaissance to gather various data to develop their attack. C:\\ProgramData\\SystemSettings.exe whoami /priv hostname reg query HKLM\\SOFTWARE\\Microsoft\\Cryptography /v MachineGuid powershell -c $psversiontable dotnet --version systeminfo reg query "HKEY_LOCAL_MACHINE\\SOFTWARE\\VMware, Inc.\\VMware Drivers" cmdkey /list REG query "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp" /v PortNumber reg query "HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Servers netsh wlan show profiles netsh wlan show interfaces set net localgroup administrators net user net user admi nistrator ipconfig /all net config workstation net view arp -a route print netstat -ano tasklist schtasks /query /fo LIST /v net start net share net use netsh firewall show config netsh firewall show state net view /domain net time /domain net group "domain admins" /domain net localgroup administrators /domain net group "domain controllers" /domain net accounts /domain nltest / domain_trusts reg query HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run reg query HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce reg query HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run reg query HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run reg query HKEY_CURRENT_USER\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\RunOnce Based on the attackers TTPs, such as loading Cobalt Strike as a DLL , using the DLL sideloading technique ( 1 , 2 ), and exploiting SharePoint, we can say with a high degree of confi s process showed that it was malware designed to steal information from browsers. Graph of policymanager.dll activity in a sandbox The file directly accesses browser files that contain user data. C:\\Users\\ \\AppData\\Local\\Google\\Chrome\\User Data\\Local State The library file is on the list of files used for DLL hijacking, as published in the HijackLibs project. The project contains a list of common processes and libraries employed in DLL-hijacking attacks, which can be used to detect these attacks. Another incident discovered by our model occurred when a user connected a removable USB drive: Example of a Kaspersky SIEM event where a wsc.dll library was loaded from a USB drive, with a DLL Hijacking module verdict The connected drive s directory contained hidden folders with an identically named shortcut for each of them. The shortcuts had icons typically used for folders. Since file extensions were not shown by default on the drive, the user might have mistaken the shortcut for a folder a nd launched it. In turn, the shortcut opened the corresponding hidden folder and ran an executable file using the following command: "%comspec%" /q /c "RECYCLER.BIN\\1\\CEFHelper.exe [$DIGITS] [$DIGITS]" CEFHelper.exe is a legitimate Avast Antivirus executable that, through DLL sideloading, loaded the wsc.dll library, which is a malicious loader. Code snippet from the malicious file The loader opens a file named AvastAuth.dat, which contains an encrypted backdoor. The library reads the data from the file into memory, decrypts it, and executes it. After this, the backdoor attempts to connect to a remote command-and-control server. The library file, which contains the malicious loader, is on the list of known libraries used for DLL sideloading, as presented on the HijackLibs project website. Conclusion Integrating the model into the product provided the means of early and accurate detection of DLL-hijacking attempts which previously might have gone unnoticed. Even during the pilot testing, the model proved its effectiveness by identifying several incidents using this technique. Going forward, its accuracy will only increase as data accumulates and algorithms are updated in KSN, making this mechanism a reliable element of proactive protection for corporate systems. IoC Legitimate files used for DLL hijacking E0E092D4EFC15F25FD9C0923C52C33D6 loads SystemSettings.dll 09CD396C8F4B4989A83ED7A1F33F5503 loads policymanager.dll A72036F635CECF0DCB1E9C6F49A8FA5B loads wsc.dll Malicious files EA2882B05F8C11A285426F90859F23C6 SystemSettings.dll E83F331BD1EC115524EBFF7043795BBE policymanager.dll 831252E7FA9BD6FA174715647EBCE516 wsc.dll Paths C:\\ProgramData\\SystemSettings.exe C:\\ProgramData\\SystemSettings.dll C:\\Program Files\\Chiniks\\SettingSyncHost.exe C:\\Program Files\\Chiniks\\policymanager.dll D:\\RECYCLER.BIN\\1\\CEFHelper.exe D:\\RECYCLER.BIN\\1\\wsc.dll', 'original_tokens': 2918, 'filtered_tokens': 1934, 'tokens_saved': 984, 'cost_savings': 0.004920000000000001, 'cost_reduction_percent': 33.721727210418095, 'is_huntable': True, 'confidence': 7672.625, 'removed_chunks': [{'text': 'Introduction Our colleagues from the AI expertise center recently developed a machine-learning model that detects DLL-hijacking attacks. We then integrated this model into the Kaspersky Unified Monitoring and Analysis Platform SIEM system. In a separate article , our colleagues shared how the model had been created and what success they had achieved in lab environments. Here, we focus on how it operates within Kaspersky SIEM, the preparation steps taken before its release, and some real-world incidents it has already helped us uncover. How the model works in Kaspersky SIEM The model s operation generally boils down to a step-by-step check of all DLL libraries loaded by processes in the system, followed by validation in the Kaspersky Security Network (KSN) cloud. This approach allows local attributes (path, process name, and file hashes) to be combined with a global knowledge base and behavioral indicators, which significantly improves detection quality and reduces the probability of fa', 'start_offset': 0, 'end_offset': 1000, 'confidence': 0.0, 'reason': 'Low huntability confidence'}, {'text': 'lse positives. The model can run in one of two modes: on a correlator or on a collector. A correlator is a SIEM component that performs event analysis and correlation based on predefined rules or algorithms. If detection is configured on a correlator, the model checks events that have already triggered a rule. This reduces the volume of KSN queries and the model s response time. This is how it looks: A collector is a software or hardware component of a SIEM platform that collects and normalizes events from various sources, and then delivers these events to the platform s core. If detection is configured on a collector, the model processes all events associated with various processes loading libraries, provided these events meet the following conditions: The path to the process file is known. The path to the library is known. The hashes of the file and the library are available. This method consumes more resources, and the model s response takes longer than it does on a correlator.', 'start_offset': 1000, 'end_offset': 1995, 'confidence': 0.0, 'reason': 'Low huntability confidence'}, {'text': 'However, it can be useful for retrospective threat hunting because it allows you to check all events logged by Kaspersky SIEM. The model s workflow on a collector looks like this: It is important to note that the model is not limited to a binary malicious/non-malicious assessment; it ranks its responses by confidence level. This allows it to be used as a flexible tool in SOC practice. Examples of possible verdicts: 0: data is being processed. 1: maliciousness not confirmed. This means the model currently does not consider the library malicious. 2: suspicious library. 3: maliciousness confirmed. A Kaspersky SIEM rule for detecting DLL hijacking would look like this: N.KL_AI_DLLHijackingCheckResult > 1 Embedding the model into the Kaspersky SIEM correlator automates the process of finding DLL-hijacking attacks, making it possible to detect them at scale without having to manually analyze hundreds or thousands of loaded libraries.', 'start_offset': 1995, 'end_offset': 2937, 'confidence': 0.0, 'reason': 'Low huntability confidence'}, {'text': 'dence that the ToddyCat APT group was behind the attack. Thanks to the prompt response of our model, we were able to respond in time and block this activity, preventing the attackers from causing damage to the organization. Another example was discovered by the model after a client was connected to MDR monitoring: a legitimate system file located in an application folder attempted to load a suspicious library that was stored next to it. C:\\Program Files\\Chiniks\\SettingSyncHost.exe C:\\Program Files\\Chiniks\\policymanager.dll E83F331BD1EC115524EBFF7043795BBE The SettingSyncHost.exe file is a system host process for synchronizing settings between one user s different devices. Its 32-bit and 64-bit versions are usually located in C:\\Windows\\System32\\ and C:\\Windows\\SysWOW64\\, respectively. In this incident, the file location differed from the normal one. Example of a policymanager.dll load event with a DLL Hijacking module verdict in Kaspersky SIEM Analysis of the library file loaded by thi', 'start_offset': 7807, 'end_offset': 8807, 'confidence': 0.0, 'reason': 'Low huntability confidence'}], 'chunks_removed': 4, 'chunks_kept': 10}
- **extracted_iocs**: {'iocs': {'ip': ['8.219.1.155'], 'domain': ['http:connect-microsoft.com', 'http:8.219.1.155', 'http:8.219.1.155:8443'], 'url': ['http:connect-microsoft.com', 'http:8.219.1.155', 'http:8.219.1.155:8443'], 'email': [], 'file_hash': ['E0E092D4EFC15F25FD9C0923C52C33D6', '09CD396C8F4B4989A83ED7A1F33F5503', 'A72036F635CECF0DCB1E9C6F49A8FA5B', 'EA2882B05F8C11A285426F90859F23C6', 'E83F331BD1EC115524EBFF7043795BBE', '831252E7FA9BD6FA174715647EBCE516'], 'registry_key': [], 'file_path': [], 'mutex': [], 'named_pipe': []}, 'extracted_at': '2025-10-07T00:18:04.926657', 'content_type': 'full content', 'model_used': 'regex', 'model_name': 'custom-regex', 'extraction_method': 'iocextract', 'confidence': 0.8, 'processing_time': 0.03536272048950195, 'raw_count': 13, 'validated_count': 13, 'metadata': {'raw_extraction_count': 13, 'validation_applied': False, 'llm_validation_successful': False}, 'content_filtering': {'enabled': True, 'min_confidence': 0.7, 'tokens_saved': 984, 'cost_reduction_percent': 33.721727210418095}}
- **chatgpt_summary**: {'summary': '**Executive Summary:**\nThe article discusses the use of machine learning (ML) in detecting DLL hijacking attacks, specifically with the Kaspersky SIEM platform. The model was trained on real-world incidents and tested in a pilot testing environment to ensure its effectiveness. The results showed that the model successfully detected several instances of DLL hijacking attempts, including those using Cobalt Strike, a malware designed to steal information from browsers.\n\n**Key Findings:**\n\n* The Kaspersky SIEM model can be used as a standalone module or part of a comprehensive defense against infrastructure attacks.\n* The model was tested in the MDR (Multi-Protocol Detection and Response) service before being released for pilot testing.\n* During pilot testing, several real-world incidents were successfully detected using the model\'s DLL hijacking detection capabilities.\n* The model identified instances where attackers used one type of DLL hijacking technique (Sideloading) to gain persistence and execute their code in the system.\n\n**Technical Details:**\n\n* The Kaspersky SIEM model uses correlation rules and telemetry sources to detect attacks.\n* The model was trained on real-world incidents, including those using Cobalt Strike and other malware.\n* During pilot testing, the model demonstrated its resilience to false positives and ability to correctly classify behavior in non-typical scenarios.\n\n**Threat Intelligence:**\n\n* The attackers used a variety of techniques, including:\n + Sideloading DLLs to gain persistence and execute their code\n + Exploiting vulnerabilities such as CVE-2021-27076 to access SharePoint services\n + Using the IIS process to load malicious code via DLL sideloading\n\n**Indicators:**\n\n* IOCs (Indicators of Compromise) include:\n + c:\\windows\\system32\\inetsrv\\w3wp.exe -ap "SharePoint - 80" -v "v4.0" -l "webengine4.dll" -a \\\\.\\pipe\\iisipmd32ded38-e45b-423f-804d-34471928538b -h "C:\\inetpub\\temp\\apppools\\SharePoint - 80\\SharePoint - 80.config"\n + SystemSettings.dll\n + policymanager.dll\n + wsc.dll\n\n**Impact:**\n\n* The attackers\' use of DLL hijacking techniques poses a significant risk to corporate systems, as it allows them to gain persistence and execute malicious code.\n* The Kaspersky SIEM model\'s effectiveness in detecting these attacks is a valuable asset for organizations seeking to improve their security posture.\n\n**Recommendations:**\n\n* Implement the Kaspersky SIEM model into your organization\'s security infrastructure to detect and respond to DLL hijacking attempts.\n* Continuously monitor and update the model to increase its accuracy and effectiveness over time.\n* Consider integrating the model with other security tools and technologies to enhance overall security posture.', 'summarized_at': '2025-10-07T00:28:14.001918', 'content_type': 'full content', 'model_used': 'ollama', 'model_name': 'llama3.2:1b'}
- **sigma_rules**: {'rules': None, 'generated_at': '2025-10-07T00:41:53.872136', 'content_type': 'full content', 'model_used': 'unknown', 'model_name': 'unknown', 'validation_results': [], 'conversation': [{'attempt': 1, 'messages': [{'role': 'system', 'content': "You are a senior cybersecurity detection engineer specializing in SIGMA rule creation and threat hunting. Generate high-quality, actionable SIGMA rules based on threat intelligence articles. Always use proper SIGMA syntax and include all required fields according to SigmaHQ standards. Focus on TTPs (Tactics, Techniques, and Procedures) rather than atomic IOCs (Indicators of Compromise). Create rules that detect behavioral patterns and techniques, not just specific artifacts like IP addresses or file hashes. Domain/URL patterns are acceptable when they represent techniques or behavioral patterns.\n\n**Key Principles:**\n1. **Behavioral Focus:** Detect attack behaviors and techniques, not just artifacts\n2. **Proper Syntax:** Use correct SIGMA rule format and structure\n3. **Complete Fields:** Include all required SIGMA fields\n4. **Actionable Detection:** Rules should detect real attack patterns\n5. **False Positive Awareness:** Balance detection capability with false positive risk\n\n**Rule Structure Requirements:**\n- **Title:** Clear, descriptive rule name\n- **Description:** What the rule detects and why it's important\n- **Logsource:** Appropriate log source category and product\n- **Detection:** Proper selection criteria and conditions\n- **Level:** Appropriate severity level (low/medium/high/critical)\n- **Tags:** Relevant attack technique tags\n- **References:** Source URLs or documentation\n\n**Avoid:**\n- Rules for single IP addresses or file hashes\n- Overly broad or generic detection criteria\n- Missing required fields\n- Incorrect syntax or structure\n- Rules that would generate excessive false positives\n\n**Focus On:**\n- Command-line patterns and process creation\n- System modifications and persistence mechanisms\n- Network behavior patterns\n- File system activities\n- Service and registry modifications\n- Cross-platform attack techniques"}, {'role': 'user', 'content': 'Generate a Sigma detection rule based on this threat intelligence:\n\n**Article Title:** Detecting DLL hijacking with machine learning: real-world cases\n**Source:** https://securelist.com/detecting-dll-hijacking-with-machine-learning-in-kaspersky-siem/117567/\n**URL:** https://securelist.com/detecting-dll-hijacking-with-machine-learning-in-kaspersky-siem/117567/\n\n**SIGMA Rule Requirements:**\n1. **Focus on TTPs:** Create rules for Tactics, Techniques, and Procedures, not atomic IOCs\n2. **Behavioral Patterns:** Detect attack behaviors and techniques\n3. **Proper Syntax:** Use correct SIGMA rule format and structure\n4. **Required Fields:** Include all mandatory SIGMA fields (title, description, logsource, detection, etc.)\n5. **Actionable Detection:** Rules should detect real attack patterns\n\n**Rule Guidelines:**\n- Avoid rules for single IP addresses or file hashes\n- Focus on command-line patterns, process creation, and system modifications\n- Use appropriate log sources (Windows Event Logs, Sysmon, Linux auditd, etc.)\n- Include proper categorization and references\n- Make rules specific enough to avoid false positives\n\n**Output Format:**\nIMPORTANT: Use ONLY spaces for indentation, NEVER tabs. YAML requires exactly 2 spaces per indentation level.\n\n```yaml\ntitle: [Descriptive rule title]\nid: [UUID or generated ID]\ndescription: [What this rule detects]\nlogsource:\n  category: [process_creation/network_connection/etc]\n  product: [windows/linux/macos]\ndetection:\n  selection:\n    [detection criteria]\n  condition: selection\nlevel: [low/medium/high/critical]\ntags:\n  - attack.[technique]\nreferences:\n  - [URL or reference]\n```\n\n**YAML Formatting Rules:**\n- Use exactly 2 spaces for each indentation level\n- NEVER use tabs\n- Ensure proper YAML syntax\n- All field names must be lowercase\n- Use quotes for values containing special characters\n\n**Threat Intelligence Content:**\nFurthermore, when combined with correlation rules and telemetry sources, the model can be used not just as a standalone module but as part of a comprehensive defense against infrastructure attacks. Incidents detected during the pilot testing of the model in the MDR service Before being released, the model (as part of the Kaspersky SIEM platform) was tested in the MDR service, where it was trained to identify attacks on large datasets supplied by our telemetry. This step was necessary to ensure that detection works not only in lab settings but also in real client infrastructures. During the pilot testing, we verified the model s resilience to false positives and its ability to correctly classify behavior even in non-typical DLL-loading scenarios. As a result, several real-world incidents were successfully detected where attackers used one type of DLL hijacking the DLL Sideloading technique to gain persistence and execute their code in the system. Let us take a closer look at the three most interesting of these. Incident 1. ToddyCat trying to launch Cobalt Strike disguised as a system library In one incident, the attackers successfully leveraged the vulnerability CVE-2021-27076 to exploit a SharePoint service that used IIS as a web server. They ran the following command: c:\\windows\\system32\\inetsrv\\w3wp.exe -ap "SharePoint - 80" -v "v4.0" -l "webengine4.dll" -a \\\\.\\pipe\\iisipmd32ded38-e45b-423f-804d-34471928538b -h "C:\\inetpub\\temp\\apppools\\SharePoint - 80\\SharePoint - 80.config" -w "" -m 0 After the exploitation, the IIS process created files that were later used to run malicious code via the DLL sideloading technique ( T1574.001 Hijack Execution Flow: DLL ): C:\\ProgramData\\SystemSettings.exe C:\\ProgramData\\SystemSettings.dll SystemSettings.dll is the name of a library associated with the Windows Settings application (SystemSettings.exe). The original library contains code and data that the Settings application uses to manage and configure various system parameters. However, the library created by the attackers has malicious functionality and is only pretending to be a system library. Later, to establish persistence in the system and launch a DLL sideloading attack, a scheduled task was created, disguised as a Microsoft Edge browser update. It launches a SystemSettings.exe file, which is located in the same directory as the malicious library: Schtasks /create /ru "SYSTEM" /tn "\\Microsoft\\Windows\\Edge\\Edgeupdates" /sc DAILY /tr "C:\\ProgramData\\SystemSettings.exe" /F The task is set to run daily. When the SystemSettings.exe process is launched, it loads the malicious DLL. As this happened, the process and library data were sent to our model for analysis and detection of a potential attack. Example of a SystemSettings.dll load event with a DLL Hijacking module verdict in Kaspersky SIEM The resulting data helped our analys ts highlight a suspicious DLL and analyze it in detail. The library was found to be a Cobalt Strike implant. After loading it, the SystemSettings.exe process attempted to connect to the attackers command-and-control server. DNS query: connect-microsoft[.]com DNS query type: AAAA DNS response: ::ffff:8.219.1[.]155; 8.219.1[.]155:8443 After establishing a connection, the attackers began host reconnaissance to gather various data to develop their attack. C:\\ProgramData\\SystemSettings.exe whoami /priv hostname reg query HKLM\\SOFTWARE\\Microsoft\\Cryptography /v MachineGuid powershell -c $psversiontable dotnet --version systeminfo reg query "HKEY_LOCAL_MACHINE\\SOFTWARE\\VMware, Inc.\\VMware Drivers" cmdkey /list REG query "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp" /v PortNumber reg query "HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Servers netsh wlan show profiles netsh wlan show interfaces set net localgroup administrators net user net user admi nistrator ipconfig /all net config workstation net view arp -a route print netstat -ano tasklist schtasks /query /fo LIST /v net start net share net use netsh firewall show config netsh firewall show state net view /domain net time /domain net group "domain admins" /domain net localgroup administrators /domain net group "domain controllers" /domain net accounts /domain nltest / domain_trusts reg query HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run reg query HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce reg query HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run reg query HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run reg query HKEY_CURRENT_USER\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\RunOnce Based on the attackers TTPs, such as loading Cobalt Strike as a DLL , using the DLL sideloading technique ( 1 , 2 ), and exploiting SharePoint, we can say with a high degree of confi s process showed that it was malware designed to steal information from browsers. Graph of policymanager.dll activity in a sandbox The file directly accesses browser files that contain user data. C:\\Users\\ \\AppData\\Local\\Google\\Chrome\\User Data\\Local State The library file is on the list of files used for DLL hijacking, as published in the HijackLibs project. The project contains a list of common processes and libraries employed in DLL-hijacking attacks, which can be used to detect these attacks. Another incident discovered by our model occurred when a user connected a removable USB drive: Example of a Kaspersky SIEM event where a wsc.dll library was loaded from a USB drive, with a DLL Hijacking module verdict The connected drive s directory contained hidden folders with an identically named shortcut for each of them. The shortcuts had icons typically used for folders. Since file extensions were not shown by default on the drive, the user might have mistaken the shortcut for a folder a nd launched it. In turn, the shortcut opened the corresponding hidden folder and ran an executable file using the following command: "%comspec%" /q /c "RECYCLER.BIN\\1\\CEFHelper.exe [$DIGITS] [$DIGITS]" CEFHelper.exe is a legitimate Avast Antivirus executable that, through DLL sideloading, loaded the wsc.dll library, which is a malicious loader. Code snippet from the malicious file The loader opens a file named AvastAuth.dat, which contains an encrypted backdoor. The library reads the data from the file into memory, decrypts it, and executes it. After this, the backdoor attempts to connect to a remote command-and-control server. The library file, which contains the malicious loader, is on the list of known libraries used for DLL sideloading, as presented on the HijackLibs project website. Conclusion Integrating the model into the product provided the means of early and accurate detection of DLL-hijacking attempts which previously might have gone unnoticed. Even during the pilot testing, the model proved its effectiveness by identifying several incidents using this technique. Going forward, its accuracy will only increase as data accumulates and algorithms are updated in KSN, making this mechanism a reliable element of proactive protection for corporate systems. IoC Legitimate files used for DLL hijacking E0E092D4EFC15F25FD9C0923C52C33D6 loads SystemSettings.dll 09CD396C8F4B4989A83ED7A1F33F5503 loads policymanager.dll A72036F635CECF0DCB1E9C6F49A8FA5B loads wsc.dll Malicious files EA2882B05F8C11A285426F90859F23C6 SystemSettings.dll E83F331BD1EC115524EBFF7043795BBE policymanager.dll 831252E7FA9BD6FA174715647EBCE516 wsc.dll Paths C:\\ProgramData\\SystemSettings.exe C:\\ProgramData\\SystemSettings.dll C:\\Program Files\\Chiniks\\SettingSyncHost.exe C:\\Program Files\\Chiniks\\policymanager.dll D:\\RECYCLER.BIN\\1\\CEFHelper.exe D:\\RECYCLER.BIN\\1\\wsc.dll'}], 'llm_response': None, 'validation': None, 'error': 'Server disconnected without sending a response.'}, {'attempt': 2, 'messages': [{'role': 'system', 'content': "You are a senior cybersecurity detection engineer specializing in SIGMA rule creation and threat hunting. Generate high-quality, actionable SIGMA rules based on threat intelligence articles. Always use proper SIGMA syntax and include all required fields according to SigmaHQ standards. Focus on TTPs (Tactics, Techniques, and Procedures) rather than atomic IOCs (Indicators of Compromise). Create rules that detect behavioral patterns and techniques, not just specific artifacts like IP addresses or file hashes. Domain/URL patterns are acceptable when they represent techniques or behavioral patterns.\n\n**Key Principles:**\n1. **Behavioral Focus:** Detect attack behaviors and techniques, not just artifacts\n2. **Proper Syntax:** Use correct SIGMA rule format and structure\n3. **Complete Fields:** Include all required SIGMA fields\n4. **Actionable Detection:** Rules should detect real attack patterns\n5. **False Positive Awareness:** Balance detection capability with false positive risk\n\n**Rule Structure Requirements:**\n- **Title:** Clear, descriptive rule name\n- **Description:** What the rule detects and why it's important\n- **Logsource:** Appropriate log source category and product\n- **Detection:** Proper selection criteria and conditions\n- **Level:** Appropriate severity level (low/medium/high/critical)\n- **Tags:** Relevant attack technique tags\n- **References:** Source URLs or documentation\n\n**Avoid:**\n- Rules for single IP addresses or file hashes\n- Overly broad or generic detection criteria\n- Missing required fields\n- Incorrect syntax or structure\n- Rules that would generate excessive false positives\n\n**Focus On:**\n- Command-line patterns and process creation\n- System modifications and persistence mechanisms\n- Network behavior patterns\n- File system activities\n- Service and registry modifications\n- Cross-platform attack techniques"}, {'role': 'user', 'content': 'Generate a Sigma detection rule based on this threat intelligence:\n\n**Article Title:** Detecting DLL hijacking with machine learning: real-world cases\n**Source:** https://securelist.com/detecting-dll-hijacking-with-machine-learning-in-kaspersky-siem/117567/\n**URL:** https://securelist.com/detecting-dll-hijacking-with-machine-learning-in-kaspersky-siem/117567/\n\n**SIGMA Rule Requirements:**\n1. **Focus on TTPs:** Create rules for Tactics, Techniques, and Procedures, not atomic IOCs\n2. **Behavioral Patterns:** Detect attack behaviors and techniques\n3. **Proper Syntax:** Use correct SIGMA rule format and structure\n4. **Required Fields:** Include all mandatory SIGMA fields (title, description, logsource, detection, etc.)\n5. **Actionable Detection:** Rules should detect real attack patterns\n\n**Rule Guidelines:**\n- Avoid rules for single IP addresses or file hashes\n- Focus on command-line patterns, process creation, and system modifications\n- Use appropriate log sources (Windows Event Logs, Sysmon, Linux auditd, etc.)\n- Include proper categorization and references\n- Make rules specific enough to avoid false positives\n\n**Output Format:**\nIMPORTANT: Use ONLY spaces for indentation, NEVER tabs. YAML requires exactly 2 spaces per indentation level.\n\n```yaml\ntitle: [Descriptive rule title]\nid: [UUID or generated ID]\ndescription: [What this rule detects]\nlogsource:\n  category: [process_creation/network_connection/etc]\n  product: [windows/linux/macos]\ndetection:\n  selection:\n    [detection criteria]\n  condition: selection\nlevel: [low/medium/high/critical]\ntags:\n  - attack.[technique]\nreferences:\n  - [URL or reference]\n```\n\n**YAML Formatting Rules:**\n- Use exactly 2 spaces for each indentation level\n- NEVER use tabs\n- Ensure proper YAML syntax\n- All field names must be lowercase\n- Use quotes for values containing special characters\n\n**Threat Intelligence Content:**\nFurthermore, when combined with correlation rules and telemetry sources, the model can be used not just as a standalone module but as part of a comprehensive defense against infrastructure attacks. Incidents detected during the pilot testing of the model in the MDR service Before being released, the model (as part of the Kaspersky SIEM platform) was tested in the MDR service, where it was trained to identify attacks on large datasets supplied by our telemetry. This step was necessary to ensure that detection works not only in lab settings but also in real client infrastructures. During the pilot testing, we verified the model s resilience to false positives and its ability to correctly classify behavior even in non-typical DLL-loading scenarios. As a result, several real-world incidents were successfully detected where attackers used one type of DLL hijacking the DLL Sideloading technique to gain persistence and execute their code in the system. Let us take a closer look at the three most interesting of these. Incident 1. ToddyCat trying to launch Cobalt Strike disguised as a system library In one incident, the attackers successfully leveraged the vulnerability CVE-2021-27076 to exploit a SharePoint service that used IIS as a web server. They ran the following command: c:\\windows\\system32\\inetsrv\\w3wp.exe -ap "SharePoint - 80" -v "v4.0" -l "webengine4.dll" -a \\\\.\\pipe\\iisipmd32ded38-e45b-423f-804d-34471928538b -h "C:\\inetpub\\temp\\apppools\\SharePoint - 80\\SharePoint - 80.config" -w "" -m 0 After the exploitation, the IIS process created files that were later used to run malicious code via the DLL sideloading technique ( T1574.001 Hijack Execution Flow: DLL ): C:\\ProgramData\\SystemSettings.exe C:\\ProgramData\\SystemSettings.dll SystemSettings.dll is the name of a library associated with the Windows Settings application (SystemSettings.exe). The original library contains code and data that the Settings application uses to manage and configure various system parameters. However, the library created by the attackers has malicious functionality and is only pretending to be a system library. Later, to establish persistence in the system and launch a DLL sideloading attack, a scheduled task was created, disguised as a Microsoft Edge browser update. It launches a SystemSettings.exe file, which is located in the same directory as the malicious library: Schtasks /create /ru "SYSTEM" /tn "\\Microsoft\\Windows\\Edge\\Edgeupdates" /sc DAILY /tr "C:\\ProgramData\\SystemSettings.exe" /F The task is set to run daily. When the SystemSettings.exe process is launched, it loads the malicious DLL. As this happened, the process and library data were sent to our model for analysis and detection of a potential attack. Example of a SystemSettings.dll load event with a DLL Hijacking module verdict in Kaspersky SIEM The resulting data helped our analys ts highlight a suspicious DLL and analyze it in detail. The library was found to be a Cobalt Strike implant. After loading it, the SystemSettings.exe process attempted to connect to the attackers command-and-control server. DNS query: connect-microsoft[.]com DNS query type: AAAA DNS response: ::ffff:8.219.1[.]155; 8.219.1[.]155:8443 After establishing a connection, the attackers began host reconnaissance to gather various data to develop their attack. C:\\ProgramData\\SystemSettings.exe whoami /priv hostname reg query HKLM\\SOFTWARE\\Microsoft\\Cryptography /v MachineGuid powershell -c $psversiontable dotnet --version systeminfo reg query "HKEY_LOCAL_MACHINE\\SOFTWARE\\VMware, Inc.\\VMware Drivers" cmdkey /list REG query "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp" /v PortNumber reg query "HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Servers netsh wlan show profiles netsh wlan show interfaces set net localgroup administrators net user net user admi nistrator ipconfig /all net config workstation net view arp -a route print netstat -ano tasklist schtasks /query /fo LIST /v net start net share net use netsh firewall show config netsh firewall show state net view /domain net time /domain net group "domain admins" /domain net localgroup administrators /domain net group "domain controllers" /domain net accounts /domain nltest / domain_trusts reg query HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run reg query HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce reg query HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run reg query HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run reg query HKEY_CURRENT_USER\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\RunOnce Based on the attackers TTPs, such as loading Cobalt Strike as a DLL , using the DLL sideloading technique ( 1 , 2 ), and exploiting SharePoint, we can say with a high degree of confi s process showed that it was malware designed to steal information from browsers. Graph of policymanager.dll activity in a sandbox The file directly accesses browser files that contain user data. C:\\Users\\ \\AppData\\Local\\Google\\Chrome\\User Data\\Local State The library file is on the list of files used for DLL hijacking, as published in the HijackLibs project. The project contains a list of common processes and libraries employed in DLL-hijacking attacks, which can be used to detect these attacks. Another incident discovered by our model occurred when a user connected a removable USB drive: Example of a Kaspersky SIEM event where a wsc.dll library was loaded from a USB drive, with a DLL Hijacking module verdict The connected drive s directory contained hidden folders with an identically named shortcut for each of them. The shortcuts had icons typically used for folders. Since file extensions were not shown by default on the drive, the user might have mistaken the shortcut for a folder a nd launched it. In turn, the shortcut opened the corresponding hidden folder and ran an executable file using the following command: "%comspec%" /q /c "RECYCLER.BIN\\1\\CEFHelper.exe [$DIGITS] [$DIGITS]" CEFHelper.exe is a legitimate Avast Antivirus executable that, through DLL sideloading, loaded the wsc.dll library, which is a malicious loader. Code snippet from the malicious file The loader opens a file named AvastAuth.dat, which contains an encrypted backdoor. The library reads the data from the file into memory, decrypts it, and executes it. After this, the backdoor attempts to connect to a remote command-and-control server. The library file, which contains the malicious loader, is on the list of known libraries used for DLL sideloading, as presented on the HijackLibs project website. Conclusion Integrating the model into the product provided the means of early and accurate detection of DLL-hijacking attempts which previously might have gone unnoticed. Even during the pilot testing, the model proved its effectiveness by identifying several incidents using this technique. Going forward, its accuracy will only increase as data accumulates and algorithms are updated in KSN, making this mechanism a reliable element of proactive protection for corporate systems. IoC Legitimate files used for DLL hijacking E0E092D4EFC15F25FD9C0923C52C33D6 loads SystemSettings.dll 09CD396C8F4B4989A83ED7A1F33F5503 loads policymanager.dll A72036F635CECF0DCB1E9C6F49A8FA5B loads wsc.dll Malicious files EA2882B05F8C11A285426F90859F23C6 SystemSettings.dll E83F331BD1EC115524EBFF7043795BBE policymanager.dll 831252E7FA9BD6FA174715647EBCE516 wsc.dll Paths C:\\ProgramData\\SystemSettings.exe C:\\ProgramData\\SystemSettings.dll C:\\Program Files\\Chiniks\\SettingSyncHost.exe C:\\Program Files\\Chiniks\\policymanager.dll D:\\RECYCLER.BIN\\1\\CEFHelper.exe D:\\RECYCLER.BIN\\1\\wsc.dll'}], 'llm_response': None, 'validation': None, 'error': '[Errno -2] Name or service not known'}, {'attempt': 3, 'messages': [{'role': 'system', 'content': "You are a senior cybersecurity detection engineer specializing in SIGMA rule creation and threat hunting. Generate high-quality, actionable SIGMA rules based on threat intelligence articles. Always use proper SIGMA syntax and include all required fields according to SigmaHQ standards. Focus on TTPs (Tactics, Techniques, and Procedures) rather than atomic IOCs (Indicators of Compromise). Create rules that detect behavioral patterns and techniques, not just specific artifacts like IP addresses or file hashes. Domain/URL patterns are acceptable when they represent techniques or behavioral patterns.\n\n**Key Principles:**\n1. **Behavioral Focus:** Detect attack behaviors and techniques, not just artifacts\n2. **Proper Syntax:** Use correct SIGMA rule format and structure\n3. **Complete Fields:** Include all required SIGMA fields\n4. **Actionable Detection:** Rules should detect real attack patterns\n5. **False Positive Awareness:** Balance detection capability with false positive risk\n\n**Rule Structure Requirements:**\n- **Title:** Clear, descriptive rule name\n- **Description:** What the rule detects and why it's important\n- **Logsource:** Appropriate log source category and product\n- **Detection:** Proper selection criteria and conditions\n- **Level:** Appropriate severity level (low/medium/high/critical)\n- **Tags:** Relevant attack technique tags\n- **References:** Source URLs or documentation\n\n**Avoid:**\n- Rules for single IP addresses or file hashes\n- Overly broad or generic detection criteria\n- Missing required fields\n- Incorrect syntax or structure\n- Rules that would generate excessive false positives\n\n**Focus On:**\n- Command-line patterns and process creation\n- System modifications and persistence mechanisms\n- Network behavior patterns\n- File system activities\n- Service and registry modifications\n- Cross-platform attack techniques"}, {'role': 'user', 'content': 'Generate a Sigma detection rule based on this threat intelligence:\n\n**Article Title:** Detecting DLL hijacking with machine learning: real-world cases\n**Source:** https://securelist.com/detecting-dll-hijacking-with-machine-learning-in-kaspersky-siem/117567/\n**URL:** https://securelist.com/detecting-dll-hijacking-with-machine-learning-in-kaspersky-siem/117567/\n\n**SIGMA Rule Requirements:**\n1. **Focus on TTPs:** Create rules for Tactics, Techniques, and Procedures, not atomic IOCs\n2. **Behavioral Patterns:** Detect attack behaviors and techniques\n3. **Proper Syntax:** Use correct SIGMA rule format and structure\n4. **Required Fields:** Include all mandatory SIGMA fields (title, description, logsource, detection, etc.)\n5. **Actionable Detection:** Rules should detect real attack patterns\n\n**Rule Guidelines:**\n- Avoid rules for single IP addresses or file hashes\n- Focus on command-line patterns, process creation, and system modifications\n- Use appropriate log sources (Windows Event Logs, Sysmon, Linux auditd, etc.)\n- Include proper categorization and references\n- Make rules specific enough to avoid false positives\n\n**Output Format:**\nIMPORTANT: Use ONLY spaces for indentation, NEVER tabs. YAML requires exactly 2 spaces per indentation level.\n\n```yaml\ntitle: [Descriptive rule title]\nid: [UUID or generated ID]\ndescription: [What this rule detects]\nlogsource:\n  category: [process_creation/network_connection/etc]\n  product: [windows/linux/macos]\ndetection:\n  selection:\n    [detection criteria]\n  condition: selection\nlevel: [low/medium/high/critical]\ntags:\n  - attack.[technique]\nreferences:\n  - [URL or reference]\n```\n\n**YAML Formatting Rules:**\n- Use exactly 2 spaces for each indentation level\n- NEVER use tabs\n- Ensure proper YAML syntax\n- All field names must be lowercase\n- Use quotes for values containing special characters\n\n**Threat Intelligence Content:**\nFurthermore, when combined with correlation rules and telemetry sources, the model can be used not just as a standalone module but as part of a comprehensive defense against infrastructure attacks. Incidents detected during the pilot testing of the model in the MDR service Before being released, the model (as part of the Kaspersky SIEM platform) was tested in the MDR service, where it was trained to identify attacks on large datasets supplied by our telemetry. This step was necessary to ensure that detection works not only in lab settings but also in real client infrastructures. During the pilot testing, we verified the model s resilience to false positives and its ability to correctly classify behavior even in non-typical DLL-loading scenarios. As a result, several real-world incidents were successfully detected where attackers used one type of DLL hijacking the DLL Sideloading technique to gain persistence and execute their code in the system. Let us take a closer look at the three most interesting of these. Incident 1. ToddyCat trying to launch Cobalt Strike disguised as a system library In one incident, the attackers successfully leveraged the vulnerability CVE-2021-27076 to exploit a SharePoint service that used IIS as a web server. They ran the following command: c:\\windows\\system32\\inetsrv\\w3wp.exe -ap "SharePoint - 80" -v "v4.0" -l "webengine4.dll" -a \\\\.\\pipe\\iisipmd32ded38-e45b-423f-804d-34471928538b -h "C:\\inetpub\\temp\\apppools\\SharePoint - 80\\SharePoint - 80.config" -w "" -m 0 After the exploitation, the IIS process created files that were later used to run malicious code via the DLL sideloading technique ( T1574.001 Hijack Execution Flow: DLL ): C:\\ProgramData\\SystemSettings.exe C:\\ProgramData\\SystemSettings.dll SystemSettings.dll is the name of a library associated with the Windows Settings application (SystemSettings.exe). The original library contains code and data that the Settings application uses to manage and configure various system parameters. However, the library created by the attackers has malicious functionality and is only pretending to be a system library. Later, to establish persistence in the system and launch a DLL sideloading attack, a scheduled task was created, disguised as a Microsoft Edge browser update. It launches a SystemSettings.exe file, which is located in the same directory as the malicious library: Schtasks /create /ru "SYSTEM" /tn "\\Microsoft\\Windows\\Edge\\Edgeupdates" /sc DAILY /tr "C:\\ProgramData\\SystemSettings.exe" /F The task is set to run daily. When the SystemSettings.exe process is launched, it loads the malicious DLL. As this happened, the process and library data were sent to our model for analysis and detection of a potential attack. Example of a SystemSettings.dll load event with a DLL Hijacking module verdict in Kaspersky SIEM The resulting data helped our analys ts highlight a suspicious DLL and analyze it in detail. The library was found to be a Cobalt Strike implant. After loading it, the SystemSettings.exe process attempted to connect to the attackers command-and-control server. DNS query: connect-microsoft[.]com DNS query type: AAAA DNS response: ::ffff:8.219.1[.]155; 8.219.1[.]155:8443 After establishing a connection, the attackers began host reconnaissance to gather various data to develop their attack. C:\\ProgramData\\SystemSettings.exe whoami /priv hostname reg query HKLM\\SOFTWARE\\Microsoft\\Cryptography /v MachineGuid powershell -c $psversiontable dotnet --version systeminfo reg query "HKEY_LOCAL_MACHINE\\SOFTWARE\\VMware, Inc.\\VMware Drivers" cmdkey /list REG query "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp" /v PortNumber reg query "HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Servers netsh wlan show profiles netsh wlan show interfaces set net localgroup administrators net user net user admi nistrator ipconfig /all net config workstation net view arp -a route print netstat -ano tasklist schtasks /query /fo LIST /v net start net share net use netsh firewall show config netsh firewall show state net view /domain net time /domain net group "domain admins" /domain net localgroup administrators /domain net group "domain controllers" /domain net accounts /domain nltest / domain_trusts reg query HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run reg query HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce reg query HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run reg query HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run reg query HKEY_CURRENT_USER\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\RunOnce Based on the attackers TTPs, such as loading Cobalt Strike as a DLL , using the DLL sideloading technique ( 1 , 2 ), and exploiting SharePoint, we can say with a high degree of confi s process showed that it was malware designed to steal information from browsers. Graph of policymanager.dll activity in a sandbox The file directly accesses browser files that contain user data. C:\\Users\\ \\AppData\\Local\\Google\\Chrome\\User Data\\Local State The library file is on the list of files used for DLL hijacking, as published in the HijackLibs project. The project contains a list of common processes and libraries employed in DLL-hijacking attacks, which can be used to detect these attacks. Another incident discovered by our model occurred when a user connected a removable USB drive: Example of a Kaspersky SIEM event where a wsc.dll library was loaded from a USB drive, with a DLL Hijacking module verdict The connected drive s directory contained hidden folders with an identically named shortcut for each of them. The shortcuts had icons typically used for folders. Since file extensions were not shown by default on the drive, the user might have mistaken the shortcut for a folder a nd launched it. In turn, the shortcut opened the corresponding hidden folder and ran an executable file using the following command: "%comspec%" /q /c "RECYCLER.BIN\\1\\CEFHelper.exe [$DIGITS] [$DIGITS]" CEFHelper.exe is a legitimate Avast Antivirus executable that, through DLL sideloading, loaded the wsc.dll library, which is a malicious loader. Code snippet from the malicious file The loader opens a file named AvastAuth.dat, which contains an encrypted backdoor. The library reads the data from the file into memory, decrypts it, and executes it. After this, the backdoor attempts to connect to a remote command-and-control server. The library file, which contains the malicious loader, is on the list of known libraries used for DLL sideloading, as presented on the HijackLibs project website. Conclusion Integrating the model into the product provided the means of early and accurate detection of DLL-hijacking attempts which previously might have gone unnoticed. Even during the pilot testing, the model proved its effectiveness by identifying several incidents using this technique. Going forward, its accuracy will only increase as data accumulates and algorithms are updated in KSN, making this mechanism a reliable element of proactive protection for corporate systems. IoC Legitimate files used for DLL hijacking E0E092D4EFC15F25FD9C0923C52C33D6 loads SystemSettings.dll 09CD396C8F4B4989A83ED7A1F33F5503 loads policymanager.dll A72036F635CECF0DCB1E9C6F49A8FA5B loads wsc.dll Malicious files EA2882B05F8C11A285426F90859F23C6 SystemSettings.dll E83F331BD1EC115524EBFF7043795BBE policymanager.dll 831252E7FA9BD6FA174715647EBCE516 wsc.dll Paths C:\\ProgramData\\SystemSettings.exe C:\\ProgramData\\SystemSettings.dll C:\\Program Files\\Chiniks\\SettingSyncHost.exe C:\\Program Files\\Chiniks\\policymanager.dll D:\\RECYCLER.BIN\\1\\CEFHelper.exe D:\\RECYCLER.BIN\\1\\wsc.dll'}], 'llm_response': None, 'validation': None, 'error': '[Errno -2] Name or service not known'}], 'validation_passed': False, 'attempts_made': 3, 'error': '[Errno -2] Name or service not known'}

---
*Extracted on 2025-10-09 17:55:40 from CTIScraper database*
