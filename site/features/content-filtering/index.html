
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Modern threat intelligence collection and analysis platform">
      
      
      
      
        <link rel="prev" href="../sigma-rules/">
      
      
        <link rel="next" href="../os-detection/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Content Filtering - Huntable CTI Studio</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#content-filtering" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Huntable CTI Studio" class="md-header__button md-logo" aria-label="Huntable CTI Studio" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Huntable CTI Studio
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Content Filtering
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../quickstart/" class="md-tabs__link">
        
  
  
    
  
  Quickstart

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting-started/installation/" class="md-tabs__link">
          
  
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../concepts/huntables/" class="md-tabs__link">
          
  
  
  Concepts

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/add-feed/" class="md-tabs__link">
          
  
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../architecture/overview/" class="md-tabs__link">
          
  
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../sigma-rules/" class="md-tabs__link">
          
  
  
  Features

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../llm/model-selection/" class="md-tabs__link">
          
  
  
  LLM & Models

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ml-training/hunt-scoring/" class="md-tabs__link">
          
  
  
  ML Training

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/cli/" class="md-tabs__link">
          
  
  
  Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../development/setup/" class="md-tabs__link">
          
  
  
  Development

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../prompts/eval-bundle/" class="md-tabs__link">
          
  
  
  Prompts

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../contributing/" class="md-tabs__link">
        
  
  
    
  
  Contributing

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../changelog/" class="md-tabs__link">
        
  
  
    
  
  Changelog

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Huntable CTI Studio" class="md-nav__button md-logo" aria-label="Huntable CTI Studio" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Huntable CTI Studio
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/first-workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    First Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/huntables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Huntables
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/pipelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pipelines
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/observables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Observables
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/add-feed/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Add a Feed
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/extract-observables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Extract Observables
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/generate-sigma/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Generate Sigma Rules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/evaluate-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Evaluate Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/backup-and-restore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backup & Restore
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/source-config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Source Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/memory-tuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory Tuning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/workflow-data-flow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow Data Flow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/scoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/chunking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chunking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/qa-loops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    QA Loops
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sigma-rules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sigma Detection Rules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Content Filtering
  

    
  </span>
  
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../os-detection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OS Detection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cmdline-preprocessor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cmdline Preprocessor
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rag-search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RAG Search
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observable-evaluation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Observable Evaluation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    LLM & Models
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    LLM & Models
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../llm/model-selection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model Selection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../llm/lmstudio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LM Studio Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../llm/extract-agent-eval/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Extract Agent Evaluation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ML Training
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    ML Training
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ml-training/hunt-scoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hunt Scoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ml-training/database-training/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database Training
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/schemas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Schemas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/ml-features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ML Feature Definitions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/versioning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Versioning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Strategy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/manual-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Manual Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/web-app-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Web App Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debugging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/database-queries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database Queries
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/allure-reports/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Allure Reports
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/multi-instance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi-Instance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/workflow-queue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow Queue
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/search-queries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Search Queries
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Prompts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Prompts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prompts/eval-bundle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Eval Bundle Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prompts/huntquery-eval/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hunt Query Eval
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prompts/proctree-eval/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Process Tree Eval
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="content-filtering">Content Filtering<a class="headerlink" href="#content-filtering" title="Permanent link">&para;</a></h1>
<!-- MERGED FROM: features/CONTENT_FILTERING.md, features/CONTENT_FILTER_ML_SETUP.md -->

<h1 id="gpt-4o-content-filtering-system-documentation">GPT-4o Content Filtering System Documentation<a class="headerlink" href="#gpt-4o-content-filtering-system-documentation" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The GPT-4o Content Filtering System is a hybrid machine learning and pattern-based solution designed to reduce OpenAI API costs by intelligently filtering out "not huntable" content before sending it to GPT-4o for analysis. The system achieves <strong>20-80% cost savings</strong> while maintaining analysis quality.</p>
<h2 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#architecture">Architecture</a></li>
<li><a href="#components">Components</a></li>
<li><a href="#how-it-works">How It Works</a></li>
<li><a href="#chunk-based-filtering">Chunk-Based Filtering</a></li>
<li><a href="#pattern-filters">Pattern Filters</a></li>
<li><a href="#machine-learning-model">Machine Learning Model</a></li>
<li><a href="#enhanced-annotation-system">Enhanced Annotation System</a></li>
<li><a href="#usage-examples">Usage Examples</a></li>
<li><a href="#performance-metrics">Performance Metrics</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#api-integration">API Integration</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ul>
<h2 id="architecture">Architecture<a class="headerlink" href="#architecture" title="Permanent link">&para;</a></h2>
<p>The system uses a <strong>hybrid approach</strong> combining:</p>
<ol>
<li><strong>Hunt scoring system</strong> (threat hunting quality assessment)</li>
<li><strong>Pattern-based filters</strong> (fast, deterministic)</li>
<li><strong>Machine learning model</strong> (contextual, adaptive with hunt score integration)</li>
<li><strong>Chunk-based analysis</strong> (preserves context)</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Article Content
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>      ‚Üì
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>Chunking (1000 chars, 200 overlap)
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>      ‚Üì
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>Hunt Scoring (0-100) + Pattern Analysis + ML Classification
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>      ‚Üì
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>Enhanced ML Classification (with hunt score features)
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>      ‚Üì
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>Filtered Content (Huntable Chunks Only)
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>      ‚Üì
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>GPT-4o API
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>      ‚Üì
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>Analysis Results + Cost Savings
</code></pre></div>
<h2 id="enhanced-annotation-system">Enhanced Annotation System<a class="headerlink" href="#enhanced-annotation-system" title="Permanent link">&para;</a></h2>
<p>The enhanced annotation system provides a sophisticated interface for creating high-quality evaluation data for ML model training. It ensures that evaluation excerpts match the production chunking parameters used by the ML model.</p>
<h2 id="ml-vs-hunt-comparison-dashboard">ML vs Hunt Comparison Dashboard<a class="headerlink" href="#ml-vs-hunt-comparison-dashboard" title="Permanent link">&para;</a></h2>
<p>The ML vs Hunt Comparison Dashboard provides comprehensive analytics for monitoring and improving ML model performance. It includes:</p>
<h3 id="key-features">Key Features<a class="headerlink" href="#key-features" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Time Series Analysis</strong>: Track classification trends across model versions</li>
<li><strong>Model Retraining</strong>: Retrain models with user feedback and track progress</li>
<li><strong>Model Evaluation</strong>: Evaluate model performance on test set with detailed metrics</li>
<li><strong>Performance Visualization</strong>: Radar charts and accuracy trends</li>
<li><strong>Backfill Processing</strong>: Process articles with high hunt scores for analysis</li>
</ul>
<h3 id="recent-improvements-october-2024">Recent Improvements (October 2024)<a class="headerlink" href="#recent-improvements-october-2024" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Fixed Agreement Calculation</strong>: Corrected ml_prediction AND hunt_prediction logic</li>
<li><strong>Percentage-Based Metrics</strong>: Converted from raw counts to percentages for better trend analysis</li>
<li><strong>Chart.js Canvas Management</strong>: Proper chart instance destruction to prevent errors</li>
<li><strong>Data Accuracy</strong>: Removed artificial 10,000 limit to show actual data counts (11,644)</li>
<li><strong>UI/UX Enhancements</strong>: Button state management and visual feedback improvements</li>
</ul>
<h3 id="key-features_1">Key Features<a class="headerlink" href="#key-features_1" title="Permanent link">&para;</a></h3>
<h4 id="1-real-time-character-counting">1. Real-Time Character Counting<a class="headerlink" href="#1-real-time-character-counting" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Live character counter</strong> displays current selection length vs. target (1000 chars)</li>
<li><strong>Color-coded guidance</strong>:</li>
<li>üü¢ <strong>Green</strong>: Excellent (950-1000 chars) - Optimal for evaluation</li>
<li>üü° <strong>Yellow</strong>: Too short (&lt;800 chars) - Needs more context</li>
<li>üîµ <strong>Blue</strong>: Acceptable (800-950 chars) - Good but not optimal</li>
<li>üî¥ <strong>Red</strong>: Too long (&gt;1000 chars) - Will be chunked differently</li>
</ul>
<h4 id="2-auto-expand-functionality">2. Auto-Expand Functionality<a class="headerlink" href="#2-auto-expand-functionality" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>üéØ Auto 1000</strong> button automatically expands selections to 1000 characters</li>
<li><strong>Smart boundary detection</strong> respects sentence, paragraph, and word boundaries</li>
<li><strong>Automatic trimming</strong> ensures selections stay within 1000-character limit</li>
<li><strong>Production alignment</strong> matches ML model's chunking parameters</li>
</ul>
<h4 id="3-manual-expansion-controls">3. Manual Expansion Controls<a class="headerlink" href="#3-manual-expansion-controls" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Precise adjustment buttons</strong>: -200, -100, -50, +50, +100, +200 chars</li>
<li><strong>Symmetrical expansion</strong> adds/removes text from both sides equally</li>
<li><strong>Smart boundary detection</strong> prevents cutting mid-word or mid-sentence</li>
</ul>
<h4 id="4-live-selection-highlighting">4. Live Selection Highlighting<a class="headerlink" href="#4-live-selection-highlighting" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Real-time visual feedback</strong> shows expanded text selection in the article</li>
<li><strong>Browser-native highlighting</strong> provides clear visual boundaries</li>
<li><strong>Auto-scroll</strong> brings expanded selections into view when needed</li>
</ul>
<h3 id="ml-training-compliance">ML Training Compliance<a class="headerlink" href="#ml-training-compliance" title="Permanent link">&para;</a></h3>
<p>The annotation system ensures evaluation data quality by:</p>
<ol>
<li><strong>Length Optimization</strong>: Targets 950-1000 characters for optimal ML performance</li>
<li><strong>Boundary Respect</strong>: Maintains semantic coherence by respecting text boundaries</li>
<li><strong>Production Alignment</strong>: Matches the exact chunking used in production ML processing</li>
<li><strong>Quality Control</strong>: Visual feedback and guidance prevent suboptimal selections</li>
</ol>
<h3 id="usage-workflow">Usage Workflow<a class="headerlink" href="#usage-workflow" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Select text</strong> in any article</li>
<li><strong>Review character count</strong> and length guidance</li>
<li><strong>Use üéØ Auto 1000</strong> for optimal expansion</li>
<li><strong>Verify selection</strong> spans appropriate content</li>
<li><strong>Classify</strong> as huntable/not huntable</li>
<li><strong>Save</strong> to database for ML training</li>
</ol>
<p>This system enables threat intelligence experts to create high-quality, production-aligned evaluation datasets that improve ML model accuracy and performance.</p>
<h2 id="components">Components<a class="headerlink" href="#components" title="Permanent link">&para;</a></h2>
<h3 id="1-content-filter-srcutilscontent_filterpy">1. Content Filter (<code>src/utils/content_filter.py</code>)<a class="headerlink" href="#1-content-filter-srcutilscontent_filterpy" title="Permanent link">&para;</a></h3>
<p><strong>Core filtering engine</strong> with pattern matching and ML classification.</p>
<p><strong>Key Features:</strong>
- <strong>92 perfect discriminators</strong> from threat hunting analysis (all string patterns)
- <strong>239 LOLBAS executables</strong> for comprehensive coverage
- <strong>Cross-platform patterns</strong> (Windows, macOS, Linux)
- <strong>Intelligence indicators</strong> (APT groups, campaigns, TTPs)
- <strong>Perfect discriminator protection</strong> - chunks containing threat hunting keywords are never filtered
- <strong>Command line obfuscation pattern support</strong> - advanced regex patterns for cmd.exe obfuscation
- <strong>Hunt score integration</strong> - ML confidence enhanced by threat hunting scores
- RandomForestClassifier with enhanced accuracy through hunt score features
- 27+ extracted features per chunk (including hunt score features)
- Configurable confidence thresholds</p>
<h3 id="2-gpt-4o-optimizer-srcutilsgpt4o_optimizerpy">2. GPT-4o Optimizer (<code>src/utils/gpt4o_optimizer.py</code>)<a class="headerlink" href="#2-gpt-4o-optimizer-srcutilsgpt4o_optimizerpy" title="Permanent link">&para;</a></h3>
<p><strong>Integration layer</strong> for cost optimization and statistics tracking.</p>
<p><strong>Key Features:</strong>
- Content optimization before API calls
- Cost estimation with/without filtering
- Statistics tracking and reporting
- Async/await support</p>
<h3 id="3-enhanced-api-endpoint-srcwebgpt4o_optimized_endpointpy">3. Enhanced API Endpoint (<code>src/web/gpt4o_optimized_endpoint.py</code>)<a class="headerlink" href="#3-enhanced-api-endpoint-srcwebgpt4o_optimized_endpointpy" title="Permanent link">&para;</a></h3>
<p><strong>New API endpoint</strong> with filtering capabilities.</p>
<p><strong>Endpoint:</strong> <code>/api/articles/{article_id}/gpt4o-rank-optimized</code></p>
<p><strong>Parameters:</strong>
- <code>use_filtering</code>: Enable/disable content filtering
- <code>min_confidence</code>: Confidence threshold (0.5-0.8)</p>
<h3 id="4-frontend-integration-srcwebtemplatesgpt4o_optimized_jsjs">4. Frontend Integration (<code>src/web/templates/gpt4o_optimized_js.js</code>)<a class="headerlink" href="#4-frontend-integration-srcwebtemplatesgpt4o_optimized_jsjs" title="Permanent link">&para;</a></h3>
<p><strong>User interface</strong> for optimization controls.</p>
<p><strong>Features:</strong>
- Optimization dialog with cost preview
- Confidence threshold selection
- Real-time cost savings calculation</p>
<h2 id="how-it-works">How It Works<a class="headerlink" href="#how-it-works" title="Permanent link">&para;</a></h2>
<h3 id="step-1-content-chunking">Step 1: Content Chunking<a class="headerlink" href="#step-1-content-chunking" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">chunks</span> <span class="o">=</span> <span class="n">chunk_content</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="c1"># Example: 2,500 char article ‚Üí 4 overlapping chunks</span>
</code></pre></div>
<h3 id="step-2-pattern-analysis">Step 2: Pattern Analysis<a class="headerlink" href="#step-2-pattern-analysis" title="Permanent link">&para;</a></h3>
<p>Each chunk is analyzed against:
- <strong>Huntable patterns:</strong> <code>powershell\.exe.*-encodedCommand</code>, <code>invoke-webrequest.*-uri</code>, etc.
- <strong>Not huntable patterns:</strong> <code>acknowledgement|gratitude</code>, <code>contact.*mandiant</code>, etc.</p>
<h3 id="step-3-ml-classification">Step 3: ML Classification<a class="headerlink" href="#step-3-ml-classification" title="Permanent link">&para;</a></h3>
<p>The ML model extracts 273 features and classifies each chunk:
- Pattern match counts
- Text characteristics (length, word count)
- Technical indicators (commands, URLs, IPs)
- Quality ratios (technical vs marketing terms)</p>
<h3 id="step-4-filtering-decision">Step 4: Filtering Decision<a class="headerlink" href="#step-4-filtering-decision" title="Permanent link">&para;</a></h3>
<p>Chunks are kept or removed based on:
- <strong>Perfect discriminator check</strong> - chunks with threat hunting keywords are always preserved
- ML model confidence score
- User-defined threshold (0.5-0.8)
- Pattern match analysis</p>
<h3 id="step-5-content-reconstruction">Step 5: Content Reconstruction<a class="headerlink" href="#step-5-content-reconstruction" title="Permanent link">&para;</a></h3>
<p>Only huntable chunks are reassembled and sent to GPT-4o.</p>
<h2 id="chunk-based-filtering">Chunk-Based Filtering<a class="headerlink" href="#chunk-based-filtering" title="Permanent link">&para;</a></h2>
<h3 id="why-chunk-based">Why Chunk-Based?<a class="headerlink" href="#why-chunk-based" title="Permanent link">&para;</a></h3>
<p><strong>‚úÖ Advantages:</strong>
- Preserves context and sentence integrity
- Avoids fragmenting technical content
- More accurate than word-by-word filtering
- Handles mixed content intelligently
- Configurable granularity</p>
<p><strong>‚ùå Keyword-only filtering problems:</strong>
- Breaks sentences mid-way
- Loses context around technical terms
- Creates fragmented, unreadable content</p>
<h3 id="chunking-algorithm">Chunking Algorithm<a class="headerlink" href="#chunking-algorithm" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">chunk_content</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">):</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="sd">    Split content into overlapping chunks.</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="sd">    Args:</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="sd">        chunk_size: Maximum characters per chunk</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="sd">        overlap: Characters to overlap between chunks</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="sd">    Returns:</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="sd">        List of (start_offset, end_offset, chunk_text) tuples</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
<p>When a sentence boundary pulls the chunk end back, the next chunk starts at most at <code>end - overlap</code>
(or simply at <code>end</code> if the chunk is shorter than the overlap) and always moves forward by at least one
character. This keeps the chunks tightly overlapping without leaving any gaps between what the debugger
visualizes and what the filter feeds into the LLM.</p>
<p><strong>Example Chunking:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>Original: 1,246 chars
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>Chunk 1: 0-337 chars    (Technical commands)
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>Chunk 2: 337-736 chars  (Acknowledgments + technical details)
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>Chunk 3: 736-1103 chars (Contact info + IP addresses)
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>Chunk 4: 1103-1246 chars (Lateral movement details)
</code></pre></div></p>
<h3 id="chunk-size-impact">Chunk Size Impact<a class="headerlink" href="#chunk-size-impact" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Chunk Size</th>
<th>Chunks Removed</th>
<th>Content Reduction</th>
</tr>
</thead>
<tbody>
<tr>
<td>200 chars</td>
<td>7 chunks</td>
<td>88.0%</td>
</tr>
<tr>
<td>400 chars</td>
<td>3 chunks</td>
<td>73.0%</td>
</tr>
<tr>
<td>600 chars</td>
<td>3 chunks</td>
<td>100.0%</td>
</tr>
<tr>
<td>1000 chars</td>
<td>1 chunk</td>
<td>80.3%</td>
</tr>
</tbody>
</table>
<h3 id="chunk-debugger-safeguards-controls">Chunk Debugger Safeguards &amp; Controls<a class="headerlink" href="#chunk-debugger-safeguards-controls" title="Permanent link">&para;</a></h3>
<p>Large articles can generate hundreds of chunks, so the debugger balances responsiveness with completeness:</p>
<ul>
<li><strong>Initial Analysis Pass</strong>: Processes up to <code>CHUNK_DEBUG_MAX_CHUNKS</code> (default <strong>150</strong>) using <code>CHUNK_DEBUG_CONCURRENCY</code> workers (default <strong>4</strong>) and a per-chunk timeout defined by <code>CHUNK_DEBUG_CHUNK_TIMEOUT</code> (default <strong>12s</strong>). When the cap is reached, the UI surfaces a ‚ö†Ô∏è Partial Analysis banner.</li>
<li><strong>Finish Full Analysis</strong>: Analysts can click the inline button to re-run the endpoint with <code>full_analysis=true</code>, optionally using <code>CHUNK_DEBUG_FULL_CONCURRENCY</code> and <code>CHUNK_DEBUG_FULL_TIMEOUT</code> overrides (falling back to the initial values if unset).</li>
<li><strong>Processing Summary</strong>: Every response now includes <code>processing_summary</code> (processed count, total count, remaining chunks, concurrency, timeout, and whether full analysis ran) so operators can audit coverage.</li>
<li><strong>Timeout Visibility</strong>: Chunks that exceed the timeout render with explicit warnings in both the API and UI, making slow regions easy to spot.</li>
<li><strong>Confidence Band Filter</strong>: UI control to isolate chunks with confidence between 40% and 60% for quicker review of borderline decisions.</li>
</ul>
<table>
<thead>
<tr>
<th>Environment Variable</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CHUNK_DEBUG_MAX_CHUNKS</code></td>
<td><code>150</code></td>
<td>Safety cap before the finish button appears</td>
</tr>
<tr>
<td><code>CHUNK_DEBUG_CONCURRENCY</code></td>
<td><code>4</code></td>
<td>Worker count for the initial analysis pass</td>
</tr>
<tr>
<td><code>CHUNK_DEBUG_CHUNK_TIMEOUT</code></td>
<td><code>12.0</code></td>
<td>Per-chunk timeout (seconds) for the initial pass</td>
</tr>
<tr>
<td><code>CHUNK_DEBUG_FULL_CONCURRENCY</code></td>
<td><em>(optional)</em></td>
<td>Worker override when finishing the analysis</td>
</tr>
<tr>
<td><code>CHUNK_DEBUG_FULL_TIMEOUT</code></td>
<td><em>(optional)</em></td>
<td>Timeout override when finishing the analysis</td>
</tr>
</tbody>
</table>
<p>Tune these values with production telemetry (CPU load, latency, timeout frequency) to match your deployment‚Äôs capacity.</p>
<h2 id="pattern-filters">Pattern Filters<a class="headerlink" href="#pattern-filters" title="Permanent link">&para;</a></h2>
<p>The pattern-based classification uses the comprehensive Hunt Scoring keyword system from <code>src/utils/content.py</code> (see <a href="../../architecture/scoring/">Scoring</a> for current counts).</p>
<h3 id="huntable-patterns">Huntable Patterns<a class="headerlink" href="#huntable-patterns" title="Permanent link">&para;</a></h3>
<p><strong>Perfect Discriminators (92 patterns):</strong>
- <strong>Process Names</strong>: <code>rundll32</code>, <code>msiexec</code>, <code>svchost</code>, <code>lsass.exe</code>, <code>powershell.exe</code>
- <strong>Registry References</strong>: <code>hklm</code>, <code>appdata</code>, <code>programdata</code>, <code>WINDIR</code>, <code>wbem</code>
- <strong>Command Execution</strong>: <code>iex</code>, <code>wmic</code>, <code>comspec</code>, <code>findstr</code>
- <strong>File Types</strong>: <code>.lnk</code>, <code>.iso</code>, <code>MZ</code>, <code>-accepteula</code>
- <strong>Path Patterns</strong>: <code>\temp\</code>, <code>\pipe\</code>, <code>%WINDIR%</code>, <code>%wintmp%</code>
- <strong>Cross-Platform</strong>: <code>homebrew</code>, <code>/users/shared/</code>, <code>chmod 777</code>, <code>tccd</code>, <code>spctl</code>
- <strong>Technical Patterns</strong>: <code>xor</code>, <code>tcp://</code>, <code>CN=</code>, <code>-ComObject</code>, <code>Base64</code></p>
<p><strong>Good Discriminators (89 patterns):</strong>
- <strong>Windows Paths</strong>: <code>c:\windows\</code>, <code>temp</code>, <code>pipe</code>, <code>::</code>
- <strong>File Extensions</strong>: <code>.bat</code>, <code>.ps1</code>, <code>.exe</code>, <code>mach-o</code>, <code>plist</code>
- <strong>Technical Patterns</strong>: <code>==</code>, <code>[.]</code>, <code>--&gt;</code>, <code>currentversion</code>, <code>Event ID</code>
- <strong>Attack Techniques</strong>: <code>mimikatz</code>, <code>kerberoast</code>, <code>psexec</code>, <code>payload</code>
- <strong>Cross-Platform</strong>: <code>osascript</code>, <code>TCC.db</code>, <code>sudo</code>, <code>cron</code>, <code>launchd</code>
- <strong>Cloud/Network</strong>: <code>aws</code>, <code>azure</code>, <code>gcp</code>, <code>ssl</code>, <code>proxy</code>, <code>network</code></p>
<p><strong>LOLBAS Executables (239 patterns):</strong>
- <strong>System Tools</strong>: <code>certutil</code>, <code>cmd</code>, <code>schtasks</code>, <code>wmic</code>, <code>regsvr32</code>, <code>rundll32</code>
- <strong>Network Tools</strong>: <code>bitsadmin</code>, <code>ftp</code>, <code>netsh</code>, <code>powershell</code>
- <strong>Script Engines</strong>: <code>cscript</code>, <code>mshta</code>, <code>wscript</code>, <code>msiexec</code>
- <strong>File Operations</strong>: <code>forfiles</code>, <code>explorer</code>, <code>ieexec</code>, <code>conhost</code>
- <strong>And 200+ more legitimate Windows executables commonly abused by threat actors</strong></p>
<p><strong>Intelligence Indicators (56 patterns):</strong>
- <strong>Threat Activity</strong>: <code>APT</code>, <code>threat actor</code>, <code>campaign</code>, <code>incident</code>, <code>breach</code>, <code>compromise</code>
- <strong>Threat Groups</strong>: <code>FIN</code>, <code>TA</code>, <code>UNC</code>, <code>APT1</code>, <code>APT28</code>, <code>Lazarus</code>, <code>Carbanak</code>
- <strong>Attack Types</strong>: <code>ransomware</code>, <code>data breach</code>, <code>cyber attack</code>, <code>espionage</code>
- <strong>Technical Terms</strong>: <code>IOC</code>, <code>indicator</code>, <code>TTP</code>, <code>technique</code>, <code>malware family</code>
- <strong>Attack Techniques</strong>: <code>golden-ticket</code>, <code>silver-ticket</code>, <code>lateral movement</code></p>
<h3 id="not-huntable-patterns-25-patterns">Not Huntable Patterns (25 patterns)<a class="headerlink" href="#not-huntable-patterns-25-patterns" title="Permanent link">&para;</a></h3>
<p><strong>Educational/Marketing Content:</strong>
- <code>what is</code>, <code>how to</code>, <code>guide to</code>, <code>tutorial</code>, <code>best practices</code>
- <code>statistics</code>, <code>survey</code>, <code>report shows</code>, <code>study reveals</code>
- <code>learn more</code>, <code>read more</code>, <code>click here</code>, <code>download now</code>
- <code>free trial</code>, <code>contact us</code>, <code>get started</code>, <code>sign up</code>
- <code>blog post</code>, <code>newsletter</code>, <code>webinar</code>, <code>training</code>
- <code>overview</code>, <code>introduction</code>, <code>basics</code>, <code>fundamentals</code></p>
<h2 id="machine-learning-model">Machine Learning Model<a class="headerlink" href="#machine-learning-model" title="Permanent link">&para;</a></h2>
<h3 id="model-details">Model Details<a class="headerlink" href="#model-details" title="Permanent link">&para;</a></h3>
<p><strong>Algorithm:</strong> RandomForestClassifier
<strong>Training Data:</strong> 222 annotations (167 huntable, 55 not huntable) + 81 feedback samples
<strong>Latest Model:</strong> Trained on 278 total samples
<strong>Accuracy:</strong> 80% on test data (requires validation)
<strong>Features:</strong> 27 extracted features per chunk</p>
<h3 id="feature-categories">Feature Categories<a class="headerlink" href="#feature-categories" title="Permanent link">&para;</a></h3>
<p><strong>Pattern-Based Features:</strong>
- <code>huntable_pattern_count</code>: Number of huntable pattern matches
- <code>not_huntable_pattern_count</code>: Number of not huntable pattern matches
- <code>huntable_pattern_ratio</code>: Ratio of huntable patterns to total words
- <code>not_huntable_pattern_ratio</code>: Ratio of not huntable patterns to total words</p>
<p><strong>Text Characteristics:</strong>
- <code>char_count</code>: Total character count
- <code>word_count</code>: Total word count
- <code>sentence_count</code>: Number of sentences
- <code>avg_word_length</code>: Average word length</p>
<p><strong>Technical Content Features:</strong>
- <code>command_count</code>: Number of command patterns
- <code>url_count</code>: Number of URLs
- <code>ip_count</code>: Number of IP addresses
- <code>file_path_count</code>: Number of file paths
- <code>process_count</code>: Number of process names
- <code>cve_count</code>: Number of CVE references
- <code>technical_term_count</code>: Number of technical terms</p>
<p><strong>Quality Indicators:</strong>
- <code>marketing_term_count</code>: Number of marketing terms
- <code>acknowledgment_count</code>: Number of acknowledgment terms
- <code>marketing_term_ratio</code>: Ratio of marketing terms
- <code>technical_term_ratio</code>: Ratio of technical terms</p>
<p><strong>Structural Features:</strong>
- <code>has_code_blocks</code>: Boolean for code block presence
- <code>has_commands</code>: Boolean for command presence
- <code>has_urls</code>: Boolean for URL presence
- <code>has_file_paths</code>: Boolean for file path presence</p>
<p><strong>Hunt Score Integration (NEW):</strong>
- <code>hunt_score</code>: Normalized hunt score (0-1 range)
- <code>hunt_score_high</code>: Boolean for high-quality content (‚â•70)
- <code>hunt_score_medium</code>: Boolean for medium-quality content (30-69)
- <code>hunt_score_low</code>: Boolean for low-quality content (&lt;30)</p>
<h3 id="training-process">Training Process<a class="headerlink" href="#training-process" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Train the model</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>python3<span class="w"> </span>scripts/train_content_filter.py<span class="w"> </span>--data<span class="w"> </span>highlighted_text_classifications.csv
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="c1"># Output:</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="c1"># Model trained successfully. Accuracy: 0.800</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="c1"># Classification Report:</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="c1">#               precision    recall  f1-score   support</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="c1"># Not Huntable       0.75      1.00      0.86         3</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="c1">#     Huntable       1.00      0.50      0.67         2</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="c1">#     accuracy                           0.80         5</span>
</code></pre></div>
<h2 id="usage-examples">Usage Examples<a class="headerlink" href="#usage-examples" title="Permanent link">&para;</a></h2>
<h3 id="basic-usage">Basic Usage<a class="headerlink" href="#basic-usage" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.utils.content_filter</span><span class="w"> </span><span class="kn">import</span> <span class="n">ContentFilter</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="c1"># Initialize filter</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="n">filter_system</span> <span class="o">=</span> <span class="n">ContentFilter</span><span class="p">(</span><span class="s1">&#39;models/content_filter.pkl&#39;</span><span class="p">)</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="c1"># Filter content</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="n">result</span> <span class="o">=</span> <span class="n">filter_system</span><span class="o">.</span><span class="n">filter_content</span><span class="p">(</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    <span class="n">content</span><span class="o">=</span><span class="n">article_content</span><span class="p">,</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    <span class="n">min_confidence</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>    <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1000</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="p">)</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Content reduction: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">cost_savings</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Filtered content: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">filtered_content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="api-integration">API Integration<a class="headerlink" href="#api-integration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.utils.llm_optimizer</span><span class="w"> </span><span class="kn">import</span> <span class="n">optimize_article_content</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="c1"># Optimize content for GPT-4o</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="n">optimization_result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">optimize_article_content</span><span class="p">(</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="n">content</span><span class="o">=</span><span class="n">article_content</span><span class="p">,</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    <span class="n">min_confidence</span><span class="o">=</span><span class="mf">0.7</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="p">)</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="k">if</span> <span class="n">optimization_result</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]:</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cost savings: $</span><span class="si">{</span><span class="n">optimization_result</span><span class="p">[</span><span class="s1">&#39;cost_savings&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tokens saved: </span><span class="si">{</span><span class="n">optimization_result</span><span class="p">[</span><span class="s1">&#39;tokens_saved&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="web-api-usage">Web API Usage<a class="headerlink" href="#web-api-usage" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1">// Call optimized endpoint</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/articles/</span><span class="si">${</span><span class="nx">articleId</span><span class="si">}</span><span class="sb">/gpt4o-rank-optimized`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">        </span><span class="nx">api_key</span><span class="o">:</span><span class="w"> </span><span class="nx">apiKey</span><span class="p">,</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">        </span><span class="nx">use_filtering</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">        </span><span class="nx">min_confidence</span><span class="o">:</span><span class="w"> </span><span class="mf">0.7</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="p">});</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Cost savings: $</span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">optimization</span><span class="p">.</span><span class="nx">cost_savings</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</code></pre></div>
<h2 id="performance-metrics">Performance Metrics<a class="headerlink" href="#performance-metrics" title="Permanent link">&para;</a></h2>
<h3 id="cost-savings-analysis">Cost Savings Analysis<a class="headerlink" href="#cost-savings-analysis" title="Permanent link">&para;</a></h3>
<p><strong>Sample Content (1,996 chars, ~499 tokens):</strong></p>
<table>
<thead>
<tr>
<th>Confidence Threshold</th>
<th>Content Reduction</th>
<th>Tokens Saved</th>
<th>Cost Savings</th>
</tr>
</thead>
<tbody>
<tr>
<td>0.5 (Aggressive)</td>
<td>52.6%</td>
<td>263</td>
<td>$0.0013</td>
</tr>
<tr>
<td>0.7 (Balanced)</td>
<td>77.7%</td>
<td>388</td>
<td>$0.0019</td>
</tr>
<tr>
<td>0.8 (Conservative)</td>
<td>77.7%</td>
<td>388</td>
<td>$0.0019</td>
</tr>
</tbody>
</table>
<h3 id="content-classification-examples">Content Classification Examples<a class="headerlink" href="#content-classification-examples" title="Permanent link">&para;</a></h3>
<p><strong>‚úÖ KEPT (Sent to OpenAI):</strong>
- <code>"Command: powershell.exe -encodedCommand REDACTEDBASE64PAYLOAD=="</code>
- <code>"Cleartext: Invoke-WebRequest -uri http://REDACTED:REDACTED/d3d11.dll"</code>
- <code>"the Centre.exe executable connected to these IP addresses: 104.21.16[.]1"</code></p>
<p><strong>‚ùå REMOVED (Not sent to OpenAI):</strong>
- <code>"Acknowledgement We would like to extend our gratitude to the Sitecore team..."</code>
- <code>"Contact Mandiant If you believe your systems may be compromised..."</code>
- <code>"This highlights how quickly threat actors can pivot to leverage new vulnerabilities..."</code></p>
<h3 id="model-performance">Model Performance<a class="headerlink" href="#model-performance" title="Permanent link">&para;</a></h3>
<p><strong>Accuracy:</strong> 80% on test data
<strong>Precision:</strong> 100% for Huntable, 75% for Not Huntable
<strong>Recall:</strong> 50% for Huntable, 100% for Not Huntable</p>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<h3 id="confidence-thresholds">Confidence Thresholds<a class="headerlink" href="#confidence-thresholds" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Threshold</th>
<th>Filtering Behavior</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td>0.5</td>
<td>Aggressive filtering</td>
<td>Maximum cost savings</td>
</tr>
<tr>
<td>0.7</td>
<td>Balanced filtering</td>
<td>Recommended default</td>
</tr>
<tr>
<td>0.8</td>
<td>Conservative filtering</td>
<td>Preserve more content</td>
</tr>
</tbody>
</table>
<h3 id="chunk-size-settings">Chunk Size Settings<a class="headerlink" href="#chunk-size-settings" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Chunk Size</th>
<th>Granularity</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td>200 chars</td>
<td>Fine-grained</td>
<td>Detailed analysis</td>
</tr>
<tr>
<td>400 chars</td>
<td>Medium</td>
<td>Balanced approach</td>
</tr>
<tr>
<td>1000 chars</td>
<td>Coarse</td>
<td>Default setting</td>
</tr>
</tbody>
</table>
<h3 id="environment-variables">Environment Variables<a class="headerlink" href="#environment-variables" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># Model path</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nv">CONTENT_FILTER_MODEL_PATH</span><span class="o">=</span>models/content_filter.pkl
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="c1"># Default settings</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="nv">DEFAULT_CHUNK_SIZE</span><span class="o">=</span><span class="m">1000</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="nv">DEFAULT_OVERLAP</span><span class="o">=</span><span class="m">200</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="nv">DEFAULT_CONFIDENCE_THRESHOLD</span><span class="o">=</span><span class="m">0</span>.7
</code></pre></div>
<blockquote>
<p><strong>Note</strong>: The standalone content filtering threshold defaults to 0.7. The agentic workflow's Junk Filter step uses a separate threshold defaulting to 0.8, configurable via <code>junk_filter_threshold</code> in the workflow configuration.</p>
</blockquote>
<h2 id="api-integration_1">API Integration<a class="headerlink" href="#api-integration_1" title="Permanent link">&para;</a></h2>
<h3 id="new-endpoint">New Endpoint<a class="headerlink" href="#new-endpoint" title="Permanent link">&para;</a></h3>
<p><strong>URL:</strong> <code>/api/articles/{article_id}/gpt4o-rank-optimized</code></p>
<p><strong>Method:</strong> POST</p>
<p><strong>Request Body:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="p">{</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="nt">&quot;api_key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sk-...&quot;</span><span class="p">,</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="nt">&quot;use_filtering&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="nt">&quot;min_confidence&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.7</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>Response:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="nt">&quot;article_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">    </span><span class="nt">&quot;analysis&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SIGMA HUNTABILITY SCORE: 8...&quot;</span><span class="p">,</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">    </span><span class="nt">&quot;optimization&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">        </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">        </span><span class="nt">&quot;cost_savings&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0019</span><span class="p">,</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">        </span><span class="nt">&quot;tokens_saved&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">388</span><span class="p">,</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">        </span><span class="nt">&quot;chunks_removed&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">        </span><span class="nt">&quot;min_confidence&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.7</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="frontend-integration">Frontend Integration<a class="headerlink" href="#frontend-integration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1">// Show optimization dialog</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">optimizationOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">showOptimizationDialog</span><span class="p">();</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="c1">// Call optimized endpoint</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/articles/</span><span class="si">${</span><span class="nx">articleId</span><span class="si">}</span><span class="sb">/gpt4o-rank-optimized`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">        </span><span class="nx">api_key</span><span class="o">:</span><span class="w"> </span><span class="nx">apiKey</span><span class="p">,</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">        </span><span class="nx">use_filtering</span><span class="o">:</span><span class="w"> </span><span class="nx">optimizationOptions</span><span class="p">.</span><span class="nx">useFiltering</span><span class="p">,</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">        </span><span class="nx">min_confidence</span><span class="o">:</span><span class="w"> </span><span class="nx">optimizationOptions</span><span class="p">.</span><span class="nx">minConfidence</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="p">});</span>
</code></pre></div>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="common-issues">Common Issues<a class="headerlink" href="#common-issues" title="Permanent link">&para;</a></h3>
<p><strong>1. Model Not Found</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>Error: [Errno 2] No such file or directory: &#39;models/content_filter.pkl&#39;
</code></pre></div>
<strong>Solution:</strong> Train the model first:
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>python3<span class="w"> </span>scripts/train_content_filter.py
</code></pre></div></p>
<p><strong>2. Low Accuracy</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>Model accuracy: 0.60
</code></pre></div>
<strong>Solution:</strong> 
- Collect more training data
- Retrain with updated annotations
- Adjust feature extraction</p>
<p><strong>3. Too Aggressive Filtering</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>Content reduction: 95%
</code></pre></div>
<strong>Solution:</strong> 
- Lower confidence threshold (0.5 instead of 0.7)
- Increase chunk size (1000 instead of 400)
- Review pattern rules</p>
<p><strong>4. Missing Technical Content</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>Technical commands removed incorrectly
</code></pre></div>
<strong>Solution:</strong>
- Add more huntable patterns
- Retrain model with better examples
- Adjust ML feature weights</p>
<h3 id="debugging">Debugging<a class="headerlink" href="#debugging" title="Permanent link">&para;</a></h3>
<p><strong>Enable Verbose Logging:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Test Individual Components:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># Test pattern matching</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">is_huntable</span><span class="p">,</span> <span class="n">confidence</span> <span class="o">=</span> <span class="n">filter_system</span><span class="o">.</span><span class="n">_pattern_based_classification</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="c1"># Test ML model</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="n">is_huntable</span><span class="p">,</span> <span class="n">confidence</span> <span class="o">=</span> <span class="n">filter_system</span><span class="o">.</span><span class="n">predict_huntability</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="c1"># Test feature extraction</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="n">features</span> <span class="o">=</span> <span class="n">filter_system</span><span class="o">.</span><span class="n">extract_features</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Comprehensive Testing:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>python3<span class="w"> </span>scripts/test_filter_comprehensive.py
</code></pre></div></p>
<h2 id="ml-mismatch-analysis-new">ML Mismatch Analysis (NEW)<a class="headerlink" href="#ml-mismatch-analysis-new" title="Permanent link">&para;</a></h2>
<h3 id="overview_1">Overview<a class="headerlink" href="#overview_1" title="Permanent link">&para;</a></h3>
<p>The system now includes comprehensive ML mismatch analysis to identify discrepancies between ML predictions and actual filtering decisions.</p>
<h3 id="features">Features<a class="headerlink" href="#features" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Visual Indicators</strong>: Yellow rings around mismatched chunks in visualization</li>
<li><strong>Filter Button</strong>: "Show ML Mismatches" to isolate problematic chunks</li>
<li><strong>Statistics Dashboard</strong>: Real-time accuracy metrics and mismatch counts</li>
<li><strong>Chunk Tags</strong>: "ML MISMATCH" badges for easy identification</li>
</ul>
<h3 id="api-integration_2">API Integration<a class="headerlink" href="#api-integration_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># Chunk debug endpoint with mismatch analysis</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">GET</span> <span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">articles</span><span class="o">/</span><span class="p">{</span><span class="n">article_id</span><span class="p">}</span><span class="o">/</span><span class="n">chunk</span><span class="o">-</span><span class="n">debug</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="c1"># Response includes:</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="p">{</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>    <span class="s2">&quot;ml_stats&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>        <span class="s2">&quot;total_predictions&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>        <span class="s2">&quot;correct_predictions&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>        <span class="s2">&quot;accuracy_percent&quot;</span><span class="p">:</span> <span class="mf">72.2</span><span class="p">,</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>        <span class="s2">&quot;mismatches&quot;</span><span class="p">:</span> <span class="mi">5</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>    <span class="p">},</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>    <span class="s2">&quot;chunk_analysis&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>        <span class="p">{</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>            <span class="s2">&quot;ml_mismatch&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>            <span class="s2">&quot;ml_prediction_correct&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>            <span class="s2">&quot;ml_details&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>                <span class="s2">&quot;prediction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>                <span class="s2">&quot;prediction_label&quot;</span><span class="p">:</span> <span class="s2">&quot;Not Huntable&quot;</span><span class="p">,</span>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>                <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="mf">0.665</span>
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>            <span class="p">}</span>
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a>        <span class="p">}</span>
<a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a>    <span class="p">]</span>
<a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="p">}</span>
</code></pre></div>
<h3 id="use-cases">Use Cases<a class="headerlink" href="#use-cases" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Model Validation</strong>: Identify where ML predictions fail</li>
<li><strong>Training Data Collection</strong>: Gather examples for model improvement</li>
<li><strong>Quality Assurance</strong>: Monitor filtering accuracy over time</li>
<li><strong>Debugging</strong>: Understand why specific chunks were filtered</li>
</ul>
<h2 id="chunk-debug-interface-new">Chunk Debug Interface (NEW)<a class="headerlink" href="#chunk-debug-interface-new" title="Permanent link">&para;</a></h2>
<h3 id="features_1">Features<a class="headerlink" href="#features_1" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Interactive Visualization</strong>: Click-to-highlight chunks</li>
<li><strong>Real-time Filtering</strong>: Multiple filter buttons for different chunk types</li>
<li><strong>Detailed Analysis</strong>: Feature breakdown and ML prediction details</li>
<li><strong>Feedback System</strong>: User feedback collection for model improvement</li>
</ul>
<h3 id="filter-options">Filter Options<a class="headerlink" href="#filter-options" title="Permanent link">&para;</a></h3>
<ul>
<li>Show All Chunks</li>
<li>Show Kept Only</li>
<li>Show Removed Only</li>
<li>Show Threat Keywords</li>
<li>Show Perfect Discriminators</li>
<li>Show ML Predictions</li>
<li><strong>Show ML Mismatches</strong> (NEW)</li>
</ul>
<h2 id="future-enhancements">Future Enhancements<a class="headerlink" href="#future-enhancements" title="Permanent link">&para;</a></h2>
<h3 id="planned-improvements">Planned Improvements<a class="headerlink" href="#planned-improvements" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Expand Training Data</strong></li>
<li>Collect more annotations</li>
<li>Include diverse content types</li>
<li>
<p>Improve model accuracy</p>
</li>
<li>
<p><strong>Advanced Features</strong></p>
</li>
<li>Dynamic chunk sizing</li>
<li>Context-aware filtering</li>
<li>
<p>Multi-language support</p>
</li>
<li>
<p><strong>Performance Optimization</strong></p>
</li>
<li>Caching of model predictions</li>
<li>Parallel chunk processing</li>
<li>
<p>GPU acceleration</p>
</li>
<li>
<p><strong>Analytics Dashboard</strong></p>
</li>
<li>Cost savings tracking</li>
<li>Filtering effectiveness metrics</li>
<li>User preference learning</li>
</ol>
<h3 id="contributing">Contributing<a class="headerlink" href="#contributing" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Add New Patterns</strong></li>
<li>Update <code>pattern_rules</code> in <code>ContentFilter</code></li>
<li>Test with diverse content</li>
<li>
<p>Document pattern purpose</p>
</li>
<li>
<p><strong>Improve ML Model</strong></p>
</li>
<li>Add new features</li>
<li>Collect training data</li>
<li>
<p>Experiment with algorithms</p>
</li>
<li>
<p><strong>Enhance API</strong></p>
</li>
<li>Add new endpoints</li>
<li>Improve error handling</li>
<li>Add rate limiting</li>
</ol>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>The GPT-4o Content Filtering System successfully reduces API costs by 20-80% while maintaining analysis quality. The hybrid approach combining pattern filters and machine learning provides both speed and accuracy, making it an effective solution for cost optimization in threat intelligence analysis.</p>
<p><strong>Key Benefits:</strong>
- ‚úÖ Significant cost savings (20-80%)
- ‚úÖ Preserves technical content quality
- ‚úÖ User-configurable filtering
- ‚úÖ Backward compatibility
- ‚úÖ Comprehensive logging and metrics</p>
<p><strong>Next Steps:</strong>
- Deploy to production environment
- Monitor cost savings and quality metrics
- Collect user feedback for improvements
- Expand training data for better accuracy</p>
<hr />
<h1 id="content-filter-ml-model-setup">Content Filter ML Model Setup<a class="headerlink" href="#content-filter-ml-model-setup" title="Permanent link">&para;</a></h1>
<h2 id="overview_2">Overview<a class="headerlink" href="#overview_2" title="Permanent link">&para;</a></h2>
<p>The content filtering system uses a trained Random Forest ML model for classification. The model is <strong>automatically trained during setup</strong> using default training data.</p>
<p><strong>Setup</strong>: The ML model is created automatically when you run <code>./setup.sh</code>. No manual configuration required.</p>
<h2 id="automatic-setup">Automatic Setup<a class="headerlink" href="#automatic-setup" title="Permanent link">&para;</a></h2>
<p>The ML model is automatically trained during <code>./setup.sh</code>. The setup script:</p>
<ol>
<li>Creates default training data with examples of huntable and not huntable content</li>
<li>Trains a Random Forest classifier</li>
<li>Saves the model to <code>models/content_filter.pkl</code></li>
</ol>
<p><strong>No manual steps required</strong> - the model is ready to use after setup completes.</p>
<h2 id="manual-training-advanced">Manual Training (Advanced)<a class="headerlink" href="#manual-training-advanced" title="Permanent link">&para;</a></h2>
<p>If you need to retrain or update the model:</p>
<h3 id="option-1-train-from-user-feedback-recommended">Option 1: Train from User Feedback (Recommended)<a class="headerlink" href="#option-1-train-from-user-feedback-recommended" title="Permanent link">&para;</a></h3>
<p>If you've collected chunk classification feedback through the UI:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># Retrain using feedback from database</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>python3<span class="w"> </span>scripts/retrain_with_feedback.py
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="c1"># This will:</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="c1"># 1. Load feedback from chunk_classification_feedback table</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="c1"># 2. Combine with existing annotations</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="c1"># 3. Train new model</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="c1"># 4. Save to models/content_filter.pkl</span>
</code></pre></div>
<h3 id="option-2-train-from-annotations">Option 2: Train from Annotations<a class="headerlink" href="#option-2-train-from-annotations" title="Permanent link">&para;</a></h3>
<p>If you have article annotations in the database:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># Export annotations to CSV</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>python3<span class="w"> </span>scripts/export_highlights.py<span class="w"> </span>highlighted_text_classifications.csv
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="c1"># Train the model</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>python3<span class="w"> </span>scripts/train_content_filter.py<span class="w"> </span>--data<span class="w"> </span>highlighted_text_classifications.csv
</code></pre></div>
<h3 id="option-3-manual-training-data">Option 3: Manual Training Data<a class="headerlink" href="#option-3-manual-training-data" title="Permanent link">&para;</a></h3>
<p>Create a CSV file with columns: <code>highlighted_text</code>, <code>classification</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>highlighted_text,classification
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>&quot;Post exploitation Huntress has observed...&quot;,Huntable
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>&quot;Thank you for reading this article...&quot;,Not Huntable
</code></pre></div>
<p>Then train:
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>python3<span class="w"> </span>scripts/train_content_filter.py<span class="w"> </span>--data<span class="w"> </span>your_training_data.csv
</code></pre></div></p>
<h2 id="verification">Verification<a class="headerlink" href="#verification" title="Permanent link">&para;</a></h2>
<p>After training, verify the model loads:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># Check if model file exists</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>ls<span class="w"> </span>-lh<span class="w"> </span>models/content_filter.pkl
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="c1"># Test model loading</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>python3<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="s2">from src.utils.content_filter import ContentFilter</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="s2">cf = ContentFilter()</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="s2">cf.load_model()</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="s2">print(&#39;‚úÖ Model loaded&#39; if cf.model else &#39;‚ùå Model failed to load&#39;)</span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="s2">&quot;</span>
</code></pre></div>
<h2 id="using-the-model">Using the Model<a class="headerlink" href="#using-the-model" title="Permanent link">&para;</a></h2>
<p>Once trained, the model is automatically loaded when the web app starts. You'll see:</p>
<ul>
<li><strong>ML predictions</strong> in chunk debug views</li>
<li><strong>Feedback buttons</strong> for ML classifications</li>
<li><strong>ML confidence scores</strong> instead of pattern-based only</li>
</ul>
<h2 id="collecting-training-data">Collecting Training Data<a class="headerlink" href="#collecting-training-data" title="Permanent link">&para;</a></h2>
<h3 id="via-ui-feedback">Via UI Feedback<a class="headerlink" href="#via-ui-feedback" title="Permanent link">&para;</a></h3>
<ol>
<li>Navigate to article detail page</li>
<li>Open chunk debug view</li>
<li>Review ML predictions (or pattern-based if no model)</li>
<li>Click ‚úÖ Correct or ‚ùå Incorrect buttons</li>
<li>Feedback is stored in <code>chunk_classification_feedback</code> table</li>
</ol>
<h3 id="via-annotations">Via Annotations<a class="headerlink" href="#via-annotations" title="Permanent link">&para;</a></h3>
<ol>
<li>Use the annotation interface to highlight text</li>
<li>Classify as "Huntable" or "Not Huntable"</li>
<li>Annotations stored in <code>article_annotations</code> table</li>
<li>Export with <code>scripts/export_highlights.py</code></li>
</ol>
<h2 id="retraining-workflow">Retraining Workflow<a class="headerlink" href="#retraining-workflow" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1"># 1. Collect feedback (via UI)</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="c1"># 2. Retrain with new feedback</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>python3<span class="w"> </span>scripts/retrain_with_feedback.py
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="c1"># 3. Restart web app to load new model</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>docker-compose<span class="w"> </span>restart<span class="w"> </span>web
</code></pre></div>
<h2 id="troubleshooting_1">Troubleshooting<a class="headerlink" href="#troubleshooting_1" title="Permanent link">&para;</a></h2>
<p><strong>"ML model not available" message:</strong>
- Should not appear after running <code>./setup.sh</code>
- If it appears, the model training may have failed during setup
- Re-run training: <code>python3 scripts/train_content_filter.py --data models/default_content_filter_training_data.csv</code></p>
<p><strong>Model fails to load:</strong>
- Check file exists: <code>ls models/content_filter.pkl</code>
- Check scikit-learn installed: <code>python3 -c "import sklearn; print(sklearn.__version__)"</code>
- Check logs: <code>docker-compose logs web | grep -i model</code></p>
<p><strong>Model missing after setup:</strong>
- Check if <code>models/content_filter.pkl</code> exists
- Verify Python 3 and scikit-learn are installed
- Re-run setup or manually train: <code>python3 scripts/train_content_filter.py</code></p>
<h2 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h2>
<ul>
<li><code>scikit-learn</code> (included in requirements.txt)</li>
<li><code>joblib</code> (for model serialization)</li>
<li>Training data: minimum 10-20 examples (more is better)</li>
</ul>
<h2 id="model-location">Model Location<a class="headerlink" href="#model-location" title="Permanent link">&para;</a></h2>
<ul>
<li>Default: <code>models/content_filter.pkl</code></li>
<li>Configurable via <code>ContentFilter(model_path=...)</code></li>
<li>Must exist in filesystem (not in Docker volume unless mounted)</li>
</ul>
<hr />
<p><em>Last updated: February 2025</em></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["content.code.copy", "navigation.tabs", "navigation.sections", "toc.integrate"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>