
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Modern threat intelligence collection and analysis platform">
      
      
      
      
        <link rel="prev" href="../web-app-testing/">
      
      
        <link rel="next" href="../database-queries/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Debugging - Huntable CTI Studio</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#debugging" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Huntable CTI Studio" class="md-header__button md-logo" aria-label="Huntable CTI Studio" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Huntable CTI Studio
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Debugging
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../quickstart/" class="md-tabs__link">
        
  
  
    
  
  Quickstart

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting-started/installation/" class="md-tabs__link">
          
  
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../concepts/huntables/" class="md-tabs__link">
          
  
  
  Concepts

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/add-feed/" class="md-tabs__link">
          
  
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../architecture/overview/" class="md-tabs__link">
          
  
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../features/sigma-rules/" class="md-tabs__link">
          
  
  
  Features

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../llm/model-selection/" class="md-tabs__link">
          
  
  
  LLM & Models

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ml-training/hunt-scoring/" class="md-tabs__link">
          
  
  
  ML Training

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/cli/" class="md-tabs__link">
          
  
  
  Reference

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../setup/" class="md-tabs__link">
          
  
  
  Development

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../prompts/eval-bundle/" class="md-tabs__link">
          
  
  
  Prompts

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../CONTRIBUTING/" class="md-tabs__link">
        
  
  
    
  
  Contributing

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../CHANGELOG/" class="md-tabs__link">
        
  
  
    
  
  Changelog

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Huntable CTI Studio" class="md-nav__button md-logo" aria-label="Huntable CTI Studio" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Huntable CTI Studio
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/first-workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    First Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/huntables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Huntables
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/pipelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pipelines
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/observables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Observables
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/add-feed/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Add a Feed
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/extract-observables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Extract Observables
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/generate-sigma/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Generate Sigma Rules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/evaluate-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Evaluate Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/backup-and-restore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backup & Restore
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/source-config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Source Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/memory-tuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Memory Tuning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/workflow-data-flow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow Data Flow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/scoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/chunking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chunking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/qa-loops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    QA Loops
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/sigma-rules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sigma Detection Rules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/content-filtering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Content Filtering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/os-detection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OS Detection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/cmdline-preprocessor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cmdline Preprocessor
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/rag-search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RAG Search
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/observable-evaluation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Observable Evaluation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    LLM & Models
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    LLM & Models
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../llm/model-selection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model Selection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../llm/lmstudio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LM Studio Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../llm/extract-agent-eval/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Extract Agent Evaluation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ML Training
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    ML Training
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ml-training/hunt-scoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hunt Scoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ml-training/database-training/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database Training
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/schemas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Schemas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/ml-features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ML Feature Definitions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/versioning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Versioning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" checked>
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Strategy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../manual-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Manual Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../web-app-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Web App Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Debugging
  

    
  </span>
  
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../database-queries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database Queries
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../allure-reports/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Allure Reports
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-instance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi-Instance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workflow-queue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow Queue
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../search-queries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Search Queries
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Prompts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Prompts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prompts/eval-bundle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Eval Bundle Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prompts/huntquery-eval/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hunt Query Eval
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prompts/proctree-eval/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Process Tree Eval
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CHANGELOG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="debugging">Debugging<a class="headerlink" href="#debugging" title="Permanent link">&para;</a></h1>
<!-- MERGED FROM: development/DEBUGGING_TOOLS_GUIDE.md, development/DEBUG_EVAL_LMSTUDIO_LOGS.md, development/TROUBLESHOOT_EVAL_PENDING.md -->

<h1 id="huntable-cti-studio-debugging-tools-guide">Huntable CTI Studio Debugging Tools Guide<a class="headerlink" href="#huntable-cti-studio-debugging-tools-guide" title="Permanent link">&para;</a></h1>
<p>This comprehensive guide covers the enhanced debugging capabilities available in the Huntable CTI Studio test suite. These tools are designed to improve developer productivity by providing detailed failure analysis, performance monitoring, and debugging utilities.</p>
<h2 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#overview">Overview</a></li>
<li><a href="#langfuse-workflow-debugging">LangFuse Workflow Debugging</a></li>
<li><a href="#test-failure-analysis">Test Failure Analysis</a></li>
<li><a href="#async-test-debugging">Async Test Debugging</a></li>
<li><a href="#test-isolation-and-cleanup">Test Isolation and Cleanup</a></li>
<li><a href="#performance-profiling">Performance Profiling</a></li>
<li><a href="#enhanced-output-formatting">Enhanced Output Formatting</a></li>
<li><a href="#best-practices">Best Practices</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ol>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The Huntable CTI Studio debugging tools provide:</p>
<ul>
<li><strong>LangFuse Workflow Debugging</strong>: Session-based tracing for agentic workflow executions with direct links to LangFuse UI</li>
<li><strong>Comprehensive Failure Analysis</strong>: Automatic categorization and analysis of test failures with actionable suggestions</li>
<li><strong>Async Debugging</strong>: Specialized tools for debugging async/await code and event loop issues</li>
<li><strong>Test Isolation</strong>: Enhanced isolation mechanisms to prevent test interference</li>
<li><strong>Performance Profiling</strong>: Detailed performance monitoring and bottleneck identification</li>
<li><strong>Rich Output Formatting</strong>: Timestamped, colorized, and structured test output</li>
</ul>
<h2 id="langfuse-workflow-debugging">LangFuse Workflow Debugging<a class="headerlink" href="#langfuse-workflow-debugging" title="Permanent link">&para;</a></h2>
<h3 id="overview_1">Overview<a class="headerlink" href="#overview_1" title="Permanent link">&para;</a></h3>
<p>The agentic workflow integrates with LangFuse to provide comprehensive tracing and debugging capabilities. Each workflow execution creates a session in LangFuse that groups all traces, spans, and events for that execution.</p>
<h3 id="accessing-debug-links">Accessing Debug Links<a class="headerlink" href="#accessing-debug-links" title="Permanent link">&para;</a></h3>
<p>From the Workflow Executions page, each execution has a <strong>Debug</strong> button that takes you directly to the LangFuse session:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>https://us.cloud.langfuse.com/project/{project_id}/sessions/workflow_exec_{execution_id}
</code></pre></div>
<p><strong>Example</strong>: For execution #86, the session URL is:
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>https://us.cloud.langfuse.com/project/{project_id}/sessions/workflow_exec_86
</code></pre></div></p>
<h3 id="session-structure">Session Structure<a class="headerlink" href="#session-structure" title="Permanent link">&para;</a></h3>
<p>Each workflow execution creates:</p>
<ol>
<li><strong>Session ID</strong>: Format <code>workflow_exec_{execution_id}</code> (e.g., <code>workflow_exec_86</code>)</li>
<li><strong>Trace ID</strong>: 32-character unique identifier for the execution trace</li>
<li><strong>Spans</strong>: Individual workflow steps (extraction, ranking, SIGMA generation, etc.)</li>
</ol>
<h3 id="implementation-details">Implementation Details<a class="headerlink" href="#implementation-details" title="Permanent link">&para;</a></h3>
<p>The LangFuse integration is implemented in <code>src/utils/langfuse_client.py</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># Create trace with session context</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">langfuse.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">TraceContext</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">trace_context</span> <span class="o">=</span> <span class="n">TraceContext</span><span class="p">(</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="n">session_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;workflow_exec_</span><span class="si">{</span><span class="n">execution_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="n">user_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;article_</span><span class="si">{</span><span class="n">article_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="p">)</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="c1"># Start trace as current span</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="n">span_cm</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>    <span class="n">trace_context</span><span class="o">=</span><span class="n">trace_context</span><span class="p">,</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;agentic_workflow_execution_</span><span class="si">{</span><span class="n">execution_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="nb">input</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">execution_id</span><span class="p">,</span> <span class="s2">&quot;article_id&quot;</span><span class="p">:</span> <span class="n">article_id</span><span class="p">},</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="o">...</span><span class="p">}</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="p">)</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="n">span</span> <span class="o">=</span> <span class="n">span_cm</span><span class="o">.</span><span class="fm">__enter__</span><span class="p">()</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="c1"># Explicitly associate trace with session (required in LangFuse 3.x)</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="n">span</span><span class="o">.</span><span class="n">update_trace</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">)</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="c1"># Store trace_id (32 chars) not span id (16 chars)</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="n">trace_id</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">trace_id</span>
</code></pre></div>
<h3 id="key-implementation-points">Key Implementation Points<a class="headerlink" href="#key-implementation-points" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Session Association</strong>: In LangFuse 3.x with OpenTelemetry, passing <code>session_id</code> in <code>TraceContext</code> alone is insufficient. An explicit <code>span.update_trace(session_id=...)</code> call is required.</p>
</li>
<li>
<p><strong>Trace ID vs Span ID</strong>:</p>
</li>
<li><strong>Trace ID</strong>: 32-character identifier (e.g., <code>62ed1c144abee5401636ea6c5b9b4f7a</code>)</li>
<li><strong>Span ID</strong>: 16-character identifier (e.g., <code>9754b82b9794d922</code>)</li>
<li>
<p>Store the <strong>trace ID</strong> for debug links, not the span ID.</p>
</li>
<li>
<p><strong>Context Manager Handling</strong>: The span context manager must be properly entered with <code>__enter__()</code> and exited with <code>__exit__()</code> to ensure traces are flushed.</p>
</li>
</ol>
<h3 id="viewing-workflow-traces">Viewing Workflow Traces<a class="headerlink" href="#viewing-workflow-traces" title="Permanent link">&para;</a></h3>
<h4 id="session-view-recommended">Session View (Recommended)<a class="headerlink" href="#session-view-recommended" title="Permanent link">&para;</a></h4>
<p>The session view shows all traces for a workflow execution grouped together:</p>
<ol>
<li>Click <strong>Debug</strong> button on workflow execution</li>
<li>View all workflow steps in chronological order</li>
<li>See inputs, outputs, and metadata for each step</li>
<li>Track token usage and latency per agent</li>
</ol>
<h4 id="trace-view-individual-steps">Trace View (Individual Steps)<a class="headerlink" href="#trace-view-individual-steps" title="Permanent link">&para;</a></h4>
<p>To view an individual trace:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>https://us.cloud.langfuse.com/project/{project_id}/traces/{trace_id}
</code></pre></div>
<h3 id="debugging-workflow-issues">Debugging Workflow Issues<a class="headerlink" href="#debugging-workflow-issues" title="Permanent link">&para;</a></h3>
<p>When debugging workflow failures:</p>
<ol>
<li><strong>Check Session View</strong>: Start with the session view to see the full execution timeline</li>
<li><strong>Identify Failed Step</strong>: Look for spans with <code>ERROR</code> status</li>
<li><strong>Review Inputs/Outputs</strong>: Check the input and output data for each span</li>
<li><strong>Check Metadata</strong>: Review metadata for execution context (article ID, config version, etc.)</li>
<li><strong>Monitor Token Usage</strong>: Track token consumption across agents</li>
</ol>
<h3 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h3>
<p>LangFuse configuration is set via environment variables:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nv">LANGFUSE_PUBLIC_KEY</span><span class="o">=</span>pk-lf-...
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nv">LANGFUSE_SECRET_KEY</span><span class="o">=</span>sk-lf-...
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="nv">LANGFUSE_HOST</span><span class="o">=</span>https://us.cloud.langfuse.com
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="nv">LANGFUSE_PROJECT_ID</span><span class="o">=</span>your-project-id
</code></pre></div>
<h3 id="code-references">Code References<a class="headerlink" href="#code-references" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Trace creation</strong>: <code>src/utils/langfuse_client.py</code> (lines 155-189)</li>
<li><strong>Workflow execution</strong>: <code>src/workflows/agentic_workflow.py</code> (line 1662)</li>
<li><strong>Debug link generation</strong>: <code>src/web/routes/workflow_executions.py</code> (lines 805-814)</li>
</ul>
<h2 id="test-failure-analysis">Test Failure Analysis<a class="headerlink" href="#test-failure-analysis" title="Permanent link">&para;</a></h2>
<h3 id="automatic-failure-analysis">Automatic Failure Analysis<a class="headerlink" href="#automatic-failure-analysis" title="Permanent link">&para;</a></h3>
<p>The <code>TestFailureAnalyzer</code> automatically categorizes test failures and provides debugging context:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_failure_analyzer</span><span class="w"> </span><span class="kn">import</span> <span class="n">analyze_test_failure</span><span class="p">,</span> <span class="n">generate_failure_report</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="c1"># Analyze a test failure</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="n">failure_context</span> <span class="o">=</span> <span class="n">analyze_test_failure</span><span class="p">(</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>    <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;test_example&quot;</span><span class="p">,</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    <span class="n">exc_info</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">(),</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    <span class="n">test_duration</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    <span class="n">environment_info</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="s2">&quot;test_db&quot;</span><span class="p">}</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="p">)</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="c1"># Generate comprehensive failure report</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="n">failure_report</span> <span class="o">=</span> <span class="n">generate_failure_report</span><span class="p">(</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>    <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;test_example&quot;</span><span class="p">,</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>    <span class="n">exc_info</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">(),</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>    <span class="n">test_duration</span><span class="o">=</span><span class="mf">2.5</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="p">)</span>
</code></pre></div>
<h3 id="failure-categories">Failure Categories<a class="headerlink" href="#failure-categories" title="Permanent link">&para;</a></h3>
<p>The analyzer categorizes failures into these types:</p>
<ul>
<li><strong>AssertionError</strong>: Test assertion failures</li>
<li><strong>TimeoutError</strong>: Async operation timeouts</li>
<li><strong>ConnectionError</strong>: Network/database connection issues</li>
<li><strong>ImportError</strong>: Module import problems</li>
<li><strong>AttributeError</strong>: Missing object attributes</li>
<li><strong>TypeError</strong>: Type mismatch errors</li>
<li><strong>ValueError</strong>: Invalid values</li>
<li><strong>KeyError</strong>: Missing dictionary keys</li>
<li><strong>AsyncError</strong>: Async/await related issues</li>
<li><strong>MockError</strong>: Mock configuration problems</li>
<li><strong>DatabaseError</strong>: Database operation failures</li>
<li><strong>NetworkError</strong>: Network-related issues</li>
<li><strong>PermissionError</strong>: File system permission issues</li>
<li><strong>FileNotFoundError</strong>: Missing files</li>
<li><strong>ConfigurationError</strong>: Configuration problems</li>
</ul>
<h3 id="using-failure-analysis-in-tests">Using Failure Analysis in Tests<a class="headerlink" href="#using-failure-analysis-in-tests" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_failure_analyzer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestFailureReporter</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">failure_reporter</span><span class="p">():</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    <span class="k">return</span> <span class="n">TestFailureReporter</span><span class="p">()</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_example</span><span class="p">(</span><span class="n">failure_reporter</span><span class="p">):</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>        <span class="c1"># Your test code here</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>        <span class="k">assert</span> <span class="n">some_condition</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>        <span class="c1"># Generate failure report</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>        <span class="n">failure_context</span> <span class="o">=</span> <span class="n">failure_reporter</span><span class="o">.</span><span class="n">generate_failure_report</span><span class="p">(</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>            <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;test_example&quot;</span><span class="p">,</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>            <span class="n">exc_info</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">(),</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>            <span class="n">test_duration</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>        <span class="p">)</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>        <span class="c1"># Access failure analysis</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failure type: </span><span class="si">{</span><span class="n">failure_context</span><span class="o">.</span><span class="n">failure_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Suggestions: </span><span class="si">{</span><span class="n">failure_context</span><span class="o">.</span><span class="n">suggestions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>        <span class="k">raise</span>
</code></pre></div>
<h2 id="async-test-debugging">Async Test Debugging<a class="headerlink" href="#async-test-debugging" title="Permanent link">&para;</a></h2>
<h3 id="async-debugger">Async Debugger<a class="headerlink" href="#async-debugger" title="Permanent link">&para;</a></h3>
<p>The <code>AsyncDebugger</code> provides specialized debugging for async operations:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.async_debug_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncDebugger</span><span class="p">,</span> <span class="n">debug_async_test</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="c1"># Using the debugger directly</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="n">debugger</span> <span class="o">=</span> <span class="n">AsyncDebugger</span><span class="p">()</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="k">await</span> <span class="n">debugger</span><span class="o">.</span><span class="n">start_monitoring</span><span class="p">()</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    <span class="c1"># Your async test code</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">some_async_operation</span><span class="p">()</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>    <span class="k">await</span> <span class="n">debugger</span><span class="o">.</span><span class="n">stop_monitoring</span><span class="p">()</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="c1"># Using the convenience function</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="n">result</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="k">await</span> <span class="n">debug_async_test</span><span class="p">(</span><span class="n">some_async_function</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>
</code></pre></div>
<h3 id="async-context-managers">Async Context Managers<a class="headerlink" href="#async-context-managers" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.async_debug_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">async_debug_context</span><span class="p">,</span> <span class="n">async_test_isolation</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="c1"># Debug context</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="k">async</span> <span class="k">with</span> <span class="n">async_debug_context</span><span class="p">()</span> <span class="k">as</span> <span class="n">debugger</span><span class="p">:</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    <span class="c1"># Your async test code</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">some_async_operation</span><span class="p">()</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>    <span class="c1"># Get debug info</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>    <span class="n">debug_info</span> <span class="o">=</span> <span class="n">debugger</span><span class="o">.</span><span class="n">get_debug_summary</span><span class="p">()</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="c1"># Test isolation</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="k">async</span> <span class="k">with</span> <span class="n">async_test_isolation</span><span class="p">()</span> <span class="k">as</span> <span class="n">isolation</span><span class="p">:</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>    <span class="c1"># Your async test code</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">some_async_operation</span><span class="p">()</span>
</code></pre></div>
<h3 id="async-operation-tracing">Async Operation Tracing<a class="headerlink" href="#async-operation-tracing" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.async_debug_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">trace_async_operation</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_async_operation</span><span class="p">():</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    <span class="k">async</span> <span class="k">with</span> <span class="n">trace_async_operation</span><span class="p">(</span><span class="s2">&quot;database_query&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">trace</span><span class="p">:</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>        <span class="c1"># Your async operation</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">database</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM users&quot;</span><span class="p">)</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>        <span class="c1"># Trace data is automatically collected</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Operation duration: </span><span class="si">{</span><span class="n">trace</span><span class="o">.</span><span class="n">duration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="test-isolation-and-cleanup">Test Isolation and Cleanup<a class="headerlink" href="#test-isolation-and-cleanup" title="Permanent link">&para;</a></h2>
<h3 id="test-isolation-manager">Test Isolation Manager<a class="headerlink" href="#test-isolation-manager" title="Permanent link">&para;</a></h3>
<p>The <code>TestIsolationManager</code> provides comprehensive test isolation:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_isolation</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestIsolationManager</span><span class="p">,</span> <span class="n">test_isolation</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="c1"># Using the manager directly</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="n">manager</span> <span class="o">=</span> <span class="n">TestIsolationManager</span><span class="p">()</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="k">await</span> <span class="n">manager</span><span class="o">.</span><span class="n">start_isolation</span><span class="p">()</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>    <span class="c1"># Your test code</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>    <span class="k">pass</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>    <span class="k">await</span> <span class="n">manager</span><span class="o">.</span><span class="n">stop_isolation</span><span class="p">()</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="c1"># Using the context manager</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="k">async</span> <span class="k">with</span> <span class="n">test_isolation</span><span class="p">()</span> <span class="k">as</span> <span class="n">isolation</span><span class="p">:</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>    <span class="c1"># Your test code</span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>    <span class="k">pass</span>
</code></pre></div>
<h3 id="file-system-isolation">File System Isolation<a class="headerlink" href="#file-system-isolation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_isolation</span><span class="w"> </span><span class="kn">import</span> <span class="n">isolated_filesystem</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="k">with</span> <span class="n">isolated_filesystem</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>    <span class="c1"># Create test files</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="n">test_file</span> <span class="o">=</span> <span class="n">temp_dir</span> <span class="o">/</span> <span class="s2">&quot;test.txt&quot;</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>    <span class="n">test_file</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;test content&quot;</span><span class="p">)</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>    <span class="c1"># Files are automatically cleaned up</span>
</code></pre></div>
<h3 id="database-isolation">Database Isolation<a class="headerlink" href="#database-isolation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_isolation</span><span class="w"> </span><span class="kn">import</span> <span class="n">isolated_database</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="k">async</span> <span class="k">with</span> <span class="n">isolated_database</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">db_isolation</span><span class="p">:</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>    <span class="c1"># Database is automatically cleaned up</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>    <span class="c1"># Test data is isolated</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>    <span class="k">pass</span>
</code></pre></div>
<h3 id="mock-isolation">Mock Isolation<a class="headerlink" href="#mock-isolation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_isolation</span><span class="w"> </span><span class="kn">import</span> <span class="n">isolated_mocks</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="k">with</span> <span class="n">isolated_mocks</span><span class="p">()</span> <span class="k">as</span> <span class="n">mock_isolation</span><span class="p">:</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    <span class="c1"># Mocks are automatically reset</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>    <span class="k">pass</span>
</code></pre></div>
<h2 id="performance-profiling">Performance Profiling<a class="headerlink" href="#performance-profiling" title="Permanent link">&para;</a></h2>
<h3 id="performance-profiler">Performance Profiler<a class="headerlink" href="#performance-profiler" title="Permanent link">&para;</a></h3>
<p>The <code>PerformanceProfiler</code> monitors test performance:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.performance_profiler</span><span class="w"> </span><span class="kn">import</span> <span class="n">PerformanceProfiler</span><span class="p">,</span> <span class="n">profile_test</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="c1"># Using the profiler directly</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="n">profiler</span> <span class="o">=</span> <span class="n">PerformanceProfiler</span><span class="p">()</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="k">with</span> <span class="n">profiler</span><span class="o">.</span><span class="n">profile_test</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">):</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>    <span class="c1"># Your test code</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>    <span class="k">pass</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="c1"># Using the context manager</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="k">with</span> <span class="n">profile_test</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">):</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>    <span class="c1"># Your test code</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>    <span class="k">pass</span>
</code></pre></div>
<h3 id="performance-monitoring">Performance Monitoring<a class="headerlink" href="#performance-monitoring" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.performance_profiler</span><span class="w"> </span><span class="kn">import</span> <span class="n">start_performance_monitoring</span><span class="p">,</span> <span class="n">stop_performance_monitoring</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="c1"># Start monitoring</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="n">start_performance_monitoring</span><span class="p">()</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>    <span class="c1"># Your test code</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>    <span class="k">pass</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>    <span class="c1"># Stop monitoring and generate report</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>    <span class="n">stop_performance_monitoring</span><span class="p">()</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>    <span class="n">save_performance_report</span><span class="p">()</span>
</code></pre></div>
<h3 id="performance-decorators">Performance Decorators<a class="headerlink" href="#performance-decorators" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.performance_profiler</span><span class="w"> </span><span class="kn">import</span> <span class="n">profile_performance</span><span class="p">,</span> <span class="n">profile_async_performance</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="nd">@profile_performance</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">)</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_example</span><span class="p">():</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>    <span class="c1"># Your test code</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>    <span class="k">pass</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="nd">@profile_async_performance</span><span class="p">(</span><span class="s2">&quot;async_test_example&quot;</span><span class="p">)</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_async_example</span><span class="p">():</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>    <span class="c1"># Your async test code</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>    <span class="k">pass</span>
</code></pre></div>
<h3 id="performance-analysis">Performance Analysis<a class="headerlink" href="#performance-analysis" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.performance_profiler</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_analyzer</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="n">analyzer</span> <span class="o">=</span> <span class="n">get_analyzer</span><span class="p">()</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="n">analysis</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">analyze_performance_data</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overall assessment: </span><span class="si">{</span><span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;overall_assessment&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Issues: </span><span class="si">{</span><span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;issues&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recommendations: </span><span class="si">{</span><span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;recommendations&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="enhanced-output-formatting">Enhanced Output Formatting<a class="headerlink" href="#enhanced-output-formatting" title="Permanent link">&para;</a></h2>
<h3 id="test-output-formatter">Test Output Formatter<a class="headerlink" href="#test-output-formatter" title="Permanent link">&para;</a></h3>
<p>The <code>TestOutputFormatter</code> provides rich, timestamped output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_output_formatter</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestOutputFormatter</span><span class="p">,</span> <span class="n">print_header</span><span class="p">,</span> <span class="n">print_test_result</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="n">formatter</span> <span class="o">=</span> <span class="n">TestOutputFormatter</span><span class="p">()</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="c1"># Print formatted header</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="n">formatter</span><span class="o">.</span><span class="n">print_header</span><span class="p">(</span><span class="s2">&quot;Test Suite&quot;</span><span class="p">,</span> <span class="s2">&quot;Running all tests&quot;</span><span class="p">)</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="c1"># Print test results</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="n">formatter</span><span class="o">.</span><span class="n">print_test_result</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">,</span> <span class="s2">&quot;PASSED&quot;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="c1"># Print test failure</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="n">formatter</span><span class="o">.</span><span class="n">print_test_failure</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">,</span> <span class="s2">&quot;Assertion failed&quot;</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span>
</code></pre></div>
<h3 id="convenience-functions">Convenience Functions<a class="headerlink" href="#convenience-functions" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_output_formatter</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>    <span class="n">print_header</span><span class="p">,</span> <span class="n">print_test_start</span><span class="p">,</span> <span class="n">print_test_result</span><span class="p">,</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>    <span class="n">print_test_failure</span><span class="p">,</span> <span class="n">print_progress</span><span class="p">,</span> <span class="n">print_summary</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="p">)</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="c1"># Print test start</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="n">print_test_start</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">)</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="c1"># Print test result</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="n">print_test_result</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">,</span> <span class="s2">&quot;PASSED&quot;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="c1"># Print progress</span>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="n">print_progress</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;Running tests&quot;</span><span class="p">)</span>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="c1"># Print summary</span>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="n">print_summary</span><span class="p">()</span>
</code></pre></div>
<h3 id="output-configuration">Output Configuration<a class="headerlink" href="#output-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_output_formatter</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestOutputConfig</span><span class="p">,</span> <span class="n">TestOutputFormatter</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="n">config</span> <span class="o">=</span> <span class="n">TestOutputConfig</span><span class="p">(</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>    <span class="n">show_timestamps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>    <span class="n">show_colors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>    <span class="n">show_emojis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>    <span class="n">timestamp_format</span><span class="o">=</span><span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">,</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>    <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;test_results.log&quot;</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="p">)</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="n">formatter</span> <span class="o">=</span> <span class="n">TestOutputFormatter</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>
<h2 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h2>
<h3 id="1-use-failure-analysis-for-debugging">1. Use Failure Analysis for Debugging<a class="headerlink" href="#1-use-failure-analysis-for-debugging" title="Permanent link">&para;</a></h3>
<p>Always use the failure analyzer for test failures:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_example</span><span class="p">(</span><span class="n">failure_reporter</span><span class="p">):</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>        <span class="c1"># Your test code</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>        <span class="k">pass</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>        <span class="c1"># Generate failure report</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>        <span class="n">failure_context</span> <span class="o">=</span> <span class="n">failure_reporter</span><span class="o">.</span><span class="n">generate_failure_report</span><span class="p">(</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>            <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;test_example&quot;</span><span class="p">,</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>            <span class="n">exc_info</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>        <span class="p">)</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>        <span class="c1"># Use suggestions for debugging</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>        <span class="k">for</span> <span class="n">suggestion</span> <span class="ow">in</span> <span class="n">failure_context</span><span class="o">.</span><span class="n">suggestions</span><span class="p">:</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Suggestion: </span><span class="si">{</span><span class="n">suggestion</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>        <span class="k">raise</span>
</code></pre></div>
<h3 id="2-profile-slow-tests">2. Profile Slow Tests<a class="headerlink" href="#2-profile-slow-tests" title="Permanent link">&para;</a></h3>
<p>Use performance profiling for tests that take longer than 1 second:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">performance</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_slow_operation</span><span class="p">():</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>    <span class="k">with</span> <span class="n">profile_test</span><span class="p">(</span><span class="s2">&quot;test_slow_operation&quot;</span><span class="p">):</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>        <span class="c1"># Your slow test code</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>        <span class="k">pass</span>
</code></pre></div>
<h3 id="3-use-test-isolation">3. Use Test Isolation<a class="headerlink" href="#3-use-test-isolation" title="Permanent link">&para;</a></h3>
<p>Always use test isolation for tests that modify global state:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_database_operation</span><span class="p">(</span><span class="n">isolation_manager</span><span class="p">):</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>    <span class="k">await</span> <span class="n">isolation_manager</span><span class="o">.</span><span class="n">start_isolation</span><span class="p">()</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>        <span class="c1"># Your test code</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>        <span class="k">pass</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>        <span class="k">await</span> <span class="n">isolation_manager</span><span class="o">.</span><span class="n">stop_isolation</span><span class="p">()</span>
</code></pre></div>
<h3 id="4-debug-async-tests">4. Debug Async Tests<a class="headerlink" href="#4-debug-async-tests" title="Permanent link">&para;</a></h3>
<p>Use async debugging for complex async operations:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_async_operation</span><span class="p">(</span><span class="n">async_debugger</span><span class="p">):</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>    <span class="k">await</span> <span class="n">async_debugger</span><span class="o">.</span><span class="n">start_monitoring</span><span class="p">()</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>        <span class="c1"># Your async test code</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">some_async_operation</span><span class="p">()</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>        <span class="c1"># Check debug info</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>        <span class="n">debug_info</span> <span class="o">=</span> <span class="n">async_debugger</span><span class="o">.</span><span class="n">get_debug_summary</span><span class="p">()</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>        <span class="k">assert</span> <span class="n">debug_info</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;active&quot;</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>        <span class="k">await</span> <span class="n">async_debugger</span><span class="o">.</span><span class="n">stop_monitoring</span><span class="p">()</span>
</code></pre></div>
<h3 id="5-use-rich-output-formatting">5. Use Rich Output Formatting<a class="headerlink" href="#5-use-rich-output-formatting" title="Permanent link">&para;</a></h3>
<p>Use the output formatter for better test visibility:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_example</span><span class="p">(</span><span class="n">test_output_formatter</span><span class="p">):</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>    <span class="n">test_output_formatter</span><span class="o">.</span><span class="n">print_test_start</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">)</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>        <span class="c1"># Your test code</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">some_operation</span><span class="p">()</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>        <span class="n">test_output_formatter</span><span class="o">.</span><span class="n">print_test_result</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">,</span> <span class="s2">&quot;PASSED&quot;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>        <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>        <span class="n">test_output_formatter</span><span class="o">.</span><span class="n">print_test_failure</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>        <span class="k">raise</span>
</code></pre></div>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="common-issues">Common Issues<a class="headerlink" href="#common-issues" title="Permanent link">&para;</a></h3>
<h4 id="1-import-errors">1. Import Errors<a class="headerlink" href="#1-import-errors" title="Permanent link">&para;</a></h4>
<p>If you get import errors for the debugging utilities:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1"># Ensure the project root is in Python path</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PYTHONPATH</span><span class="si">}</span><span class="s2">:</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="c1"># Or add to your test file</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>import<span class="w"> </span>sys
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>from<span class="w"> </span>pathlib<span class="w"> </span>import<span class="w"> </span>Path
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>sys.path.insert<span class="o">(</span><span class="m">0</span>,<span class="w"> </span>str<span class="o">(</span>Path<span class="o">(</span>__file__<span class="o">)</span>.parent.parent.parent<span class="o">))</span>
</code></pre></div>
<h4 id="2-async-debugging-issues">2. Async Debugging Issues<a class="headerlink" href="#2-async-debugging-issues" title="Permanent link">&para;</a></h4>
<p>If async debugging doesn't work:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1"># Ensure you&#39;re in an async context</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_example</span><span class="p">():</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>    <span class="n">debugger</span> <span class="o">=</span> <span class="n">AsyncDebugger</span><span class="p">()</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>    <span class="k">await</span> <span class="n">debugger</span><span class="o">.</span><span class="n">start_monitoring</span><span class="p">()</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>        <span class="c1"># Your async code</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>        <span class="k">pass</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>        <span class="k">await</span> <span class="n">debugger</span><span class="o">.</span><span class="n">stop_monitoring</span><span class="p">()</span>
</code></pre></div>
<h4 id="3-performance-profiling-issues">3. Performance Profiling Issues<a class="headerlink" href="#3-performance-profiling-issues" title="Permanent link">&para;</a></h4>
<p>If performance profiling fails:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># Check if profiling is enabled</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.performance_profiler</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_profiler</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="n">profiler</span> <span class="o">=</span> <span class="n">get_profiler</span><span class="p">()</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="k">if</span> <span class="n">profiler</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_cpu_profiling</span><span class="p">:</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>    <span class="c1"># Profiling is enabled</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>    <span class="k">pass</span>
</code></pre></div>
<h4 id="4-test-isolation-issues">4. Test Isolation Issues<a class="headerlink" href="#4-test-isolation-issues" title="Permanent link">&para;</a></h4>
<p>If test isolation doesn't work:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1"># Check isolation configuration</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_isolation</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestIsolationManager</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="n">manager</span> <span class="o">=</span> <span class="n">TestIsolationManager</span><span class="p">()</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="k">if</span> <span class="n">manager</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">database_cleanup</span><span class="p">:</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>    <span class="c1"># Database cleanup is enabled</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>    <span class="k">pass</span>
</code></pre></div>
<h3 id="debug-mode">Debug Mode<a class="headerlink" href="#debug-mode" title="Permanent link">&para;</a></h3>
<p>Enable debug mode for more verbose output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1"># Set debug environment variable</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">TEST_LOG_LEVEL</span><span class="o">=</span>DEBUG
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="c1"># Or use in test</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>import<span class="w"> </span>logging
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>logging.getLogger<span class="o">()</span>.setLevel<span class="o">(</span>logging.DEBUG<span class="o">)</span>
</code></pre></div>
<h3 id="performance-issues">Performance Issues<a class="headerlink" href="#performance-issues" title="Permanent link">&para;</a></h3>
<p>If tests are running slowly:</p>
<ol>
<li><strong>Check performance profiling</strong>: Use the profiler to identify bottlenecks</li>
<li><strong>Review test isolation</strong>: Ensure cleanup isn't taking too long</li>
<li><strong>Check async operations</strong>: Use async debugging to identify event loop issues</li>
<li><strong>Review mock usage</strong>: Ensure mocks aren't causing performance issues</li>
</ol>
<h3 id="memory-issues">Memory Issues<a class="headerlink" href="#memory-issues" title="Permanent link">&para;</a></h3>
<p>If tests are using too much memory:</p>
<ol>
<li><strong>Use memory profiling</strong>: Enable memory profiling in the performance profiler</li>
<li><strong>Check test isolation</strong>: Ensure proper cleanup of resources</li>
<li><strong>Review test data</strong>: Use smaller test datasets</li>
<li><strong>Check for memory leaks</strong>: Use the memory monitoring features</li>
</ol>
<h2 id="integration-with-test-runner">Integration with Test Runner<a class="headerlink" href="#integration-with-test-runner" title="Permanent link">&para;</a></h2>
<p>The debugging tools are automatically integrated with the test runner:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># Run tests with enhanced debugging</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>python3<span class="w"> </span>run_tests.py<span class="w"> </span>all<span class="w"> </span>--debug<span class="w"> </span>--verbose
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="c1"># Run performance tests with profiling</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>python3<span class="w"> </span>run_tests.py<span class="w"> </span>performance<span class="w"> </span>--coverage
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="c1"># Run tests with failure analysis</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>python3<span class="w"> </span>run_tests.py<span class="w"> </span>unit<span class="w"> </span>--debug
</code></pre></div>
<p>The test runner automatically:
- Enables failure analysis for failed tests
- Starts performance monitoring for performance tests
- Uses enhanced output formatting
- Provides debugging context in error messages</p>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>The Huntable CTI Studio debugging tools provide comprehensive support for test debugging and optimization. By using these tools effectively, you can:</p>
<ul>
<li>Quickly identify and resolve test failures</li>
<li>Debug complex async operations</li>
<li>Monitor and optimize test performance</li>
<li>Ensure proper test isolation</li>
<li>Get rich, informative test output</li>
</ul>
<p>For more information, refer to the individual module documentation and examples in the <code>tests/utils/</code> directory.</p>
<h1 id="huntable-cti-studio-debugging-tools-guide_1">Huntable CTI Studio Debugging Tools Guide<a class="headerlink" href="#huntable-cti-studio-debugging-tools-guide_1" title="Permanent link">&para;</a></h1>
<p>This comprehensive guide covers the enhanced debugging capabilities available in the Huntable CTI Studio test suite. These tools are designed to improve developer productivity by providing detailed failure analysis, performance monitoring, and debugging utilities.</p>
<h2 id="table-of-contents_1">Table of Contents<a class="headerlink" href="#table-of-contents_1" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#overview">Overview</a></li>
<li><a href="#langfuse-workflow-debugging">LangFuse Workflow Debugging</a></li>
<li><a href="#test-failure-analysis">Test Failure Analysis</a></li>
<li><a href="#async-test-debugging">Async Test Debugging</a></li>
<li><a href="#test-isolation-and-cleanup">Test Isolation and Cleanup</a></li>
<li><a href="#performance-profiling">Performance Profiling</a></li>
<li><a href="#enhanced-output-formatting">Enhanced Output Formatting</a></li>
<li><a href="#best-practices">Best Practices</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ol>
<h2 id="overview_2">Overview<a class="headerlink" href="#overview_2" title="Permanent link">&para;</a></h2>
<p>The Huntable CTI Studio debugging tools provide:</p>
<ul>
<li><strong>LangFuse Workflow Debugging</strong>: Session-based tracing for agentic workflow executions with direct links to LangFuse UI</li>
<li><strong>Comprehensive Failure Analysis</strong>: Automatic categorization and analysis of test failures with actionable suggestions</li>
<li><strong>Async Debugging</strong>: Specialized tools for debugging async/await code and event loop issues</li>
<li><strong>Test Isolation</strong>: Enhanced isolation mechanisms to prevent test interference</li>
<li><strong>Performance Profiling</strong>: Detailed performance monitoring and bottleneck identification</li>
<li><strong>Rich Output Formatting</strong>: Timestamped, colorized, and structured test output</li>
</ul>
<h2 id="langfuse-workflow-debugging_1">LangFuse Workflow Debugging<a class="headerlink" href="#langfuse-workflow-debugging_1" title="Permanent link">&para;</a></h2>
<h3 id="overview_3">Overview<a class="headerlink" href="#overview_3" title="Permanent link">&para;</a></h3>
<p>The agentic workflow integrates with LangFuse to provide comprehensive tracing and debugging capabilities. Each workflow execution creates a session in LangFuse that groups all traces, spans, and events for that execution.</p>
<h3 id="accessing-debug-links_1">Accessing Debug Links<a class="headerlink" href="#accessing-debug-links_1" title="Permanent link">&para;</a></h3>
<p>From the Workflow Executions page, each execution has a <strong>Debug</strong> button that takes you directly to the LangFuse session:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>https://us.cloud.langfuse.com/project/{project_id}/sessions/workflow_exec_{execution_id}
</code></pre></div>
<p><strong>Example</strong>: For execution #86, the session URL is:
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>https://us.cloud.langfuse.com/project/{project_id}/sessions/workflow_exec_86
</code></pre></div></p>
<h3 id="session-structure_1">Session Structure<a class="headerlink" href="#session-structure_1" title="Permanent link">&para;</a></h3>
<p>Each workflow execution creates:</p>
<ol>
<li><strong>Session ID</strong>: Format <code>workflow_exec_{execution_id}</code> (e.g., <code>workflow_exec_86</code>)</li>
<li><strong>Trace ID</strong>: 32-character unique identifier for the execution trace</li>
<li><strong>Spans</strong>: Individual workflow steps (extraction, ranking, SIGMA generation, etc.)</li>
</ol>
<h3 id="implementation-details_1">Implementation Details<a class="headerlink" href="#implementation-details_1" title="Permanent link">&para;</a></h3>
<p>The LangFuse integration is implemented in <code>src/utils/langfuse_client.py</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># Create trace with session context</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">langfuse.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">TraceContext</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="n">trace_context</span> <span class="o">=</span> <span class="n">TraceContext</span><span class="p">(</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>    <span class="n">session_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;workflow_exec_</span><span class="si">{</span><span class="n">execution_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>    <span class="n">user_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;article_</span><span class="si">{</span><span class="n">article_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="p">)</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="c1"># Start trace as current span</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="n">span_cm</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>    <span class="n">trace_context</span><span class="o">=</span><span class="n">trace_context</span><span class="p">,</span>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;agentic_workflow_execution_</span><span class="si">{</span><span class="n">execution_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>    <span class="nb">input</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">execution_id</span><span class="p">,</span> <span class="s2">&quot;article_id&quot;</span><span class="p">:</span> <span class="n">article_id</span><span class="p">},</span>
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="o">...</span><span class="p">}</span>
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="p">)</span>
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="n">span</span> <span class="o">=</span> <span class="n">span_cm</span><span class="o">.</span><span class="fm">__enter__</span><span class="p">()</span>
<a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>
<a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="c1"># Explicitly associate trace with session (required in LangFuse 3.x)</span>
<a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="n">span</span><span class="o">.</span><span class="n">update_trace</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">)</span>
<a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>
<a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="c1"># Store trace_id (32 chars) not span id (16 chars)</span>
<a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="n">trace_id</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">trace_id</span>
</code></pre></div>
<h3 id="key-implementation-points_1">Key Implementation Points<a class="headerlink" href="#key-implementation-points_1" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Session Association</strong>: In LangFuse 3.x with OpenTelemetry, passing <code>session_id</code> in <code>TraceContext</code> alone is insufficient. An explicit <code>span.update_trace(session_id=...)</code> call is required.</p>
</li>
<li>
<p><strong>Trace ID vs Span ID</strong>:</p>
</li>
<li><strong>Trace ID</strong>: 32-character identifier (e.g., <code>62ed1c144abee5401636ea6c5b9b4f7a</code>)</li>
<li><strong>Span ID</strong>: 16-character identifier (e.g., <code>9754b82b9794d922</code>)</li>
<li>
<p>Store the <strong>trace ID</strong> for debug links, not the span ID.</p>
</li>
<li>
<p><strong>Context Manager Handling</strong>: The span context manager must be properly entered with <code>__enter__()</code> and exited with <code>__exit__()</code> to ensure traces are flushed.</p>
</li>
</ol>
<h3 id="viewing-workflow-traces_1">Viewing Workflow Traces<a class="headerlink" href="#viewing-workflow-traces_1" title="Permanent link">&para;</a></h3>
<h4 id="session-view-recommended_1">Session View (Recommended)<a class="headerlink" href="#session-view-recommended_1" title="Permanent link">&para;</a></h4>
<p>The session view shows all traces for a workflow execution grouped together:</p>
<ol>
<li>Click <strong>Debug</strong> button on workflow execution</li>
<li>View all workflow steps in chronological order</li>
<li>See inputs, outputs, and metadata for each step</li>
<li>Track token usage and latency per agent</li>
</ol>
<h4 id="trace-view-individual-steps_1">Trace View (Individual Steps)<a class="headerlink" href="#trace-view-individual-steps_1" title="Permanent link">&para;</a></h4>
<p>To view an individual trace:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>https://us.cloud.langfuse.com/project/{project_id}/traces/{trace_id}
</code></pre></div>
<h3 id="debugging-workflow-issues_1">Debugging Workflow Issues<a class="headerlink" href="#debugging-workflow-issues_1" title="Permanent link">&para;</a></h3>
<p>When debugging workflow failures:</p>
<ol>
<li><strong>Check Session View</strong>: Start with the session view to see the full execution timeline</li>
<li><strong>Identify Failed Step</strong>: Look for spans with <code>ERROR</code> status</li>
<li><strong>Review Inputs/Outputs</strong>: Check the input and output data for each span</li>
<li><strong>Check Metadata</strong>: Review metadata for execution context (article ID, config version, etc.)</li>
<li><strong>Monitor Token Usage</strong>: Track token consumption across agents</li>
</ol>
<h3 id="configuration_1">Configuration<a class="headerlink" href="#configuration_1" title="Permanent link">&para;</a></h3>
<p>LangFuse configuration is set via environment variables:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="nv">LANGFUSE_PUBLIC_KEY</span><span class="o">=</span>pk-lf-...
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="nv">LANGFUSE_SECRET_KEY</span><span class="o">=</span>sk-lf-...
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="nv">LANGFUSE_HOST</span><span class="o">=</span>https://us.cloud.langfuse.com
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="nv">LANGFUSE_PROJECT_ID</span><span class="o">=</span>your-project-id
</code></pre></div>
<h3 id="code-references_1">Code References<a class="headerlink" href="#code-references_1" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Trace creation</strong>: <code>src/utils/langfuse_client.py</code> (lines 155-189)</li>
<li><strong>Workflow execution</strong>: <code>src/workflows/agentic_workflow.py</code> (line 1662)</li>
<li><strong>Debug link generation</strong>: <code>src/web/routes/workflow_executions.py</code> (lines 805-814)</li>
</ul>
<h2 id="test-failure-analysis_1">Test Failure Analysis<a class="headerlink" href="#test-failure-analysis_1" title="Permanent link">&para;</a></h2>
<h3 id="automatic-failure-analysis_1">Automatic Failure Analysis<a class="headerlink" href="#automatic-failure-analysis_1" title="Permanent link">&para;</a></h3>
<p>The <code>TestFailureAnalyzer</code> automatically categorizes test failures and provides debugging context:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_failure_analyzer</span><span class="w"> </span><span class="kn">import</span> <span class="n">analyze_test_failure</span><span class="p">,</span> <span class="n">generate_failure_report</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="c1"># Analyze a test failure</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="n">failure_context</span> <span class="o">=</span> <span class="n">analyze_test_failure</span><span class="p">(</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>    <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;test_example&quot;</span><span class="p">,</span>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>    <span class="n">exc_info</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">(),</span>
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>    <span class="n">test_duration</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span>
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>    <span class="n">environment_info</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="s2">&quot;test_db&quot;</span><span class="p">}</span>
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="p">)</span>
<a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a>
<a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a><span class="c1"># Generate comprehensive failure report</span>
<a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a><span class="n">failure_report</span> <span class="o">=</span> <span class="n">generate_failure_report</span><span class="p">(</span>
<a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a>    <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;test_example&quot;</span><span class="p">,</span>
<a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a>    <span class="n">exc_info</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">(),</span>
<a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a>    <span class="n">test_duration</span><span class="o">=</span><span class="mf">2.5</span>
<a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a><span class="p">)</span>
</code></pre></div>
<h3 id="failure-categories_1">Failure Categories<a class="headerlink" href="#failure-categories_1" title="Permanent link">&para;</a></h3>
<p>The analyzer categorizes failures into these types:</p>
<ul>
<li><strong>AssertionError</strong>: Test assertion failures</li>
<li><strong>TimeoutError</strong>: Async operation timeouts</li>
<li><strong>ConnectionError</strong>: Network/database connection issues</li>
<li><strong>ImportError</strong>: Module import problems</li>
<li><strong>AttributeError</strong>: Missing object attributes</li>
<li><strong>TypeError</strong>: Type mismatch errors</li>
<li><strong>ValueError</strong>: Invalid values</li>
<li><strong>KeyError</strong>: Missing dictionary keys</li>
<li><strong>AsyncError</strong>: Async/await related issues</li>
<li><strong>MockError</strong>: Mock configuration problems</li>
<li><strong>DatabaseError</strong>: Database operation failures</li>
<li><strong>NetworkError</strong>: Network-related issues</li>
<li><strong>PermissionError</strong>: File system permission issues</li>
<li><strong>FileNotFoundError</strong>: Missing files</li>
<li><strong>ConfigurationError</strong>: Configuration problems</li>
</ul>
<h3 id="using-failure-analysis-in-tests_1">Using Failure Analysis in Tests<a class="headerlink" href="#using-failure-analysis-in-tests_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_failure_analyzer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestFailureReporter</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">failure_reporter</span><span class="p">():</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>    <span class="k">return</span> <span class="n">TestFailureReporter</span><span class="p">()</span>
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_example</span><span class="p">(</span><span class="n">failure_reporter</span><span class="p">):</span>
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>        <span class="c1"># Your test code here</span>
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a>        <span class="k">assert</span> <span class="n">some_condition</span>
<a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a>        <span class="c1"># Generate failure report</span>
<a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a>        <span class="n">failure_context</span> <span class="o">=</span> <span class="n">failure_reporter</span><span class="o">.</span><span class="n">generate_failure_report</span><span class="p">(</span>
<a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a>            <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;test_example&quot;</span><span class="p">,</span>
<a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a>            <span class="n">exc_info</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">(),</span>
<a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a>            <span class="n">test_duration</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a>        <span class="p">)</span>
<a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a>
<a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a>        <span class="c1"># Access failure analysis</span>
<a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failure type: </span><span class="si">{</span><span class="n">failure_context</span><span class="o">.</span><span class="n">failure_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Suggestions: </span><span class="si">{</span><span class="n">failure_context</span><span class="o">.</span><span class="n">suggestions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-38-23" name="__codelineno-38-23" href="#__codelineno-38-23"></a>        <span class="k">raise</span>
</code></pre></div>
<h2 id="async-test-debugging_1">Async Test Debugging<a class="headerlink" href="#async-test-debugging_1" title="Permanent link">&para;</a></h2>
<h3 id="async-debugger_1">Async Debugger<a class="headerlink" href="#async-debugger_1" title="Permanent link">&para;</a></h3>
<p>The <code>AsyncDebugger</code> provides specialized debugging for async operations:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.async_debug_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncDebugger</span><span class="p">,</span> <span class="n">debug_async_test</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="c1"># Using the debugger directly</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="n">debugger</span> <span class="o">=</span> <span class="n">AsyncDebugger</span><span class="p">()</span>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="k">await</span> <span class="n">debugger</span><span class="o">.</span><span class="n">start_monitoring</span><span class="p">()</span>
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a>    <span class="c1"># Your async test code</span>
<a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a>    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">some_async_operation</span><span class="p">()</span>
<a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a>    <span class="k">await</span> <span class="n">debugger</span><span class="o">.</span><span class="n">stop_monitoring</span><span class="p">()</span>
<a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a>
<a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a><span class="c1"># Using the convenience function</span>
<a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="n">result</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="k">await</span> <span class="n">debug_async_test</span><span class="p">(</span><span class="n">some_async_function</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>
</code></pre></div>
<h3 id="async-context-managers_1">Async Context Managers<a class="headerlink" href="#async-context-managers_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.async_debug_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">async_debug_context</span><span class="p">,</span> <span class="n">async_test_isolation</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="c1"># Debug context</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="k">async</span> <span class="k">with</span> <span class="n">async_debug_context</span><span class="p">()</span> <span class="k">as</span> <span class="n">debugger</span><span class="p">:</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>    <span class="c1"># Your async test code</span>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">some_async_operation</span><span class="p">()</span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>    <span class="c1"># Get debug info</span>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>    <span class="n">debug_info</span> <span class="o">=</span> <span class="n">debugger</span><span class="o">.</span><span class="n">get_debug_summary</span><span class="p">()</span>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="c1"># Test isolation</span>
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="k">async</span> <span class="k">with</span> <span class="n">async_test_isolation</span><span class="p">()</span> <span class="k">as</span> <span class="n">isolation</span><span class="p">:</span>
<a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a>    <span class="c1"># Your async test code</span>
<a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a>    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">some_async_operation</span><span class="p">()</span>
</code></pre></div>
<h3 id="async-operation-tracing_1">Async Operation Tracing<a class="headerlink" href="#async-operation-tracing_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.async_debug_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">trace_async_operation</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_async_operation</span><span class="p">():</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>    <span class="k">async</span> <span class="k">with</span> <span class="n">trace_async_operation</span><span class="p">(</span><span class="s2">&quot;database_query&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">trace</span><span class="p">:</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>        <span class="c1"># Your async operation</span>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">database</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM users&quot;</span><span class="p">)</span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>        <span class="c1"># Trace data is automatically collected</span>
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Operation duration: </span><span class="si">{</span><span class="n">trace</span><span class="o">.</span><span class="n">duration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="test-isolation-and-cleanup_1">Test Isolation and Cleanup<a class="headerlink" href="#test-isolation-and-cleanup_1" title="Permanent link">&para;</a></h2>
<h3 id="test-isolation-manager_1">Test Isolation Manager<a class="headerlink" href="#test-isolation-manager_1" title="Permanent link">&para;</a></h3>
<p>The <code>TestIsolationManager</code> provides comprehensive test isolation:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_isolation</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestIsolationManager</span><span class="p">,</span> <span class="n">test_isolation</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="c1"># Using the manager directly</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="n">manager</span> <span class="o">=</span> <span class="n">TestIsolationManager</span><span class="p">()</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="k">await</span> <span class="n">manager</span><span class="o">.</span><span class="n">start_isolation</span><span class="p">()</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>    <span class="c1"># Your test code</span>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>    <span class="k">pass</span>
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a><span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a>    <span class="k">await</span> <span class="n">manager</span><span class="o">.</span><span class="n">stop_isolation</span><span class="p">()</span>
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>
<a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a><span class="c1"># Using the context manager</span>
<a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a><span class="k">async</span> <span class="k">with</span> <span class="n">test_isolation</span><span class="p">()</span> <span class="k">as</span> <span class="n">isolation</span><span class="p">:</span>
<a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a>    <span class="c1"># Your test code</span>
<a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a>    <span class="k">pass</span>
</code></pre></div>
<h3 id="file-system-isolation_1">File System Isolation<a class="headerlink" href="#file-system-isolation_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_isolation</span><span class="w"> </span><span class="kn">import</span> <span class="n">isolated_filesystem</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="k">with</span> <span class="n">isolated_filesystem</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>    <span class="c1"># Create test files</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>    <span class="n">test_file</span> <span class="o">=</span> <span class="n">temp_dir</span> <span class="o">/</span> <span class="s2">&quot;test.txt&quot;</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>    <span class="n">test_file</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;test content&quot;</span><span class="p">)</span>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>    <span class="c1"># Files are automatically cleaned up</span>
</code></pre></div>
<h3 id="database-isolation_1">Database Isolation<a class="headerlink" href="#database-isolation_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_isolation</span><span class="w"> </span><span class="kn">import</span> <span class="n">isolated_database</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="k">async</span> <span class="k">with</span> <span class="n">isolated_database</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">db_isolation</span><span class="p">:</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>    <span class="c1"># Database is automatically cleaned up</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>    <span class="c1"># Test data is isolated</span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a>    <span class="k">pass</span>
</code></pre></div>
<h3 id="mock-isolation_1">Mock Isolation<a class="headerlink" href="#mock-isolation_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_isolation</span><span class="w"> </span><span class="kn">import</span> <span class="n">isolated_mocks</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="k">with</span> <span class="n">isolated_mocks</span><span class="p">()</span> <span class="k">as</span> <span class="n">mock_isolation</span><span class="p">:</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>    <span class="c1"># Mocks are automatically reset</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>    <span class="k">pass</span>
</code></pre></div>
<h2 id="performance-profiling_1">Performance Profiling<a class="headerlink" href="#performance-profiling_1" title="Permanent link">&para;</a></h2>
<h3 id="performance-profiler_1">Performance Profiler<a class="headerlink" href="#performance-profiler_1" title="Permanent link">&para;</a></h3>
<p>The <code>PerformanceProfiler</code> monitors test performance:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.performance_profiler</span><span class="w"> </span><span class="kn">import</span> <span class="n">PerformanceProfiler</span><span class="p">,</span> <span class="n">profile_test</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="c1"># Using the profiler directly</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="n">profiler</span> <span class="o">=</span> <span class="n">PerformanceProfiler</span><span class="p">()</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="k">with</span> <span class="n">profiler</span><span class="o">.</span><span class="n">profile_test</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">):</span>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>    <span class="c1"># Your test code</span>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>    <span class="k">pass</span>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="c1"># Using the context manager</span>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="k">with</span> <span class="n">profile_test</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">):</span>
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a>    <span class="c1"># Your test code</span>
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a>    <span class="k">pass</span>
</code></pre></div>
<h3 id="performance-monitoring_1">Performance Monitoring<a class="headerlink" href="#performance-monitoring_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.performance_profiler</span><span class="w"> </span><span class="kn">import</span> <span class="n">start_performance_monitoring</span><span class="p">,</span> <span class="n">stop_performance_monitoring</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="c1"># Start monitoring</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="n">start_performance_monitoring</span><span class="p">()</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a>    <span class="c1"># Your test code</span>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a>    <span class="k">pass</span>
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a>    <span class="c1"># Stop monitoring and generate report</span>
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a>    <span class="n">stop_performance_monitoring</span><span class="p">()</span>
<a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a>    <span class="n">save_performance_report</span><span class="p">()</span>
</code></pre></div>
<h3 id="performance-decorators_1">Performance Decorators<a class="headerlink" href="#performance-decorators_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.performance_profiler</span><span class="w"> </span><span class="kn">import</span> <span class="n">profile_performance</span><span class="p">,</span> <span class="n">profile_async_performance</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="nd">@profile_performance</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">)</span>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_example</span><span class="p">():</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a>    <span class="c1"># Your test code</span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>    <span class="k">pass</span>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a>
<a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="nd">@profile_async_performance</span><span class="p">(</span><span class="s2">&quot;async_test_example&quot;</span><span class="p">)</span>
<a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_async_example</span><span class="p">():</span>
<a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a>    <span class="c1"># Your async test code</span>
<a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a>    <span class="k">pass</span>
</code></pre></div>
<h3 id="performance-analysis_1">Performance Analysis<a class="headerlink" href="#performance-analysis_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.performance_profiler</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_analyzer</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="n">analyzer</span> <span class="o">=</span> <span class="n">get_analyzer</span><span class="p">()</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="n">analysis</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">analyze_performance_data</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overall assessment: </span><span class="si">{</span><span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;overall_assessment&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Issues: </span><span class="si">{</span><span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;issues&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recommendations: </span><span class="si">{</span><span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;recommendations&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="enhanced-output-formatting_1">Enhanced Output Formatting<a class="headerlink" href="#enhanced-output-formatting_1" title="Permanent link">&para;</a></h2>
<h3 id="test-output-formatter_1">Test Output Formatter<a class="headerlink" href="#test-output-formatter_1" title="Permanent link">&para;</a></h3>
<p>The <code>TestOutputFormatter</code> provides rich, timestamped output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_output_formatter</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestOutputFormatter</span><span class="p">,</span> <span class="n">print_header</span><span class="p">,</span> <span class="n">print_test_result</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="n">formatter</span> <span class="o">=</span> <span class="n">TestOutputFormatter</span><span class="p">()</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="c1"># Print formatted header</span>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="n">formatter</span><span class="o">.</span><span class="n">print_header</span><span class="p">(</span><span class="s2">&quot;Test Suite&quot;</span><span class="p">,</span> <span class="s2">&quot;Running all tests&quot;</span><span class="p">)</span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="c1"># Print test results</span>
<a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="n">formatter</span><span class="o">.</span><span class="n">print_test_result</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">,</span> <span class="s2">&quot;PASSED&quot;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
<a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a>
<a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="c1"># Print test failure</span>
<a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="n">formatter</span><span class="o">.</span><span class="n">print_test_failure</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">,</span> <span class="s2">&quot;Assertion failed&quot;</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span>
</code></pre></div>
<h3 id="convenience-functions_1">Convenience Functions<a class="headerlink" href="#convenience-functions_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_output_formatter</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>    <span class="n">print_header</span><span class="p">,</span> <span class="n">print_test_start</span><span class="p">,</span> <span class="n">print_test_result</span><span class="p">,</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>    <span class="n">print_test_failure</span><span class="p">,</span> <span class="n">print_progress</span><span class="p">,</span> <span class="n">print_summary</span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="p">)</span>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="c1"># Print test start</span>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="n">print_test_start</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">)</span>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a>
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="c1"># Print test result</span>
<a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="n">print_test_result</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">,</span> <span class="s2">&quot;PASSED&quot;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
<a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a>
<a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="c1"># Print progress</span>
<a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="n">print_progress</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;Running tests&quot;</span><span class="p">)</span>
<a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a>
<a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a><span class="c1"># Print summary</span>
<a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a><span class="n">print_summary</span><span class="p">()</span>
</code></pre></div>
<h3 id="output-configuration_1">Output Configuration<a class="headerlink" href="#output-configuration_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_output_formatter</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestOutputConfig</span><span class="p">,</span> <span class="n">TestOutputFormatter</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="n">config</span> <span class="o">=</span> <span class="n">TestOutputConfig</span><span class="p">(</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>    <span class="n">show_timestamps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>    <span class="n">show_colors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a>    <span class="n">show_emojis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a>    <span class="n">timestamp_format</span><span class="o">=</span><span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">,</span>
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a>    <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;test_results.log&quot;</span>
<a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="p">)</span>
<a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a>
<a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a><span class="n">formatter</span> <span class="o">=</span> <span class="n">TestOutputFormatter</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>
<h2 id="best-practices_1">Best Practices<a class="headerlink" href="#best-practices_1" title="Permanent link">&para;</a></h2>
<h3 id="1-use-failure-analysis-for-debugging_1">1. Use Failure Analysis for Debugging<a class="headerlink" href="#1-use-failure-analysis-for-debugging_1" title="Permanent link">&para;</a></h3>
<p>Always use the failure analyzer for test failures:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_example</span><span class="p">(</span><span class="n">failure_reporter</span><span class="p">):</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>        <span class="c1"># Your test code</span>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>        <span class="k">pass</span>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>        <span class="c1"># Generate failure report</span>
<a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a>        <span class="n">failure_context</span> <span class="o">=</span> <span class="n">failure_reporter</span><span class="o">.</span><span class="n">generate_failure_report</span><span class="p">(</span>
<a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a>            <span class="n">test_name</span><span class="o">=</span><span class="s2">&quot;test_example&quot;</span><span class="p">,</span>
<a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a>            <span class="n">exc_info</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
<a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a>        <span class="p">)</span>
<a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a>
<a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a>        <span class="c1"># Use suggestions for debugging</span>
<a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a>        <span class="k">for</span> <span class="n">suggestion</span> <span class="ow">in</span> <span class="n">failure_context</span><span class="o">.</span><span class="n">suggestions</span><span class="p">:</span>
<a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Suggestion: </span><span class="si">{</span><span class="n">suggestion</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a>
<a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a>        <span class="k">raise</span>
</code></pre></div>
<h3 id="2-profile-slow-tests_1">2. Profile Slow Tests<a class="headerlink" href="#2-profile-slow-tests_1" title="Permanent link">&para;</a></h3>
<p>Use performance profiling for tests that take longer than 1 second:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">performance</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_slow_operation</span><span class="p">():</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>    <span class="k">with</span> <span class="n">profile_test</span><span class="p">(</span><span class="s2">&quot;test_slow_operation&quot;</span><span class="p">):</span>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a>        <span class="c1"># Your slow test code</span>
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a>        <span class="k">pass</span>
</code></pre></div>
<h3 id="3-use-test-isolation_1">3. Use Test Isolation<a class="headerlink" href="#3-use-test-isolation_1" title="Permanent link">&para;</a></h3>
<p>Always use test isolation for tests that modify global state:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_database_operation</span><span class="p">(</span><span class="n">isolation_manager</span><span class="p">):</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>    <span class="k">await</span> <span class="n">isolation_manager</span><span class="o">.</span><span class="n">start_isolation</span><span class="p">()</span>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a>        <span class="c1"># Your test code</span>
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a>        <span class="k">pass</span>
<a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a>        <span class="k">await</span> <span class="n">isolation_manager</span><span class="o">.</span><span class="n">stop_isolation</span><span class="p">()</span>
</code></pre></div>
<h3 id="4-debug-async-tests_1">4. Debug Async Tests<a class="headerlink" href="#4-debug-async-tests_1" title="Permanent link">&para;</a></h3>
<p>Use async debugging for complex async operations:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_async_operation</span><span class="p">(</span><span class="n">async_debugger</span><span class="p">):</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>    <span class="k">await</span> <span class="n">async_debugger</span><span class="o">.</span><span class="n">start_monitoring</span><span class="p">()</span>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>        <span class="c1"># Your async test code</span>
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a>        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">some_async_operation</span><span class="p">()</span>
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a>
<a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a>        <span class="c1"># Check debug info</span>
<a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a>        <span class="n">debug_info</span> <span class="o">=</span> <span class="n">async_debugger</span><span class="o">.</span><span class="n">get_debug_summary</span><span class="p">()</span>
<a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a>        <span class="k">assert</span> <span class="n">debug_info</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;active&quot;</span>
<a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a>
<a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a>        <span class="k">await</span> <span class="n">async_debugger</span><span class="o">.</span><span class="n">stop_monitoring</span><span class="p">()</span>
</code></pre></div>
<h3 id="5-use-rich-output-formatting_1">5. Use Rich Output Formatting<a class="headerlink" href="#5-use-rich-output-formatting_1" title="Permanent link">&para;</a></h3>
<p>Use the output formatter for better test visibility:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_example</span><span class="p">(</span><span class="n">test_output_formatter</span><span class="p">):</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>    <span class="n">test_output_formatter</span><span class="o">.</span><span class="n">print_test_start</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">)</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a>        <span class="c1"># Your test code</span>
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">some_operation</span><span class="p">()</span>
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a>
<a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a>        <span class="n">test_output_formatter</span><span class="o">.</span><span class="n">print_test_result</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">,</span> <span class="s2">&quot;PASSED&quot;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
<a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a>        <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a>
<a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a>        <span class="n">test_output_formatter</span><span class="o">.</span><span class="n">print_test_failure</span><span class="p">(</span><span class="s2">&quot;test_example&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<a id="__codelineno-57-13" name="__codelineno-57-13" href="#__codelineno-57-13"></a>        <span class="k">raise</span>
</code></pre></div>
<h2 id="troubleshooting_1">Troubleshooting<a class="headerlink" href="#troubleshooting_1" title="Permanent link">&para;</a></h2>
<h3 id="common-issues_1">Common Issues<a class="headerlink" href="#common-issues_1" title="Permanent link">&para;</a></h3>
<h4 id="1-import-errors_1">1. Import Errors<a class="headerlink" href="#1-import-errors_1" title="Permanent link">&para;</a></h4>
<p>If you get import errors for the debugging utilities:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="c1"># Ensure the project root is in Python path</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PYTHONPATH</span><span class="si">}</span><span class="s2">:</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="c1"># Or add to your test file</span>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>import<span class="w"> </span>sys
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a>from<span class="w"> </span>pathlib<span class="w"> </span>import<span class="w"> </span>Path
<a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>sys.path.insert<span class="o">(</span><span class="m">0</span>,<span class="w"> </span>str<span class="o">(</span>Path<span class="o">(</span>__file__<span class="o">)</span>.parent.parent.parent<span class="o">))</span>
</code></pre></div>
<h4 id="2-async-debugging-issues_1">2. Async Debugging Issues<a class="headerlink" href="#2-async-debugging-issues_1" title="Permanent link">&para;</a></h4>
<p>If async debugging doesn't work:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="c1"># Ensure you&#39;re in an async context</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_example</span><span class="p">():</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>    <span class="n">debugger</span> <span class="o">=</span> <span class="n">AsyncDebugger</span><span class="p">()</span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>    <span class="k">await</span> <span class="n">debugger</span><span class="o">.</span><span class="n">start_monitoring</span><span class="p">()</span>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>        <span class="c1"># Your async code</span>
<a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a>        <span class="k">pass</span>
<a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a>        <span class="k">await</span> <span class="n">debugger</span><span class="o">.</span><span class="n">stop_monitoring</span><span class="p">()</span>
</code></pre></div>
<h4 id="3-performance-profiling-issues_1">3. Performance Profiling Issues<a class="headerlink" href="#3-performance-profiling-issues_1" title="Permanent link">&para;</a></h4>
<p>If performance profiling fails:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="c1"># Check if profiling is enabled</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.performance_profiler</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_profiler</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a>
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="n">profiler</span> <span class="o">=</span> <span class="n">get_profiler</span><span class="p">()</span>
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="k">if</span> <span class="n">profiler</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_cpu_profiling</span><span class="p">:</span>
<a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a>    <span class="c1"># Profiling is enabled</span>
<a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a>    <span class="k">pass</span>
</code></pre></div>
<h4 id="4-test-isolation-issues_1">4. Test Isolation Issues<a class="headerlink" href="#4-test-isolation-issues_1" title="Permanent link">&para;</a></h4>
<p>If test isolation doesn't work:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="c1"># Check isolation configuration</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tests.utils.test_isolation</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestIsolationManager</span>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="n">manager</span> <span class="o">=</span> <span class="n">TestIsolationManager</span><span class="p">()</span>
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="k">if</span> <span class="n">manager</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">database_cleanup</span><span class="p">:</span>
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a>    <span class="c1"># Database cleanup is enabled</span>
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a>    <span class="k">pass</span>
</code></pre></div>
<h3 id="debug-mode_1">Debug Mode<a class="headerlink" href="#debug-mode_1" title="Permanent link">&para;</a></h3>
<p>Enable debug mode for more verbose output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="c1"># Set debug environment variable</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">TEST_LOG_LEVEL</span><span class="o">=</span>DEBUG
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="c1"># Or use in test</span>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a>import<span class="w"> </span>logging
<a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a>logging.getLogger<span class="o">()</span>.setLevel<span class="o">(</span>logging.DEBUG<span class="o">)</span>
</code></pre></div>
<h3 id="performance-issues_1">Performance Issues<a class="headerlink" href="#performance-issues_1" title="Permanent link">&para;</a></h3>
<p>If tests are running slowly:</p>
<ol>
<li><strong>Check performance profiling</strong>: Use the profiler to identify bottlenecks</li>
<li><strong>Review test isolation</strong>: Ensure cleanup isn't taking too long</li>
<li><strong>Check async operations</strong>: Use async debugging to identify event loop issues</li>
<li><strong>Review mock usage</strong>: Ensure mocks aren't causing performance issues</li>
</ol>
<h3 id="memory-issues_1">Memory Issues<a class="headerlink" href="#memory-issues_1" title="Permanent link">&para;</a></h3>
<p>If tests are using too much memory:</p>
<ol>
<li><strong>Use memory profiling</strong>: Enable memory profiling in the performance profiler</li>
<li><strong>Check test isolation</strong>: Ensure proper cleanup of resources</li>
<li><strong>Review test data</strong>: Use smaller test datasets</li>
<li><strong>Check for memory leaks</strong>: Use the memory monitoring features</li>
</ol>
<h2 id="integration-with-test-runner_1">Integration with Test Runner<a class="headerlink" href="#integration-with-test-runner_1" title="Permanent link">&para;</a></h2>
<p>The debugging tools are automatically integrated with the test runner:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="c1"># Run tests with enhanced debugging</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>python3<span class="w"> </span>run_tests.py<span class="w"> </span>all<span class="w"> </span>--debug<span class="w"> </span>--verbose
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="c1"># Run performance tests with profiling</span>
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a>python3<span class="w"> </span>run_tests.py<span class="w"> </span>performance<span class="w"> </span>--coverage
<a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a>
<a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="c1"># Run tests with failure analysis</span>
<a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a>python3<span class="w"> </span>run_tests.py<span class="w"> </span>unit<span class="w"> </span>--debug
</code></pre></div>
<p>The test runner automatically:
- Enables failure analysis for failed tests
- Starts performance monitoring for performance tests
- Uses enhanced output formatting
- Provides debugging context in error messages</p>
<h2 id="conclusion_1">Conclusion<a class="headerlink" href="#conclusion_1" title="Permanent link">&para;</a></h2>
<p>The Huntable CTI Studio debugging tools provide comprehensive support for test debugging and optimization. By using these tools effectively, you can:</p>
<ul>
<li>Quickly identify and resolve test failures</li>
<li>Debug complex async operations</li>
<li>Monitor and optimize test performance</li>
<li>Ensure proper test isolation</li>
<li>Get rich, informative test output</li>
</ul>
<p>For more information, refer to the individual module documentation and examples in the <code>tests/utils/</code> directory.</p>
<hr />
<h1 id="debugging-missing-lmstudio-logs-in-evaluations">Debugging Missing LMStudio Logs in Evaluations<a class="headerlink" href="#debugging-missing-lmstudio-logs-in-evaluations" title="Permanent link">&para;</a></h1>
<h2 id="issue">Issue<a class="headerlink" href="#issue" title="Permanent link">&para;</a></h2>
<p>When running evaluations via <code>/mlops/agent-evals</code>, no LMStudio logs are being generated.</p>
<h2 id="root-causes">Root Causes<a class="headerlink" href="#root-causes" title="Permanent link">&para;</a></h2>
<h3 id="1-execution-not-running">1. Execution Not Running<a class="headerlink" href="#1-execution-not-running" title="Permanent link">&para;</a></h3>
<p>The workflow execution may be stuck in <code>pending</code> status and not actually executing.</p>
<p><strong>Check:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">article_id</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">current_step</span><span class="p">,</span><span class="w"> </span><span class="n">started_at</span><span class="p">,</span><span class="w"> </span><span class="n">error_message</span><span class="w"> </span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">agentic_workflow_executions</span><span class="w"> </span>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">article_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">68</span><span class="w"> </span>
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span>
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="k">LIMIT</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div></p>
<p><strong>Fix:</strong>
- Check Celery worker is running: <code>docker ps | grep cti_worker</code>
- Check worker logs: <code>docker logs cti_worker --tail 100</code>
- Retry stuck executions via UI or API</p>
<h3 id="2-hybrid-extractor-being-used">2. Hybrid Extractor Being Used<a class="headerlink" href="#2-hybrid-extractor-being-used" title="Permanent link">&para;</a></h3>
<p>If <code>use_hybrid_extractor=True</code>, the hybrid extractor runs first and may return results without calling LMStudio.</p>
<p><strong>Check:</strong>
- If a hybrid extractor is enabled, it may run first and return results without calling LMStudio. Verify workflow configuration and execution logs.</p>
<p><strong>Fix:</strong>
- Verify no hybrid extractor is enabled for the eval path (check env and workflow config).
- Check execution logs for hybrid extractor usage.</p>
<h3 id="3-execution-failing-before-llm-call">3. Execution Failing Before LLM Call<a class="headerlink" href="#3-execution-failing-before-llm-call" title="Permanent link">&para;</a></h3>
<p>The workflow may be failing at an earlier step (junk filter, OS detection, etc.).</p>
<p><strong>Check:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="k">SELECT</span><span class="w"> </span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="w">    </span><span class="n">id</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="w">    </span><span class="n">status</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="w">    </span><span class="n">current_step</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="w">    </span><span class="n">error_message</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="w">    </span><span class="n">error_log</span><span class="w"> </span>
<a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="k">FROM</span><span class="w"> </span><span class="n">agentic_workflow_executions</span><span class="w"> </span>
<a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">article_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">68</span><span class="w"> </span>
<a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span>
<a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a><span class="k">LIMIT</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div></p>
<p><strong>Fix:</strong>
- Review <code>error_log</code> JSON for step-specific errors
- Check application logs: <code>docker logs cti_web --tail 200</code></p>
<h3 id="4-lmstudio-not-receiving-requests">4. LMStudio Not Receiving Requests<a class="headerlink" href="#4-lmstudio-not-receiving-requests" title="Permanent link">&para;</a></h3>
<p>The HTTP requests may not be reaching LMStudio.</p>
<p><strong>Check:</strong>
- LMStudio is running and accessible
- <code>LMSTUDIO_API_URL</code> is correct (default: <code>http://host.docker.internal:1234/v1</code>)
- Network connectivity from container to host</p>
<p><strong>Verify:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="c1"># From inside container</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://host.docker.internal:1234/v1/chat/completions<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;model&quot;:&quot;test&quot;,&quot;messages&quot;:[{&quot;role&quot;:&quot;user&quot;,&quot;content&quot;:&quot;test&quot;}]}&#39;</span>
</code></pre></div></p>
<h3 id="5-log-level-too-high">5. Log Level Too High<a class="headerlink" href="#5-log-level-too-high" title="Permanent link">&para;</a></h3>
<p>LMStudio request logs are at INFO level.</p>
<p><strong>Check:</strong>
- Application log level: <code>LOG_LEVEL</code> env var
- Look for: <code>"Attempting LMStudio at {url} with model {model}"</code></p>
<p><strong>Fix:</strong>
- Set <code>LOG_LEVEL=INFO</code> or <code>LOG_LEVEL=DEBUG</code>
- Check logs: <code>docker logs cti_worker --tail 500 | grep -i lmstudio</code></p>
<h2 id="diagnostic-steps">Diagnostic Steps<a class="headerlink" href="#diagnostic-steps" title="Permanent link">&para;</a></h2>
<h3 id="step-1-verify-execution-status">Step 1: Verify Execution Status<a class="headerlink" href="#step-1-verify-execution-status" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.database.manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatabaseManager</span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.database.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgenticWorkflowExecutionTable</span>
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="n">db</span> <span class="o">=</span> <span class="n">DatabaseManager</span><span class="p">()</span>
<a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="n">session</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_session</span><span class="p">()</span>
<a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="n">exec</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">AgenticWorkflowExecutionTable</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
<a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a>    <span class="n">AgenticWorkflowExecutionTable</span><span class="o">.</span><span class="n">article_id</span> <span class="o">==</span> <span class="mi">68</span>
<a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">AgenticWorkflowExecutionTable</span><span class="o">.</span><span class="n">created_at</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a>
<a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status: </span><span class="si">{</span><span class="n">exec</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step: </span><span class="si">{</span><span class="n">exec</span><span class="o">.</span><span class="n">current_step</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">exec</span><span class="o">.</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-67-13" name="__codelineno-67-13" href="#__codelineno-67-13"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config: </span><span class="si">{</span><span class="n">exec</span><span class="o">.</span><span class="n">config_snapshot</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="step-2-check-worker-logs">Step 2: Check Worker Logs<a class="headerlink" href="#step-2-check-worker-logs" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>docker<span class="w"> </span>logs<span class="w"> </span>cti_worker<span class="w"> </span>--tail<span class="w"> </span><span class="m">500</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;(CmdlineExtract|LMStudio|extraction)&quot;</span>
</code></pre></div>
<h3 id="step-3-verify-lmstudio-connectivity">Step 3: Verify LMStudio Connectivity<a class="headerlink" href="#step-3-verify-lmstudio-connectivity" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>cti_worker<span class="w"> </span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://host.docker.internal:1234/v1/chat/completions<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;model&quot;:&quot;test&quot;,&quot;messages&quot;:[{&quot;role&quot;:&quot;user&quot;,&quot;content&quot;:&quot;test&quot;}]}&#39;</span>
</code></pre></div>
<h3 id="step-4-check-langfuse-traces">Step 4: Check Langfuse Traces<a class="headerlink" href="#step-4-check-langfuse-traces" title="Permanent link">&para;</a></h3>
<p>If Langfuse is enabled, check for traces:
- UI: Click " Trace" button on execution
- Or check Langfuse dashboard for session <code>workflow_exec_{execution_id}</code></p>
<h2 id="expected-log-sequence">Expected Log Sequence<a class="headerlink" href="#expected-log-sequence" title="Permanent link">&para;</a></h2>
<p>When evaluation runs correctly, you should see:</p>
<ol>
<li>
<p><strong>Workflow Start:</strong>
   <div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>INFO: Triggering agentic workflow for article 68 (execution_id: XXX)
</code></pre></div></p>
</li>
<li>
<p><strong>Extraction Agent Start:</strong>
   <div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>INFO: Running extraction agent CmdlineExtract (QA enabled: False)
</code></pre></div></p>
</li>
<li>
<p><strong>LMStudio Request:</strong>
   <div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a>INFO: Attempting LMStudio at http://host.docker.internal:1234/v1 with model {model} (CmdlineExtract extraction attempt 1)
</code></pre></div></p>
</li>
<li>
<p><strong>Response:</strong>
   <div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>INFO: CmdlineExtract raw response length: XXX chars
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>INFO: CmdlineExtract token usage: {...}
</code></pre></div></p>
</li>
</ol>
<h2 id="quick-fixes">Quick Fixes<a class="headerlink" href="#quick-fixes" title="Permanent link">&para;</a></h2>
<h3 id="force-llm-extraction-disable-hybrid">Force LLM Extraction (Disable Hybrid)<a class="headerlink" href="#force-llm-extraction-disable-hybrid" title="Permanent link">&para;</a></h3>
<p>Set in workflow config or execution snapshot:
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="n">config_snapshot</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>    <span class="o">...</span>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a>    <span class="s1">&#39;use_hybrid_extractor&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Force LLM extraction</span>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="enable-debug-logging">Enable Debug Logging<a class="headerlink" href="#enable-debug-logging" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>cti_web<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;export LOG_LEVEL=DEBUG&#39;</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="c1"># Or in docker-compose.yml:</span>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a>environment:
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="w">  </span>-<span class="w"> </span><span class="nv">LOG_LEVEL</span><span class="o">=</span>DEBUG
</code></pre></div>
<h3 id="retry-stuck-execution">Retry Stuck Execution<a class="headerlink" href="#retry-stuck-execution" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="c1"># Via API</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="n">POST</span> <span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">workflow</span><span class="o">/</span><span class="n">executions</span><span class="o">/</span><span class="p">{</span><span class="n">execution_id</span><span class="p">}</span><span class="o">/</span><span class="n">retry</span>
</code></pre></div>
<h2 id="related-files">Related Files<a class="headerlink" href="#related-files" title="Permanent link">&para;</a></h2>
<ul>
<li><code>src/workflows/agentic_workflow.py:944</code> - <code>use_hybrid_extractor=False</code> setting</li>
<li><code>src/services/llm_service.py:2555-2568</code> - Hybrid extractor logic</li>
<li><code>src/services/llm_service.py:2629-2650</code> - LLM call with tracing</li>
<li><code>src/services/llm_service.py:971-974</code> - LMStudio request logging</li>
</ul>
<hr />
<h1 id="troubleshooting-evaluation-executions-stuck-in-pending">Troubleshooting: Evaluation Executions Stuck in Pending<a class="headerlink" href="#troubleshooting-evaluation-executions-stuck-in-pending" title="Permanent link">&para;</a></h1>
<h2 id="root-cause">Root Cause<a class="headerlink" href="#root-cause" title="Permanent link">&para;</a></h2>
<p><strong>Issue:</strong> Evaluation executions are created with <code>status='pending'</code> but never start processing, resulting in no LMStudio logs.</p>
<p><strong>Root Cause:</strong> Celery worker is at capacity processing other tasks, preventing <code>trigger_agentic_workflow</code> tasks from being picked up.</p>
<h2 id="evidence">Evidence<a class="headerlink" href="#evidence" title="Permanent link">&para;</a></h2>
<h3 id="1-tasks-queued-but-not-processing">1. Tasks Queued But Not Processing<a class="headerlink" href="#1-tasks-queued-but-not-processing" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>cti_worker<span class="w"> </span>celery<span class="w"> </span>-A<span class="w"> </span>src.worker.celery_app<span class="w"> </span>inspect<span class="w"> </span>reserved
</code></pre></div>
<p>Shows multiple <code>trigger_agentic_workflow</code> tasks in the <code>workflows</code> or <code>default</code> queue:
- All have <code>'time_start': None</code> and <code>'worker_pid': None</code>
- Tasks are queued but not being executed</p>
<h3 id="2-worker-capacity">2. Worker Capacity<a class="headerlink" href="#2-worker-capacity" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Max concurrency:</strong> 12 workers</li>
<li><strong>Prefetch count:</strong> 12 tasks</li>
<li><strong>Active tasks:</strong> Worker slots are filled with long-running tasks (especially <code>check_all_sources</code>)</li>
</ul>
<h3 id="3-task-routing">3. Task Routing<a class="headerlink" href="#3-task-routing" title="Permanent link">&para;</a></h3>
<ul>
<li><code>trigger_agentic_workflow</code>  <code>workflows</code> queue (as configured in <code>src/worker/celeryconfig.py</code>). Default queue used when no specific routing is set.</li>
<li><code>check_all_sources</code>  <code>source_checks</code> queue</li>
<li>Worker processes both queues, but <code>source_checks</code> tasks are long-running and block capacity</li>
</ul>
<h2 id="why-this-happens">Why This Happens<a class="headerlink" href="#why-this-happens" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Source check tasks are long-running</strong> - They scrape websites, which can take minutes</li>
<li><strong>Worker prefetch fills up</strong> - Worker reserves 12 tasks, but if they're all long-running, new tasks wait</li>
<li><strong>No priority mechanism</strong> - Workflow tasks have same priority as source checks</li>
<li><strong>Sequential processing</strong> - Tasks are processed in order, so workflow tasks wait behind source checks</li>
</ol>
<h2 id="solutions">Solutions<a class="headerlink" href="#solutions" title="Permanent link">&para;</a></h2>
<h3 id="option-1-increase-worker-concurrency-quick-fix">Option 1: Increase Worker Concurrency (Quick Fix)<a class="headerlink" href="#option-1-increase-worker-concurrency-quick-fix" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="c1"># In docker-compose.yml, increase worker concurrency</span>
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>celery<span class="w"> </span>-A<span class="w"> </span>src.worker.celery_app<span class="w"> </span>worker<span class="w"> </span>--concurrency<span class="o">=</span><span class="m">24</span>
</code></pre></div>
<p><strong>Pros:</strong> More capacity for parallel processing
<strong>Cons:</strong> Higher memory usage</p>
<h3 id="option-2-dedicated-workflow-queue-recommended">Option 2: Dedicated Workflow Queue (Recommended)<a class="headerlink" href="#option-2-dedicated-workflow-queue-recommended" title="Permanent link">&para;</a></h3>
<p>Create a separate queue for workflow tasks with dedicated workers:</p>
<p><strong>In <code>src/worker/celeryconfig.py</code>:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="n">task_routes</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a>    <span class="s1">&#39;src.worker.celery_app.check_all_sources&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;queue&#39;</span><span class="p">:</span> <span class="s1">&#39;source_checks&#39;</span><span class="p">},</span>
<a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a>    <span class="s1">&#39;src.worker.celery_app.trigger_agentic_workflow&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;queue&#39;</span><span class="p">:</span> <span class="s1">&#39;workflows&#39;</span><span class="p">},</span>  <span class="c1"># Add this</span>
<a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a>    <span class="c1"># ... other routes</span>
<a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="p">}</span>
<a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a>
<a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a><span class="n">task_queues</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a>    <span class="c1"># ... existing queues</span>
<a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a>    <span class="s1">&#39;workflows&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a>        <span class="s1">&#39;exchange&#39;</span><span class="p">:</span> <span class="s1">&#39;workflows&#39;</span><span class="p">,</span>
<a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a>        <span class="s1">&#39;routing_key&#39;</span><span class="p">:</span> <span class="s1">&#39;workflows&#39;</span><span class="p">,</span>
<a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a>    <span class="p">},</span>
<a id="__codelineno-79-13" name="__codelineno-79-13" href="#__codelineno-79-13"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>Start dedicated worker:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>celery<span class="w"> </span>-A<span class="w"> </span>src.worker.celery_app<span class="w"> </span>worker<span class="w"> </span>-Q<span class="w"> </span>workflows<span class="w"> </span>--concurrency<span class="o">=</span><span class="m">4</span>
</code></pre></div></p>
<p><strong>Pros:</strong> Workflow tasks never blocked by source checks
<strong>Cons:</strong> Requires additional worker process</p>
<h3 id="option-3-reduce-prefetch-multiplier">Option 3: Reduce Prefetch Multiplier<a class="headerlink" href="#option-3-reduce-prefetch-multiplier" title="Permanent link">&para;</a></h3>
<p><strong>In <code>src/worker/celeryconfig.py</code>:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="n">worker_prefetch_multiplier</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Already set, but ensure it&#39;s low</span>
</code></pre></div></p>
<p>Lower prefetch means worker doesn't reserve as many tasks, allowing faster task rotation.</p>
<h3 id="option-4-priority-queue-advanced">Option 4: Priority Queue (Advanced)<a class="headerlink" href="#option-4-priority-queue-advanced" title="Permanent link">&para;</a></h3>
<p>Use Celery priority queues to give workflow tasks higher priority than source checks.</p>
<h3 id="option-5-manual-trigger-workaround">Option 5: Manual Trigger (Workaround)<a class="headerlink" href="#option-5-manual-trigger-workaround" title="Permanent link">&para;</a></h3>
<p>For immediate needs, manually trigger stuck executions:
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.worker.celery_app</span><span class="w"> </span><span class="kn">import</span> <span class="n">trigger_agentic_workflow</span>
<a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="n">trigger_agentic_workflow</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">article_id</span><span class="p">)</span>
</code></pre></div></p>
<h2 id="diagnostic-commands">Diagnostic Commands<a class="headerlink" href="#diagnostic-commands" title="Permanent link">&para;</a></h2>
<h3 id="check-queued-tasks">Check Queued Tasks<a class="headerlink" href="#check-queued-tasks" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>cti_worker<span class="w"> </span>celery<span class="w"> </span>-A<span class="w"> </span>src.worker.celery_app<span class="w"> </span>inspect<span class="w"> </span>reserved<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>trigger_agentic_workflow
</code></pre></div>
<h3 id="check-active-tasks">Check Active Tasks<a class="headerlink" href="#check-active-tasks" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>cti_worker<span class="w"> </span>celery<span class="w"> </span>-A<span class="w"> </span>src.worker.celery_app<span class="w"> </span>inspect<span class="w"> </span>active
</code></pre></div>
<h3 id="check-worker-stats">Check Worker Stats<a class="headerlink" href="#check-worker-stats" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>cti_worker<span class="w"> </span>celery<span class="w"> </span>-A<span class="w"> </span>src.worker.celery_app<span class="w"> </span>inspect<span class="w"> </span>stats
</code></pre></div>
<h3 id="check-pending-executions">Check Pending Executions<a class="headerlink" href="#check-pending-executions" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">article_id</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span>
<a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">agentic_workflow_executions</span><span class="w"> </span>
<a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;pending&#39;</span><span class="w"> </span>
<a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</code></pre></div>
<h2 id="immediate-workaround">Immediate Workaround<a class="headerlink" href="#immediate-workaround" title="Permanent link">&para;</a></h2>
<p>If executions are stuck, manually trigger them:
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.database.manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatabaseManager</span>
<a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.database.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgenticWorkflowExecutionTable</span>
<a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">src.worker.celery_app</span><span class="w"> </span><span class="kn">import</span> <span class="n">trigger_agentic_workflow</span>
<a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a>
<a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a><span class="n">db</span> <span class="o">=</span> <span class="n">DatabaseManager</span><span class="p">()</span>
<a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="n">session</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_session</span><span class="p">()</span>
<a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a><span class="n">pending</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">AgenticWorkflowExecutionTable</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
<a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a>    <span class="n">AgenticWorkflowExecutionTable</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;pending&#39;</span>
<a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a>
<a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a><span class="k">for</span> <span class="n">exec</span> <span class="ow">in</span> <span class="n">pending</span><span class="p">:</span>
<a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a>    <span class="n">trigger_agentic_workflow</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">exec</span><span class="o">.</span><span class="n">article_id</span><span class="p">)</span>
</code></pre></div></p>
<h2 id="prevention">Prevention<a class="headerlink" href="#prevention" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Monitor queue depth</strong> - Alert when <code>default</code> queue has &gt; 10 tasks</li>
<li><strong>Separate queues</strong> - Use dedicated queue for workflow tasks</li>
<li><strong>Task timeouts</strong> - Set reasonable timeouts for long-running tasks</li>
<li><strong>Worker scaling</strong> - Scale workers based on queue depth</li>
</ol>
<h2 id="related-files_1">Related Files<a class="headerlink" href="#related-files_1" title="Permanent link">&para;</a></h2>
<ul>
<li><code>src/worker/celeryconfig.py</code> - Celery configuration</li>
<li><code>src/worker/celery_app.py:629</code> - <code>trigger_agentic_workflow</code> task definition</li>
<li><code>src/web/routes/evaluation_api.py:862</code> - Task dispatch in eval API</li>
</ul>
<hr />
<p><em>Last updated: February 2025</em></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["content.code.copy", "navigation.tabs", "navigation.sections", "toc.integrate"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>