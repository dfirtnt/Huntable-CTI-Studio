# CTI Scraper Test Environment Configuration
# This file defines standardized test environment variables
# Used across localhost, Docker, and CI/CD contexts

# =============================================================================
# TEST ENVIRONMENT IDENTIFICATION
# =============================================================================

# Environment type (test, development, staging, production)
ENVIRONMENT=test

# Test mode flag
TESTING=true

# Test database prefix to avoid conflicts
TEST_DB_PREFIX=test_

# Test isolation level (process, class, function)
TEST_ISOLATION_LEVEL=function

# =============================================================================
# DATABASE CONFIGURATION (TEST-SPECIFIC)
# =============================================================================

# Test Database URLs - automatically detected based on context
# Localhost: postgresql+asyncpg://test_user:test_password@localhost:5432/test_cti_scraper
# Docker: postgresql+asyncpg://cti_user:test_password@postgres:5432/test_cti_scraper
# CI: postgresql+asyncpg://postgres:postgres@localhost:5432/test_cti_scraper

# Database connection details (context-aware)
POSTGRES_DB=test_cti_scraper
POSTGRES_USER=test_user
POSTGRES_PASSWORD=test_password
POSTGRES_HOST=localhost
POSTGRES_PORT=5432

# Test database pool settings (smaller for tests)
DB_POOL_SIZE=5
DB_MAX_OVERFLOW=10
DB_POOL_PRE_PING=true
DB_POOL_RECYCLE=1800

# Test database isolation
DB_ISOLATION_LEVEL=READ_COMMITTED
DB_AUTOCOMMIT=false

# =============================================================================
# REDIS CONFIGURATION (TEST-SPECIFIC)
# =============================================================================

# Test Redis URLs - automatically detected based on context
# Localhost: redis://localhost:6379/1
# Docker: redis://redis:6379/1
# CI: redis://localhost:6379/1

# Redis connection details (context-aware)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=1

# Test Redis settings
REDIS_MAX_CONNECTIONS=10
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5

# =============================================================================
# WEB SERVER CONFIGURATION (TEST-SPECIFIC)
# =============================================================================

# Test server settings
HOST=127.0.0.1
PORT=8002
TEST_PORT=8002

# Test worker configuration (minimal)
WORKERS=1
MAX_WORKERS=2
WORKER_TIMEOUT=60
REQUEST_TIMEOUT=10

# Test-specific settings
RELOAD=false
DEBUG=true
LOG_LEVEL=DEBUG

# =============================================================================
# SECURITY CONFIGURATION (TEST-SPECIFIC)
# =============================================================================

# Test security settings (relaxed for testing)
SECRET_KEY=test-secret-key-not-for-production
ALLOWED_HOSTS=localhost,127.0.0.1,0.0.0.0,testserver
CORS_ORIGINS=["http://localhost:3000", "http://localhost:8002", "http://testserver"]
TRUSTED_HOSTS=["localhost", "127.0.0.1", "0.0.0.0", "testserver"]

# Test rate limiting (relaxed)
RATE_LIMIT_PER_MINUTE=1000
API_RATE_LIMIT_PER_MINUTE=1000

# =============================================================================
# CELERY CONFIGURATION (TEST-SPECIFIC)
# =============================================================================

# Test Celery settings
CELERY_TASK_ALWAYS_EAGER=true
CELERY_TASK_EAGER_PROPAGATES=true
CELERY_WORKER_CONCURRENCY=1
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=["json"]

# Test broker settings
CELERY_BROKER_URL=redis://localhost:6379/1
CELERY_RESULT_BACKEND=redis://localhost:6379/1

# =============================================================================
# CONTENT PROCESSING (TEST-SPECIFIC)
# =============================================================================

# Test content processing limits (smaller for faster tests)
MAX_CONTENT_LENGTH=1048576  # 1MB
CONTENT_CLEANUP_ENABLED=true
GARBAGE_DETECTION_ENABLED=true

# Test content filtering (disabled for consistent results)
THREAT_HUNTING_KEYWORDS_ENABLED=false
PERFECT_DISCRIMINATOR_ENABLED=false
CONTENT_FILTER_ENABLED=false
CONTENT_FILTERING_ENABLED=false

# Test scoring settings
MIN_CONTENT_LENGTH=50
MIN_WORD_COUNT=10

# =============================================================================
# LLM CONFIGURATION (TEST-SPECIFIC)
# =============================================================================

# Test LLM settings (mocked for most tests)
LLM_API_URL=http://localhost:11434
LLM_MODEL=test-model
LLM_TEMPERATURE=0.0
LLM_MAX_TOKENS=100
OLLAMA_CONTENT_LIMIT=10000

# Test API keys (dummy values)
CHATGPT_API_KEY=test-openai-key
ANTHROPIC_API_KEY=test-anthropic-key
OPENAI_API_KEY=test-openai-key

# Test LLM settings
USE_LLM_RESPONSES=false
MOCK_LLM_RESPONSES=true

# =============================================================================
# MONITORING AND LOGGING (TEST-SPECIFIC)
# =============================================================================

# Test monitoring (disabled)
ENABLE_METRICS=false
METRICS_PORT=9091

# Test logging
LOG_FORMAT=text
LOG_FILE=test-results/test.log
LOG_LEVEL=DEBUG

# Test-specific logging
TEST_LOG_LEVEL=DEBUG
TEST_LOG_FORMAT=%(asctime)s - %(name)s - %(levelname)s - %(message)s

# =============================================================================
# TEST EXECUTION SETTINGS
# =============================================================================

# Test execution configuration
PYTEST_TIMEOUT=300
PYTEST_MAX_FAILURES=10
PYTEST_VERBOSE=true
PYTEST_COV_THRESHOLD=70

# Test data settings
TEST_DATA_DIR=test-data
TEST_FIXTURES_DIR=tests/fixtures
TEST_TEMP_DIR=test-results/temp

# Test isolation settings
TEST_DB_CLEANUP=true
TEST_CACHE_CLEANUP=true
TEST_FILE_CLEANUP=true

# =============================================================================
# PLAYWRIGHT CONFIGURATION (TEST-SPECIFIC)
# =============================================================================

# Playwright test settings
PLAYWRIGHT_BROWSER=chromium
PLAYWRIGHT_HEADLESS=true
PLAYWRIGHT_SLOW_MO=100
PLAYWRIGHT_TIMEOUT=30000
PLAYWRIGHT_VIDEO_DIR=test-results/videos
PLAYWRIGHT_TRACE_DIR=test-results/traces

# Test browser settings
BROWSER_WIDTH=1280
BROWSER_HEIGHT=720
BROWSER_IGNORE_HTTPS=true

# =============================================================================
# TEST COVERAGE AND REPORTING
# =============================================================================

# Coverage settings
COVERAGE_ENABLED=true
COVERAGE_THRESHOLD=70
COVERAGE_REPORT_FORMATS=html,xml,term
COVERAGE_REPORT_DIR=test-results/coverage

# Test reporting
TEST_REPORT_FORMAT=html
TEST_REPORT_DIR=test-results/reports
ALLURE_RESULTS_DIR=test-results/allure-results
ALLURE_REPORT_DIR=test-results/allure-report

# =============================================================================
# PERFORMANCE TESTING
# =============================================================================

# Performance test settings
PERFORMANCE_TEST_ENABLED=false
PERFORMANCE_TEST_TIMEOUT=60
PERFORMANCE_TEST_CONCURRENT_USERS=10
PERFORMANCE_TEST_DURATION=30

# Load test settings
LOAD_TEST_ENABLED=false
LOAD_TEST_RAMP_UP_TIME=10
LOAD_TEST_STEADY_STATE_TIME=30

# =============================================================================
# INTEGRATION TEST SETTINGS
# =============================================================================

# Integration test configuration
INTEGRATION_TEST_ENABLED=true
INTEGRATION_TEST_TIMEOUT=120
INTEGRATION_TEST_RETRIES=3

# External service mocking
MOCK_EXTERNAL_SERVICES=true
MOCK_HTTP_REQUESTS=true
MOCK_DATABASE_OPERATIONS=false

# =============================================================================
# CONTEXT-SPECIFIC OVERRIDES
# =============================================================================

# Docker context overrides
# These will be set automatically in Docker environments
# POSTGRES_HOST=postgres
# REDIS_HOST=redis
# HOST=0.0.0.0

# CI context overrides
# These will be set automatically in CI environments
# POSTGRES_USER=postgres
# POSTGRES_PASSWORD=postgres
# REDIS_PASSWORD=

# =============================================================================
# NOTES
# =============================================================================

# 1. This file serves as a template for test environments
# 2. Context-specific values are automatically detected and overridden
# 3. Test isolation is maintained through separate databases and Redis DBs
# 4. All external services are mocked by default for consistent testing
# 5. Performance tests are disabled by default to avoid CI timeouts
# 6. Coverage thresholds are set lower for test environments
# 7. Logging is set to DEBUG for better test debugging
